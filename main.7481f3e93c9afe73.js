(self.webpackChunktestProject=self.webpackChunktestProject||[]).push([[179],{667:(md,Rl,Fl)=>{"use strict";function Tn(e){return"function"==typeof e}function Nc(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const gd=Nc(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,a)=>`${a+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function y(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Hn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const u of n)u.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(Tn(r))try{r()}catch(u){t=u instanceof gd?u.errors:[u]}const{_finalizers:a}=this;if(a){this._finalizers=null;for(const u of a)try{Xt(u)}catch(p){t=t??[],p instanceof gd?t=[...t,...p.errors]:t.push(p)}}if(t)throw new gd(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Xt(t);else{if(t instanceof Hn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&y(n,t)}remove(t){const{_finalizers:n}=this;n&&y(n,t),t instanceof Hn&&t._removeParent(this)}}Hn.EMPTY=(()=>{const e=new Hn;return e.closed=!0,e})();const So=Hn.EMPTY;function ao(e){return e instanceof Hn||e&&"closed"in e&&Tn(e.remove)&&Tn(e.add)&&Tn(e.unsubscribe)}function Xt(e){Tn(e)?e():e.unsubscribe()}const xe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Mo={setTimeout(e,t,...n){const{delegate:r}=Mo;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Mo;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function wi(e){Mo.setTimeout(()=>{const{onUnhandledError:t}=xe;if(!t)throw e;t(e)})}function On(){}const Ll=Vr("C",void 0,void 0);function Vr(e,t,n){return{kind:e,value:t,error:n}}let Hi=null;function Un(e){if(xe.useDeprecatedSynchronousErrorHandling){const t=!Hi;if(t&&(Hi={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=Hi;if(Hi=null,n)throw r}}else e()}class co extends Hn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ao(t)&&t.add(this)):this.destination=Qo}static create(t,n,r){return new Gi(t,n,r)}next(t){this.isStopped?uo(function To(e){return Vr("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?uo(function Wa(e){return Vr("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?uo(Ll,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ci=Function.prototype.bind;function la(e,t){return Ci.call(e,t)}class Ao{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){Di(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){Di(r)}else Di(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Di(n)}}}class Gi extends co{constructor(t,n,r){let a;if(super(),Tn(t)||!t)a={next:t??void 0,error:n??void 0,complete:r??void 0};else{let u;this&&xe.useDeprecatedNextContext?(u=Object.create(t),u.unsubscribe=()=>this.unsubscribe(),a={next:t.next&&la(t.next,u),error:t.error&&la(t.error,u),complete:t.complete&&la(t.complete,u)}):a=t}this.destination=new Ao(a)}}function Di(e){xe.useDeprecatedSynchronousErrorHandling?function lo(e){xe.useDeprecatedSynchronousErrorHandling&&Hi&&(Hi.errorThrown=!0,Hi.error=e)}(e):wi(e)}function uo(e,t){const{onStoppedNotification:n}=xe;n&&Mo.setTimeout(()=>n(e,t))}const Qo={closed:!0,next:On,error:function ca(e){throw e},complete:On},at="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ur(e){return e}function Ei(e){return 0===e.length?Ur:1===e.length?e[0]:function(n){return e.reduce((r,a)=>a(r),n)}}let on=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,a){const u=function ha(e){return e&&e instanceof co||function ua(e){return e&&Tn(e.next)&&Tn(e.error)&&Tn(e.complete)}(e)&&ao(e)}(n)?n:new Gi(n,r,a);return Un(()=>{const{operator:p,source:v}=this;u.add(p?p.call(u,v):v?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=es(r))((a,u)=>{const p=new Gi({next:v=>{try{n(v)}catch(w){u(w),p.unsubscribe()}},error:u,complete:a});this.subscribe(p)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[at](){return this}pipe(...n){return Ei(n)(this)}toPromise(n){return new(n=es(n))((r,a)=>{let u;this.subscribe(p=>u=p,p=>a(p),()=>r(u))})}}return e.create=t=>new e(t),e})();function es(e){var t;return null!==(t=e??xe.Promise)&&void 0!==t?t:Promise}const da=Nc(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let rr=(()=>{class e extends on{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new ko(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new da}next(n){Un(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){Un(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){Un(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:a,observers:u}=this;return r||a?So:(this.currentObservers=null,u.push(n),new Hn(()=>{this.currentObservers=null,y(u,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:a,isStopped:u}=this;r?n.error(a):u&&n.complete()}asObservable(){const n=new on;return n.source=this,n}}return e.create=(t,n)=>new ko(t,n),e})();class ko extends rr{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:So}}function Ro(e){return Tn(e?.lift)}function An(e){return t=>{if(Ro(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Qt(e,t,n,r,a){return new pa(e,t,n,r,a)}class pa extends co{constructor(t,n,r,a,u,p){super(t),this.onFinalize=u,this.shouldUnsubscribe=p,this._next=n?function(v){try{n(v)}catch(w){t.error(w)}}:super._next,this._error=a?function(v){try{a(v)}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function At(e,t){return An((n,r)=>{let a=0;n.subscribe(Qt(r,u=>{r.next(e.call(t,u,a++))}))})}function ve(e){return this instanceof ve?(this.v=e,this):new ve(e)}function Oe(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,r=n.apply(e,t||[]),u=[];return a={},p("next"),p("throw"),p("return"),a[Symbol.asyncIterator]=function(){return this},a;function p(q){r[q]&&(a[q]=function(Y){return new Promise(function(le,Ce){u.push([q,Y,le,Ce])>1||v(q,Y)})})}function v(q,Y){try{!function w(q){q.value instanceof ve?Promise.resolve(q.value.v).then(I,k):N(u[0][2],q)}(r[q](Y))}catch(le){N(u[0][3],le)}}function I(q){v("next",q)}function k(q){v("throw",q)}function N(q,Y){q(Y),u.shift(),u.length&&v(u[0][0],u[0][1])}}function Wi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function ma(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(u){n[u]=e[u]&&function(p){return new Promise(function(v,w){!function a(u,p,v,w){Promise.resolve(w).then(function(I){u({value:I,done:v})},p)}(v,w,(p=e[u](p)).done,p.value)})}}}const _t=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function hr(e){return Tn(e?.then)}function No(e){return Tn(e[at])}function pt(e){return Symbol.asyncIterator&&Tn(e?.[Symbol.asyncIterator])}function ho(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Rs=function dr(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Xn(e){return Tn(e?.[Rs])}function Ir(e){return Oe(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:a}=yield ve(n.read());if(a)return yield ve(void 0);yield yield ve(r)}}finally{n.releaseLock()}})}function hn(e){return Tn(e?.getReader)}function _r(e){if(e instanceof on)return e;if(null!=e){if(No(e))return function po(e){return new on(t=>{const n=e[at]();if(Tn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(_t(e))return function Fs(e){return new on(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(hr(e))return function Ls(e){return new on(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,wi)})}(e);if(pt(e))return rs(e);if(Xn(e))return function ya(e){return new on(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(hn(e))return function G(e){return rs(Ir(e))}(e)}throw ho(e)}function rs(e){return new on(t=>{(function P(e,t){var n,r,a,u;return function jt(e,t,n,r){return new(n||(n=Promise))(function(u,p){function v(k){try{I(r.next(k))}catch(N){p(N)}}function w(k){try{I(r.throw(k))}catch(N){p(N)}}function I(k){k.done?u(k.value):function a(u){return u instanceof n?u:new n(function(p){p(u)})}(k.value).then(v,w)}I((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Wi(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(p){a={error:p}}finally{try{r&&!r.done&&(u=n.return)&&(yield u.call(n))}finally{if(a)throw a.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function O(e,t,n,r=0,a=!1){const u=t.schedule(function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(u),!a)return u}function $(e,t,n=1/0){return Tn(t)?$((r,a)=>At((u,p)=>t(r,u,a,p))(_r(e(r,a))),n):("number"==typeof t&&(n=t),An((r,a)=>function H(e,t,n,r,a,u,p,v){const w=[];let I=0,k=0,N=!1;const q=()=>{N&&!w.length&&!I&&t.complete()},Y=Ce=>I<r?le(Ce):w.push(Ce),le=Ce=>{u&&t.next(Ce),I++;let Me=!1;_r(n(Ce,k++)).subscribe(Qt(t,Pe=>{a?.(Pe),u?Y(Pe):t.next(Pe)},()=>{Me=!0},void 0,()=>{if(Me)try{for(I--;w.length&&I<r;){const Pe=w.shift();p?O(t,p,()=>le(Pe)):le(Pe)}q()}catch(Pe){t.error(Pe)}}))};return e.subscribe(Qt(t,Y,()=>{N=!0,q()})),()=>{v?.()}}(r,a,e,n)))}function ee(e=1/0){return $(Ur,e)}const ie=new on(e=>e.complete());function ye(e){return e[e.length-1]}function Ee(e){return Tn(ye(e))?e.pop():void 0}function ge(e){return function oe(e){return e&&Tn(e.schedule)}(ye(e))?e.pop():void 0}function Qe(e,t=0){return An((n,r)=>{n.subscribe(Qt(r,a=>O(r,e,()=>r.next(a),t),()=>O(r,e,()=>r.complete(),t),a=>O(r,e,()=>r.error(a),t)))})}function Be(e,t=0){return An((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function It(e,t){if(!e)throw new Error("Iterable cannot be null");return new on(n=>{O(n,t,()=>{const r=e[Symbol.asyncIterator]();O(n,t,()=>{r.next().then(a=>{a.done?n.complete():n.next(a.value)})},0,!0)})})}function zt(e,t){return t?function _n(e,t){if(null!=e){if(No(e))return function st(e,t){return _r(e).pipe(Be(t),Qe(t))}(e,t);if(_t(e))return function $t(e,t){return new on(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(hr(e))return function ct(e,t){return _r(e).pipe(Be(t),Qe(t))}(e,t);if(pt(e))return It(e,t);if(Xn(e))return function ft(e,t){return new on(n=>{let r;return O(n,t,()=>{r=e[Rs](),O(n,t,()=>{let a,u;try{({value:a,done:u}=r.next())}catch(p){return void n.error(p)}u?n.complete():n.next(a)},0,!0)}),()=>Tn(r?.return)&&r.return()})}(e,t);if(hn(e))return function Ht(e,t){return It(Ir(e),t)}(e,t)}throw ho(e)}(e,t):_r(e)}function is(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new Gi({next:()=>{r.unsubscribe(),e()}});return t(...n).subscribe(r)}function dn(e){for(let t in e)if(e[t]===dn)return t;throw Error("Could not find renamed property on target object.")}function vn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(vn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Ja(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Ku=dn({__forward_ref__:dn});function Cn(e){return e.__forward_ref__=Cn,e.toString=function(){return vn(this())},e}function mt(e){return function zc(e){return"function"==typeof e&&e.hasOwnProperty(Ku)&&e.__forward_ref__===Cn}(e)?e():e}class ze extends Error{constructor(t,n){super(function Ya(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}(t,n)),this.code=t}}function Ct(e){return"string"==typeof e?e:null==e?"":String(e)}function Ns(e,t){throw new ze(-201,!1)}function pi(e,t){null==e&&function an(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function $e(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function jr(e){return{providers:e.providers||[],imports:e.imports||[]}}function os(e){return Hc(e,zs)||Hc(e,Bl)}function Hc(e,t){return e.hasOwnProperty(t)?e[t]:null}function tl(e){return e&&(e.hasOwnProperty(nl)||e.hasOwnProperty(Vl))?e[nl]:null}const zs=dn({\u0275prov:dn}),nl=dn({\u0275inj:dn}),Bl=dn({ngInjectableDef:dn}),Vl=dn({ngInjectorDef:dn});var ut=(()=>((ut=ut||{})[ut.Default=0]="Default",ut[ut.Host=1]="Host",ut[ut.Self=2]="Self",ut[ut.SkipSelf=4]="SkipSelf",ut[ut.Optional=8]="Optional",ut))();let rl;function mi(e){const t=rl;return rl=e,t}function qc(e,t,n){const r=os(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&ut.Optional?null:void 0!==t?t:void Ns(vn(e))}function ss(e){return{toString:e}.toString()}var Zi=(()=>((Zi=Zi||{})[Zi.OnPush=0]="OnPush",Zi[Zi.Default=1]="Default",Zi))(),fo=(()=>{return(e=fo||(fo={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",fo;var e})();const En=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),as={},en=[],zo=dn({\u0275cmp:dn}),jl=dn({\u0275dir:dn}),$l=dn({\u0275pipe:dn}),ol=dn({\u0275mod:dn}),$r=dn({\u0275fac:dn}),va=dn({__NG_ELEMENT_ID__:dn});let xa=0;function Kt(e){return ss(()=>{const n=!0===e.standalone,r={},a={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Zi.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||en,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||fo.Emulated,id:"c"+xa++,styles:e.styles||en,_:null,setInput:null,schemas:e.schemas||null,tView:null},u=e.dependencies,p=e.features;return a.inputs=ba(e.inputs,r),a.outputs=ba(e.outputs),p&&p.forEach(v=>v(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(Rt).filter(Jt):null,a.pipeDefs=u?()=>("function"==typeof u?u():u).map(Gr).filter(Jt):null,a})}function Rt(e){return xn(e)||Tr(e)}function Jt(e){return null!==e}function Ft(e){return ss(()=>({type:e.type,bootstrap:e.bootstrap||en,declarations:e.declarations||en,imports:e.imports||en,exports:e.exports||en,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function ba(e,t){if(null==e)return as;const n={};for(const r in e)if(e.hasOwnProperty(r)){let a=e[r],u=a;Array.isArray(a)&&(u=a[1],a=a[0]),n[a]=r,t&&(t[a]=u)}return n}const lt=Kt;function Hr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function xn(e){return e[zo]||null}function Tr(e){return e[jl]||null}function Gr(e){return e[$l]||null}function vr(e,t){const n=e[ol]||null;if(!n&&!0===t)throw new Error(`Type ${vn(e)} does not have '\u0275mod' property.`);return n}function In(e){return Array.isArray(e)&&"object"==typeof e[1]}function qr(e){return Array.isArray(e)&&!0===e[1]}function Wr(e){return 0!=(8&e.flags)}function Gl(e){return 2==(2&e.flags)}function Ki(e){return 1==(1&e.flags)}function Ai(e){return null!==e.template}function $o(e){return 0!=(256&e[2])}function Ho(e,t){return e.hasOwnProperty($r)?e[$r]:null}class Yc{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function Zr(){return Xr}function Xr(e){return e.type.prototype.ngOnChanges&&(e.setInput=lh),ps}function ps(){const e=Xl(this),t=e?.current;if(t){const n=e.previous;if(n===as)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function lh(e,t,n,r){const a=Xl(e)||function cl(e,t){return e[Us]=t}(e,{previous:as,current:null}),u=a.current||(a.current={}),p=a.previous,v=this.declaredInputs[n],w=p[v];u[v]=new Yc(w&&w.currentValue,t,p===as),e[r]=t}Zr.ngInherit=!0;const Us="__ngSimpleChanges__";function Xl(e){return e[Us]||null}function er(e){for(;Array.isArray(e);)e=e[0];return e}function Je(e,t){return er(t[e])}function et(e,t){return er(t[e.index])}function ul(e,t){return e.data[t]}function gi(e,t){return e[t]}function bn(e,t){const n=t[e];return In(n)?n:n[0]}function yi(e){return 64==(64&e[2])}function Kr(e,t){return null==t?null:e[t]}function jn(e){e[18]=0}function Gn(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const vt={lFrame:Ji(null),bindingsEnabled:!0};function g(){return vt.bindingsEnabled}function E(){return vt.lFrame.lView}function M(){return vt.lFrame.tView}function A(e){return vt.lFrame.contextLView=e,e[8]}function F(e){return vt.lFrame.contextLView=null,e}function z(){let e=V();for(;null!==e&&64===e.type;)e=e.parent;return e}function V(){return vt.lFrame.currentTNode}function W(e,t){const n=vt.lFrame;n.currentTNode=e,n.isParent=t}function Z(){return vt.lFrame.isParent}function re(){vt.lFrame.isParent=!1}function ue(){const e=vt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function Se(){return vt.lFrame.bindingIndex++}function me(e){const t=vt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function qe(e,t){const n=vt.lFrame;n.bindingIndex=n.bindingRootIndex=e,Dt(t)}function Dt(e){vt.lFrame.currentDirectiveIndex=e}function ln(){return vt.lFrame.currentQueryIndex}function tn(e){vt.lFrame.currentQueryIndex=e}function Bt(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Vt(e,t,n){if(n&ut.SkipSelf){let a=t,u=e;for(;!(a=a.parent,null!==a||n&ut.Host||(a=Bt(u),null===a||(u=u[15],10&a.type))););if(null===a)return!1;t=a,e=u}const r=vt.lFrame=ir();return r.currentTNode=t,r.lView=e,!0}function cn(e){const t=ir(),n=e[1];vt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function ir(){const e=vt.lFrame,t=null===e?null:e.child;return null===t?Ji(e):t}function Ji(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function ki(){const e=vt.lFrame;return vt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Yi=ki;function _o(){const e=ki();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function $n(){return vt.lFrame.selectedIndex}function Qi(e){vt.lFrame.selectedIndex=e}function Lt(){const e=vt.lFrame;return ul(e.tView,e.selectedIndex)}function vo(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const u=e.data[n].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:v,ngAfterViewInit:w,ngAfterViewChecked:I,ngOnDestroy:k}=u;p&&(e.contentHooks||(e.contentHooks=[])).push(-n,p),v&&((e.contentHooks||(e.contentHooks=[])).push(n,v),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,v)),w&&(e.viewHooks||(e.viewHooks=[])).push(-n,w),I&&((e.viewHooks||(e.viewHooks=[])).push(n,I),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,I)),null!=k&&(e.destroyHooks||(e.destroyHooks=[])).push(n,k)}}function Ma(e,t,n){tc(e,t,3,n)}function Go(e,t,n,r){(3&e[2])===n&&tc(e,t,n,r)}function ec(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function tc(e,t,n,r){const u=r??-1,p=t.length-1;let v=0;for(let w=void 0!==r?65535&e[18]:0;w<p;w++)if("number"==typeof t[w+1]){if(v=t[w],null!=r&&v>=r)break}else t[w]<0&&(e[18]+=65536),(v<u||-1==u)&&(gs(e,n,t,w),e[18]=(4294901760&e[18])+w+2),w++}function gs(e,t,n,r){const a=n[r]<0,u=n[r+1],v=e[a?-n[r]:n[r]];if(a){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{u.call(v)}finally{}}}else try{u.call(v)}finally{}}class eo{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function qo(e,t,n){let r=0;for(;r<n.length;){const a=n[r];if("number"==typeof a){if(0!==a)break;r++;const u=n[r++],p=n[r++],v=n[r++];e.setAttribute(t,p,v,u)}else{const u=a,p=n[++r];Aa(u)?e.setProperty(t,u,p):e.setAttribute(t,u,p),r++}}return r}function Dd(e){return 3===e||4===e||6===e}function Aa(e){return 64===e.charCodeAt(0)}function hh(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const a=t[r];"number"==typeof a?n=a:0===n||Ed(e,n,a,null,-1===n||2===n?t[++r]:null)}}return e}function Ed(e,t,n,r,a){let u=0,p=e.length;if(-1===t)p=-1;else for(;u<e.length;){const v=e[u++];if("number"==typeof v){if(v===t){p=-1;break}if(v>t){p=u-1;break}}}for(;u<e.length;){const v=e[u];if("number"==typeof v)break;if(v===n){if(null===r)return void(null!==a&&(e[u+1]=a));if(r===e[u+1])return void(e[u+2]=a)}u++,null!==r&&u++,null!==a&&u++}-1!==p&&(e.splice(p,0,t),u=p+1),e.splice(u++,0,n),null!==r&&e.splice(u++,0,r),null!==a&&e.splice(u++,0,a)}function tr(e){return-1!==e}function Pa(e){return 32767&e}function xo(e,t){let n=function yf(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let $s=!0;function hl(e){const t=$s;return $s=e,t}let xf=0;const _s={};function nu(e,t){const n=dh(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,ru(r.data,e),ru(t,null),ru(r.blueprint,null));const a=iu(e,t),u=e.injectorIndex;if(tr(a)){const p=Pa(a),v=xo(a,t),w=v[1].data;for(let I=0;I<8;I++)t[u+I]=v[p+I]|w[p+I]}return t[u+8]=a,u}function ru(e,t){e.push(0,0,0,0,0,0,0,0,t)}function dh(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function iu(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,a=t;for(;null!==a;){if(r=Td(a),null===r)return-1;if(n++,a=a[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Hs(e,t,n){!function Sd(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(va)&&(r=n[va]),null==r&&(r=n[va]=xf++);const a=255&r;t.data[e+(a>>5)]|=1<<a}(e,t,n)}function ic(e,t,n){if(n&ut.Optional||void 0!==e)return e;Ns()}function ou(e,t,n,r){if(n&ut.Optional&&void 0===r&&(r=null),0==(n&(ut.Self|ut.Host))){const a=e[9],u=mi(void 0);try{return a?a.get(t,r,n&ut.Optional):qc(t,r,n&ut.Optional)}finally{mi(u)}}return ic(r,0,n)}function su(e,t,n,r=ut.Default,a){if(null!==e){if(1024&t[2]){const p=function mh(e,t,n,r,a){let u=e,p=t;for(;null!==u&&null!==p&&1024&p[2]&&!(256&p[2]);){const v=bf(u,p,n,r|ut.Self,_s);if(v!==_s)return v;let w=u.parent;if(!w){const I=p[21];if(I){const k=I.get(n,_s,r);if(k!==_s)return k}w=Td(p),p=p[15]}u=w}return a}(e,t,n,r,_s);if(p!==_s)return p}const u=bf(e,t,n,r,_s);if(u!==_s)return u}return ou(t,n,r,a)}function bf(e,t,n,r,a){const u=function wf(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(va)?e[va]:void 0;return"number"==typeof t?t>=0?255&t:zg:t}(n);if("function"==typeof u){if(!Vt(t,e,r))return r&ut.Host?ic(a,0,r):ou(t,n,r,a);try{const p=u(r);if(null!=p||r&ut.Optional)return p;Ns()}finally{Yi()}}else if("number"==typeof u){let p=null,v=dh(e,t),w=-1,I=r&ut.Host?t[16][6]:null;for((-1===v||r&ut.SkipSelf)&&(w=-1===v?iu(e,t):t[v+8],-1!==w&&Md(r,!1)?(p=t[1],v=Pa(w),t=xo(w,t)):v=-1);-1!==v;){const k=t[1];if(ph(u,v,k.data)){const N=Ng(v,t,n,p,r,I);if(N!==_s)return N}w=t[v+8],-1!==w&&Md(r,t[1].data[v+8]===I)&&ph(u,v,t)?(p=k,v=Pa(w),t=xo(w,t)):v=-1}}return a}function Ng(e,t,n,r,a,u){const p=t[1],v=p.data[e+8],k=br(v,p,n,null==r?Gl(v)&&$s:r!=p&&0!=(3&v.type),a&ut.Host&&u===v);return null!==k?mr(t,p,k,v):_s}function br(e,t,n,r,a){const u=e.providerIndexes,p=t.data,v=1048575&u,w=e.directiveStart,k=u>>20,q=a?v+k:e.directiveEnd;for(let Y=r?v:v+k;Y<q;Y++){const le=p[Y];if(Y<w&&n===le||Y>=w&&le.type===n)return Y}if(a){const Y=p[w];if(Y&&Ai(Y)&&Y.type===n)return w}return null}function mr(e,t,n,r){let a=e[n];const u=t.data;if(function nc(e){return e instanceof eo}(a)){const p=a;p.resolving&&function Os(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new ze(-200,`Circular dependency in DI detected for ${e}${n}`)}(function sn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Ct(e)}(u[n]));const v=hl(p.canSeeViewProviders);p.resolving=!0;const w=p.injectImpl?mi(p.injectImpl):null;Vt(e,r,ut.Default);try{a=e[n]=p.factory(void 0,u,e,r),t.firstCreatePass&&n>=r.directiveStart&&function Fi(e,t,n){const{ngOnChanges:r,ngOnInit:a,ngDoCheck:u}=t.type.prototype;if(r){const p=Xr(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,p),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,p)}a&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,a),u&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,u),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,u))}(n,u[n],t)}finally{null!==w&&mi(w),hl(v),p.resolving=!1,Yi()}}return a}function ph(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Md(e,t){return!(e&ut.Self||e&ut.Host&&t)}class vs{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return su(this._tNode,this._lView,t,r,n)}}function zg(){return new vs(z(),E())}function Td(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[6]:null}function oc(e){return function Og(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const r=n.length;let a=0;for(;a<r;){const u=n[a];if(Dd(u))break;if(0===u)a+=2;else if("number"==typeof u)for(a++;a<r&&"string"==typeof n[a];)a++;else{if(u===t)return n[a+1];a+=2}}}return null}(z(),e)}const sc="__parameters__";function xs(e,t,n){return ss(()=>{const r=function au(e){return function(...n){if(e){const r=e(...n);for(const a in r)this[a]=r[a]}}}(t);function a(...u){if(this instanceof a)return r.apply(this,u),this;const p=new a(...u);return v.annotation=p,v;function v(w,I,k){const N=w.hasOwnProperty(sc)?w[sc]:Object.defineProperty(w,sc,{value:[]})[sc];for(;N.length<=k;)N.push(null);return(N[k]=N[k]||[]).push(p),w}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a})}class dt{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=$e({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function to(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),to(r,t)):t!==e&&t.push(r)}return t}function Li(e,t){e.forEach(n=>Array.isArray(n)?Li(n,t):t(n))}function Df(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Bn(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Yr(e,t,n){let r=Fa(e,t);return r>=0?e[1|r]=n:(r=~r,function _h(e,t,n,r){let a=e.length;if(a==t)e.push(n,r);else if(1===a)e.push(r,e[0]),e[0]=n;else{for(a--,e.push(e[a-1],e[a]);a>t;)e[a]=e[a-2],a--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function uu(e,t){const n=Fa(e,t);if(n>=0)return e[1|n]}function Fa(e,t){return function Nd(e,t,n){let r=0,a=e.length>>n;for(;a!==r;){const u=r+(a-r>>1),p=e[u<<n];if(t===p)return u<<n;p>t?a=u:r=u+1}return~(a<<n)}(e,t,1)}const pu={},Ud="__NG_DI_FLAG__",bh="ngTempTokenPath",$g=/\n/gm,pl="__source";let fu;function lc(e){const t=fu;return fu=e,t}function Hg(e,t=ut.Default){if(void 0===fu)throw new ze(-203,!1);return null===fu?qc(e,void 0,t):fu.get(e,t&ut.Optional?null:void 0,t)}function ot(e,t=ut.Default){return(function Ul(){return rl}()||Hg)(mt(e),t)}function or(e,t=ut.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),ot(e,t)}function $d(e){const t=[];for(let n=0;n<e.length;n++){const r=mt(e[n]);if(Array.isArray(r)){if(0===r.length)throw new ze(900,!1);let a,u=ut.Default;for(let p=0;p<r.length;p++){const v=r[p],w=Gg(v);"number"==typeof w?-1===w?a=v.token:u|=w:a=v}t.push(ot(a,u))}else t.push(ot(r))}return t}function mu(e,t){return e[Ud]=t,e.prototype[Ud]=t,e}function Gg(e){return e[Ud]}const _u=mu(xs("Optional"),8),vu=mu(xs("SkipSelf"),4);let Dh;class Rf{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Ws(e){return e instanceof Rf?e.changingThisBreaksApplicationSecurity:e}const ay=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var sr=(()=>((sr=sr||{})[sr.NONE=0]="NONE",sr[sr.HTML=1]="HTML",sr[sr.STYLE=2]="STYLE",sr[sr.SCRIPT=3]="SCRIPT",sr[sr.URL=4]="URL",sr[sr.RESOURCE_URL=5]="RESOURCE_URL",sr))();function Oa(e){const t=function Iu(){const e=E();return e&&e[12]}();return t?t.sanitize(sr.URL,e)||"":function Cu(e,t){const n=function iy(e){return e instanceof Rf&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}(e,"URL")?Ws(e):function Ah(e){return(e=String(e)).match(ay)?e:"unsafe:"+e}(Ct(e))}const ws=new dt("ENVIRONMENT_INITIALIZER"),ep=new dt("INJECTOR",-1),tp=new dt("INJECTOR_DEF_TYPES");class $f{get(t,n=pu){if(n===pu){const r=new Error(`NullInjectorError: No provider for ${vn(t)}!`);throw r.name="NullInjectorError",r}return n}}function fy(...e){return{\u0275providers:Hf(0,e)}}function Hf(e,...t){const n=[],r=new Set;let a;return Li(t,u=>{const p=u;Mu(p,n,[],r)&&(a||(a=[]),a.push(p))}),void 0!==a&&Su(a,n),n}function Su(e,t){for(let n=0;n<e.length;n++){const{providers:a}=e[n];Li(a,u=>{t.push(u)})}}function Mu(e,t,n,r){if(!(e=mt(e)))return!1;let a=null,u=tl(e);const p=!u&&xn(e);if(u||p){if(p&&!p.standalone)return!1;a=e}else{const w=e.ngModule;if(u=tl(w),!u)return!1;a=w}const v=r.has(a);if(p){if(v)return!1;if(r.add(a),p.dependencies){const w="function"==typeof p.dependencies?p.dependencies():p.dependencies;for(const I of w)Mu(I,t,n,r)}}else{if(!u)return!1;{if(null!=u.imports&&!v){let I;r.add(a);try{Li(u.imports,k=>{Mu(k,t,n,r)&&(I||(I=[]),I.push(k))})}finally{}void 0!==I&&Su(I,t)}if(!v){const I=Ho(a)||(()=>new a);t.push({provide:a,useFactory:I,deps:en},{provide:tp,useValue:a,multi:!0},{provide:ws,useValue:()=>ot(a),multi:!0})}const w=u.providers;null==w||v||Li(w,k=>{t.push(k)})}}return a!==e&&void 0!==e.providers}const np=dn({provide:String,useValue:dn});function Tu(e){return null!==e&&"object"==typeof e&&np in e}function Zs(e){return"function"==typeof e}const _c=new dt("Set Injector scope."),vc={},my={};let rp;function Nh(){return void 0===rp&&(rp=new $f),rp}class Na{}class Wf extends Na{constructor(t,n,r,a){super(),this.parent=n,this.source=r,this.scopes=a,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,xc(t,p=>this.processProvider(p)),this.records.set(ep,_l(void 0,this)),a.has("environment")&&this.records.set(Na,_l(void 0,this));const u=this.records.get(_c);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(tp.multi,en,ut.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const n=lc(this),r=mi(void 0);try{return t()}finally{lc(n),mi(r)}}get(t,n=pu,r=ut.Default){this.assertNotDestroyed();const a=lc(this),u=mi(void 0);try{if(!(r&ut.SkipSelf)){let v=this.records.get(t);if(void 0===v){const w=function Kf(e){return"function"==typeof e||"object"==typeof e&&e instanceof dt}(t)&&os(t);v=w&&this.injectableDefInScope(w)?_l(zh(t),vc):null,this.records.set(t,v)}if(null!=v)return this.hydrate(t,v)}return(r&ut.Self?Nh():this.parent).get(t,n=r&ut.Optional&&n===pu?null:n)}catch(p){if("NullInjectorError"===p.name){if((p[bh]=p[bh]||[]).unshift(vn(t)),a)throw p;return function Hd(e,t,n,r){const a=e[bh];throw t[pl]&&a.unshift(t[pl]),e.message=function gu(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let a=vn(t);if(Array.isArray(t))a=t.map(vn).join(" -> ");else if("object"==typeof t){let u=[];for(let p in t)if(t.hasOwnProperty(p)){let v=t[p];u.push(p+":"+("string"==typeof v?JSON.stringify(v):vn(v)))}a=`{${u.join(", ")}}`}return`${n}${r?"("+r+")":""}[${a}]: ${e.replace($g,"\n  ")}`}("\n"+e.message,a,n,r),e.ngTokenPath=a,e[bh]=null,e}(p,t,"R3InjectorError",this.source)}throw p}finally{mi(u),lc(a)}}resolveInjectorInitializers(){const t=lc(this),n=mi(void 0);try{const r=this.get(ws.multi,en,ut.Self);for(const a of r)a()}finally{lc(t),mi(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(vn(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ze(205,!1)}processProvider(t){let n=Zs(t=mt(t))?t:mt(t&&t.provide);const r=function yl(e){return Tu(e)?_l(void 0,e.useValue):_l(ip(e),vc)}(t);if(Zs(t)||!0!==t.multi)this.records.get(n);else{let a=this.records.get(n);a||(a=_l(void 0,vc,!0),a.factory=()=>$d(a.multi),this.records.set(n,a)),n=t,a.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===vc&&(n.value=my,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Xf(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=mt(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function zh(e){const t=os(e),n=null!==t?t.factory:Ho(e);if(null!==n)return n;if(e instanceof dt)throw new ze(204,!1);if(e instanceof Function)return function qn(e){const t=e.length;if(t>0)throw function Ra(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new ze(204,!1);const n=function fi(e){const t=e&&(e[zs]||e[Bl]);if(t){const n=function Gc(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new ze(204,!1)}function ip(e,t,n){let r;if(Zs(e)){const a=mt(e);return Ho(a)||zh(a)}if(Tu(e))r=()=>mt(e.useValue);else if(function Gf(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...$d(e.deps||[]));else if(function gl(e){return!(!e||!e.useExisting)}(e))r=()=>ot(mt(e.useExisting));else{const a=mt(e&&(e.useClass||e.provide));if(!function Zf(e){return!!e.deps}(e))return Ho(a)||zh(a);r=()=>new a(...$d(e.deps))}return r}function _l(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function op(e){return!!e.\u0275providers}function xc(e,t){for(const n of e)Array.isArray(n)?xc(n,t):op(n)?xc(n.\u0275providers,t):t(n)}class Bh{}class Qf{resolveComponentFactory(t){throw function Yf(e){const t=Error(`No component factory found for ${vn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let bc=(()=>{class e{}return e.NULL=new Qf,e})();function em(){return vl(z(),E())}function vl(e,t){return new Ni(et(e,t))}let Ni=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=em,e})();function tm(e){return e instanceof Ni?e.nativeElement:e}class Uh{}let wo=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function Au(){const e=E(),n=bn(z().index,e);return(In(n)?n:e)[11]}(),e})(),sp=(()=>{class e{}return e.\u0275prov=$e({token:e,providedIn:"root",factory:()=>null}),e})();class Pu{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const s=new Pu("14.2.8"),i={};function De(e){return e.ngOriginalError}class we{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&De(t);for(;n&&De(n);)n=De(n);return n||null}}const it=new Map;let nt=0;const gr="__ngContext__";function gn(e,t){In(t)?(e[gr]=t[20],function Sn(e){it.set(e[20],e)}(t)):e[gr]=t}function Dr(e){return e instanceof Function?e():e}var vi=(()=>((vi=vi||{})[vi.Important=1]="Important",vi[vi.DashCase=2]="DashCase",vi))();function Ru(e,t){return undefined(e,t)}function xl(e){const t=e[3];return qr(t)?t[3]:t}function cp(e){return rm(e[13])}function up(e){return rm(e[4])}function rm(e){for(;null!==e&&!qr(e);)e=e[4];return e}function wc(e,t,n,r,a){if(null!=r){let u,p=!1;qr(r)?u=r:In(r)&&(p=!0,r=r[0]);const v=er(r);0===e&&null!==n?null==a?qx(t,n,v):Ou(t,n,v,a||null,!0):1===e&&null!==n?Ou(t,n,v,a||null,!0):2===e?function Qx(e,t,n){const r=am(e,t);r&&function _I(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,v,p):3===e&&t.destroyNode(v),null!=u&&function bI(e,t,n,r,a){const u=n[7];u!==er(n)&&wc(t,e,r,u,a);for(let v=10;v<n.length;v++){const w=n[v];dp(w[1],w,e,t,r,u)}}(t,e,u,n,a)}}function Cc(e,t,n){return e.createElement(t,n)}function za(e,t){const n=e[9],r=n.indexOf(t),a=t[3];512&t[2]&&(t[2]&=-513,Gn(a,-1)),n.splice(r,1)}function yy(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const a=r[17];null!==a&&a!==e&&za(a,r),t>0&&(e[n-1][4]=r[4]);const u=Bn(e,10+t);!function om(e,t){dp(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const p=u[19];null!==p&&p.detachView(u[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function $x(e,t){if(!(128&t[2])){const n=t[11];n.destroyNode&&dp(e,t,n,3,null,null),function Fu(e){let t=e[13];if(!t)return _y(e[1],e);for(;t;){let n=null;if(In(t))n=t[13];else{const r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)In(t)&&_y(t[1],t),t=t[3];null===t&&(t=e),In(t)&&_y(t[1],t),n=t&&t[4]}t=n}}(t)}}function _y(e,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function yI(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const a=t[n[r]];if(!(a instanceof eo)){const u=n[r+1];if(Array.isArray(u))for(let p=0;p<u.length;p+=2){const v=a[u[p]],w=u[p+1];try{w.call(v)}finally{}}else try{u.call(a)}finally{}}}}(e,t),function gI(e,t){const n=e.cleanup,r=t[7];let a=-1;if(null!==n)for(let u=0;u<n.length-1;u+=2)if("string"==typeof n[u]){const p=n[u+1],v="function"==typeof p?p(t):er(t[p]),w=r[a=n[u+2]],I=n[u+3];"boolean"==typeof I?v.removeEventListener(n[u],w,I):I>=0?r[a=I]():r[a=-I].unsubscribe(),u+=2}else{const p=r[a=n[u+1]];n[u].call(p)}if(null!==r){for(let u=a+1;u<r.length;u++)(0,r[u])();t[7]=null}}(e,t),1===t[1].type&&t[11].destroy();const n=t[17];if(null!==n&&qr(t[3])){n!==t[3]&&za(n,t);const r=t[19];null!==r&&r.detachView(e)}!function ar(e){it.delete(e[20])}(t)}}function Hx(e,t,n){return function Gx(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const a=e.data[r.directiveStart].encapsulation;if(a===fo.None||a===fo.Emulated)return null}return et(r,n)}(e,t.parent,n)}function Ou(e,t,n,r,a){e.insertBefore(t,n,r,a)}function qx(e,t,n){e.appendChild(t,n)}function Wx(e,t,n,r,a){null!==r?Ou(e,t,n,r,a):qx(e,t,n)}function am(e,t){return e.parentNode(t)}let Kx=function Xx(e,t,n){return 40&e.type?et(e,n):null};function lm(e,t,n,r){const a=Hx(e,r,t),u=t[11],v=function Zx(e,t,n){return Kx(e,t,n)}(r.parent||t[6],r,t);if(null!=a)if(Array.isArray(n))for(let w=0;w<n.length;w++)Wx(u,a,n[w],v,!1);else Wx(u,a,n,v,!1)}function cm(e,t){if(null!==t){const n=t.type;if(3&n)return et(t,e);if(4&n)return xy(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return cm(e,r);{const a=e[t.index];return qr(a)?xy(-1,a):er(a)}}if(32&n)return Ru(t,e)()||er(e[t.index]);{const r=Yx(e,t);return null!==r?Array.isArray(r)?r[0]:cm(xl(e[16]),r):cm(e,t.next)}}return null}function Yx(e,t){return null!==t?e[16][6].projection[t.projection]:null}function xy(e,t){const n=10+e+1;if(n<t.length){const r=t[n],a=r[1].firstChild;if(null!==a)return cm(r,a)}return t[7]}function by(e,t,n,r,a,u,p){for(;null!=n;){const v=r[n.index],w=n.type;if(p&&0===t&&(v&&gn(er(v),r),n.flags|=4),64!=(64&n.flags))if(8&w)by(e,t,n.child,r,a,u,!1),wc(t,e,a,v,u);else if(32&w){const I=Ru(n,r);let k;for(;k=I();)wc(t,e,a,k,u);wc(t,e,a,v,u)}else 16&w?e0(e,t,r,n,a,u):wc(t,e,a,v,u);n=p?n.projectionNext:n.next}}function dp(e,t,n,r,a,u){by(n,r,e.firstChild,t,a,u,!1)}function e0(e,t,n,r,a,u){const p=n[16],w=p[6].projection[r.projection];if(Array.isArray(w))for(let I=0;I<w.length;I++)wc(t,e,a,w[I],u);else by(e,t,w,p[3],a,u,!0)}function t0(e,t,n){e.setAttribute(t,"style",n)}function wy(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function n0(e,t,n){let r=e.length;for(;;){const a=e.indexOf(t,n);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const u=t.length;if(a+u===r||e.charCodeAt(a+u)<=32)return a}n=a+1}}const r0="ng-template";function CI(e,t,n){let r=0;for(;r<e.length;){let a=e[r++];if(n&&"class"===a){if(a=e[r],-1!==n0(a.toLowerCase(),t,0))return!0}else if(1===a){for(;r<e.length&&"string"==typeof(a=e[r++]);)if(a.toLowerCase()===t)return!0;return!1}}return!1}function o0(e){return 4===e.type&&e.value!==r0}function DI(e,t,n){return t===(4!==e.type||n?e.value:r0)}function EI(e,t,n){let r=4;const a=e.attrs||[],u=function MI(e){for(let t=0;t<e.length;t++)if(Dd(e[t]))return t;return e.length}(a);let p=!1;for(let v=0;v<t.length;v++){const w=t[v];if("number"!=typeof w){if(!p)if(4&r){if(r=2|1&r,""!==w&&!DI(e,w,n)||""===w&&1===t.length){if(Js(r))return!1;p=!0}}else{const I=8&r?w:t[++v];if(8&r&&null!==e.attrs){if(!CI(e.attrs,I,n)){if(Js(r))return!1;p=!0}continue}const N=II(8&r?"class":w,a,o0(e),n);if(-1===N){if(Js(r))return!1;p=!0;continue}if(""!==I){let q;q=N>u?"":a[N+1].toLowerCase();const Y=8&r?q:null;if(Y&&-1!==n0(Y,I,0)||2&r&&I!==q){if(Js(r))return!1;p=!0}}}}else{if(!p&&!Js(r)&&!Js(w))return!1;if(p&&Js(w))continue;p=!1,r=w|1&r}}return Js(r)||p}function Js(e){return 0==(1&e)}function II(e,t,n,r){if(null===t)return-1;let a=0;if(r||!n){let u=!1;for(;a<t.length;){const p=t[a];if(p===e)return a;if(3===p||6===p)u=!0;else{if(1===p||2===p){let v=t[++a];for(;"string"==typeof v;)v=t[++a];continue}if(4===p)break;if(0===p){a+=4;continue}}a+=u?1:2}return-1}return function TI(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function s0(e,t,n=!1){for(let r=0;r<t.length;r++)if(EI(e,t[r],n))return!0;return!1}function a0(e,t){return e?":not("+t.trim()+")":t}function PI(e){let t=e[0],n=1,r=2,a="",u=!1;for(;n<e.length;){let p=e[n];if("string"==typeof p)if(2&r){const v=e[++n];a+="["+p+(v.length>0?'="'+v+'"':"")+"]"}else 8&r?a+="."+p:4&r&&(a+=" "+p);else""!==a&&!Js(p)&&(t+=a0(u,a),a=""),r=p,u=u||!Js(r);n++}return""!==a&&(t+=a0(u,a)),t}const Nt={};function nn(e){l0(M(),E(),$n()+e,!1)}function l0(e,t,n,r){if(!r)if(3==(3&t[2])){const u=e.preOrderCheckHooks;null!==u&&Ma(t,u,n)}else{const u=e.preOrderHooks;null!==u&&Go(t,u,0,n)}Qi(n)}function d0(e,t=null,n=null,r){const a=p0(e,t,n,r);return a.resolveInjectorInitializers(),a}function p0(e,t=null,n=null,r,a=new Set){const u=[n||en,fy(e)];return r=r||("object"==typeof e?void 0:vn(e)),new Wf(u,t||Nh(),r||null,a)}let Xo=(()=>{class e{static create(n,r){if(Array.isArray(n))return d0({name:""},r,n,"");{const a=n.name??"";return d0({name:a},n.parent,n.providers,a)}}}return e.THROW_IF_NOT_FOUND=pu,e.NULL=new $f,e.\u0275prov=$e({token:e,providedIn:"any",factory:()=>ot(ep)}),e.__NG_ELEMENT_ID__=-1,e})();function Ae(e,t=ut.Default){const n=E();return null===n?ot(e,t):su(z(),n,mt(e),t)}function Sy(){throw new Error("invalid")}function hm(e,t){return e<<17|t<<2}function Ys(e){return e>>17&32767}function My(e){return 2|e}function bl(e){return(131068&e)>>2}function Ty(e,t){return-131069&e|t<<2}function Ay(e){return 1|e}function A0(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const a=n[r],u=n[r+1];if(-1!==u){const p=e.data[u];tn(a),p.contentQueries(2,t[u],u)}}}function fm(e,t,n,r,a,u,p,v,w,I,k){const N=t.blueprint.slice();return N[0]=a,N[2]=76|r,(null!==k||e&&1024&e[2])&&(N[2]|=1024),jn(N),N[3]=N[15]=e,N[8]=n,N[10]=p||e&&e[10],N[11]=v||e&&e[11],N[12]=w||e&&e[12]||null,N[9]=I||e&&e[9]||null,N[6]=u,N[20]=function Tt(){return nt++}(),N[21]=k,N[16]=2==t.type?e[16]:N,N}function Hh(e,t,n,r,a){let u=e.data[t];if(null===u)u=function zy(e,t,n,r,a){const u=V(),p=Z(),w=e.data[t]=function pS(e,t,n,r,a,u){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:a,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?u:u&&u.parent,n,t,r,a);return null===e.firstChild&&(e.firstChild=w),null!==u&&(p?null==u.child&&null!==w.parent&&(u.child=w):null===u.next&&(u.next=w)),w}(e,t,n,r,a),function He(){return vt.lFrame.inI18n}()&&(u.flags|=64);else if(64&u.type){u.type=n,u.value=r,u.attrs=a;const p=function X(){const e=vt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();u.injectorIndex=null===p?-1:p.injectorIndex}return W(u,!0),u}function Gh(e,t,n,r){if(0===n)return-1;const a=t.length;for(let u=0;u<n;u++)t.push(r),e.blueprint.push(r),e.data.push(null);return a}function By(e,t,n){cn(t);try{const r=e.viewQuery;null!==r&&Wy(1,r,n);const a=e.template;null!==a&&P0(e,t,a,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&A0(e,t),e.staticViewQueries&&Wy(2,e.viewQuery,n);const u=e.components;null!==u&&function uS(e,t){for(let n=0;n<t.length;n++)TS(e,t[n])}(t,u)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,_o()}}function mm(e,t,n,r){const a=t[2];if(128!=(128&a)){cn(t);try{jn(t),function be(e){return vt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&P0(e,t,n,2,r);const p=3==(3&a);if(p){const I=e.preOrderCheckHooks;null!==I&&Ma(t,I,null)}else{const I=e.preOrderHooks;null!==I&&Go(t,I,0,null),ec(t,0)}if(function SS(e){for(let t=cp(e);null!==t;t=up(t)){if(!t[2])continue;const n=t[9];for(let r=0;r<n.length;r++){const a=n[r],u=a[3];0==(512&a[2])&&Gn(u,1),a[2]|=512}}}(t),function IS(e){for(let t=cp(e);null!==t;t=up(t))for(let n=10;n<t.length;n++){const r=t[n],a=r[1];yi(r)&&mm(a,r,a.template,r[8])}}(t),null!==e.contentQueries&&A0(e,t),p){const I=e.contentCheckHooks;null!==I&&Ma(t,I)}else{const I=e.contentHooks;null!==I&&Go(t,I,1),ec(t,1)}!function lS(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const a=n[r];if(a<0)Qi(~a);else{const u=a,p=n[++r],v=n[++r];qe(p,u),v(2,t[u])}}}finally{Qi(-1)}}(e,t);const v=e.components;null!==v&&function cS(e,t){for(let n=0;n<t.length;n++)MS(e,t[n])}(t,v);const w=e.viewQuery;if(null!==w&&Wy(2,w,r),p){const I=e.viewCheckHooks;null!==I&&Ma(t,I)}else{const I=e.viewHooks;null!==I&&Go(t,I,2),ec(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Gn(t[3],-1))}finally{_o()}}}function P0(e,t,n,r,a){const u=$n(),p=2&r;try{Qi(-1),p&&t.length>22&&l0(e,t,22,!1),n(r,a)}finally{Qi(u)}}function k0(e,t,n){if(Wr(t)){const a=t.directiveEnd;for(let u=t.directiveStart;u<a;u++){const p=e.data[u];p.contentQueries&&p.contentQueries(1,n[u],u)}}}function Vy(e,t,n){!g()||(function _S(e,t,n,r){const a=n.directiveStart,u=n.directiveEnd;e.firstCreatePass||nu(n,t),gn(r,t);const p=n.initialInputs;for(let v=a;v<u;v++){const w=e.data[v],I=Ai(w);I&&CS(t,n,w);const k=mr(t,e,v,n);gn(k,t),null!==p&&DS(0,v-a,k,w,0,p),I&&(bn(n.index,t)[8]=k)}}(e,t,n,et(n,t)),128==(128&n.flags)&&function vS(e,t,n){const r=n.directiveStart,a=n.directiveEnd,u=n.index,p=function xt(){return vt.lFrame.currentDirectiveIndex}();try{Qi(u);for(let v=r;v<a;v++){const w=e.data[v],I=t[v];Dt(v),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&B0(w,I)}}finally{Qi(-1),Dt(p)}}(e,t,n))}function Uy(e,t,n=et){const r=t.localNames;if(null!==r){let a=t.index+1;for(let u=0;u<r.length;u+=2){const p=r[u+1],v=-1===p?n(t,e):e[p];e[a++]=v}}}function R0(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=jy(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function jy(e,t,n,r,a,u,p,v,w,I){const k=22+r,N=k+a,q=function hS(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Nt);return n}(k,N),Y="function"==typeof I?I():I;return q[1]={type:e,blueprint:q,template:n,queries:null,viewQuery:v,declTNode:t,data:q.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:N,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:w,consts:Y,incompleteFirstPass:!1}}function F0(e,t,n,r){const a=H0(t);null===n?a.push(r):(a.push(n),e.firstCreatePass&&G0(e).push(r,a.length-1))}function L0(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const a=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,a):n[r]=[t,a]}return n}function O0(e,t){const r=t.directiveEnd,a=e.data,u=t.attrs,p=[];let v=null,w=null;for(let I=t.directiveStart;I<r;I++){const k=a[I],N=k.inputs,q=null===u||o0(t)?null:ES(N,u);p.push(q),v=L0(N,I,v),w=L0(k.outputs,I,w)}null!==v&&(v.hasOwnProperty("class")&&(t.flags|=16),v.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=p,t.inputs=v,t.outputs=w}function Ko(e,t,n,r,a,u,p,v){const w=et(t,n);let k,I=t.inputs;!v&&null!=I&&(k=I[r])?(Zy(e,n,k,r,a),Gl(t)&&N0(n,t.index)):3&t.type&&(r=function fS(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),a=null!=p?p(a,t.value||"",r):a,u.setProperty(w,r,a))}function N0(e,t){const n=bn(t,e);16&n[2]||(n[2]|=32)}function $y(e,t,n,r){let a=!1;if(g()){const u=function xS(e,t,n){const r=e.directiveRegistry;let a=null;if(r)for(let u=0;u<r.length;u++){const p=r[u];s0(n,p.selectors,!1)&&(a||(a=[]),Hs(nu(n,t),e,p.type),Ai(p)?(V0(e,n),a.unshift(p)):a.push(p))}return a}(e,t,n),p=null===r?null:{"":-1};if(null!==u){a=!0,U0(n,e.data.length,u.length);for(let k=0;k<u.length;k++){const N=u[k];N.providersResolver&&N.providersResolver(N)}let v=!1,w=!1,I=Gh(e,t,u.length,null);for(let k=0;k<u.length;k++){const N=u[k];n.mergedAttrs=hh(n.mergedAttrs,N.hostAttrs),j0(e,n,t,I,N),wS(I,N,p),null!==N.contentQueries&&(n.flags|=8),(null!==N.hostBindings||null!==N.hostAttrs||0!==N.hostVars)&&(n.flags|=128);const q=N.type.prototype;!v&&(q.ngOnChanges||q.ngOnInit||q.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),v=!0),!w&&(q.ngOnChanges||q.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),w=!0),I++}O0(e,n)}p&&function bS(e,t,n){if(t){const r=e.localNames=[];for(let a=0;a<t.length;a+=2){const u=n[t[a+1]];if(null==u)throw new ze(-301,!1);r.push(t[a],u)}}}(n,r,p)}return n.mergedAttrs=hh(n.mergedAttrs,n.attrs),a}function z0(e,t,n,r,a,u){const p=u.hostBindings;if(p){let v=e.hostBindingOpCodes;null===v&&(v=e.hostBindingOpCodes=[]);const w=~t.index;(function yS(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(v)!=w&&v.push(w),v.push(r,a,p)}}function B0(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function V0(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function wS(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Ai(t)&&(n[""]=e)}}function U0(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function j0(e,t,n,r,a){e.data[r]=a;const u=a.factory||(a.factory=Ho(a.type)),p=new eo(u,Ai(a),Ae);e.blueprint[r]=p,n[r]=p,z0(e,t,0,r,Gh(e,n,a.hostVars,Nt),a)}function CS(e,t,n){const r=et(t,e),a=R0(n),u=e[10],p=gm(e,fm(e,a,null,n.onPush?32:16,r,t,u,u.createRenderer(r,n),null,null,null));e[t.index]=p}function DS(e,t,n,r,a,u){const p=u[t];if(null!==p){const v=r.setInput;for(let w=0;w<p.length;){const I=p[w++],k=p[w++],N=p[w++];null!==v?r.setInput(n,N,I,k):n[k]=N}}}function ES(e,t){let n=null,r=0;for(;r<t.length;){const a=t[r];if(0!==a)if(5!==a){if("number"==typeof a)break;e.hasOwnProperty(a)&&(null===n&&(n=[]),n.push(a,e[a],t[r+1])),r+=2}else r+=2;else r+=4}return n}function $0(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function MS(e,t){const n=bn(t,e);if(yi(n)){const r=n[1];48&n[2]?mm(r,n,r.template,n[8]):n[5]>0&&Gy(n)}}function Gy(e){for(let r=cp(e);null!==r;r=up(r))for(let a=10;a<r.length;a++){const u=r[a];if(yi(u))if(512&u[2]){const p=u[1];mm(p,u,p.template,u[8])}else u[5]>0&&Gy(u)}const n=e[1].components;if(null!==n)for(let r=0;r<n.length;r++){const a=bn(n[r],e);yi(a)&&a[5]>0&&Gy(a)}}function TS(e,t){const n=bn(t,e),r=n[1];(function AS(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),By(r,n,n[8])}function gm(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function qy(e){for(;e;){e[2]|=32;const t=xl(e);if($o(e)&&!t)return e;e=t}return null}function ym(e,t,n,r=!0){const a=t[10];a.begin&&a.begin();try{mm(e,t,e.template,n)}catch(p){throw r&&W0(t,p),p}finally{a.end&&a.end()}}function Wy(e,t,n){tn(0),t(e,n)}function H0(e){return e[7]||(e[7]=[])}function G0(e){return e.cleanup||(e.cleanup=[])}function W0(e,t){const n=e[9],r=n?n.get(we,null):null;r&&r.handleError(t)}function Zy(e,t,n,r,a){for(let u=0;u<n.length;){const p=n[u++],v=n[u++],w=t[p],I=e.data[p];null!==I.setInput?I.setInput(w,a,r,v):w[v]=a}}function _m(e,t,n){let r=n?e.styles:null,a=n?e.classes:null,u=0;if(null!==t)for(let p=0;p<t.length;p++){const v=t[p];"number"==typeof v?u=v:1==u?a=Ja(a,v):2==u&&(r=Ja(r,v+": "+t[++p]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=a:e.classesWithoutHost=a}function vm(e,t,n,r,a=!1){for(;null!==n;){const u=t[n.index];if(null!==u&&r.push(er(u)),qr(u))for(let v=10;v<u.length;v++){const w=u[v],I=w[1].firstChild;null!==I&&vm(w[1],w,I,r)}const p=n.type;if(8&p)vm(e,t,n.child,r);else if(32&p){const v=Ru(n,t);let w;for(;w=v();)r.push(w)}else if(16&p){const v=Yx(t,n);if(Array.isArray(v))r.push(...v);else{const w=xl(t[16]);vm(w[1],w,v,r,!0)}}n=a?n.projectionNext:n.next}return r}class pp{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return vm(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(qr(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&(yy(t,r),Bn(n,r))}this._attachedToViewContainer=!1}$x(this._lView[1],this._lView)}onDestroy(t){F0(this._lView[1],this._lView,null,t)}markForCheck(){qy(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){ym(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ze(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ds(e,t){dp(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ze(902,!1);this._appRef=t}}class PS extends pp{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;ym(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class Xy extends bc{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=xn(t);return new fp(n,this.ngModule)}}function Z0(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class RS{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){const a=this.injector.get(t,i,r);return a!==i||n===i?a:this.parentInjector.get(t,n,r)}}class fp extends Bh{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function kI(e){return e.map(PI).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return Z0(this.componentDef.inputs)}get outputs(){return Z0(this.componentDef.outputs)}create(t,n,r,a){let u=(a=a||this.ngModule)instanceof Na?a:a?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const p=u?new RS(t,u):t,v=p.get(Uh,null);if(null===v)throw new ze(407,!1);const w=p.get(sp,null),I=v.createRenderer(null,this.componentDef),k=this.componentDef.selectors[0][0]||"div",N=r?function dS(e,t,n){return e.selectRootElement(t,n===fo.ShadowDom)}(I,r,this.componentDef.encapsulation):Cc(v.createRenderer(null,this.componentDef),k,function kS(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(k)),q=this.componentDef.onPush?288:272,Y=jy(0,null,null,1,0,null,null,null,null,null),le=fm(null,Y,null,q,null,null,v,I,w,p,null);let Ce,Me;cn(le);try{const Pe=function OS(e,t,n,r,a,u){const p=n[1];n[22]=e;const w=Hh(p,22,2,"#host",null),I=w.mergedAttrs=t.hostAttrs;null!==I&&(_m(w,I,!0),null!==e&&(qo(a,e,I),null!==w.classes&&wy(a,e,w.classes),null!==w.styles&&t0(a,e,w.styles)));const k=r.createRenderer(e,t),N=fm(n,R0(t),null,t.onPush?32:16,n[22],w,r,k,u||null,null,null);return p.firstCreatePass&&(Hs(nu(w,n),p,t.type),V0(p,w),U0(w,n.length,1)),gm(n,N),n[22]=N}(N,this.componentDef,le,v,I);if(N)if(r)qo(I,N,["ng-version",s.full]);else{const{attrs:Ze,classes:Ie}=function RI(e){const t=[],n=[];let r=1,a=2;for(;r<e.length;){let u=e[r];if("string"==typeof u)2===a?""!==u&&t.push(u,e[++r]):8===a&&n.push(u);else{if(!Js(a))break;a=u}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);Ze&&qo(I,N,Ze),Ie&&Ie.length>0&&wy(I,N,Ie.join(" "))}if(Me=ul(Y,22),void 0!==n){const Ze=Me.projection=[];for(let Ie=0;Ie<this.ngContentSelectors.length;Ie++){const ht=n[Ie];Ze.push(null!=ht?Array.from(ht):null)}}Ce=function NS(e,t,n,r){const a=n[1],u=function gS(e,t,n){const r=z();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),j0(e,r,t,Gh(e,t,1,null),n),O0(e,r));const a=mr(t,e,r.directiveStart,r);gn(a,t);const u=et(r,t);return u&&gn(u,t),a}(a,n,t);if(e[8]=n[8]=u,null!==r)for(const v of r)v(u,t);if(t.contentQueries){const v=z();t.contentQueries(1,u,v.directiveStart)}const p=z();return!a.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Qi(p.index),z0(n[1],p,0,p.directiveStart,p.directiveEnd,t),B0(t,u)),u}(Pe,this.componentDef,le,[zS]),By(Y,le,null)}finally{_o()}return new LS(this.componentType,Ce,vl(Me,le),le,Me)}}class LS extends class Jf{}{constructor(t,n,r,a,u){super(),this.location=r,this._rootLView=a,this._tNode=u,this.instance=n,this.hostView=this.changeDetectorRef=new PS(a),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let a;if(null!==r&&(a=r[t])){const u=this._rootLView;Zy(u[1],u,a,t,n),N0(u,this._tNode.index)}}get injector(){return new vs(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function zS(){const e=z();vo(E()[1],e)}let xm=null;function Nu(){if(!xm){const e=En.Symbol;if(e&&e.iterator)xm=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(xm=r)}}}return xm}function mp(e){return!!function Jy(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Nu()in e)}function Va(e,t,n){return e[t]=n}function Vi(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function zu(e,t,n,r){const a=Vi(e,t,n);return Vi(e,t+1,r)||a}function Wh(e,t,n,r){return Vi(e,Se(),n)?t+Ct(n)+r:Nt}function Zh(e,t,n,r,a,u){const v=zu(e,function _e(){return vt.lFrame.bindingIndex}(),n,a);return me(2),v?t+Ct(n)+r+Ct(a)+u:Nt}function Is(e,t,n,r,a,u,p,v){const w=E(),I=M(),k=e+22,N=I.firstCreatePass?function KS(e,t,n,r,a,u,p,v,w){const I=t.consts,k=Hh(t,e,4,p||null,Kr(I,v));$y(t,n,k,Kr(I,w)),vo(t,k);const N=k.tViews=jy(2,k,r,a,u,t.directiveRegistry,t.pipeRegistry,null,t.schemas,I);return null!==t.queries&&(t.queries.template(t,k),N.queries=t.queries.embeddedTView(k)),k}(k,I,w,t,n,r,a,u,p):I.data[k];W(N,!1);const q=w[11].createComment("");lm(I,w,q,N),gn(q,w),gm(w,w[k]=$0(q,w,q,N)),Ki(N)&&Vy(I,w,N),null!=p&&Uy(w,N,v)}function td(e){return gi(function he(){return vt.lFrame.contextLView}(),22+e)}function Lr(e,t,n){const r=E();return Vi(r,Se(),t)&&Ko(M(),Lt(),r,e,t,r[11],n,!1),Lr}function Yy(e,t,n,r,a){const p=a?"class":"style";Zy(e,n,t.inputs[p],p,r)}function gt(e,t,n,r){const a=E(),u=M(),p=22+e,v=a[11],w=a[p]=Cc(v,t,function Fn(){return vt.lFrame.currentNamespace}()),I=u.firstCreatePass?function YS(e,t,n,r,a,u,p){const v=t.consts,I=Hh(t,e,2,a,Kr(v,u));return $y(t,n,I,Kr(v,p)),null!==I.attrs&&_m(I,I.attrs,!1),null!==I.mergedAttrs&&_m(I,I.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,I),I}(p,u,a,0,t,n,r):u.data[p];W(I,!0);const k=I.mergedAttrs;null!==k&&qo(v,w,k);const N=I.classes;null!==N&&wy(v,w,N);const q=I.styles;return null!==q&&t0(v,w,q),64!=(64&I.flags)&&lm(u,a,w,I),0===function o(){return vt.lFrame.elementDepthCount}()&&gn(w,a),function c(){vt.lFrame.elementDepthCount++}(),Ki(I)&&(Vy(u,a,I),k0(u,I,a)),null!==r&&Uy(a,I),gt}function bt(){let e=z();Z()?re():(e=e.parent,W(e,!1));const t=e;!function d(){vt.lFrame.elementDepthCount--}();const n=M();return n.firstCreatePass&&(vo(n,e),Wr(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function tu(e){return 0!=(16&e.flags)}(t)&&Yy(n,t,E(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function rc(e){return 0!=(32&e.flags)}(t)&&Yy(n,t,E(),t.stylesWithoutHost,!1),bt}function Or(e,t,n,r){return gt(e,t,n,r),bt(),Or}function yp(e,t,n){const r=E(),a=M(),u=e+22,p=a.firstCreatePass?function QS(e,t,n,r,a){const u=t.consts,p=Kr(u,r),v=Hh(t,e,8,"ng-container",p);return null!==p&&_m(v,p,!0),$y(t,n,v,Kr(u,a)),null!==t.queries&&t.queries.elementStart(t,v),v}(u,a,r,t,n):a.data[u];W(p,!0);const v=r[u]=r[11].createComment("");return lm(a,r,v,p),gn(v,r),Ki(p)&&(Vy(a,r,p),k0(a,p,r)),null!=n&&Uy(r,p),yp}function _p(){let e=z();const t=M();return Z()?re():(e=e.parent,W(e,!1)),t.firstCreatePass&&(vo(t,e),Wr(e)&&t.queries.elementEnd(e)),_p}function wm(){return E()}function vp(e){return!!e&&"function"==typeof e.then}const Qy=function sb(e){return!!e&&"function"==typeof e.subscribe};function ui(e,t,n,r){const a=E(),u=M(),p=z();return function lb(e,t,n,r,a,u,p,v){const w=Ki(r),k=e.firstCreatePass&&G0(e),N=t[8],q=H0(t);let Y=!0;if(3&r.type||v){const Me=et(r,t),Pe=v?v(Me):Me,Ze=q.length,Ie=v?yn=>v(er(yn[r.index])):r.index;let ht=null;if(!v&&w&&(ht=function eM(e,t,n,r){const a=e.cleanup;if(null!=a)for(let u=0;u<a.length-1;u+=2){const p=a[u];if(p===n&&a[u+1]===r){const v=t[7],w=a[u+2];return v.length>w?v[w]:null}"string"==typeof p&&(u+=2)}return null}(e,t,a,r.index)),null!==ht)(ht.__ngLastListenerFn__||ht).__ngNextListenerFn__=u,ht.__ngLastListenerFn__=u,Y=!1;else{u=ub(r,t,N,u,!1);const yn=n.listen(Pe,a,u);q.push(u,yn),k&&k.push(a,Ie,Ze,Ze+1)}}else u=ub(r,t,N,u,!1);const le=r.outputs;let Ce;if(Y&&null!==le&&(Ce=le[a])){const Me=Ce.length;if(Me)for(let Pe=0;Pe<Me;Pe+=2){const nr=t[Ce[Pe]][Ce[Pe+1]].subscribe(u),Xu=q.length;q.push(u,nr),k&&k.push(a,r.index,Xu,-(Xu+1))}}}(u,a,a[11],p,e,t,0,r),ui}function cb(e,t,n,r){try{return!1!==n(r)}catch(a){return W0(e,a),!1}}function ub(e,t,n,r,a){return function u(p){if(p===Function)return r;qy(2&e.flags?bn(e.index,t):t);let w=cb(t,0,r,p),I=u.__ngNextListenerFn__;for(;I;)w=cb(t,0,I,p)&&w,I=I.__ngNextListenerFn__;return a&&!1===w&&(p.preventDefault(),p.returnValue=!1),w}}function Jo(e=1){return function Ri(e){return(vt.lFrame.contextLView=function si(e,t){for(;e>0;)t=t[15],e--;return t}(e,vt.lFrame.contextLView))[8]}(e)}function xp(e,t,n,r,a){const u=E(),p=Wh(u,t,n,r);return p!==Nt&&Ko(M(),Lt(),u,e,p,u[11],a,!1),xp}function Cm(e,t,n,r,a,u,p){const v=E(),w=Zh(v,t,n,r,a,u);return w!==Nt&&Ko(M(),Lt(),v,e,w,v[11],p,!1),Cm}function vb(e,t,n,r,a){const u=e[n+1],p=null===t;let v=r?Ys(u):bl(u),w=!1;for(;0!==v&&(!1===w||p);){const k=e[v+1];sM(e[v],t)&&(w=!0,e[v+1]=r?Ay(k):My(k)),v=r?Ys(k):bl(k)}w&&(e[n+1]=r?My(u):Ay(u))}function sM(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Fa(e,t)>=0}const ni={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function xb(e){return e.substring(ni.key,ni.keyEnd)}function bb(e,t){const n=ni.textEnd;return n===t?-1:(t=ni.keyEnd=function uM(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,ni.key=t,n),nd(e,t,n))}function nd(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function bp(e,t){return function Qs(e,t,n,r){const a=E(),u=M(),p=me(2);u.firstUpdatePass&&Mb(u,e,p,r),t!==Nt&&Vi(a,p,t)&&Ab(u,u.data[$n()],a,a[11],e,a[p+1]=function bM(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=vn(Ws(e)))),e}(t,n),r,p)}(e,t,null,!0),bp}function $a(e,t){for(let n=function lM(e){return function Cb(e){ni.key=0,ni.keyEnd=0,ni.value=0,ni.valueEnd=0,ni.textEnd=e.length}(e),bb(e,nd(e,0,ni.textEnd))}(t);n>=0;n=bb(t,n))Yr(e,xb(t),!0)}function Sb(e,t){return t>=e.expandoStartIndex}function Mb(e,t,n,r){const a=e.data;if(null===a[n+1]){const u=a[$n()],p=Sb(e,n);kb(u,r)&&null===t&&!p&&(t=!1),t=function mM(e,t,n,r){const a=function rt(e){const t=vt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let u=r?t.residualClasses:t.residualStyles;if(null===a)0===(r?t.classBindings:t.styleBindings)&&(n=wp(n=e_(null,e,t,n,r),t.attrs,r),u=null);else{const p=t.directiveStylingLast;if(-1===p||e[p]!==a)if(n=e_(a,e,t,n,r),null===u){let w=function gM(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==bl(r))return e[Ys(r)]}(e,t,r);void 0!==w&&Array.isArray(w)&&(w=e_(null,e,t,w[1],r),w=wp(w,t.attrs,r),function yM(e,t,n,r){e[Ys(n?t.classBindings:t.styleBindings)]=r}(e,t,r,w))}else u=function _M(e,t,n){let r;const a=t.directiveEnd;for(let u=1+t.directiveStylingLast;u<a;u++)r=wp(r,e[u].hostAttrs,n);return wp(r,t.attrs,n)}(e,t,r)}return void 0!==u&&(r?t.residualClasses=u:t.residualStyles=u),n}(a,u,t,r),function iM(e,t,n,r,a,u){let p=u?t.classBindings:t.styleBindings,v=Ys(p),w=bl(p);e[r]=n;let k,I=!1;if(Array.isArray(n)){const N=n;k=N[1],(null===k||Fa(N,k)>0)&&(I=!0)}else k=n;if(a)if(0!==w){const q=Ys(e[v+1]);e[r+1]=hm(q,v),0!==q&&(e[q+1]=Ty(e[q+1],r)),e[v+1]=function YI(e,t){return 131071&e|t<<17}(e[v+1],r)}else e[r+1]=hm(v,0),0!==v&&(e[v+1]=Ty(e[v+1],r)),v=r;else e[r+1]=hm(w,0),0===v?v=r:e[w+1]=Ty(e[w+1],r),w=r;I&&(e[r+1]=My(e[r+1])),vb(e,k,r,!0),vb(e,k,r,!1),function oM(e,t,n,r,a){const u=a?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof t&&Fa(u,t)>=0&&(n[r+1]=Ay(n[r+1]))}(t,k,e,r,u),p=hm(v,w),u?t.classBindings=p:t.styleBindings=p}(a,u,t,n,p,r)}}function e_(e,t,n,r,a){let u=null;const p=n.directiveEnd;let v=n.directiveStylingLast;for(-1===v?v=n.directiveStart:v++;v<p&&(u=t[v],r=wp(r,u.hostAttrs,a),u!==e);)v++;return null!==e&&(n.directiveStylingLast=v),r}function wp(e,t,n){const r=n?1:2;let a=-1;if(null!==t)for(let u=0;u<t.length;u++){const p=t[u];"number"==typeof p?a=p:a===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Yr(e,p,!!n||t[++u]))}return void 0===e?null:e}function Ab(e,t,n,r,a,u,p,v){if(!(3&t.type))return;const w=e.data,I=w[v+1];Dm(function w0(e){return 1==(1&e)}(I)?Pb(w,t,n,a,bl(I),p):void 0)||(Dm(u)||function b0(e){return 2==(2&e)}(I)&&(u=Pb(w,null,n,a,v,p)),function wI(e,t,n,r,a){if(t)a?e.addClass(n,r):e.removeClass(n,r);else{let u=-1===r.indexOf("-")?void 0:vi.DashCase;null==a?e.removeStyle(n,r,u):("string"==typeof a&&a.endsWith("!important")&&(a=a.slice(0,-10),u|=vi.Important),e.setStyle(n,r,a,u))}}(r,p,Je($n(),n),a,u))}function Pb(e,t,n,r,a,u){const p=null===t;let v;for(;a>0;){const w=e[a],I=Array.isArray(w),k=I?w[1]:w,N=null===k;let q=n[a+1];q===Nt&&(q=N?en:void 0);let Y=N?uu(q,r):k===r?q:void 0;if(I&&!Dm(Y)&&(Y=uu(w,r)),Dm(Y)&&(v=Y,p))return v;const le=e[a+1];a=p?Ys(le):bl(le)}if(null!==t){let w=u?t.residualClasses:t.residualStyles;null!=w&&(v=uu(w,r))}return v}function Dm(e){return void 0!==e}function kb(e,t){return 0!=(e.flags&(t?16:32))}function Wt(e,t=""){const n=E(),r=M(),a=e+22,u=r.firstCreatePass?Hh(r,a,1,t,null):r.data[a],p=n[a]=function hp(e,t){return e.createText(t)}(n[11],t);lm(r,n,p,u),W(u,!1)}function ta(e){return Yo("",e,""),ta}function Yo(e,t,n){const r=E(),a=Wh(r,e,t,n);return a!==Nt&&function wl(e,t,n){const r=Je(t,e);!function im(e,t,n){e.setValue(t,n)}(e[11],r,n)}(r,$n(),a),Yo}function t_(e,t,n){!function ea(e,t,n,r){const a=M(),u=me(2);a.firstUpdatePass&&Mb(a,null,u,r);const p=E();if(n!==Nt&&Vi(p,u,n)){const v=a.data[$n()];if(kb(v,r)&&!Sb(a,u)){let w=r?v.classesWithoutHost:v.stylesWithoutHost;null!==w&&(n=Ja(w,n||"")),Yy(a,v,p,n,r)}else!function xM(e,t,n,r,a,u,p,v){a===Nt&&(a=en);let w=0,I=0,k=0<a.length?a[0]:null,N=0<u.length?u[0]:null;for(;null!==k||null!==N;){const q=w<a.length?a[w+1]:void 0,Y=I<u.length?u[I+1]:void 0;let Ce,le=null;k===N?(w+=2,I+=2,q!==Y&&(le=N,Ce=Y)):null===N||null!==k&&k<N?(w+=2,le=k):(I+=2,le=N,Ce=Y),null!==le&&Ab(e,t,n,r,le,Ce,p,v),k=w<a.length?a[w]:null,N=I<u.length?u[I]:null}}(a,v,p,p[11],p[u+1],p[u+1]=function vM(e,t,n){if(null==n||""===n)return en;const r=[],a=Ws(n);if(Array.isArray(a))for(let u=0;u<a.length;u++)e(r,a[u],!0);else if("object"==typeof a)for(const u in a)a.hasOwnProperty(u)&&e(r,u,a[u]);else"string"==typeof a&&t(r,a);return r}(e,t,n),r,u)}}(Yr,$a,Wh(E(),e,t,n),!0)}const id="en-US";let ew=id;function i_(e,t,n,r,a){if(e=mt(e),Array.isArray(e))for(let u=0;u<e.length;u++)i_(e[u],t,n,r,a);else{const u=M(),p=E();let v=Zs(e)?e:mt(e.provide),w=ip(e);const I=z(),k=1048575&I.providerIndexes,N=I.directiveStart,q=I.providerIndexes>>20;if(Zs(e)||!e.multi){const Y=new eo(w,a,Ae),le=s_(v,t,a?k:k+q,N);-1===le?(Hs(nu(I,p),u,v),o_(u,e,t.length),t.push(v),I.directiveStart++,I.directiveEnd++,a&&(I.providerIndexes+=1048576),n.push(Y),p.push(Y)):(n[le]=Y,p[le]=Y)}else{const Y=s_(v,t,k+q,N),le=s_(v,t,k,k+q),Ce=Y>=0&&n[Y],Me=le>=0&&n[le];if(a&&!Me||!a&&!Ce){Hs(nu(I,p),u,v);const Pe=function zT(e,t,n,r,a){const u=new eo(e,n,Ae);return u.multi=[],u.index=t,u.componentProviders=0,Ew(u,a,r&&!n),u}(a?NT:OT,n.length,a,r,w);!a&&Me&&(n[le].providerFactory=Pe),o_(u,e,t.length,0),t.push(v),I.directiveStart++,I.directiveEnd++,a&&(I.providerIndexes+=1048576),n.push(Pe),p.push(Pe)}else o_(u,e,Y>-1?Y:le,Ew(n[a?le:Y],w,!a&&r));!a&&r&&Me&&n[le].componentProviders++}}}function o_(e,t,n,r){const a=Zs(t),u=function qf(e){return!!e.useClass}(t);if(a||u){const w=(u?mt(t.useClass):t).prototype.ngOnDestroy;if(w){const I=e.destroyHooks||(e.destroyHooks=[]);if(!a&&t.multi){const k=I.indexOf(n);-1===k?I.push(n,[r,w]):I[k+1].push(r,w)}else I.push(n,w)}}}function Ew(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function s_(e,t,n,r){for(let a=n;a<r;a++)if(t[a]===e)return a;return-1}function OT(e,t,n,r){return a_(this.multi,[])}function NT(e,t,n,r){const a=this.multi;let u;if(this.providerFactory){const p=this.providerFactory.componentProviders,v=mr(n,n[1],this.providerFactory.index,r);u=v.slice(0,p),a_(a,u);for(let w=p;w<v.length;w++)u.push(v[w])}else u=[],a_(a,u);return u}function a_(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Jn(e,t=[]){return n=>{n.providersResolver=(r,a)=>function LT(e,t,n){const r=M();if(r.firstCreatePass){const a=Ai(e);i_(n,r.data,r.blueprint,a,!0),i_(t,r.data,r.blueprint,a,!1)}}(r,a?a(e):e,t)}}class Vu{}class Iw{}class Sw extends Vu{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Xy(this);const r=vr(t);this._bootstrapComponents=Dr(r.bootstrap),this._r3Injector=p0(t,n,[{provide:Vu,useValue:this},{provide:bc,useValue:this.componentFactoryResolver}],vn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class l_ extends Iw{constructor(t){super(),this.moduleType=t}create(t){return new Sw(this.moduleType,t)}}class VT extends Vu{constructor(t,n,r){super(),this.componentFactoryResolver=new Xy(this),this.instance=null;const a=new Wf([...t,{provide:Vu,useValue:this},{provide:bc,useValue:this.componentFactoryResolver}],n||Nh(),r,new Set(["environment"]));this.injector=a,a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Tm(e,t,n=null){return new VT(e,t,n).injector}let UT=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=Hf(0,n.type),a=r.length>0?Tm([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,a)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=$e({token:e,providedIn:"environment",factory:()=>new e(ot(Na))}),e})();function Mw(e){e.getStandaloneInjector=t=>t.get(UT).getOrCreateStandaloneInjector(e)}function Lw(e,t,n,r){return function Ow(e,t,n,r,a,u){const p=t+n;return Vi(e,p,a)?Va(e,p+1,u?r.call(u,a):r(a)):Mp(e,p+1)}(E(),ue(),e,t,n,r)}function Mp(e,t){const n=e[t];return n===Nt?void 0:n}function jw(e,t,n,r){const a=e+22,u=E(),p=gi(u,a);return function Tp(e,t){return e[1].data[t].pure}(u,a)?function Nw(e,t,n,r,a,u,p){const v=t+n;return zu(e,v,a,u)?Va(e,v+2,p?r.call(p,a,u):r(a,u)):Mp(e,v+2)}(u,ue(),t,p.transform,n,r,p):p.transform(n,r)}function u_(e){return t=>{setTimeout(e,void 0,t)}}const Yn=class uA extends rr{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let a=t,u=n||(()=>null),p=r;if(t&&"object"==typeof t){const w=t;a=w.next?.bind(w),u=w.error?.bind(w),p=w.complete?.bind(w)}this.__isAsync&&(u=u_(u),a&&(a=u_(a)),p&&(p=u_(p)));const v=super.subscribe({next:a,error:u,complete:p});return t instanceof Hn&&t.add(v),v}};function hA(){return this._results[Nu()]()}class h_{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=Nu(),r=h_.prototype;r[n]||(r[n]=hA)}get changes(){return this._changes||(this._changes=new Yn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const r=this;r.dirty=!1;const a=to(t);(this._changesDetected=!function Fd(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let a=e[r],u=t[r];if(n&&(a=n(a),u=n(u)),u!==a)return!1}return!0}(r._results,a,n))&&(r._results=a,r.length=a.length,r.last=a[this.length-1],r.first=a[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Cl=(()=>{class e{}return e.__NG_ELEMENT_ID__=fA,e})();const dA=Cl,pA=class extends dA{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(t,n){const r=this._declarationTContainer.tViews,a=fm(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,n||null);a[17]=this._declarationLView[this._declarationTContainer.index];const p=this._declarationLView[19];return null!==p&&(a[19]=p.createEmbeddedView(r)),By(r,a,t),new pp(a)}};function fA(){return Am(z(),E())}function Am(e,t){return 4&e.type?new pA(t,e,vl(e,t)):null}let na=(()=>{class e{}return e.__NG_ELEMENT_ID__=mA,e})();function mA(){return Gw(z(),E())}const gA=na,$w=class extends gA{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return vl(this._hostTNode,this._hostLView)}get injector(){return new vs(this._hostTNode,this._hostLView)}get parentInjector(){const t=iu(this._hostTNode,this._hostLView);if(tr(t)){const n=xo(t,this._hostLView),r=Pa(t);return new vs(n[1].data[r+8],n)}return new vs(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=Hw(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,r){let a,u;"number"==typeof r?a=r:null!=r&&(a=r.index,u=r.injector);const p=t.createEmbeddedView(n||{},u);return this.insert(p,a),p}createComponent(t,n,r,a,u){const p=t&&!function cu(e){return"function"==typeof e}(t);let v;if(p)v=n;else{const N=n||{};v=N.index,r=N.injector,a=N.projectableNodes,u=N.environmentInjector||N.ngModuleRef}const w=p?t:new fp(xn(t)),I=r||this.parentInjector;if(!u&&null==w.ngModule){const q=(p?I:this.parentInjector).get(Na,null);q&&(u=q)}const k=w.create(I,a,void 0,u);return this.insert(k.hostView,v),k}insert(t,n){const r=t._lView,a=r[1];if(function uh(e){return qr(e[3])}(r)){const k=this.indexOf(t);if(-1!==k)this.detach(k);else{const N=r[3],q=new $w(N,N[6],N[3]);q.detach(q.indexOf(t))}}const u=this._adjustIndex(n),p=this._lContainer;!function Lu(e,t,n,r){const a=10+r,u=n.length;r>0&&(n[a-1][4]=t),r<u-10?(t[4]=n[a],Df(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const p=t[17];null!==p&&n!==p&&function sm(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(p,t);const v=t[19];null!==v&&v.insertView(e),t[2]|=64}(a,r,p,u);const v=xy(u,p),w=r[11],I=am(w,p[7]);return null!==I&&function xi(e,t,n,r,a,u){r[0]=a,r[6]=t,dp(e,r,n,1,a,u)}(a,p[6],w,r,I,v),t.attachToViewContainerRef(),Df(d_(p),u,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=Hw(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=yy(this._lContainer,n);r&&(Bn(d_(this._lContainer),n),$x(r[1],r))}detach(t){const n=this._adjustIndex(t,-1),r=yy(this._lContainer,n);return r&&null!=Bn(d_(this._lContainer),n)?new pp(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function Hw(e){return e[8]}function d_(e){return e[8]||(e[8]=[])}function Gw(e,t){let n;const r=t[e.index];if(qr(r))n=r;else{let a;if(8&e.type)a=er(r);else{const u=t[11];a=u.createComment("");const p=et(e,t);Ou(u,am(u,p),a,function vI(e,t){return e.nextSibling(t)}(u,p),!1)}t[e.index]=n=$0(r,t,a,e),gm(t,n)}return new $w(n,e,t)}class p_{constructor(t){this.queryList=t,this.matches=null}clone(){return new p_(this.queryList)}setDirty(){this.queryList.setDirty()}}class f_{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,a=[];for(let u=0;u<r;u++){const p=n.getByIndex(u);a.push(this.queries[p.indexInDeclarationView].clone())}return new f_(a)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==Kw(t,n).matches&&this.queries[n].setDirty()}}class qw{constructor(t,n,r=null){this.predicate=t,this.flags=n,this.read=r}}class m_{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const a=null!==n?n.length:0,u=this.getByIndex(r).embeddedTView(t,a);u&&(u.indexInDeclarationView=r,null!==n?n.push(u):n=[u])}return null!==n?new m_(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class g_{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new g_(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let a=0;a<r.length;a++){const u=r[a];this.matchTNodeWithReadOption(t,n,vA(n,u)),this.matchTNodeWithReadOption(t,n,br(n,t,u,!1,!1))}else r===Cl?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,br(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const a=this.metadata.read;if(null!==a)if(a===Ni||a===na||a===Cl&&4&n.type)this.addMatch(n.index,-2);else{const u=br(n,t,a,!1,!1);null!==u&&this.addMatch(n.index,u)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function vA(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function bA(e,t,n,r){return-1===n?function xA(e,t){return 11&e.type?vl(e,t):4&e.type?Am(e,t):null}(t,e):-2===n?function wA(e,t,n){return n===Ni?vl(t,e):n===Cl?Am(t,e):n===na?Gw(t,e):void 0}(e,t,r):mr(e,e[1],n,t)}function Ww(e,t,n,r){const a=t[19].queries[r];if(null===a.matches){const u=e.data,p=n.matches,v=[];for(let w=0;w<p.length;w+=2){const I=p[w];v.push(I<0?null:bA(t,u[I],p[w+1],n.metadata.read))}a.matches=v}return a.matches}function y_(e,t,n,r){const a=e.queries.getByIndex(n),u=a.matches;if(null!==u){const p=Ww(e,t,a,n);for(let v=0;v<u.length;v+=2){const w=u[v];if(w>0)r.push(p[v/2]);else{const I=u[v+1],k=t[-w];for(let N=10;N<k.length;N++){const q=k[N];q[17]===q[3]&&y_(q[1],q,I,r)}if(null!==k[9]){const N=k[9];for(let q=0;q<N.length;q++){const Y=N[q];y_(Y[1],Y,I,r)}}}}}return r}function Ap(e){const t=E(),n=M(),r=ln();tn(r+1);const a=Kw(n,r);if(e.dirty&&function fs(e){return 4==(4&e[2])}(t)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{const u=a.crossesNgTemplate?y_(n,t,r,[]):Ww(n,t,a,r);e.reset(u,tm),e.notifyOnChanges()}return!0}return!1}function __(e,t,n){const r=M();r.firstCreatePass&&(function Xw(e,t,n){null===e.queries&&(e.queries=new m_),e.queries.track(new g_(t,n))}(r,new qw(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function Zw(e,t,n){const r=new h_(4==(4&n));F0(e,t,r,r.destroy),null===t[19]&&(t[19]=new f_),t[19].queries.push(new p_(r))}(r,E(),t)}function Pp(){return function CA(e,t){return e[19].queries[t].queryList}(E(),ln())}function Kw(e,t){return e.queries.getByIndex(t)}function km(...e){}const Rm=new dt("Application Initializer");let Fm=(()=>{class e{constructor(n){this.appInits=n,this.resolve=km,this.reject=km,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,a)=>{this.resolve=r,this.reject=a})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let a=0;a<this.appInits.length;a++){const u=this.appInits[a]();if(vp(u))n.push(u);else if(Qy(u)){const p=new Promise((v,w)=>{u.subscribe({complete:v,error:w})});n.push(p)}}Promise.all(n).then(()=>{r()}).catch(a=>{this.reject(a)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(ot(Rm,8))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Rp=new dt("AppId",{providedIn:"root",factory:function m1(){return`${D_()}${D_()}${D_()}`}});function D_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const g1=new dt("Platform Initializer"),E_=new dt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),y1=new dt("appBootstrapListener");let GA=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Dl=new dt("LocaleId",{providedIn:"root",factory:()=>or(Dl,ut.Optional|ut.SkipSelf)||function qA(){return typeof $localize<"u"&&$localize.locale||id}()});class ZA{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let I_=(()=>{class e{compileModuleSync(n){return new l_(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),u=Dr(vr(n).declarations).reduce((p,v)=>{const w=xn(v);return w&&p.push(new fp(w)),p},[]);return new ZA(r,u)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const JA=(()=>Promise.resolve(0))();function S_(e){typeof Zone>"u"?JA.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ri{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Yn(!1),this.onMicrotaskEmpty=new Yn(!1),this.onStable=new Yn(!1),this.onError=new Yn(!1),typeof Zone>"u")throw new ze(908,!1);Zone.assertZonePatched();const a=this;if(a._nesting=0,a._outer=a._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const u=Zone.AsyncStackTaggingZoneSpec;a._inner=a._inner.fork(new u("Angular"))}Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!r&&n,a.shouldCoalesceRunChangeDetection=r,a.lastRequestAnimationFrameId=-1,a.nativeRequestAnimationFrame=function YA(){let e=En.requestAnimationFrame,t=En.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function t2(e){const t=()=>{!function e2(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(En,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,T_(e),e.isCheckStableRunning=!0,M_(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),T_(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,a,u,p,v)=>{try{return x1(e),n.invokeTask(a,u,p,v)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&t(),b1(e)}},onInvoke:(n,r,a,u,p,v,w)=>{try{return x1(e),n.invoke(a,u,p,v,w)}finally{e.shouldCoalesceRunChangeDetection&&t(),b1(e)}},onHasTask:(n,r,a,u)=>{n.hasTask(a,u),r===a&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,T_(e),M_(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(n,r,a,u)=>(n.handleError(a,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(a)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ri.isInAngularZone())throw new ze(909,!1)}static assertNotInAngularZone(){if(ri.isInAngularZone())throw new ze(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,a){const u=this._inner,p=u.scheduleEventTask("NgZoneEvent: "+a,t,QA,km,km);try{return u.runTask(p,n,r)}finally{u.cancelTask(p)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const QA={};function M_(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function T_(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function x1(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function b1(e){e._nesting--,M_(e)}class n2{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Yn,this.onMicrotaskEmpty=new Yn,this.onStable=new Yn,this.onError=new Yn}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,a){return t.apply(n,r)}}const w1=new dt(""),Lm=new dt("");let k_,A_=(()=>{class e{constructor(n,r,a){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,k_||(function r2(e){k_=e}(a),a.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ri.assertNotInAngularZone(),S_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())S_(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,a){let u=-1;r&&r>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==u),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:u,updateCb:a})}whenStable(n,r,a){if(a&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,a),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,a){return[]}}return e.\u0275fac=function(n){return new(n||e)(ot(ri),ot(P_),ot(Lm))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})(),P_=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return k_?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Ic=null;const C1=new dt("AllowMultipleToken"),R_=new dt("PlatformDestroyListeners");class D1{constructor(t,n){this.name=t,this.token=n}}function I1(e,t,n=[]){const r=`Platform: ${t}`,a=new dt(r);return(u=[])=>{let p=F_();if(!p||p.injector.get(C1,!1)){const v=[...n,...u,{provide:a,useValue:!0}];e?e(v):function a2(e){if(Ic&&!Ic.get(C1,!1))throw new ze(400,!1);Ic=e;const t=e.get(M1);(function E1(e){const t=e.get(g1,null);t&&t.forEach(n=>n())})(e)}(function S1(e=[],t){return Xo.create({name:t,providers:[{provide:_c,useValue:"platform"},{provide:R_,useValue:new Set([()=>Ic=null])},...e]})}(v,r))}return function c2(e){const t=F_();if(!t)throw new ze(401,!1);return t}()}}function F_(){return Ic?.get(M1)??null}let M1=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const a=function A1(e,t){let n;return n="noop"===e?new n2:("zone.js"===e?void 0:e)||new ri(t),n}(r?.ngZone,function T1(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(r)),u=[{provide:ri,useValue:a}];return a.run(()=>{const p=Xo.create({providers:u,parent:this.injector,name:n.moduleType.name}),v=n.create(p),w=v.injector.get(we,null);if(!w)throw new ze(402,!1);return a.runOutsideAngular(()=>{const I=a.onError.subscribe({next:k=>{w.handleError(k)}});v.onDestroy(()=>{Nm(this._modules,v),I.unsubscribe()})}),function P1(e,t,n){try{const r=n();return vp(r)?r.catch(a=>{throw t.runOutsideAngular(()=>e.handleError(a)),a}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(w,a,()=>{const I=v.injector.get(Fm);return I.runInitializers(),I.donePromise.then(()=>(function tw(e){pi(e,"Expected localeId to be defined"),"string"==typeof e&&(ew=e.toLowerCase().replace(/_/g,"-"))}(v.injector.get(Dl,id)||id),this._moduleDoBootstrap(v),v))})})}bootstrapModule(n,r=[]){const a=k1({},r);return function o2(e,t,n){const r=new l_(n);return Promise.resolve(r)}(0,0,n).then(u=>this.bootstrapModuleFactory(u,a))}_moduleDoBootstrap(n){const r=n.injector.get(Om);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(a=>r.bootstrap(a));else{if(!n.instance.ngDoBootstrap)throw new ze(403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ze(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(R_,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(ot(Xo))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function k1(e,t){return Array.isArray(t)?t.reduce(k1,e):{...e,...t}}let Om=(()=>{class e{constructor(n,r,a){this._zone=n,this._injector=r,this._exceptionHandler=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const u=new on(v=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{v.next(this._stable),v.complete()})}),p=new on(v=>{let w;this._zone.runOutsideAngular(()=>{w=this._zone.onStable.subscribe(()=>{ri.assertNotInAngularZone(),S_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,v.next(!0))})})});const I=this._zone.onUnstable.subscribe(()=>{ri.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{v.next(!1)}))});return()=>{w.unsubscribe(),I.unsubscribe()}});this.isStable=function Pn(...e){const t=ge(e),n=function Ke(e,t){return"number"==typeof ye(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?_r(r[0]):ee(n)(zt(r,t)):ie}(u,p.pipe(function Sr(e={}){const{connector:t=(()=>new rr),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:a=!0}=e;return u=>{let p,v,w,I=0,k=!1,N=!1;const q=()=>{v?.unsubscribe(),v=void 0},Y=()=>{q(),p=w=void 0,k=N=!1},le=()=>{const Ce=p;Y(),Ce?.unsubscribe()};return An((Ce,Me)=>{I++,!N&&!k&&q();const Pe=w=w??t();Me.add(()=>{I--,0===I&&!N&&!k&&(v=is(le,a))}),Pe.subscribe(Me),!p&&I>0&&(p=new Gi({next:Ze=>Pe.next(Ze),error:Ze=>{N=!0,q(),v=is(Y,n,Ze),Pe.error(Ze)},complete:()=>{k=!0,q(),v=is(Y,r),Pe.complete()}}),_r(Ce).subscribe(p))})(u)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const a=n instanceof Bh;if(!this._injector.get(Fm).done)throw!a&&function Bo(e){const t=xn(e)||Tr(e)||Gr(e);return null!==t&&t.standalone}(n),new ze(405,false);let p;p=a?n:this._injector.get(bc).resolveComponentFactory(n),this.componentTypes.push(p.componentType);const v=function s2(e){return e.isBoundToModule}(p)?void 0:this._injector.get(Vu),I=p.create(Xo.NULL,[],r||p.selector,v),k=I.location.nativeElement,N=I.injector.get(w1,null);return N?.registerApplication(k),I.onDestroy(()=>{this.detachView(I.hostView),Nm(this.components,I),N?.unregisterApplication(k)}),this._loadComponent(I),I}tick(){if(this._runningTick)throw new ze(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;Nm(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(y1,[]).concat(this._bootstrapListeners).forEach(a=>a(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Nm(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new ze(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(ot(ri),ot(Na),ot(we))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Nm(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let F1=!0,Fp=(()=>{class e{}return e.__NG_ELEMENT_ID__=d2,e})();function d2(e){return function p2(e,t,n){if(Gl(e)&&!n){const r=bn(e.index,t);return new pp(r,r)}return 47&e.type?new pp(t[16],t):null}(z(),E(),16==(16&e))}class B1{constructor(){}supports(t){return mp(t)}create(t){return new v2(t)}}const _2=(e,t)=>t;class v2{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||_2}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,r=this._removalsHead,a=0,u=null;for(;n||r;){const p=!r||n&&n.currentIndex<U1(r,a,u)?n:r,v=U1(p,a,u),w=p.currentIndex;if(p===r)a--,r=r._nextRemoved;else if(n=n._next,null==p.previousIndex)a++;else{u||(u=[]);const I=v-a,k=w-a;if(I!=k){for(let q=0;q<I;q++){const Y=q<u.length?u[q]:u[q]=0,le=Y+q;k<=le&&le<I&&(u[q]=Y+1)}u[p.previousIndex]=k-I}}v!==w&&t(p,v,w)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!mp(t))throw new ze(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let a,u,p,n=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let v=0;v<this.length;v++)u=t[v],p=this._trackByFn(v,u),null!==n&&Object.is(n.trackById,p)?(r&&(n=this._verifyReinsertion(n,u,p,v)),Object.is(n.item,u)||this._addIdentityChange(n,u)):(n=this._mismatch(n,u,p,v),r=!0),n=n._next}else a=0,function WS(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Nu()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(t,v=>{p=this._trackByFn(a,v),null!==n&&Object.is(n.trackById,p)?(r&&(n=this._verifyReinsertion(n,v,p,a)),Object.is(n.item,v)||this._addIdentityChange(n,v)):(n=this._mismatch(n,v,p,a),r=!0),n=n._next,a++}),this.length=a;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,r,a){let u;return null===t?u=this._itTail:(u=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,u,a)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,a))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,u,a)):t=this._addAfter(new x2(n,r),u,a),t}_verifyReinsertion(t,n,r,a){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==u?t=this._reinsertAfter(u,t._prev,a):t.currentIndex!=a&&(t.currentIndex=a,this._addToMoves(t,a)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const a=t._prevRemoved,u=t._nextRemoved;return null===a?this._removalsHead=u:a._nextRemoved=u,null===u?this._removalsTail=a:u._prevRemoved=a,this._insertAfter(t,n,r),this._addToMoves(t,r),t}_moveAfter(t,n,r){return this._unlink(t),this._insertAfter(t,n,r),this._addToMoves(t,r),t}_addAfter(t,n,r){return this._insertAfter(t,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,r){const a=null===n?this._itHead:n._next;return t._next=a,t._prev=n,null===a?this._itTail=t:a._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new V1),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,r=t._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new V1),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class x2{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class b2{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const n=t._prevDup,r=t._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class V1{constructor(){this.map=new Map}put(t){const n=t.trackById;let r=this.map.get(n);r||(r=new b2,this.map.set(n,r)),r.add(t)}get(t,n){const a=this.map.get(t);return a?a.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function U1(e,t,n){const r=e.previousIndex;if(null===r)return r;let a=0;return n&&r<n.length&&(a=n[r]),r+t+a}function $1(){return new Vm([new B1])}let Vm=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(null!=r){const a=r.factories.slice();n=n.concat(a)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||$1()),deps:[[e,new vu,new _u]]}}find(n){const r=this.factories.find(a=>a.supports(n));if(null!=r)return r;throw new ze(901,!1)}}return e.\u0275prov=$e({token:e,providedIn:"root",factory:$1}),e})();const I2=I1(null,"core",[]);let S2=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(ot(Om))},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({}),e})();function Il(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let Um=null;function Ha(){return Um}const oo=new dt("DocumentToken");let B_=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:function(){return function P2(){return ot(G1)}()},providedIn:"platform"}),e})();const k2=new dt("Location Initialized");let G1=(()=>{class e extends B_{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ha().getBaseHref(this._doc)}onPopState(n){const r=Ha().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=Ha().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,a){q1()?this._history.pushState(n,r,a):this.location.hash=a}replaceState(n,r,a){q1()?this._history.replaceState(n,r,a):this.location.hash=a}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(ot(oo))},e.\u0275prov=$e({token:e,factory:function(){return function R2(){return new G1(ot(oo))}()},providedIn:"platform"}),e})();function q1(){return!!window.history.pushState}function V_(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function W1(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Sl(e){return e&&"?"!==e[0]?"?"+e:e}let ju=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:function(){return or(X1)},providedIn:"root"}),e})();const Z1=new dt("appBaseHref");let X1=(()=>{class e extends ju{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??or(oo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return V_(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Sl(this._platformLocation.search),a=this._platformLocation.hash;return a&&n?`${r}${a}`:r}pushState(n,r,a,u){const p=this.prepareExternalUrl(a+Sl(u));this._platformLocation.pushState(n,r,p)}replaceState(n,r,a,u){const p=this.prepareExternalUrl(a+Sl(u));this._platformLocation.replaceState(n,r,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(ot(B_),ot(Z1,8))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),F2=(()=>{class e extends ju{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=V_(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,a,u){let p=this.prepareExternalUrl(a+Sl(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(n,r,p)}replaceState(n,r,a,u){let p=this.prepareExternalUrl(a+Sl(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(ot(B_),ot(Z1,8))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})(),U_=(()=>{class e{constructor(n){this._subject=new Yn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._baseHref=W1(K1(r)),this._locationStrategy.onPopState(a=>{this._subject.emit({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Sl(r))}normalize(n){return e.stripTrailingSlash(function O2(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,K1(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",a=null){this._locationStrategy.pushState(a,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Sl(r)),a)}replaceState(n,r="",a=null){this._locationStrategy.replaceState(a,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Sl(r)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(a=>a(n,r))}subscribe(n,r,a){return this._subject.subscribe({next:n,error:r,complete:a})}}return e.normalizeQueryParams=Sl,e.joinWithSlash=V_,e.stripTrailingSlash=W1,e.\u0275fac=function(n){return new(n||e)(ot(ju))},e.\u0275prov=$e({token:e,factory:function(){return function L2(){return new U_(ot(ju))}()},providedIn:"root"}),e})();function K1(e){return e.replace(/\/index.html$/,"")}function oC(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[a,u]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(a.trim()===t)return decodeURIComponent(u)}return null}class bP{constructor(t,n,r,a){this.$implicit=t,this.ngForOf=n,this.index=r,this.count=a}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Jm=(()=>{class e{constructor(n,r,a){this._viewContainer=n,this._template=r,this._differs=a,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((a,u,p)=>{if(null==a.previousIndex)r.createEmbeddedView(this._template,new bP(a.item,this._ngForOf,-1,-1),null===p?void 0:p);else if(null==p)r.remove(null===u?void 0:u);else if(null!==u){const v=r.get(u);r.move(v,p),lC(v,a)}});for(let a=0,u=r.length;a<u;a++){const v=r.get(a).context;v.index=a,v.count=u,v.ngForOf=this._ngForOf}n.forEachIdentityChange(a=>{lC(r.get(a.currentIndex),a)})}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(Ae(na),Ae(Cl),Ae(Vm))},e.\u0275dir=lt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function lC(e,t){e.context.$implicit=t.item}let J_=(()=>{class e{constructor(n,r){this._viewContainer=n,this._context=new CP,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){cC("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){cC("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(Ae(na),Ae(Cl))},e.\u0275dir=lt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class CP{constructor(){this.$implicit=null,this.ngIf=null}}function cC(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${vn(t)}'.`)}let nv=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({}),e})();let QP=(()=>{class e{}return e.\u0275prov=$e({token:e,providedIn:"root",factory:()=>new ek(ot(oo),window)}),e})();class ek{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function tk(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let a=r.currentNode;for(;a;){const u=a.shadowRoot;if(u){const p=u.getElementById(t)||u.querySelector(`[name="${t}"]`);if(p)return p}a=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,a=n.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(r-u[0],a-u[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=pC(this.window.history)||pC(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function pC(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class fC{}class ov extends class vk extends class A2{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function T2(e){Um||(Um=e)}(new ov)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function xk(){return Bp=Bp||document.querySelector("base"),Bp?Bp.getAttribute("href"):null}();return null==n?null:function bk(e){Qm=Qm||document.createElement("a"),Qm.setAttribute("href",e);const t=Qm.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Bp=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return oC(document.cookie,t)}}let Qm,Bp=null;const _C=new dt("TRANSITION_ID"),Ck=[{provide:Rm,useFactory:function wk(e,t,n){return()=>{n.get(Fm).donePromise.then(()=>{const r=Ha(),a=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let u=0;u<a.length;u++)r.remove(a[u])})}},deps:[_C,oo,Xo],multi:!0}];let Ek=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();const eg=new dt("EventManagerPlugins");let tg=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(a=>a.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,a){return this._findPluginFor(r).addEventListener(n,r,a)}addGlobalEventListener(n,r,a){return this._findPluginFor(r).addGlobalEventListener(n,r,a)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const a=this._plugins;for(let u=0;u<a.length;u++){const p=a[u];if(p.supports(n))return this._eventNameToPlugin.set(n,p),p}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(ot(eg),ot(ri))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();class vC{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const a=Ha().getGlobalEventTarget(this._doc,t);if(!a)throw new Error(`Unsupported event target ${a} for event ${n}`);return this.addEventListener(a,n,r)}}let xC=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(a=>{this._stylesSet.has(a)||(this._stylesSet.add(a),r.add(a))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})(),Vp=(()=>{class e extends xC{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,a){n.forEach(u=>{const p=this._doc.createElement("style");p.textContent=u,a.push(r.appendChild(p))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(bC),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,a)=>{this._addStylesToHost(n,a,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(bC))}}return e.\u0275fac=function(n){return new(n||e)(ot(oo))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();function bC(e){Ha().remove(e)}const sv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},av=/%COMP%/g;function ng(e,t,n){for(let r=0;r<t.length;r++){let a=t[r];Array.isArray(a)?ng(e,a,n):(a=a.replace(av,e),n.push(a))}return n}function DC(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let lv=(()=>{class e{constructor(n,r,a){this.eventManager=n,this.sharedStylesHost=r,this.appId=a,this.rendererByCompId=new Map,this.defaultRenderer=new cv(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case fo.Emulated:{let a=this.rendererByCompId.get(r.id);return a||(a=new Pk(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,a)),a.applyToHost(n),a}case 1:case fo.ShadowDom:return new kk(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const a=ng(r.id,r.styles,[]);this.sharedStylesHost.addStyles(a),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(ot(tg),ot(Vp),ot(Rp))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();class cv{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(sv[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(IC(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(IC(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,a){if(a){n=a+":"+n;const u=sv[a];u?t.setAttributeNS(u,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const a=sv[r];a?t.removeAttributeNS(a,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,a){a&(vi.DashCase|vi.Important)?t.style.setProperty(n,r,a&vi.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&vi.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,DC(r)):this.eventManager.addEventListener(t,n,DC(r))}}function IC(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Pk extends cv{constructor(t,n,r,a){super(t),this.component=r;const u=ng(a+"-"+r.id,r.styles,[]);n.addStyles(u),this.contentAttr=function Mk(e){return"_ngcontent-%COMP%".replace(av,e)}(a+"-"+r.id),this.hostAttr=function Tk(e){return"_nghost-%COMP%".replace(av,e)}(a+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}class kk extends cv{constructor(t,n,r,a){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=ng(a.id,a.styles,[]);for(let p=0;p<u.length;p++){const v=document.createElement("style");v.textContent=u[p],this.shadowRoot.appendChild(v)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let Rk=(()=>{class e extends vC{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,a){return n.addEventListener(r,a,!1),()=>this.removeEventListener(n,r,a)}removeEventListener(n,r,a){return n.removeEventListener(r,a)}}return e.\u0275fac=function(n){return new(n||e)(ot(oo))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();const SC=["alt","control","meta","shift"],Fk={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Lk={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Ok=(()=>{class e extends vC{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,a){const u=e.parseEventName(r),p=e.eventCallback(u.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ha().onAndCancel(n,u.domEventName,p))}static parseEventName(n){const r=n.toLowerCase().split("."),a=r.shift();if(0===r.length||"keydown"!==a&&"keyup"!==a)return null;const u=e._normalizeKey(r.pop());let p="",v=r.indexOf("code");if(v>-1&&(r.splice(v,1),p="code."),SC.forEach(I=>{const k=r.indexOf(I);k>-1&&(r.splice(k,1),p+=I+".")}),p+=u,0!=r.length||0===u.length)return null;const w={};return w.domEventName=a,w.fullKey=p,w}static matchEventFullKeyCode(n,r){let a=Fk[n.key]||n.key,u="";return r.indexOf("code.")>-1&&(a=n.code,u="code."),!(null==a||!a)&&(a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),SC.forEach(p=>{p!==a&&(0,Lk[p])(n)&&(u+=p+".")}),u+=a,u===r)}static eventCallback(n,r,a){return u=>{e.matchEventFullKeyCode(u,n)&&a.runGuarded(()=>r(u))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(ot(oo))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();const Vk=I1(I2,"browser",[{provide:E_,useValue:"browser"},{provide:g1,useValue:function Nk(){ov.makeCurrent()},multi:!0},{provide:oo,useFactory:function Bk(){return function wn(e){Dh=e}(document),document},deps:[]}]),AC=new dt(""),PC=[{provide:Lm,useClass:class Dk{addToWindow(t){En.getAngularTestability=(r,a=!0)=>{const u=t.findTestabilityInTree(r,a);if(null==u)throw new Error("Could not find testability for element.");return u},En.getAllAngularTestabilities=()=>t.getAllTestabilities(),En.getAllAngularRootElements=()=>t.getAllRootElements(),En.frameworkStabilizers||(En.frameworkStabilizers=[]),En.frameworkStabilizers.push(r=>{const a=En.getAllAngularTestabilities();let u=a.length,p=!1;const v=function(w){p=p||w,u--,0==u&&r(p)};a.forEach(function(w){w.whenStable(v)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?Ha().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:w1,useClass:A_,deps:[ri,P_,Lm]},{provide:A_,useClass:A_,deps:[ri,P_,Lm]}],kC=[{provide:_c,useValue:"root"},{provide:we,useFactory:function zk(){return new we},deps:[]},{provide:eg,useClass:Rk,multi:!0,deps:[oo,ri,E_]},{provide:eg,useClass:Ok,multi:!0,deps:[oo]},{provide:lv,useClass:lv,deps:[tg,Vp,Rp]},{provide:Uh,useExisting:lv},{provide:xC,useExisting:Vp},{provide:Vp,useClass:Vp,deps:[oo]},{provide:tg,useClass:tg,deps:[eg,ri]},{provide:fC,useClass:Ek,deps:[]},[]];let Uk=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:Rp,useValue:n.appId},{provide:_C,useExisting:Rp},Ck]}}}return e.\u0275fac=function(n){return new(n||e)(ot(AC,12))},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({providers:[...kC,...PC],imports:[nv,S2]}),e})(),RC=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(ot(oo))},e.\u0275prov=$e({token:e,factory:function(n){let r=null;return r=n?new n:function $k(){return new RC(ot(oo))}(),r},providedIn:"root"}),e})();function yt(...e){return zt(e,ge(e))}typeof window<"u"&&window;class sa extends rr{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}const rg=Nc(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:Jk}=Array,{getPrototypeOf:Yk,prototype:Qk,keys:eR}=Object;const{isArray:nR}=Array;function BC(...e){const t=ge(e),n=Ee(e),{args:r,keys:a}=function OC(e){if(1===e.length){const t=e[0];if(Jk(t))return{args:t,keys:null};if(function tR(e){return e&&"object"==typeof e&&Yk(e)===Qk}(t)){const n=eR(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return zt([],t);const u=new on(function iR(e,t,n=Ur){return r=>{VC(t,()=>{const{length:a}=e,u=new Array(a);let p=a,v=a;for(let w=0;w<a;w++)VC(t,()=>{const I=zt(e[w],t);let k=!1;I.subscribe(Qt(r,N=>{u[w]=N,k||(k=!0,v--),v||r.next(n(u.slice()))},()=>{--p||r.complete()}))},r)},r)}}(r,t,a?p=>function zC(e,t){return e.reduce((n,r,a)=>(n[r]=t[a],n),{})}(a,p):Ur));return n?u.pipe(function NC(e){return At(t=>function rR(e,t){return nR(t)?e(...t):e(t)}(e,t))}(n)):u}function VC(e,t,n){e?O(n,e,t):t()}function dv(...e){return function oR(){return ee(1)}()(zt(e,ge(e)))}function UC(e){return new on(t=>{_r(e()).subscribe(t)})}function Up(e,t){const n=Tn(e)?e:()=>e,r=a=>a.error(n());return new on(t?a=>t.schedule(r,0,a):r)}function pv(){return An((e,t)=>{let n=null;e._refCount++;const r=Qt(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const a=e._connection,u=n;n=null,a&&(!u||a===u)&&a.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class jC extends on{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Ro(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Hn;const n=this.getSubject();t.add(this.source.subscribe(Qt(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Hn.EMPTY)}return t}refCount(){return pv()(this)}}function Ga(e,t){return An((n,r)=>{let a=null,u=0,p=!1;const v=()=>p&&!a&&r.complete();n.subscribe(Qt(r,w=>{a?.unsubscribe();let I=0;const k=u++;_r(e(w,k)).subscribe(a=Qt(r,N=>r.next(t?t(w,N,k,I++):N),()=>{a=null,v()}))},()=>{p=!0,v()}))})}function jp(e){return e<=0?()=>ie:An((t,n)=>{let r=0;t.subscribe(Qt(n,a=>{++r<=e&&(n.next(a),e<=r&&n.complete())}))})}function Tl(e,t){return An((n,r)=>{let a=0;n.subscribe(Qt(r,u=>e.call(t,u,a++)&&r.next(u)))})}function ig(e){return An((t,n)=>{let r=!1;t.subscribe(Qt(n,a=>{r=!0,n.next(a)},()=>{r||n.next(e),n.complete()}))})}function $C(e=aR){return An((t,n)=>{let r=!1;t.subscribe(Qt(n,a=>{r=!0,n.next(a)},()=>r?n.complete():n.error(e())))})}function aR(){return new rg}function Mc(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Tl((a,u)=>e(a,u,r)):Ur,jp(1),n?ig(t):$C(()=>new rg))}function Tc(e,t){return Tn(t)?$(e,t,1):$(e,1)}function ji(e,t,n){const r=Tn(e)||t||n?{next:e,error:t,complete:n}:e;return r?An((a,u)=>{var p;null===(p=r.subscribe)||void 0===p||p.call(r);let v=!0;a.subscribe(Qt(u,w=>{var I;null===(I=r.next)||void 0===I||I.call(r,w),u.next(w)},()=>{var w;v=!1,null===(w=r.complete)||void 0===w||w.call(r),u.complete()},w=>{var I;v=!1,null===(I=r.error)||void 0===I||I.call(r,w),u.error(w)},()=>{var w,I;v&&(null===(w=r.unsubscribe)||void 0===w||w.call(r)),null===(I=r.finalize)||void 0===I||I.call(r)}))}):Ur}function Ac(e){return An((t,n)=>{let u,r=null,a=!1;r=t.subscribe(Qt(n,void 0,void 0,p=>{u=_r(e(p,Ac(e)(t))),r?(r.unsubscribe(),r=null,u.subscribe(n)):a=!0})),a&&(r.unsubscribe(),r=null,u.subscribe(n))})}function lR(e,t,n,r,a){return(u,p)=>{let v=n,w=t,I=0;u.subscribe(Qt(p,k=>{const N=I++;w=v?e(w,k,N):(v=!0,k),r&&p.next(w)},a&&(()=>{v&&p.next(w),p.complete()})))}}function HC(e,t){return An(lR(e,t,arguments.length>=2,!0))}function fv(e){return e<=0?()=>ie:An((t,n)=>{let r=[];t.subscribe(Qt(n,a=>{r.push(a),e<r.length&&r.shift()},()=>{for(const a of r)n.next(a);n.complete()},void 0,()=>{r=null}))})}function GC(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Tl((a,u)=>e(a,u,r)):Ur,fv(1),n?ig(t):$C(()=>new rg))}function mv(e){return An((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const Zt="primary",$p=Symbol("RouteTitle");class hR{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function ad(e){return new hR(e)}function dR(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const a={};for(let u=0;u<r.length;u++){const p=r[u],v=e[u];if(p.startsWith(":"))a[p.substring(1)]=v;else if(p!==v.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}function qa(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let a;for(let u=0;u<n.length;u++)if(a=n[u],!qC(e[a],t[a]))return!1;return!0}function qC(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((a,u)=>r[u]===a)}return e===t}function WC(e){return Array.prototype.concat.apply([],e)}function ZC(e){return e.length>0?e[e.length-1]:null}function bi(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Pc(e){return Qy(e)?e:vp(e)?zt(Promise.resolve(e)):yt(e)}const mR={exact:function JC(e,t,n){if(!Hu(e.segments,t.segments)||!og(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!JC(e.children[r],t.children[r],n))return!1;return!0},subset:YC},XC={exact:function gR(e,t){return qa(e,t)},subset:function yR(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>qC(e[n],t[n]))},ignored:()=>!0};function KC(e,t,n){return mR[n.paths](e.root,t.root,n.matrixParams)&&XC[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function YC(e,t,n){return QC(e,t,t.segments,n)}function QC(e,t,n,r){if(e.segments.length>n.length){const a=e.segments.slice(0,n.length);return!(!Hu(a,n)||t.hasChildren()||!og(a,n,r))}if(e.segments.length===n.length){if(!Hu(e.segments,n)||!og(e.segments,n,r))return!1;for(const a in t.children)if(!e.children[a]||!YC(e.children[a],t.children[a],r))return!1;return!0}{const a=n.slice(0,e.segments.length),u=n.slice(e.segments.length);return!!(Hu(e.segments,a)&&og(e.segments,a,r)&&e.children[Zt])&&QC(e.children[Zt],t,u,r)}}function og(e,t,n){return t.every((r,a)=>XC[n](e[a].parameters,r.parameters))}class $u{constructor(t,n,r){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ad(this.queryParams)),this._queryParamMap}toString(){return xR.serialize(this)}}class Yt{constructor(t,n){this.segments=t,this.children=n,this.parent=null,bi(n,(r,a)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return sg(this)}}class Hp{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=ad(this.parameters)),this._parameterMap}toString(){return rD(this)}}function Hu(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let eD=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:function(){return new yv},providedIn:"root"}),e})();class yv{parse(t){const n=new TR(t);return new $u(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${Gp(t.root,!0)}`,r=function CR(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(a=>`${ag(n)}=${ag(a)}`).join("&"):`${ag(n)}=${ag(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function bR(e){return encodeURI(e)}(t.fragment)}`:""}`}}const xR=new yv;function sg(e){return e.segments.map(t=>rD(t)).join("/")}function Gp(e,t){if(!e.hasChildren())return sg(e);if(t){const n=e.children[Zt]?Gp(e.children[Zt],!1):"",r=[];return bi(e.children,(a,u)=>{u!==Zt&&r.push(`${u}:${Gp(a,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function vR(e,t){let n=[];return bi(e.children,(r,a)=>{a===Zt&&(n=n.concat(t(r,a)))}),bi(e.children,(r,a)=>{a!==Zt&&(n=n.concat(t(r,a)))}),n}(e,(r,a)=>a===Zt?[Gp(e.children[Zt],!1)]:[`${a}:${Gp(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Zt]?`${sg(e)}/${n[0]}`:`${sg(e)}/(${n.join("//")})`}}function tD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ag(e){return tD(e).replace(/%3B/gi,";")}function _v(e){return tD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function lg(e){return decodeURIComponent(e)}function nD(e){return lg(e.replace(/\+/g,"%20"))}function rD(e){return`${_v(e.path)}${function wR(e){return Object.keys(e).map(t=>`;${_v(t)}=${_v(e[t])}`).join("")}(e.parameters)}`}const DR=/^[^\/()?;=#]+/;function cg(e){const t=e.match(DR);return t?t[0]:""}const ER=/^[^=?&#]+/,SR=/^[^&#]+/;class TR{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Yt([],{}):new Yt([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[Zt]=new Yt(t,n)),r}parseSegment(){const t=cg(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new ze(4009,!1);return this.capture(t),new Hp(lg(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=cg(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const a=cg(this.remaining);a&&(r=a,this.capture(r))}t[lg(n)]=lg(r)}parseQueryParam(t){const n=function IR(e){const t=e.match(ER);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const p=function MR(e){const t=e.match(SR);return t?t[0]:""}(this.remaining);p&&(r=p,this.capture(r))}const a=nD(n),u=nD(r);if(t.hasOwnProperty(a)){let p=t[a];Array.isArray(p)||(p=[p],t[a]=p),p.push(u)}else t[a]=u}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=cg(this.remaining),a=this.remaining[r.length];if("/"!==a&&")"!==a&&";"!==a)throw new ze(4010,!1);let u;r.indexOf(":")>-1?(u=r.slice(0,r.indexOf(":")),this.capture(u),this.capture(":")):t&&(u=Zt);const p=this.parseChildren();n[u]=1===Object.keys(p).length?p[Zt]:new Yt([],p),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new ze(4011,!1)}}function vv(e){return e.segments.length>0?new Yt([],{[Zt]:e}):e}function ug(e){const t={};for(const r of Object.keys(e.children)){const u=ug(e.children[r]);(u.segments.length>0||u.hasChildren())&&(t[r]=u)}return function AR(e){if(1===e.numberOfChildren&&e.children[Zt]){const t=e.children[Zt];return new Yt(e.segments.concat(t.segments),t.children)}return e}(new Yt(e.segments,t))}function Gu(e){return e instanceof $u}function RR(e,t,n,r,a){if(0===n.length)return ld(t.root,t.root,t.root,r,a);const u=function sD(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new oD(!0,0,e);let t=0,n=!1;const r=e.reduce((a,u,p)=>{if("object"==typeof u&&null!=u){if(u.outlets){const v={};return bi(u.outlets,(w,I)=>{v[I]="string"==typeof w?w.split("/"):w}),[...a,{outlets:v}]}if(u.segmentPath)return[...a,u.segmentPath]}return"string"!=typeof u?[...a,u]:0===p?(u.split("/").forEach((v,w)=>{0==w&&"."===v||(0==w&&""===v?n=!0:".."===v?t++:""!=v&&a.push(v))}),a):[...a,u]},[]);return new oD(n,t,r)}(n);return u.toRoot()?ld(t.root,t.root,new Yt([],{}),r,a):function p(w){const I=function LR(e,t,n,r){if(e.isAbsolute)return new cd(t.root,!0,0);if(-1===r)return new cd(n,n===t.root,0);return function aD(e,t,n){let r=e,a=t,u=n;for(;u>a;){if(u-=a,r=r.parent,!r)throw new ze(4005,!1);a=r.segments.length}return new cd(r,!1,a-u)}(n,r+(qp(e.commands[0])?0:1),e.numberOfDoubleDots)}(u,t,e.snapshot?._urlSegment,w),k=I.processChildren?Zp(I.segmentGroup,I.index,u.commands):bv(I.segmentGroup,I.index,u.commands);return ld(t.root,I.segmentGroup,k,r,a)}(e.snapshot?._lastPathIndex)}function qp(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Wp(e){return"object"==typeof e&&null!=e&&e.outlets}function ld(e,t,n,r,a){let p,u={};r&&bi(r,(w,I)=>{u[I]=Array.isArray(w)?w.map(k=>`${k}`):`${w}`}),p=e===t?n:iD(e,t,n);const v=vv(ug(p));return new $u(v,u,a)}function iD(e,t,n){const r={};return bi(e.children,(a,u)=>{r[u]=a===t?n:iD(a,t,n)}),new Yt(e.segments,r)}class oD{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&qp(r[0]))throw new ze(4003,!1);const a=r.find(Wp);if(a&&a!==ZC(r))throw new ze(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class cd{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function bv(e,t,n){if(e||(e=new Yt([],{})),0===e.segments.length&&e.hasChildren())return Zp(e,t,n);const r=function NR(e,t,n){let r=0,a=t;const u={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(r>=n.length)return u;const p=e.segments[a],v=n[r];if(Wp(v))break;const w=`${v}`,I=r<n.length-1?n[r+1]:null;if(a>0&&void 0===w)break;if(w&&I&&"object"==typeof I&&void 0===I.outlets){if(!cD(w,I,p))return u;r+=2}else{if(!cD(w,{},p))return u;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,t,n),a=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const u=new Yt(e.segments.slice(0,r.pathIndex),{});return u.children[Zt]=new Yt(e.segments.slice(r.pathIndex),e.children),Zp(u,0,a)}return r.match&&0===a.length?new Yt(e.segments,{}):r.match&&!e.hasChildren()?wv(e,t,n):r.match?Zp(e,0,a):wv(e,t,n)}function Zp(e,t,n){if(0===n.length)return new Yt(e.segments,{});{const r=function OR(e){return Wp(e[0])?e[0].outlets:{[Zt]:e}}(n),a={};return bi(r,(u,p)=>{"string"==typeof u&&(u=[u]),null!==u&&(a[p]=bv(e.children[p],t,u))}),bi(e.children,(u,p)=>{void 0===r[p]&&(a[p]=u)}),new Yt(e.segments,a)}}function wv(e,t,n){const r=e.segments.slice(0,t);let a=0;for(;a<n.length;){const u=n[a];if(Wp(u)){const w=zR(u.outlets);return new Yt(r,w)}if(0===a&&qp(n[0])){r.push(new Hp(e.segments[t].path,lD(n[0]))),a++;continue}const p=Wp(u)?u.outlets[Zt]:`${u}`,v=a<n.length-1?n[a+1]:null;p&&v&&qp(v)?(r.push(new Hp(p,lD(v))),a+=2):(r.push(new Hp(p,{})),a++)}return new Yt(r,{})}function zR(e){const t={};return bi(e,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=wv(new Yt([],{}),0,n))}),t}function lD(e){const t={};return bi(e,(n,r)=>t[r]=`${n}`),t}function cD(e,t,n){return e==n.path&&qa(t,n.parameters)}class Al{constructor(t,n){this.id=t,this.url=n}}class Cv extends Al{constructor(t,n,r="imperative",a=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class qu extends Al{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class hg extends Al{constructor(t,n,r,a){super(t,n),this.reason=r,this.code=a,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class uD extends Al{constructor(t,n,r,a){super(t,n),this.error=r,this.target=a,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class BR extends Al{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class VR extends Al{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class UR extends Al{constructor(t,n,r,a,u){super(t,n),this.urlAfterRedirects=r,this.state=a,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class jR extends Al{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class $R extends Al{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class HR{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class GR{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class qR{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class WR{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZR{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class XR{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hD{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class dD{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Dv(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=Dv(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=Ev(t,this._root);return n.length<2?[]:n[n.length-2].children.map(a=>a.value).filter(a=>a!==t)}pathFromRoot(t){return Ev(t,this._root).map(n=>n.value)}}function Dv(e,t){if(e===t.value)return t;for(const n of t.children){const r=Dv(e,n);if(r)return r}return null}function Ev(e,t){if(e===t.value)return[t];for(const n of t.children){const r=Ev(e,n);if(r.length)return r.unshift(t),r}return[]}class Pl{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function ud(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class pD extends dD{constructor(t,n){super(t),this.snapshot=n,Iv(this,t)}toString(){return this.snapshot.toString()}}function fD(e,t){const n=function JR(e,t){const p=new dg([],{},{},"",{},Zt,t,null,e.root,-1,{});return new gD("",new Pl(p,[]))}(e,t),r=new sa([new Hp("",{})]),a=new sa({}),u=new sa({}),p=new sa({}),v=new sa(""),w=new kc(r,a,p,v,u,Zt,t,n.root);return w.snapshot=n.root,new pD(new Pl(w,[]),n)}class kc{constructor(t,n,r,a,u,p,v,w){this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=u,this.outlet=p,this.component=v,this.title=this.data?.pipe(At(I=>I[$p]))??yt(void 0),this._futureSnapshot=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(At(t=>ad(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(At(t=>ad(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function mD(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const a=n[r],u=n[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(u.component)break;r--}}return function YR(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class dg{constructor(t,n,r,a,u,p,v,w,I,k,N,q){this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=u,this.outlet=p,this.component=v,this.title=this.data?.[$p],this.routeConfig=w,this._urlSegment=I,this._lastPathIndex=k,this._correctedLastPathIndex=q??k,this._resolve=N}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ad(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ad(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class gD extends dD{constructor(t,n){super(n),this.url=t,Iv(this,n)}toString(){return yD(this._root)}}function Iv(e,t){t.value._routerState=e,t.children.forEach(n=>Iv(e,n))}function yD(e){const t=e.children.length>0?` { ${e.children.map(yD).join(", ")} } `:"";return`${e.value}${t}`}function Sv(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,qa(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),qa(t.params,n.params)||e.params.next(n.params),function pR(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!qa(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),qa(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Mv(e,t){const n=qa(e.params,t.params)&&function _R(e,t){return Hu(e,t)&&e.every((n,r)=>qa(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||Mv(e.parent,t.parent))}function Xp(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const a=function eF(e,t,n){return t.children.map(r=>{for(const a of n.children)if(e.shouldReuseRoute(r.value,a.value.snapshot))return Xp(e,r,a);return Xp(e,r)})}(e,t,n);return new Pl(r,a)}{if(e.shouldAttach(t.value)){const u=e.retrieve(t.value);if(null!==u){const p=u.route;return p.value._futureSnapshot=t.value,p.children=t.children.map(v=>Xp(e,v)),p}}const r=function tF(e){return new kc(new sa(e.url),new sa(e.params),new sa(e.queryParams),new sa(e.fragment),new sa(e.data),e.outlet,e.component,e)}(t.value),a=t.children.map(u=>Xp(e,u));return new Pl(r,a)}}const Tv="ngNavigationCancelingError";function _D(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=Gu(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,a=vD(!1,0,t);return a.url=n,a.navigationBehaviorOptions=r,a}function vD(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[Tv]=!0,r.cancellationCode=t,n&&(r.url=n),r}function xD(e){return bD(e)&&Gu(e.url)}function bD(e){return e&&e[Tv]}class nF{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Kp,this.attachRef=null}}let Kp=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const a=this.getOrCreateContext(n);a.outlet=r,this.contexts.set(n,a)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new nF,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const pg=!1;let Av=(()=>{class e{constructor(n,r,a,u,p){this.parentContexts=n,this.location=r,this.changeDetector=u,this.environmentInjector=p,this.activated=null,this._activatedRoute=null,this.activateEvents=new Yn,this.deactivateEvents=new Yn,this.attachEvents=new Yn,this.detachEvents=new Yn,this.name=a||Zt,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ze(4012,pg);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ze(4012,pg);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ze(4012,pg);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new ze(4013,pg);this._activatedRoute=n;const a=this.location,p=n._futureSnapshot.component,v=this.parentContexts.getOrCreateContext(this.name).children,w=new rF(n,v,a.injector);if(r&&function iF(e){return!!e.resolveComponentFactory}(r)){const I=r.resolveComponentFactory(p);this.activated=a.createComponent(I,a.length,w)}else this.activated=a.createComponent(p,{index:a.length,injector:w,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(Ae(Kp),Ae(na),oc("name"),Ae(Fp),Ae(Na))},e.\u0275dir=lt({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),e})();class rF{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===kc?this.route:t===Kp?this.childContexts:this.parent.get(t,n)}}let Pv=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Kt({type:e,selectors:[["ng-component"]],standalone:!0,features:[Mw],decls:1,vars:0,template:function(n,r){1&n&&Or(0,"router-outlet")},dependencies:[Av],encapsulation:2}),e})();function wD(e,t){return e.providers&&!e._injector&&(e._injector=Tm(e.providers,t,`Route: ${e.path}`)),e._injector??t}function Rv(e){const t=e.children&&e.children.map(Rv),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Zt&&(n.component=Pv),n}function Ts(e){return e.outlet||Zt}function CD(e,t){const n=e.filter(r=>Ts(r)===t);return n.push(...e.filter(r=>Ts(r)!==t)),n}function Jp(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class cF{constructor(t,n,r,a){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=a}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),Sv(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const a=ud(n);t.children.forEach(u=>{const p=u.value.outlet;this.deactivateRoutes(u,a[p],r),delete a[p]}),bi(a,(u,p)=>{this.deactivateRouteAndItsChildren(u,r)})}deactivateRoutes(t,n,r){const a=t.value,u=n?n.value:null;if(a===u)if(a.component){const p=r.getContext(a.outlet);p&&this.deactivateChildRoutes(t,n,p.children)}else this.deactivateChildRoutes(t,n,r);else u&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),a=r&&t.value.component?r.children:n,u=ud(t);for(const p of Object.keys(u))this.deactivateRouteAndItsChildren(u[p],a);if(r&&r.outlet){const p=r.outlet.detach(),v=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:p,route:t,contexts:v})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),a=r&&t.value.component?r.children:n,u=ud(t);for(const p of Object.keys(u))this.deactivateRouteAndItsChildren(u[p],a);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,n,r){const a=ud(n);t.children.forEach(u=>{this.activateRoutes(u,a[u.value.outlet],r),this.forwardEvent(new XR(u.value.snapshot))}),t.children.length&&this.forwardEvent(new WR(t.value.snapshot))}activateRoutes(t,n,r){const a=t.value,u=n?n.value:null;if(Sv(a),a===u)if(a.component){const p=r.getOrCreateContext(a.outlet);this.activateChildRoutes(t,n,p.children)}else this.activateChildRoutes(t,n,r);else if(a.component){const p=r.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const v=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),p.children.onOutletReAttached(v.contexts),p.attachRef=v.componentRef,p.route=v.route.value,p.outlet&&p.outlet.attach(v.componentRef,v.route.value),Sv(v.route.value),this.activateChildRoutes(t,null,p.children)}else{const v=Jp(a.snapshot),w=v?.get(bc)??null;p.attachRef=null,p.route=a,p.resolver=w,p.injector=v,p.outlet&&p.outlet.activateWith(a,p.injector),this.activateChildRoutes(t,null,p.children)}}else this.activateChildRoutes(t,null,r)}}class DD{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class fg{constructor(t,n){this.component=t,this.route=n}}function uF(e,t,n){const r=e._root;return Yp(r,t?t._root:null,n,[r.value])}function hd(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function el(e){return null!==os(e)}(e)?t.get(e):e:r}function Yp(e,t,n,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=ud(t);return e.children.forEach(p=>{(function dF(e,t,n,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,p=t?t.value:null,v=n?n.getContext(e.value.outlet):null;if(p&&u.routeConfig===p.routeConfig){const w=function pF(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Hu(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Hu(e.url,t.url)||!qa(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Mv(e,t)||!qa(e.queryParams,t.queryParams);default:return!Mv(e,t)}}(p,u,u.routeConfig.runGuardsAndResolvers);w?a.canActivateChecks.push(new DD(r)):(u.data=p.data,u._resolvedData=p._resolvedData),Yp(e,t,u.component?v?v.children:null:n,r,a),w&&v&&v.outlet&&v.outlet.isActivated&&a.canDeactivateChecks.push(new fg(v.outlet.component,p))}else p&&Qp(t,v,a),a.canActivateChecks.push(new DD(r)),Yp(e,null,u.component?v?v.children:null:n,r,a)})(p,u[p.value.outlet],n,r.concat([p.value]),a),delete u[p.value.outlet]}),bi(u,(p,v)=>Qp(p,n.getContext(v),a)),a}function Qp(e,t,n){const r=ud(e),a=e.value;bi(r,(u,p)=>{Qp(u,a.component?t?t.children.getContext(p):null:t,n)}),n.canDeactivateChecks.push(new fg(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}function ef(e){return"function"==typeof e}function Fv(e){return e instanceof rg||"EmptyError"===e?.name}const mg=Symbol("INITIAL_VALUE");function dd(){return Ga(e=>BC(e.map(t=>t.pipe(jp(1),function sR(...e){const t=ge(e);return An((n,r)=>{(t?dv(e,n,t):dv(e,n)).subscribe(r)})}(mg)))).pipe(At(t=>{for(const n of t)if(!0!==n){if(n===mg)return mg;if(!1===n||n instanceof $u)return n}return!0}),Tl(t=>t!==mg),jp(1)))}function ED(e){return function Po(...e){return Ei(e)}(ji(t=>{if(Gu(t))throw _D(0,t)}),At(t=>!0===t))}const Lv={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ID(e,t,n,r,a){const u=Ov(e,t,n);return u.matched?function AF(e,t,n,r){const a=t.canMatch;return a&&0!==a.length?yt(a.map(p=>{const v=hd(p,e);return Pc(function vF(e){return e&&ef(e.canMatch)}(v)?v.canMatch(t,n):e.runInContext(()=>v(t,n)))})).pipe(dd(),ED()):yt(!0)}(r=wD(t,r),t,n).pipe(At(p=>!0===p?u:{...Lv})):yt(u)}function Ov(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...Lv}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const a=(t.matcher||dR)(n,e,t);if(!a)return{...Lv};const u={};bi(a.posParams,(v,w)=>{u[w]=v.path});const p=a.consumed.length>0?{...u,...a.consumed[a.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:a.consumed,remainingSegments:n.slice(a.consumed.length),parameters:p,positionalParamSegments:a.posParams??{}}}function gg(e,t,n,r,a="corrected"){if(n.length>0&&function RF(e,t,n){return n.some(r=>yg(e,t,r)&&Ts(r)!==Zt)}(e,n,r)){const p=new Yt(t,function kF(e,t,n,r){const a={};a[Zt]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const u of n)if(""===u.path&&Ts(u)!==Zt){const p=new Yt([],{});p._sourceSegment=e,p._segmentIndexShift=t.length,a[Ts(u)]=p}return a}(e,t,r,new Yt(n,e.children)));return p._sourceSegment=e,p._segmentIndexShift=t.length,{segmentGroup:p,slicedSegments:[]}}if(0===n.length&&function FF(e,t,n){return n.some(r=>yg(e,t,r))}(e,n,r)){const p=new Yt(e.segments,function PF(e,t,n,r,a,u){const p={};for(const v of r)if(yg(e,n,v)&&!a[Ts(v)]){const w=new Yt([],{});w._sourceSegment=e,w._segmentIndexShift="legacy"===u?e.segments.length:t.length,p[Ts(v)]=w}return{...a,...p}}(e,t,n,r,e.children,a));return p._sourceSegment=e,p._segmentIndexShift=t.length,{segmentGroup:p,slicedSegments:n}}const u=new Yt(e.segments,e.children);return u._sourceSegment=e,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:n}}function yg(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function SD(e,t,n,r){return!!(Ts(e)===r||r!==Zt&&yg(t,n,e))&&("**"===e.path||Ov(t,e,n).matched)}function MD(e,t,n){return 0===t.length&&!e.children[n]}const _g=!1;class vg{constructor(t){this.segmentGroup=t||null}}class TD{constructor(t){this.urlTree=t}}function tf(e){return Up(new vg(e))}function AD(e){return Up(new TD(e))}class zF{constructor(t,n,r,a,u){this.injector=t,this.configLoader=n,this.urlSerializer=r,this.urlTree=a,this.config=u,this.allowRedirects=!0}apply(){const t=gg(this.urlTree.root,[],[],this.config).segmentGroup,n=new Yt(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,Zt).pipe(At(u=>this.createUrlTree(ug(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ac(u=>{if(u instanceof TD)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof vg?this.noMatchError(u):u}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Zt).pipe(At(a=>this.createUrlTree(ug(a),t.queryParams,t.fragment))).pipe(Ac(a=>{throw a instanceof vg?this.noMatchError(a):a}))}noMatchError(t){return new ze(4002,_g)}createUrlTree(t,n,r){const a=vv(t);return new $u(a,n,r)}expandSegmentGroup(t,n,r,a){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,n,r).pipe(At(u=>new Yt([],u))):this.expandSegment(t,r,n,r.segments,a,!0)}expandChildren(t,n,r){const a=[];for(const u of Object.keys(r.children))"primary"===u?a.unshift(u):a.push(u);return zt(a).pipe(Tc(u=>{const p=r.children[u],v=CD(n,u);return this.expandSegmentGroup(t,v,p,u).pipe(At(w=>({segment:w,outlet:u})))}),HC((u,p)=>(u[p.outlet]=p.segment,u),{}),GC())}expandSegment(t,n,r,a,u,p){return zt(r).pipe(Tc(v=>this.expandSegmentAgainstRoute(t,n,r,v,a,u,p).pipe(Ac(I=>{if(I instanceof vg)return yt(null);throw I}))),Mc(v=>!!v),Ac((v,w)=>{if(Fv(v))return MD(n,a,u)?yt(new Yt([],{})):tf(n);throw v}))}expandSegmentAgainstRoute(t,n,r,a,u,p,v){return SD(a,n,u,p)?void 0===a.redirectTo?this.matchSegmentAgainstRoute(t,n,a,u,p):v&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,r,a,u,p):tf(n):tf(n)}expandSegmentAgainstRouteUsingRedirect(t,n,r,a,u,p){return"**"===a.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,a,p):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,a,u,p)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,a){const u=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?AD(u):this.lineralizeSegments(r,u).pipe($(p=>{const v=new Yt(p,{});return this.expandSegment(t,v,n,p,a,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,a,u,p){const{matched:v,consumedSegments:w,remainingSegments:I,positionalParamSegments:k}=Ov(n,a,u);if(!v)return tf(n);const N=this.applyRedirectCommands(w,a.redirectTo,k);return a.redirectTo.startsWith("/")?AD(N):this.lineralizeSegments(a,N).pipe($(q=>this.expandSegment(t,n,r,q.concat(I),p,!1)))}matchSegmentAgainstRoute(t,n,r,a,u){return"**"===r.path?(t=wD(r,t),r.loadChildren?(r._loadedRoutes?yt({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(t,r)).pipe(At(v=>(r._loadedRoutes=v.routes,r._loadedInjector=v.injector,new Yt(a,{})))):yt(new Yt(a,{}))):ID(n,r,a,t).pipe(Ga(({matched:p,consumedSegments:v,remainingSegments:w})=>p?this.getChildConfig(t=r._injector??t,r,a).pipe($(k=>{const N=k.injector??t,q=k.routes,{segmentGroup:Y,slicedSegments:le}=gg(n,v,w,q),Ce=new Yt(Y.segments,Y.children);if(0===le.length&&Ce.hasChildren())return this.expandChildren(N,q,Ce).pipe(At(Ie=>new Yt(v,Ie)));if(0===q.length&&0===le.length)return yt(new Yt(v,{}));const Me=Ts(r)===u;return this.expandSegment(N,Ce,q,le,Me?Zt:u,!0).pipe(At(Ze=>new Yt(v.concat(Ze.segments),Ze.children)))})):tf(n)))}getChildConfig(t,n,r){return n.children?yt({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?yt({routes:n._loadedRoutes,injector:n._loadedInjector}):function TF(e,t,n,r){const a=t.canLoad;return void 0===a||0===a.length?yt(!0):yt(a.map(p=>{const v=hd(p,e);return Pc(function mF(e){return e&&ef(e.canLoad)}(v)?v.canLoad(t,n):e.runInContext(()=>v(t,n)))})).pipe(dd(),ED())}(t,n,r).pipe($(a=>a?this.configLoader.loadChildren(t,n).pipe(ji(u=>{n._loadedRoutes=u.routes,n._loadedInjector=u.injector})):function OF(e){return Up(vD(_g,3))}())):yt({routes:[],injector:t})}lineralizeSegments(t,n){let r=[],a=n.root;for(;;){if(r=r.concat(a.segments),0===a.numberOfChildren)return yt(r);if(a.numberOfChildren>1||!a.children[Zt])return Up(new ze(4e3,_g));a=a.children[Zt]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,a){const u=this.createSegmentGroup(t,n.root,r,a);return new $u(u,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return bi(t,(a,u)=>{if("string"==typeof a&&a.startsWith(":")){const v=a.substring(1);r[u]=n[v]}else r[u]=a}),r}createSegmentGroup(t,n,r,a){const u=this.createSegments(t,n.segments,r,a);let p={};return bi(n.children,(v,w)=>{p[w]=this.createSegmentGroup(t,v,r,a)}),new Yt(u,p)}createSegments(t,n,r,a){return n.map(u=>u.path.startsWith(":")?this.findPosParam(t,u,a):this.findOrReturn(u,r))}findPosParam(t,n,r){const a=r[n.path.substring(1)];if(!a)throw new ze(4001,_g);return a}findOrReturn(t,n){let r=0;for(const a of n){if(a.path===t.path)return n.splice(r),a;r++}return t}}class VF{}class $F{constructor(t,n,r,a,u,p,v,w){this.injector=t,this.rootComponentType=n,this.config=r,this.urlTree=a,this.url=u,this.paramsInheritanceStrategy=p,this.relativeLinkResolution=v,this.urlSerializer=w}recognize(){const t=gg(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Zt).pipe(At(n=>{if(null===n)return null;const r=new dg([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Zt,this.rootComponentType,null,this.urlTree.root,-1,{}),a=new Pl(r,n),u=new gD(this.url,a);return this.inheritParamsAndData(u._root),u}))}inheritParamsAndData(t){const n=t.value,r=mD(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(a=>this.inheritParamsAndData(a))}processSegmentGroup(t,n,r,a){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,a)}processChildren(t,n,r){return zt(Object.keys(r.children)).pipe(Tc(a=>{const u=r.children[a],p=CD(n,a);return this.processSegmentGroup(t,p,u,a)}),HC((a,u)=>a&&u?(a.push(...u),a):null),function cR(e,t=!1){return An((n,r)=>{let a=0;n.subscribe(Qt(r,u=>{const p=e(u,a++);(p||t)&&r.next(u),!p&&r.complete()}))})}(a=>null!==a),ig(null),GC(),At(a=>{if(null===a)return null;const u=PD(a);return function HF(e){e.sort((t,n)=>t.value.outlet===Zt?-1:n.value.outlet===Zt?1:t.value.outlet.localeCompare(n.value.outlet))}(u),u}))}processSegment(t,n,r,a,u){return zt(n).pipe(Tc(p=>this.processSegmentAgainstRoute(p._injector??t,p,r,a,u)),Mc(p=>!!p),Ac(p=>{if(Fv(p))return MD(r,a,u)?yt([]):yt(null);throw p}))}processSegmentAgainstRoute(t,n,r,a,u){if(n.redirectTo||!SD(n,r,a,u))return yt(null);let p;if("**"===n.path){const v=a.length>0?ZC(a).parameters:{},w=RD(r)+a.length;p=yt({snapshot:new dg(a,v,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,LD(n),Ts(n),n.component??n._loadedComponent??null,n,kD(r),w,OD(n),w),consumedSegments:[],remainingSegments:[]})}else p=ID(r,n,a,t).pipe(At(({matched:v,consumedSegments:w,remainingSegments:I,parameters:k})=>{if(!v)return null;const N=RD(r)+w.length;return{snapshot:new dg(w,k,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,LD(n),Ts(n),n.component??n._loadedComponent??null,n,kD(r),N,OD(n),N),consumedSegments:w,remainingSegments:I}}));return p.pipe(Ga(v=>{if(null===v)return yt(null);const{snapshot:w,consumedSegments:I,remainingSegments:k}=v;t=n._injector??t;const N=n._loadedInjector??t,q=function GF(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(n),{segmentGroup:Y,slicedSegments:le}=gg(r,I,k,q.filter(Me=>void 0===Me.redirectTo),this.relativeLinkResolution);if(0===le.length&&Y.hasChildren())return this.processChildren(N,q,Y).pipe(At(Me=>null===Me?null:[new Pl(w,Me)]));if(0===q.length&&0===le.length)return yt([new Pl(w,[])]);const Ce=Ts(n)===u;return this.processSegment(N,q,Y,le,Ce?Zt:u).pipe(At(Me=>null===Me?null:[new Pl(w,Me)]))}))}}function qF(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function PD(e){const t=[],n=new Set;for(const r of e){if(!qF(r)){t.push(r);continue}const a=t.find(u=>r.value.routeConfig===u.value.routeConfig);void 0!==a?(a.children.push(...r.children),n.add(a)):t.push(r)}for(const r of n){const a=PD(r.children);t.push(new Pl(r.value,a))}return t.filter(r=>!n.has(r))}function kD(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function RD(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function LD(e){return e.data||{}}function OD(e){return e.resolve||{}}function ND(e){return"string"==typeof e.title||null===e.title}function Nv(e){return Ga(t=>{const n=e(t);return n?zt(n).pipe(At(()=>t)):yt(t)})}let zD=(()=>{class e{buildTitle(n){let r,a=n.root;for(;void 0!==a;)r=this.getResolvedTitleForRoute(a)??r,a=a.children.find(u=>u.outlet===Zt);return r}getResolvedTitleForRoute(n){return n.data[$p]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:function(){return or(BD)},providedIn:"root"}),e})(),BD=(()=>{class e extends zD{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(ot(RC))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class eL{}class nL extends class tL{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const bg=new dt("",{providedIn:"root",factory:()=>({})}),zv=new dt("ROUTES");let Bv=(()=>{class e{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return yt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=Pc(n.loadComponent()).pipe(ji(u=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=u}),mv(()=>{this.componentLoaders.delete(n)})),a=new jC(r,()=>new rr).pipe(pv());return this.componentLoaders.set(n,a),a}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return yt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const u=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(At(v=>{this.onLoadEndListener&&this.onLoadEndListener(r);let w,I,k=!1;Array.isArray(v)?I=v:(w=v.create(n).injector,I=WC(w.get(zv,[],ut.Self|ut.Optional)));return{routes:I.map(Rv),injector:w}}),mv(()=>{this.childrenLoaders.delete(r)})),p=new jC(u,()=>new rr).pipe(pv());return this.childrenLoaders.set(r,p),p}loadModuleFactoryOrRoutes(n){return Pc(n()).pipe($(r=>r instanceof Iw||Array.isArray(r)?yt(r):zt(this.compiler.compileModuleAsync(r))))}}return e.\u0275fac=function(n){return new(n||e)(ot(Xo),ot(I_))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class iL{}class oL{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function sL(e){throw e}function aL(e,t,n){return t.parse("/")}const lL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},cL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function UD(){const e=or(eD),t=or(Kp),n=or(U_),r=or(Xo),a=or(I_),u=or(zv,{optional:!0})??[],p=or(bg,{optional:!0})??{},v=or(BD),w=or(zD,{optional:!0}),I=or(iL,{optional:!0}),k=or(eL,{optional:!0}),N=new hi(null,e,t,n,r,a,WC(u));return I&&(N.urlHandlingStrategy=I),k&&(N.routeReuseStrategy=k),N.titleStrategy=w??v,function uL(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(p,N),N}let hi=(()=>{class e{constructor(n,r,a,u,p,v,w){this.rootComponentType=n,this.urlSerializer=r,this.rootContexts=a,this.location=u,this.config=w,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new rr,this.errorHandler=sL,this.malformedUriErrorHandler=aL,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>yt(void 0),this.urlHandlingStrategy=new oL,this.routeReuseStrategy=new nL,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=p.get(Bv),this.configLoader.onLoadEndListener=q=>this.triggerEvent(new GR(q)),this.configLoader.onLoadStartListener=q=>this.triggerEvent(new HR(q)),this.ngModule=p.get(Vu),this.console=p.get(GA);const N=p.get(ri);this.isNgZoneEnabled=N instanceof ri&&ri.isInAngularZone(),this.resetConfig(w),this.currentUrlTree=function fR(){return new $u(new Yt([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=fD(this.currentUrlTree,this.rootComponentType),this.transitions=new sa({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(n){const r=this.events;return n.pipe(Tl(a=>0!==a.id),At(a=>({...a,extractedUrl:this.urlHandlingStrategy.extract(a.rawUrl)})),Ga(a=>{let u=!1,p=!1;return yt(a).pipe(ji(v=>{this.currentNavigation={id:v.id,initialUrl:v.rawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ga(v=>{const w=this.browserUrlTree.toString(),I=!this.navigated||v.extractedUrl.toString()!==w||w!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||I)&&this.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return jD(v.source)&&(this.browserUrlTree=v.extractedUrl),yt(v).pipe(Ga(N=>{const q=this.transitions.getValue();return r.next(new Cv(N.id,this.serializeUrl(N.extractedUrl),N.source,N.restoredState)),q!==this.transitions.getValue()?ie:Promise.resolve(N)}),function BF(e,t,n,r){return Ga(a=>function NF(e,t,n,r,a){return new zF(e,t,n,r,a).apply()}(e,t,n,a.extractedUrl,r).pipe(At(u=>({...a,urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),ji(N=>{this.currentNavigation={...this.currentNavigation,finalUrl:N.urlAfterRedirects},a.urlAfterRedirects=N.urlAfterRedirects}),function ZF(e,t,n,r,a,u){return $(p=>function jF(e,t,n,r,a,u,p="emptyOnly",v="legacy"){return new $F(e,t,n,r,a,p,v,u).recognize().pipe(Ga(w=>null===w?function UF(e){return new on(t=>t.error(e))}(new VF):yt(w)))}(e,t,n,p.urlAfterRedirects,r.serialize(p.urlAfterRedirects),r,a,u).pipe(At(v=>({...p,targetSnapshot:v}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),ji(N=>{if(a.targetSnapshot=N.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!N.extras.skipLocationChange){const Y=this.urlHandlingStrategy.merge(N.urlAfterRedirects,N.rawUrl);this.setBrowserUrl(Y,N)}this.browserUrlTree=N.urlAfterRedirects}const q=new BR(N.id,this.serializeUrl(N.extractedUrl),this.serializeUrl(N.urlAfterRedirects),N.targetSnapshot);r.next(q)}));if(I&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:q,extractedUrl:Y,source:le,restoredState:Ce,extras:Me}=v,Pe=new Cv(q,this.serializeUrl(Y),le,Ce);r.next(Pe);const Ze=fD(Y,this.rootComponentType).snapshot;return yt(a={...v,targetSnapshot:Ze,urlAfterRedirects:Y,extras:{...Me,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=v.rawUrl,v.resolve(null),ie}),ji(v=>{const w=new VR(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(w)}),At(v=>a={...v,guards:uF(v.targetSnapshot,v.currentSnapshot,this.rootContexts)}),function bF(e,t){return $(n=>{const{targetSnapshot:r,currentSnapshot:a,guards:{canActivateChecks:u,canDeactivateChecks:p}}=n;return 0===p.length&&0===u.length?yt({...n,guardsResult:!0}):function wF(e,t,n,r){return zt(e).pipe($(a=>function MF(e,t,n,r,a){const u=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return u&&0!==u.length?yt(u.map(v=>{const w=Jp(t)??a,I=hd(v,w);return Pc(function _F(e){return e&&ef(e.canDeactivate)}(I)?I.canDeactivate(e,t,n,r):w.runInContext(()=>I(e,t,n,r))).pipe(Mc())})).pipe(dd()):yt(!0)}(a.component,a.route,n,t,r)),Mc(a=>!0!==a,!0))}(p,r,a,e).pipe($(v=>v&&function fF(e){return"boolean"==typeof e}(v)?function CF(e,t,n,r){return zt(t).pipe(Tc(a=>dv(function EF(e,t){return null!==e&&t&&t(new qR(e)),yt(!0)}(a.route.parent,r),function DF(e,t){return null!==e&&t&&t(new ZR(e)),yt(!0)}(a.route,r),function SF(e,t,n){const r=t[t.length-1],u=t.slice(0,t.length-1).reverse().map(p=>function hF(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(p)).filter(p=>null!==p).map(p=>UC(()=>yt(p.guards.map(w=>{const I=Jp(p.node)??n,k=hd(w,I);return Pc(function yF(e){return e&&ef(e.canActivateChild)}(k)?k.canActivateChild(r,e):I.runInContext(()=>k(r,e))).pipe(Mc())})).pipe(dd())));return yt(u).pipe(dd())}(e,a.path,n),function IF(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return yt(!0);const a=r.map(u=>UC(()=>{const p=Jp(t)??n,v=hd(u,p);return Pc(function gF(e){return e&&ef(e.canActivate)}(v)?v.canActivate(t,e):p.runInContext(()=>v(t,e))).pipe(Mc())}));return yt(a).pipe(dd())}(e,a.route,n))),Mc(a=>!0!==a,!0))}(r,u,e,t):yt(v)),At(v=>({...n,guardsResult:v})))})}(this.ngModule.injector,v=>this.triggerEvent(v)),ji(v=>{if(a.guardsResult=v.guardsResult,Gu(v.guardsResult))throw _D(0,v.guardsResult);const w=new UR(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.triggerEvent(w)}),Tl(v=>!!v.guardsResult||(this.restoreHistory(v),this.cancelNavigationTransition(v,"",3),!1)),Nv(v=>{if(v.guards.canActivateChecks.length)return yt(v).pipe(ji(w=>{const I=new jR(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}),Ga(w=>{let I=!1;return yt(w).pipe(function XF(e,t){return $(n=>{const{targetSnapshot:r,guards:{canActivateChecks:a}}=n;if(!a.length)return yt(n);let u=0;return zt(a).pipe(Tc(p=>function KF(e,t,n,r){const a=e.routeConfig,u=e._resolve;return void 0!==a?.title&&!ND(a)&&(u[$p]=a.title),function JF(e,t,n,r){const a=function YF(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===a.length)return yt({});const u={};return zt(a).pipe($(p=>function QF(e,t,n,r){const a=Jp(t)??r,u=hd(e,a);return Pc(u.resolve?u.resolve(t,n):a.runInContext(()=>u(t,n)))}(e[p],t,n,r).pipe(Mc(),ji(v=>{u[p]=v}))),fv(1),function uR(e){return At(()=>e)}(u),Ac(p=>Fv(p)?ie:Up(p)))}(u,e,t,r).pipe(At(p=>(e._resolvedData=p,e.data=mD(e,n).resolve,a&&ND(a)&&(e.data[$p]=a.title),null)))}(p.route,r,e,t)),ji(()=>u++),fv(1),$(p=>u===a.length?yt(n):ie))})}(this.paramsInheritanceStrategy,this.ngModule.injector),ji({next:()=>I=!0,complete:()=>{I||(this.restoreHistory(w),this.cancelNavigationTransition(w,"",2))}}))}),ji(w=>{const I=new $R(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}))}),Nv(v=>{const w=I=>{const k=[];I.routeConfig?.loadComponent&&!I.routeConfig._loadedComponent&&k.push(this.configLoader.loadComponent(I.routeConfig).pipe(ji(N=>{I.component=N}),At(()=>{})));for(const N of I.children)k.push(...w(N));return k};return BC(w(v.targetSnapshot.root)).pipe(ig(),jp(1))}),Nv(()=>this.afterPreactivation()),At(v=>{const w=function QR(e,t,n){const r=Xp(e,t._root,n?n._root:void 0);return new pD(r,t)}(this.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return a={...v,targetRouterState:w}}),ji(v=>{this.currentUrlTree=v.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(v.urlAfterRedirects,v.rawUrl),this.routerState=v.targetRouterState,"deferred"===this.urlUpdateStrategy&&(v.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,v),this.browserUrlTree=v.urlAfterRedirects)}),((e,t,n)=>At(r=>(new cF(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,v=>this.triggerEvent(v)),ji({next(){u=!0},complete(){u=!0}}),mv(()=>{u||p||this.cancelNavigationTransition(a,"",1),this.currentNavigation?.id===a.id&&(this.currentNavigation=null)}),Ac(v=>{if(p=!0,bD(v)){xD(v)||(this.navigated=!0,this.restoreHistory(a,!0));const w=new hg(a.id,this.serializeUrl(a.extractedUrl),v.message,v.cancellationCode);if(r.next(w),xD(v)){const I=this.urlHandlingStrategy.merge(v.url,this.rawUrlTree),k={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||jD(a.source)};this.scheduleNavigation(I,"imperative",null,k,{resolve:a.resolve,reject:a.reject,promise:a.promise})}else a.resolve(!1)}else{this.restoreHistory(a,!0);const w=new uD(a.id,this.serializeUrl(a.extractedUrl),v,a.targetSnapshot??void 0);r.next(w);try{a.resolve(this.errorHandler(v))}catch(I){a.reject(I)}}return ie}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next({...this.transitions.value,...n})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{const a={replaceUrl:!0},u=n.state?.navigationId?n.state:null;if(u){const v={...u};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(a.state=v)}const p=this.parseUrl(n.url);this.scheduleNavigation(p,r,u,a)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){this.config=n.map(Rv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:a,queryParams:u,fragment:p,queryParamsHandling:v,preserveFragment:w}=r,I=a||this.routerState.root,k=w?this.currentUrlTree.fragment:p;let N=null;switch(v){case"merge":N={...this.currentUrlTree.queryParams,...u};break;case"preserve":N=this.currentUrlTree.queryParams;break;default:N=u||null}return null!==N&&(N=this.removeEmptyProps(N)),RR(I,this.currentUrlTree,n,N,k??null)}navigateByUrl(n,r={skipLocationChange:!1}){const a=Gu(n)?n:this.parseUrl(n),u=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function hL(e){for(let t=0;t<e.length;t++){if(null==e[t])throw new ze(4008,false)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(a){r=this.malformedUriErrorHandler(a,this.urlSerializer,n)}return r}isActive(n,r){let a;if(a=!0===r?{...lL}:!1===r?{...cL}:r,Gu(n))return KC(this.currentUrlTree,n,a);const u=this.parseUrl(n);return KC(this.currentUrlTree,u,a)}removeEmptyProps(n){return Object.keys(n).reduce((r,a)=>{const u=n[a];return null!=u&&(r[a]=u),r},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new qu(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,r,a,u,p){if(this.disposed)return Promise.resolve(!1);let v,w,I;p?(v=p.resolve,w=p.reject,I=p.promise):I=new Promise((q,Y)=>{v=q,w=Y});const k=++this.navigationId;let N;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(a=this.location.getState()),N=a&&a.\u0275routerPageId?a.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):N=0,this.setTransition({id:k,targetPageId:N,source:r,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:u,resolve:v,reject:w,promise:I,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),I.catch(q=>Promise.reject(q))}setBrowserUrl(n,r){const a=this.urlSerializer.serialize(n),u={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(a)||r.extras.replaceUrl?this.location.replaceState(a,"",u):this.location.go(a,"",u)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const a=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===a?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===a&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(a)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,r,a){const u=new hg(n.id,this.serializeUrl(n.extractedUrl),r,a);this.triggerEvent(u),n.resolve(!1)}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){Sy()},e.\u0275prov=$e({token:e,factory:function(){return UD()},providedIn:"root"}),e})();function jD(e){return"imperative"!==e}let nf=(()=>{class e{constructor(n,r,a,u,p){this.router=n,this.route=r,this.tabIndexAttribute=a,this.renderer=u,this.el=p,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.onChanges=new rr,this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(n){this._preserveFragment=Il(n)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(n){this._skipLocationChange=Il(n)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(n){this._replaceUrl=Il(n)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(n){if(null!=this.tabIndexAttribute)return;const r=this.renderer,a=this.el.nativeElement;null!==n?r.setAttribute(a,"tabindex",n):r.removeAttribute(a,"tabindex")}ngOnChanges(n){this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){return null===this.urlTree||this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return e.\u0275fac=function(n){return new(n||e)(Ae(hi),Ae(kc),oc("tabindex"),Ae(wo),Ae(Ni))},e.\u0275dir=lt({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(n,r){1&n&&ui("click",function(){return r.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Zr]}),e})();class $D{}let fL=(()=>{class e{constructor(n,r,a,u,p){this.router=n,this.injector=a,this.preloadingStrategy=u,this.loader=p}setUpPreloading(){this.subscription=this.router.events.pipe(Tl(n=>n instanceof qu),Tc(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const a=[];for(const u of r){u.providers&&!u._injector&&(u._injector=Tm(u.providers,n,`Route: ${u.path}`));const p=u._injector??n,v=u._loadedInjector??p;u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent?a.push(this.preloadConfig(p,u)):(u.children||u._loadedRoutes)&&a.push(this.processRoutes(v,u.children??u._loadedRoutes))}return zt(a).pipe(ee())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let a;a=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):yt(null);const u=a.pipe($(p=>null===p?yt(void 0):(r._loadedRoutes=p.routes,r._loadedInjector=p.injector,this.processRoutes(p.injector??n,p.routes))));return r.loadComponent&&!r._loadedComponent?zt([u,this.loader.loadComponent(r)]).pipe(ee()):u})}}return e.\u0275fac=function(n){return new(n||e)(ot(hi),ot(I_),ot(Na),ot($D),ot(Bv))},e.\u0275prov=$e({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Uv=new dt("");let HD=(()=>{class e{constructor(n,r,a={}){this.router=n,this.viewportScroller=r,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Cv?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof qu&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof hD&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.router.triggerEvent(new hD(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){Sy()},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();function pd(e,t){return{\u0275kind:e,\u0275providers:t}}function jv(e){return[{provide:zv,multi:!0,useValue:e}]}function qD(){const e=or(Xo);return t=>{const n=e.get(Om);if(t!==n.components[0])return;const r=e.get(hi),a=e.get(WD);1===e.get($v)&&r.initialNavigation(),e.get(ZD,null,ut.Optional)?.setUpPreloading(),e.get(Uv,null,ut.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),a.next(),a.complete()}}const WD=new dt("",{factory:()=>new rr}),$v=new dt("",{providedIn:"root",factory:()=>1});const ZD=new dt("");function _L(e){return pd(0,[{provide:ZD,useExisting:fL},{provide:$D,useExisting:e}])}const XD=new dt("ROUTER_FORROOT_GUARD"),vL=[U_,{provide:eD,useClass:yv},{provide:hi,useFactory:UD},Kp,{provide:kc,useFactory:function GD(e){return e.routerState.root},deps:[hi]},Bv];function xL(){return new D1("Router",hi)}let bL=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[vL,[],jv(n),{provide:XD,useFactory:EL,deps:[[hi,new _u,new vu]]},{provide:bg,useValue:r||{}},r?.useHash?{provide:ju,useClass:F2}:{provide:ju,useClass:X1},{provide:Uv,useFactory:()=>{const e=or(hi),t=or(QP),n=or(bg);return n.scrollOffset&&t.setOffset(n.scrollOffset),new HD(e,t,n)}},r?.preloadingStrategy?_L(r.preloadingStrategy).\u0275providers:[],{provide:D1,multi:!0,useFactory:xL},r?.initialNavigation?IL(r):[],[{provide:KD,useFactory:qD},{provide:y1,multi:!0,useExisting:KD}]]}}static forChild(n){return{ngModule:e,providers:[jv(n)]}}}return e.\u0275fac=function(n){return new(n||e)(ot(XD,8))},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({imports:[Pv]}),e})();function EL(e){return"guarded"}function IL(e){return["disabled"===e.initialNavigation?pd(3,[{provide:Rm,multi:!0,useFactory:()=>{const t=or(hi);return()=>{t.setUpLocationChangeListener()}}},{provide:$v,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?pd(2,[{provide:$v,useValue:0},{provide:Rm,multi:!0,deps:[Xo],useFactory:t=>{const n=t.get(k2,Promise.resolve());let r=!1;return()=>n.then(()=>new Promise(u=>{const p=t.get(hi),v=t.get(WD);(function a(u){t.get(hi).events.pipe(Tl(v=>v instanceof qu||v instanceof hg||v instanceof uD),At(v=>v instanceof qu||v instanceof hg&&(0===v.code||1===v.code)&&null),Tl(v=>null!==v),jp(1)).subscribe(()=>{u()})})(()=>{u(!0),r=!0}),p.afterPreactivation=()=>(u(!0),r||v.closed?yt(void 0):v),p.initialNavigation()}))}}]).\u0275providers:[]]}const KD=new dt("");let ML=(()=>{class e{constructor(){this.title="testProject"}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Kt({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){1&n&&Or(0,"router-outlet")},dependencies:[Av],styles:['label.star{padding:0!important;font-size:20px!important;color:#292929!important}  label.star:before{content:"\\f005"!important;-webkit-text-stroke:1px black;text-stroke:1px black}  label.star:hover{cursor:pointer}']}),e})();const{isArray:TL}=Array;class JD{}class YD{}class kl{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const r=n.indexOf(":");if(r>0){const a=n.slice(0,r),u=a.toLowerCase(),p=n.slice(r+1).trim();this.maybeSetNormalizedName(a,u),this.headers.has(u)?this.headers.get(u).push(p):this.headers.set(u,[p])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let r=t[n];const a=n.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(a,r),this.maybeSetNormalizedName(n,a))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof kl?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new kl;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof kl?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(t.name,n);const a=("a"===t.op?this.headers.get(n):void 0)||[];a.push(...r),this.headers.set(n,a);break;case"d":const u=t.value;if(u){let p=this.headers.get(n);if(!p)return;p=p.filter(v=>-1===u.indexOf(v)),0===p.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,p)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class kL{encodeKey(t){return QD(t)}encodeValue(t){return QD(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const FL=/%(\d[a-f0-9])/gi,LL={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function QD(e){return encodeURIComponent(e).replace(FL,(t,n)=>LL[n]??t)}function Eg(e){return`${e}`}class Rc{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new kL,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function RL(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(a=>{const u=a.indexOf("="),[p,v]=-1==u?[t.decodeKey(a),""]:[t.decodeKey(a.slice(0,u)),t.decodeValue(a.slice(u+1))],w=n.get(p)||[];w.push(v),n.set(p,w)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const r=t.fromObject[n],a=Array.isArray(r)?r.map(Eg):[Eg(r)];this.map.set(n,a)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(r=>{const a=t[r];Array.isArray(a)?a.forEach(u=>{n.push({param:r,value:u,op:"a"})}):n.push({param:r,value:a,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(r=>n+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Rc({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(Eg(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let r=this.map.get(t.param)||[];const a=r.indexOf(Eg(t.value));-1!==a&&r.splice(a,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class OL{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function eE(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function tE(e){return typeof Blob<"u"&&e instanceof Blob}function nE(e){return typeof FormData<"u"&&e instanceof FormData}class rf{constructor(t,n,r,a){let u;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function NL(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||a?(this.body=void 0!==r?r:null,u=a):u=r,u&&(this.reportProgress=!!u.reportProgress,this.withCredentials=!!u.withCredentials,u.responseType&&(this.responseType=u.responseType),u.headers&&(this.headers=u.headers),u.context&&(this.context=u.context),u.params&&(this.params=u.params)),this.headers||(this.headers=new kl),this.context||(this.context=new OL),this.params){const p=this.params.toString();if(0===p.length)this.urlWithParams=n;else{const v=n.indexOf("?");this.urlWithParams=n+(-1===v?"?":v<n.length-1?"&":"")+p}}else this.params=new Rc,this.urlWithParams=n}serializeBody(){return null===this.body?null:eE(this.body)||tE(this.body)||nE(this.body)||function zL(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Rc?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||nE(this.body)?null:tE(this.body)?this.body.type||null:eE(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Rc?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,r=t.url||this.url,a=t.responseType||this.responseType,u=void 0!==t.body?t.body:this.body,p=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,v=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let w=t.headers||this.headers,I=t.params||this.params;const k=t.context??this.context;return void 0!==t.setHeaders&&(w=Object.keys(t.setHeaders).reduce((N,q)=>N.set(q,t.setHeaders[q]),w)),t.setParams&&(I=Object.keys(t.setParams).reduce((N,q)=>N.set(q,t.setParams[q]),I)),new rf(n,r,u,{params:I,headers:w,context:k,reportProgress:v,responseType:a,withCredentials:p})}}var Br=(()=>((Br=Br||{})[Br.Sent=0]="Sent",Br[Br.UploadProgress=1]="UploadProgress",Br[Br.ResponseHeader=2]="ResponseHeader",Br[Br.DownloadProgress=3]="DownloadProgress",Br[Br.Response=4]="Response",Br[Br.User=5]="User",Br))();class Hv{constructor(t,n=200,r="OK"){this.headers=t.headers||new kl,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Gv extends Hv{constructor(t={}){super(t),this.type=Br.ResponseHeader}clone(t={}){return new Gv({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Ig extends Hv{constructor(t={}){super(t),this.type=Br.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Ig({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class rE extends Hv{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function qv(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let Wv=(()=>{class e{constructor(n){this.handler=n}request(n,r,a={}){let u;if(n instanceof rf)u=n;else{let w,I;w=a.headers instanceof kl?a.headers:new kl(a.headers),a.params&&(I=a.params instanceof Rc?a.params:new Rc({fromObject:a.params})),u=new rf(n,r,void 0!==a.body?a.body:null,{headers:w,context:a.context,params:I,reportProgress:a.reportProgress,responseType:a.responseType||"json",withCredentials:a.withCredentials})}const p=yt(u).pipe(Tc(w=>this.handler.handle(w)));if(n instanceof rf||"events"===a.observe)return p;const v=p.pipe(Tl(w=>w instanceof Ig));switch(a.observe||"body"){case"body":switch(u.responseType){case"arraybuffer":return v.pipe(At(w=>{if(null!==w.body&&!(w.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return w.body}));case"blob":return v.pipe(At(w=>{if(null!==w.body&&!(w.body instanceof Blob))throw new Error("Response is not a Blob.");return w.body}));case"text":return v.pipe(At(w=>{if(null!==w.body&&"string"!=typeof w.body)throw new Error("Response is not a string.");return w.body}));default:return v.pipe(At(w=>w.body))}case"response":return v;default:throw new Error(`Unreachable: unhandled observe type ${a.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new Rc).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,a={}){return this.request("PATCH",n,qv(a,r))}post(n,r,a={}){return this.request("POST",n,qv(a,r))}put(n,r,a={}){return this.request("PUT",n,qv(a,r))}}return e.\u0275fac=function(n){return new(n||e)(ot(JD))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();class iE{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const oE=new dt("HTTP_INTERCEPTORS");let BL=(()=>{class e{intercept(n,r){return r.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();const VL=/^\)\]\}',?\n/;let sE=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new on(r=>{const a=this.xhrFactory.build();if(a.open(n.method,n.urlWithParams),n.withCredentials&&(a.withCredentials=!0),n.headers.forEach((Y,le)=>a.setRequestHeader(Y,le.join(","))),n.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const Y=n.detectContentTypeHeader();null!==Y&&a.setRequestHeader("Content-Type",Y)}if(n.responseType){const Y=n.responseType.toLowerCase();a.responseType="json"!==Y?Y:"text"}const u=n.serializeBody();let p=null;const v=()=>{if(null!==p)return p;const Y=a.statusText||"OK",le=new kl(a.getAllResponseHeaders()),Ce=function UL(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(a)||n.url;return p=new Gv({headers:le,status:a.status,statusText:Y,url:Ce}),p},w=()=>{let{headers:Y,status:le,statusText:Ce,url:Me}=v(),Pe=null;204!==le&&(Pe=typeof a.response>"u"?a.responseText:a.response),0===le&&(le=Pe?200:0);let Ze=le>=200&&le<300;if("json"===n.responseType&&"string"==typeof Pe){const Ie=Pe;Pe=Pe.replace(VL,"");try{Pe=""!==Pe?JSON.parse(Pe):null}catch(ht){Pe=Ie,Ze&&(Ze=!1,Pe={error:ht,text:Pe})}}Ze?(r.next(new Ig({body:Pe,headers:Y,status:le,statusText:Ce,url:Me||void 0})),r.complete()):r.error(new rE({error:Pe,headers:Y,status:le,statusText:Ce,url:Me||void 0}))},I=Y=>{const{url:le}=v(),Ce=new rE({error:Y,status:a.status||0,statusText:a.statusText||"Unknown Error",url:le||void 0});r.error(Ce)};let k=!1;const N=Y=>{k||(r.next(v()),k=!0);let le={type:Br.DownloadProgress,loaded:Y.loaded};Y.lengthComputable&&(le.total=Y.total),"text"===n.responseType&&!!a.responseText&&(le.partialText=a.responseText),r.next(le)},q=Y=>{let le={type:Br.UploadProgress,loaded:Y.loaded};Y.lengthComputable&&(le.total=Y.total),r.next(le)};return a.addEventListener("load",w),a.addEventListener("error",I),a.addEventListener("timeout",I),a.addEventListener("abort",I),n.reportProgress&&(a.addEventListener("progress",N),null!==u&&a.upload&&a.upload.addEventListener("progress",q)),a.send(u),r.next({type:Br.Sent}),()=>{a.removeEventListener("error",I),a.removeEventListener("abort",I),a.removeEventListener("load",w),a.removeEventListener("timeout",I),n.reportProgress&&(a.removeEventListener("progress",N),null!==u&&a.upload&&a.upload.removeEventListener("progress",q)),a.readyState!==a.DONE&&a.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(ot(fC))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})();const Zv=new dt("XSRF_COOKIE_NAME"),Xv=new dt("XSRF_HEADER_NAME");class aE{}let jL=(()=>{class e{constructor(n,r,a){this.doc=n,this.platform=r,this.cookieName=a,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=oC(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(ot(oo),ot(E_),ot(Zv))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})(),Kv=(()=>{class e{constructor(n,r){this.tokenService=n,this.headerName=r}intercept(n,r){const a=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||a.startsWith("http://")||a.startsWith("https://"))return r.handle(n);const u=this.tokenService.getToken();return null!==u&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,u)})),r.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(ot(aE),ot(Xv))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})(),$L=(()=>{class e{constructor(n,r){this.backend=n,this.injector=r,this.chain=null}handle(n){if(null===this.chain){const r=this.injector.get(oE,[]);this.chain=r.reduceRight((a,u)=>new iE(a,u),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(ot(YD),ot(Xo))},e.\u0275prov=$e({token:e,factory:e.\u0275fac}),e})(),HL=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:Kv,useClass:BL}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:Zv,useValue:n.cookieName}:[],n.headerName?{provide:Xv,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({providers:[Kv,{provide:oE,useExisting:Kv,multi:!0},{provide:aE,useClass:jL},{provide:Zv,useValue:"XSRF-TOKEN"},{provide:Xv,useValue:"X-XSRF-TOKEN"}]}),e})(),GL=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({providers:[Wv,{provide:JD,useClass:$L},sE,{provide:YD,useExisting:sE}],imports:[HL.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),e})();const aa=new dt("NgValueAccessor");let JE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({}),e})();const hx=new dt("NgModelWithFormControlWarning");let fI=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({imports:[JE]}),e})(),GO=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({imports:[fI]}),e})(),qO=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:hx,useValue:n.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({imports:[fI]}),e})();const ZO=["ngxCheckbox"];function XO(e,t){if(1&e){const n=wm();gt(0,"input",2,3),ui("click",function(){const u=A(n).$implicit;return F(Jo().rate(u))}),bt(),Or(2,"label",4)}if(2&e){const n=t.$implicit,r=Jo();t_("star star-",n,""),Cm("id","star-",n,"-",r.id,""),Lr("checked",r.value==n)("disabled",r.disabled),nn(2),t_("star star-",n,""),Cm("for","star-",n,"-",r.id,"")}}let KO=(()=>{class e{constructor(){this.stars=[5,4,3,2,1],this.propagateChange=n=>{},this.disabled||(this.disabled=!1)}ngOnInit(){}rate(n){this.disabled||this.propagateChange(n)}writeValue(n){this.ngxCheckbox&&null===n&&this.ngxCheckbox.forEach(r=>{r.nativeElement.checked=!1}),this.value=n}registerOnChange(n){this.propagateChange=n}registerOnTouched(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Kt({type:e,selectors:[["ngx-star-rating"]],viewQuery:function(n,r){if(1&n&&__(ZO,5),2&n){let a;Ap(a=Pp())&&(r.ngxCheckbox=a)}},inputs:{id:"id",disabled:"disabled"},features:[Jn([{provide:aa,useExisting:Cn(()=>e),multi:!0}])],decls:2,vars:1,consts:[["action",""],["ngFor","",3,"ngForOf"],["type","radio","name","star",3,"id","checked","disabled","click"],["ngxCheckbox",""],[3,"for"]],template:function(n,r){1&n&&(gt(0,"form",0),Is(1,XO,3,12,"ng-template",1),bt()),2&n&&(nn(1),Lr("ngForOf",r.stars))},dependencies:[Jm],styles:['*[_ngcontent-%COMP%]{margin:0;padding:0;font-family:roboto}body[_ngcontent-%COMP%]{background:#000}.cont[_ngcontent-%COMP%]{width:93%;max-width:350px;text-align:center;margin:4% auto;padding:30px 0;background:#111;color:#eee;border-radius:5px;border:thin solid #444;overflow:hidden}hr[_ngcontent-%COMP%]{margin:20px;border:none;border-bottom:thin solid rgba(255,255,255,.1)}div.title[_ngcontent-%COMP%]{font-size:2em}h1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:300;color:#fd4}div.stars[_ngcontent-%COMP%]{width:270px;display:inline-block}input.star[_ngcontent-%COMP%]{display:none}label.star[_ngcontent-%COMP%]{float:right;padding:10px;font-size:36px;color:#444;transition:all .2s}input.star[_ngcontent-%COMP%]:checked ~ label.star[_ngcontent-%COMP%]:before{content:"\\f005";color:#fd4;transition:all .25s}input.star-5[_ngcontent-%COMP%]:checked ~ label.star[_ngcontent-%COMP%]:before{color:#fe7;text-shadow:0 0 20px #952}input.star-1[_ngcontent-%COMP%]:checked ~ label.star[_ngcontent-%COMP%]:before{color:#f62}label.star[_ngcontent-%COMP%]:hover{transform:rotate(-15deg) scale(1.3)}label.star[_ngcontent-%COMP%]:before{content:"\\f006";font-family:FontAwesome}']}),e})(),JO=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({imports:[[nv]]}),e})();class _x{constructor(){this.change=new Yn,this.instances={},this.DEFAULT_ID="DEFAULT_PAGINATION_ID"}defaultId(){return this.DEFAULT_ID}register(t){return null==t.id&&(t.id=this.DEFAULT_ID),this.instances[t.id]?this.updateInstance(t):(this.instances[t.id]=t,!0)}updateInstance(t){let n=!1;for(let r in this.instances[t.id])t[r]!==this.instances[t.id][r]&&(this.instances[t.id][r]=t[r],n=!0);return n}getCurrentPage(t){return this.instances[t]?this.instances[t].currentPage:1}setCurrentPage(t,n){if(this.instances[t]){let r=this.instances[t];n<=Math.ceil(r.totalItems/r.itemsPerPage)&&1<=n&&(this.instances[t].currentPage=n,this.change.emit(t))}}setTotalItems(t,n){this.instances[t]&&0<=n&&(this.instances[t].totalItems=n,this.change.emit(t))}setItemsPerPage(t,n){this.instances[t]&&(this.instances[t].itemsPerPage=n,this.change.emit(t))}getInstance(t=this.DEFAULT_ID){return this.instances[t]?this.clone(this.instances[t]):{}}clone(t){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}}const aN=Number.MAX_SAFE_INTEGER;let lN=(()=>{class e{constructor(n){this.service=n,this.state={}}transform(n,r){if(!(n instanceof Array)){let N=r.id||this.service.defaultId();return this.state[N]?this.state[N].slice:n}let v,w,a=r.totalItems&&r.totalItems!==n.length,u=this.createInstance(n,r),p=u.id,I=u.itemsPerPage,k=this.service.register(u);if(!a&&n instanceof Array){if(I=+I||aN,v=(u.currentPage-1)*I,w=v+I,this.stateIsIdentical(p,n,v,w))return this.state[p].slice;{let q=n.slice(v,w);return this.saveState(p,n,q,v,w),this.service.change.emit(p),q}}return k&&this.service.change.emit(p),this.saveState(p,n,n,v,w),n}createInstance(n,r){return this.checkConfig(r),{id:null!=r.id?r.id:this.service.defaultId(),itemsPerPage:+r.itemsPerPage||0,currentPage:+r.currentPage||1,totalItems:+r.totalItems||n.length}}checkConfig(n){const a=["itemsPerPage","currentPage"].filter(u=>!(u in n));if(0<a.length)throw new Error(`PaginatePipe: Argument is missing the following required properties: ${a.join(", ")}`)}saveState(n,r,a,u,p){this.state[n]={collection:r,size:r.length,slice:a,start:u,end:p}}stateIsIdentical(n,r,a,u){let p=this.state[n];return!(!p||p.size!==r.length||p.start!==a||p.end!==u)&&p.slice.every((w,I)=>w===r[a+I])}}return e.\u0275fac=function(n){return new(n||e)(Ae(_x,16))},e.\u0275pipe=Hr({name:"paginate",type:e,pure:!1}),e})(),cN=(()=>{class e{constructor(n,r){this.service=n,this.changeDetectorRef=r,this.maxSize=7,this.pageChange=new Yn,this.pageBoundsCorrection=new Yn,this.pages=[],this.changeSub=this.service.change.subscribe(a=>{this.id===a&&(this.updatePageLinks(),this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges())})}ngOnInit(){void 0===this.id&&(this.id=this.service.defaultId()),this.updatePageLinks()}ngOnChanges(n){this.updatePageLinks()}ngOnDestroy(){this.changeSub.unsubscribe()}previous(){this.checkValidId(),this.setCurrent(this.getCurrent()-1)}next(){this.checkValidId(),this.setCurrent(this.getCurrent()+1)}isFirstPage(){return 1===this.getCurrent()}isLastPage(){return this.getLastPage()===this.getCurrent()}setCurrent(n){this.pageChange.emit(n)}getCurrent(){return this.service.getCurrentPage(this.id)}getLastPage(){let n=this.service.getInstance(this.id);return n.totalItems<1?1:Math.ceil(n.totalItems/n.itemsPerPage)}getTotalItems(){return this.service.getInstance(this.id).totalItems}checkValidId(){null==this.service.getInstance(this.id).id&&console.warn(`PaginationControlsDirective: the specified id "${this.id}" does not match any registered PaginationInstance`)}updatePageLinks(){let n=this.service.getInstance(this.id);const r=this.outOfBoundCorrection(n);r!==n.currentPage?setTimeout(()=>{this.pageBoundsCorrection.emit(r),this.pages=this.createPageArray(n.currentPage,n.itemsPerPage,n.totalItems,this.maxSize)}):this.pages=this.createPageArray(n.currentPage,n.itemsPerPage,n.totalItems,this.maxSize)}outOfBoundCorrection(n){const r=Math.ceil(n.totalItems/n.itemsPerPage);return r<n.currentPage&&0<r?r:n.currentPage<1?1:n.currentPage}createPageArray(n,r,a,u){u=+u;let p=[];const v=Math.max(Math.ceil(a/r),1),w=Math.ceil(u/2),I=n<=w,k=v-w<n,N=!I&&!k;let q=u<v,Y=1;for(;Y<=v&&Y<=u;){let le,Ce=this.calculatePageNumber(Y,n,u,v),Me=2===Y&&(N||k),Pe=Y===u-1&&(N||I);le=q&&(Me||Pe)?"...":Ce,p.push({label:le,value:Ce}),Y++}return p}calculatePageNumber(n,r,a,u){let p=Math.ceil(a/2);return n===a?u:1===n?n:a<u?u-p<r?u-a+n:p<r?r-p+n:n:n}}return e.\u0275fac=function(n){return new(n||e)(Ae(_x),Ae(Fp))},e.\u0275dir=lt({type:e,selectors:[["pagination-template"],["","pagination-template",""]],inputs:{id:"id",maxSize:"maxSize"},outputs:{pageChange:"pageChange",pageBoundsCorrection:"pageBoundsCorrection"},exportAs:["paginationApi"],features:[Zr]}),e})(),uN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e}),e.\u0275inj=jr({providers:[_x],imports:[[nv]]}),e})();const hN=function(e){return["detailed-job",e]};function dN(e,t){if(1&e&&(gt(0,"div",10)(1,"div",11)(2,"div",12),Or(3,"img",13),bt(),gt(4,"div",14)(5,"div",15)(6,"div",16),Wt(7),bt(),gt(8,"div",17),Wt(9),bt(),gt(10,"div",18)(11,"div",19),Wt(12),bt()()(),gt(13,"div",20)(14,"div",21)(15,"div",22),Or(16,"ngx-star-rating",23),bt()(),gt(17,"div",24),Or(18,"div",25),gt(19,"div",26),Wt(20),bt()()()()()()),2&e){const n=t.$implicit,r=t.index,a=Jo(2);nn(3),xp("src","https://picsum.photos/200/",300+r,"",Oa),nn(3),Lr("routerLink",Lw(7,hN,r)),nn(1),Yo(" ",n.title," "),nn(2),Yo(" Department name \u2022 ",n.name," "),nn(3),Yo(" ",a.getCurrentLocation(r)," "),nn(4),Lr("id","rating"+r),nn(4),Yo("Posted ",a.actualDayCounting(n.updatedAt)," days ago")}}function pN(e,t){if(1&e){const n=wm();gt(0,"span",29),ui("click",function(){A(n);const a=Jo().$implicit;return Jo(),F(td(4).setCurrent(a.value))}),Wt(1),bt()}if(2&e){const n=Jo().$implicit;nn(1),ta(n.label)}}function fN(e,t){if(1&e&&(gt(0,"div")(1,"span"),Wt(2),bt()()),2&e){const n=Jo().$implicit;nn(2),ta(n.label)}}function mN(e,t){if(1&e&&(gt(0,"div",27),Is(1,pN,2,1,"span",28),Is(2,fN,3,1,"div",0),bt()),2&e){const n=t.$implicit;Jo();const r=td(4);bp("current",r.getCurrent()===n.value),nn(1),Lr("ngIf",r.getCurrent()!==n.value),nn(1),Lr("ngIf",r.getCurrent()===n.value)}}function gN(e,t){if(1&e){const n=wm();yp(0),Is(1,dN,21,9,"div",1),function Uw(e,t){const n=M();let r;const a=e+22;n.firstCreatePass?(r=function oA(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}}(t,n.pipeRegistry),n.data[a]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(a,r.onDestroy)):r=n.data[a];const u=r.factory||(r.factory=Ho(r.type)),p=mi(Ae);try{const v=hl(!1),w=u();return hl(v),function JS(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,E(),a,w),w}finally{mi(p)}}(2,"paginate"),gt(3,"pagination-template",2,3),ui("pageChange",function(a){return A(n),F(Jo().config.currentPage=a)}),gt(5,"div",4)(6,"div",5)(7,"span",6),ui("click",function(){A(n);const a=td(4);return F(a.getCurrent()>1&&a.previous())}),Wt(8," chevron_left "),bt()(),gt(9,"div",7),Is(10,mN,3,4,"div",8),bt(),gt(11,"div",9)(12,"span",6),ui("click",function(){A(n);const a=td(4);return F(a.getCurrent()<a.pages.length&&a.next())}),Wt(13," chevron_right "),bt()()()(),_p()}if(2&e){const n=td(4),r=Jo();nn(1),Lr("ngForOf",jw(2,3,r.jobs,r.config)),nn(2),Lr("id",r.config.id),nn(7),Lr("ngForOf",n.pages)}}let yN=(()=>{class e{constructor(n,r){this.httpClient=n,this.router=r,this.locs="",this.pageLoading=!1,this.actualDayResult="",this.actualDay=0,this.yearsPosting=0,this.monthPosting=0,this.dayPosting=0,this.page=1,this.timeStamp=(new Date).getTime(),this.linkPicture="https://picsum.photos/200/300",this.config={id:"custom",itemsPerPage:15,currentPage:1,totalItems:0},this.jobs=[],this.locs=[],this.config.totalItems=this.jobs.length}ngOnInit(){this.getWorkersList()}actualDayCounting(n){return this.actualDayResult=n.split("T")[0],this.yearsPosting=+this.actualDayResult.split("-")[0],this.monthPosting=+this.actualDayResult.split("-")[1],this.dayPosting=+this.actualDayResult.split("-")[2],this.actualDay=this.yearsPosting<=2012?365*((new Date).getFullYear()-this.yearsPosting)+2+30*((new Date).getMonth()-this.monthPosting)+(new Date).getDate()-this.dayPosting:365*((new Date).getFullYear()-this.yearsPosting)+1+30*((new Date).getMonth()-this.monthPosting)+(new Date).getDate()-this.dayPosting,this.actualDay}setLocationList(){let n,r;(function PL(...e){const t=Ee(e),n=function AL(e){return 1===e.length&&TL(e[0])?e[0]:e}(e);return n.length?new on(r=>{let a=n.map(()=>[]),u=n.map(()=>!1);r.add(()=>{a=u=null});for(let p=0;!r.closed&&p<n.length;p++)_r(n[p]).subscribe(Qt(r,v=>{if(a[p].push(v),a.every(w=>w.length)){const w=a.map(I=>I.shift());r.next(t?t(...w):w),a.some((I,k)=>!I.length&&u[k])&&r.complete()}},()=>{u[p]=!0,!a[p].length&&r.complete()}));return()=>{a=u=null}}):ie})(...this.jobs.map(u=>(n=""+u.location.lat,r=""+u.location.long,this.httpClient.get(`https://api.geoapify.com/v1/geocode/reverse?lat=${n}&lon=${r}&apiKey=f63668a6d3c84036b32711090672634d`)))).subscribe(u=>{this.locs=u})}getCurrentLocation(n){let r=this.locs[n].features[0].properties.city,a=this.locs[n].features[0].properties.country,u=r+", "+a;return(void 0===r||void 0===a)&&(u="Locus non available"),u}getLinkPicture(){return this.timeStamp?this.linkPicture+"?"+this.timeStamp:this.linkPicture?this.setLinkPicture(this.linkPicture):0}setLinkPicture(n){this.linkPicture=n,this.timeStamp=(new Date).getTime()}getWorkersList(){this.httpClient.get("https://api.json-generator.com/templates/ZM1r0eic3XEy/data?access_token=wm3gg940gy0xek1ld98uaizhz83c6rh2sir9f9fu").subscribe(n=>{this.jobs=n,this.totalLength=n.length,void 0!==this.jobs&&this.setLocationList(),this.pageLoading=!0})}}return e.\u0275fac=function(n){return new(n||e)(Ae(Wv),Ae(hi))},e.\u0275cmp=Kt({type:e,selectors:[["app-response"]],decls:1,vars:1,consts:[[4,"ngIf"],["class","response_block",4,"ngFor","ngForOf"],[3,"id","pageChange"],["p","paginationApi"],[1,"custom-pagination"],[1,"pagination-previous"],[1,"material-icons",3,"click"],[1,"pages_count"],["class","page-number",3,"current",4,"ngFor","ngForOf"],[1,"pagination-next"],[1,"response_block"],[1,"response_block__response"],[1,"img_area"],["alt","random image","height","100","width","100",1,"img_area__source",3,"src"],[1,"content_area"],[1,"text_area"],[1,"text_area__header",3,"routerLink"],[1,"text_area__description"],[1,"text_area__location"],[1,"text_area__location-Country"],[1,"post_estimate"],[1,"rating_area"],[1,"rating_area__stars"],[3,"id"],[1,"post_date_area"],[1,"rect-img"],[1,"post_date"],[1,"page-number"],[3,"click",4,"ngIf"],[3,"click"]],template:function(n,r){1&n&&Is(0,gN,14,6,"ng-container",0),2&n&&Lr("ngIf",r.pageLoading)},dependencies:[Jm,J_,KO,cN,nf,lN],styles:['[_nghost-%COMP%]{display:block;padding:9px}.img_area[_ngcontent-%COMP%]{border-radius:50%;min-width:100px;height:100px;overflow:hidden}.response_block[_ngcontent-%COMP%]{margin:29px 260px -19px}.response_block__response[_ngcontent-%COMP%]{background:white;padding:24px 16px;border-radius:8px;box-shadow:2px 1px 7px #00000014,0 2px 1px -1px #0000000a,0 1px 3px #0000001f;display:flex;width:100%;flex-direction:row;column-gap:20px}.text_area__location-Country[_ngcontent-%COMP%]{position:relative;margin-left:13px}.text_area__location-Country[_ngcontent-%COMP%]:before{content:"";transform:scale(1);position:absolute;width:13px;height:18px;background:url(map-marker-1.540489a79ce73d70.svg) no-repeat center;left:-13px;bottom:1px}.text_area__header[_ngcontent-%COMP%]{size:20px;max-width:585px;word-break:break-all;font-weight:700;color:#3a4562d0;padding-bottom:10px;line-height:25px;letter-spacing:-.625px}.text_area__header[_ngcontent-%COMP%]:hover{cursor:pointer;color:#000}.text_area__description[_ngcontent-%COMP%]{padding:10px 0;color:#878d9d}.text_area__location[_ngcontent-%COMP%]{padding-top:10px;color:#878d9d}.rating_area[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;padding-right:50px;min-width:143px;max-width:300px}.post_estimate[_ngcontent-%COMP%]{display:flex;flex-direction:row}.rect-img[_ngcontent-%COMP%]{width:18px;height:22px;background:url(Rectangle.8336b7fd4a8df6d6.png) center no-repeat}.rect-img[_ngcontent-%COMP%]:hover{cursor:pointer;background:url(Rectangle-hover.ff58d9171a37df9c.png) center no-repeat}.post_date_area[_ngcontent-%COMP%]{display:flex;margin-left:auto;flex-direction:column;align-items:flex-end;justify-content:space-between}.post_date[_ngcontent-%COMP%]{font-weight:400;font-size:16px;line-height:25px;min-width:150px;color:#878d9d}.custom-pagination[_ngcontent-%COMP%]{margin:60px auto!important;line-height:52px!important;background:white!important;max-width:512px!important;border-radius:10.4px!important;display:flex!important;align-items:center!important;justify-content:space-between!important;box-shadow:2px 1px 7px #00000014,0 2px 1px -1px #0000000a,0 1px 3px #0000001f;font-size:20.8px;font-weight:700;color:#70778b}.custom-pagination[_ngcontent-%COMP%]   .page-number[_ngcontent-%COMP%]{display:inline-block;margin:0 4px}.page-number.current[_ngcontent-%COMP%]{position:relative;color:#5876c5}.page-number.current[_ngcontent-%COMP%]:after{content:"";display:block;height:3px;width:100%;background:#5876C5;position:absolute;bottom:0}.page-number[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;height:100%;padding:0 9px;cursor:pointer}.pages_count[_ngcontent-%COMP%]{padding:0 10px!important}.pagination-previous[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .pagination-next[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:30px!important;color:#7d859c7c!important;font-weight:700!important;justify-self:center!important;padding:0 20px;position:relative}.pagination-previous[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{content:"";position:absolute;display:block;width:1.3px;height:140%;background-color:#dee3ef;right:0;bottom:-20%}.pagination-next[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{content:"";position:absolute;display:block;width:1.3px;height:140%;background-color:#dee3ef;left:0;bottom:-20%}.pagination-previous[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover, .pagination-next[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{cursor:pointer}.content_area[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}@media (min-width: 801px) and (max-width: 1260px){.response_block[_ngcontent-%COMP%]{margin:0}}@media only screen and (max-width: 800px){html[_ngcontent-%COMP%]{margin:0;padding:0}.response_block[_ngcontent-%COMP%]{margin:9px}.response_block__response[_ngcontent-%COMP%]{background:#EFF0F5;width:95.5%;margin:0 0 9px}.img_area[_ngcontent-%COMP%]{order:0;align-self:center}.rating_area[_ngcontent-%COMP%]{order:1;min-width:100px}.post_date_area[_ngcontent-%COMP%]{order:2}.text_area[_ngcontent-%COMP%]{order:3}.text_area__description[_ngcontent-%COMP%], .text_area__location[_ngcontent-%COMP%]{max-width:75%;font-size:16px}.text_area__header[_ngcontent-%COMP%]{max-width:85%;font-size:18px}.rating_area[_ngcontent-%COMP%]{order:0;justify-content:start;padding:0}.content_area[_ngcontent-%COMP%]{flex-direction:column;width:100%;margin:0 5px 0 0}.post_estimate[_ngcontent-%COMP%]{padding-bottom:17px;justify-content:space-between}.post_date_area[_ngcontent-%COMP%]{display:block;margin:0}.post_date[_ngcontent-%COMP%]{min-width:160px;padding-right:16px}.rect-img[_ngcontent-%COMP%]{display:none}.text_area__location-Country[_ngcontent-%COMP%]:before{transform:scale(1.2);width:13px;height:18px;bottom:3px;left:-19px}.text_area__location-Country[_ngcontent-%COMP%]{margin-left:18px}}']}),e})(),_N=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Kt({type:e,selectors:[["app-not-found"]],decls:2,vars:0,template:function(n,r){1&n&&(gt(0,"h1"),Wt(1,"Page Not Found!"),bt())},styles:["h1[_ngcontent-%COMP%]{font-family:Cambria,Cochin,Georgia,Times,Times New Roman,serif;font-size:72px;padding-bottom:100px}[_nghost-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100vh}"]}),e})();var vx=Fl(943);const vN=["map"];let xN=(()=>{class e{constructor(){}ngOnInit(){this.getJobLocation(this.job.location.lat,this.job.location.long)}ngAfterViewInit(){const n={lng:this.jobLongLocation,lat:this.jobLatLocation,zoom:14};this.map=new vx.Map({container:this.mapContainer.nativeElement,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=8zQsDmDd3AnJyMNje7sb",center:[n.lng,n.lat],zoom:n.zoom}),this.map.addControl(new vx.NavigationControl({}),"top-right"),new vx.Marker({color:"#D8D8D8"}).setLngLat([n.lng,n.lat]).addTo(this.map)}ngOnDestroy(){this.map?.remove()}getJobLocation(n,r){this.jobLatLocation=n,this.jobLongLocation=r}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Kt({type:e,selectors:[["app-map"]],viewQuery:function(n,r){if(1&n&&__(vN,5),2&n){let a;Ap(a=Pp())&&(r.mapContainer=a.first)}},inputs:{job:"job"},decls:5,vars:0,consts:[[1,"map-wrap"],["href","https://www.maptiler.com",1,"watermark"],["src","https://api.maptiler.com/resources/logo.svg","alt","MapTiler logo"],[1,"map"],["map",""]],template:function(n,r){1&n&&(gt(0,"div",0)(1,"a",1),Or(2,"img",2),bt(),Or(3,"div",3,4),bt())},styles:[".map-wrap[_ngcontent-%COMP%]{position:relative;width:100%;height:calc(100vh - 77px)}.map[_ngcontent-%COMP%]{position:absolute;width:100%;height:40%}.watermark[_ngcontent-%COMP%]{position:absolute;left:10px;bottom:10px;z-index:999}"]}),e})();function bN(e,t){if(1&e&&(gt(0,"li"),Wt(1),bt()),2&e){const n=t.$implicit;nn(1),ta(n)}}function wN(e,t){if(1&e&&(gt(0,"div",48),Wt(1),bt()),2&e){const n=t.$implicit;nn(1),ta(n.replace(" ","-"))}}function CN(e,t){if(1&e&&(gt(0,"div",49),Wt(1),bt()),2&e){const n=t.$implicit;nn(1),ta(n)}}function DN(e,t){if(1&e&&(gt(0,"div",50),Or(1,"img",51),bt()),2&e){const n=t.$implicit,r=t.index,a=Jo(2);nn(1),xp("alt","attached image \u2116",r+1,""),Lr("src",a.setTimeoutImages(n,r),Oa)}}function EN(e,t){if(1&e&&(yp(0),gt(1,"div",1)(2,"section",2)(3,"div",3)(4,"p",4),Wt(5,"Job Details"),bt(),gt(6,"div",5)(7,"p",6),Wt(8,"Save to my list"),bt(),gt(9,"p",7),Wt(10,"Share"),bt()()(),gt(11,"button",8),Wt(12,"APPLY NOW"),bt(),gt(13,"div",9)(14,"div",10),Wt(15),bt(),gt(16,"div",11)(17,"p",12),Wt(18),bt(),gt(19,"p",13),Wt(20,"Brutto, per year"),bt()()(),gt(21,"div",14)(22,"div",15),Wt(23),bt(),gt(24,"div",16)(25,"p",13),Wt(26,"Brutto, per year"),bt(),gt(27,"p",12),Wt(28),bt()()(),gt(29,"div",17),Wt(30),Or(31,"br")(32,"br")(33,"br"),gt(34,"b"),Wt(35,"Responsopilities"),bt(),Or(36,"br")(37,"br"),Wt(38),Or(39,"br")(40,"br")(41,"br"),gt(42,"b"),Wt(43,"Compensation & Benefits:"),bt()(),Or(44,"br")(45,"br"),gt(46,"ul",18),Is(47,bN,2,1,"li",19),bt(),Or(48,"br"),gt(49,"div",20)(50,"button",21),Wt(51,"APPLY NOW"),bt()(),gt(52,"div",22)(53,"div",23)(54,"div",24),Wt(55," Additional Info "),bt(),gt(56,"div",25)(57,"p",26),Wt(58," Employment type "),bt(),gt(59,"div",27),Is(60,wN,2,1,"div",28),bt(),gt(61,"p",29),Wt(62," Benefits "),bt(),gt(63,"div",30),Is(64,CN,2,1,"div",31),bt()()(),gt(65,"div",32)(66,"div",33),Wt(67," Attached images "),bt(),gt(68,"div",34),Is(69,DN,2,2,"div",35),bt()()(),gt(70,"div",36)(71,"button",37)(72,"span"),Wt(73,"RETURN TO JOB BOARD"),bt()()()(),gt(74,"section",38)(75,"div",39),Wt(76," Contacts "),bt(),gt(77,"div",40)(78,"div",41)(79,"div",42)(80,"div",43),Wt(81," Department name. "),Or(82,"br"),Wt(83),bt(),gt(84,"div",44)(85,"p"),Or(86,"span",45),Wt(87),bt(),gt(88,"p"),Wt(89),Or(90,"br"),Wt(91),bt()()()(),gt(92,"div",46),Or(93,"app-map",47),bt()()()(),_p()),2&e){const n=Jo();nn(15),ta(n.job.title),nn(3),Yo("\u20ac\xa0",n.job.salary.replaceAll("k"," 000").replace("-","\u2014"),""),nn(5),Yo("Posted ",n.actualDayCounting(n.job.updatedAt)," days ago"),nn(5),Yo("\u20ac\xa0",n.job.salary.replaceAll("k"," 000").replace("-","\u2014"),""),nn(2),ta(n.job.description.split("Responsopilities")[0]),nn(8),Yo(" ",n.job.description.split("Responsopilities:")[1].split("Compensation & Benefits:")[0],""),nn(9),Lr("ngForOf",n.benefits),nn(13),Lr("ngForOf",n.job.employment_type),nn(4),Lr("ngForOf",n.job.benefits),nn(5),Lr("ngForOf",n.job.pictures),nn(2),Lr("routerLink",""),nn(12),Yo("",n.job.name,". "),nn(4),ta(n.job.address),nn(2),Yo("",n.job.phone,","),nn(2),ta(n.job.email),nn(2),Lr("job",n.job)}}const IN=[{path:"",component:yN},{path:"detailed-job/:id",component:(()=>{class e{constructor(n,r){this.httpClient=n,this.activateRoute=r,this.pageLoading=!1,this.benefits=[],this.actualDayResult="",this.actualDay=0,this.yearsPosting=0,this.monthPosting=0,this.dayPosting=0,this.apiKey="f63668a6d3c84036b32711090672634d",this.jobs=[],this.subscription=r.params.subscribe(a=>this.id=a.id)}ngOnInit(){void 0!==this.id&&this.getWorkersList()}getWorkersList(){this.httpClient.get("https://api.json-generator.com/templates/ZM1r0eic3XEy/data?access_token=wm3gg940gy0xek1ld98uaizhz83c6rh2sir9f9fu").subscribe(r=>{this.jobs=r,void 0!==this.id&&(this.job=JSON.parse(JSON.stringify(this.jobs[this.id])),this.benefits.push(this.job.description.split("Responsopilities")[1].split("Compensation & Benefits:")[1].split(".")),this.benefits[0].pop(),this.benefits=Array.from(this.benefits[0]),console.log(this.benefits),this.pageLoading=!0)})}actualDayCounting(n){return this.actualDayResult=n.split("T")[0],this.yearsPosting=+this.actualDayResult.split("-")[0],this.monthPosting=+this.actualDayResult.split("-")[1],this.dayPosting=+this.actualDayResult.split("-")[2],this.actualDay=this.yearsPosting<=2012?365*((new Date).getFullYear()-this.yearsPosting)+2+30*((new Date).getMonth()-this.monthPosting)+(new Date).getDate()-this.dayPosting:365*((new Date).getFullYear()-this.yearsPosting)+1+30*((new Date).getMonth()-this.monthPosting)+(new Date).getDate()-this.dayPosting,this.actualDay}setTimeoutImages(n,r){if(void 0!==this.id){let a;return a=+n.slice(n.lastIndexOf("/")+1)+ +this.id,a+=r,n=n.substring(0,n.lastIndexOf("/")+1)+a,console.log(n),n}}}return e.\u0275fac=function(n){return new(n||e)(Ae(Wv),Ae(kc))},e.\u0275cmp=Kt({type:e,selectors:[["app-detailed-job-page"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"container"],[1,"main"],[1,"title_section","underline"],[1,"title","titles_styling"],[1,"action_section"],[1,"save"],[1,"share"],["id","apply-btn-1",1,"apply"],[1,"job-title-section"],[1,"job-title"],[1,"job-salary"],[1,"salary-value"],[1,"salary-description"],[1,"post-date-section"],[1,"post_date"],[1,"job-salary-phone"],[1,"job-description"],[1,"benefits"],[4,"ngFor","ngForOf"],[1,"btn-apply-container"],["id","btn2",1,"apply"],[1,"additional_container"],[1,"additional_section"],[1,"additional-title","titles_styling","underline","mobile_underline"],[1,"employment"],[1,"employment-header","e-header"],[1,"employment_container","e-container"],["class","employment-type e-type",4,"ngFor","ngForOf"],[1,"benefits-header","e-header"],[1,"benefits_container","e-container"],["class","benefits-type e-type",4,"ngFor","ngForOf"],[1,"attached_section"],[1,"attached-header","titles_styling","underline","mobile_underline"],[1,"images_container"],["src","","class","attached__img",4,"ngFor","ngForOf"],[1,"btn_container"],[1,"return-btn",3,"routerLink"],[1,"aside"],[1,"Contacts-title","titles_styling","underline","mobile_underline"],[1,"map_container"],[1,"contact-info-bg"],[1,"contact-info-content"],[1,"contact-info__header"],[1,"contact-info__content"],[1,"location-mark"],[1,"map"],[3,"job"],[1,"employment-type","e-type"],[1,"benefits-type","e-type"],["src","",1,"attached__img"],[1,"a_img",3,"src","alt"]],template:function(n,r){1&n&&Is(0,EN,94,16,"ng-container",0),2&n&&Lr("ngIf",r.pageLoading)},dependencies:[Jm,J_,nf,xN],styles:['.container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;background:white}.main[_ngcontent-%COMP%]{width:60%;padding-top:65px;padding-left:347px}.aside[_ngcontent-%COMP%]{width:40%}.title_section[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:baseline}.underline[_ngcontent-%COMP%]{border-bottom:solid 1px #3a456269}.action_section[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:64px;font-style:normal;font-weight:400;font-size:18px;line-height:24px;letter-spacing:-.5625px;color:#3a4562;font-stretch:100}.title[_ngcontent-%COMP%]{min-width:146px}.titles_styling[_ngcontent-%COMP%]{color:#3a4562;line-height:34.1px;letter-spacing:.41px;padding-bottom:9px;font-family:Proxima Nova;font-style:normal;font-weight:700;font-size:28px;line-height:34px;letter-spacing:.413333px}button[_ngcontent-%COMP%]:hover{cursor:pointer}.apply[_ngcontent-%COMP%]:hover{background:#4e5e86;box-shadow:0 0 1px #000}.save[_ngcontent-%COMP%], .share[_ngcontent-%COMP%]{position:relative}.save[_ngcontent-%COMP%]:hover, .share[_ngcontent-%COMP%]:hover{cursor:pointer}.save[_ngcontent-%COMP%]:before{content:"";display:block;position:absolute;width:18px;height:22px;left:-32px;transform:scale(.9);background:url(Rectangle.8336b7fd4a8df6d6.png) center no-repeat}.save[_ngcontent-%COMP%]:hover:before{background:url(Rectangle-hover.ff58d9171a37df9c.png) center no-repeat}.share[_ngcontent-%COMP%]:before{content:"";display:block;position:absolute;width:20px;height:22px;left:-32px;transform:scale(.9);background:url(ShapeIcon.a32a1d035f82416e.png) center no-repeat}.share[_ngcontent-%COMP%]:hover:before{transform:rotate(-20deg)}.apply[_ngcontent-%COMP%]{margin:39px 0 32px;padding:18px 30px;background:#384564;color:#fff;border:transparent;border-radius:8px;font-family:Proxima Nova;font-style:normal;font-weight:500;font-size:12px;line-height:16px}.job-title-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.job-title[_ngcontent-%COMP%]{max-width:500px;font-family:Proxima Nova;font-style:normal;font-weight:700;font-size:24px;line-height:30px;color:#3a4562}.job-salary[_ngcontent-%COMP%]{display:flex;flex-direction:column}.job-salary-phone[_ngcontent-%COMP%]{display:none}.salary-value[_ngcontent-%COMP%]{font-family:Proxima Nova;font-style:normal;font-weight:700;font-size:20px;line-height:25px}.salary-description[_ngcontent-%COMP%]{font-style:normal;font-weight:400;font-size:18px;line-height:24px;color:#3a4562}.post_date[_ngcontent-%COMP%]{padding:7px 0;font-style:normal;font-weight:400;font-size:18px;line-height:24px;color:#38415d5b}.job-description[_ngcontent-%COMP%]{font-style:normal;font-weight:400;font-size:18px;line-height:24px;color:#3a4562}.benefits[_ngcontent-%COMP%]{font-style:normal;font-weight:400;font-size:18px;line-height:24px;color:#3a4562;list-style-type:none}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{position:relative}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:"";position:absolute;width:9px;height:9px;background:rgba(56,69,100,.632594);left:-19px;bottom:9px}#btn2[_ngcontent-%COMP%]{margin-bottom:86px}.e-header[_ngcontent-%COMP%]{margin:15px 0 10px;font-style:normal;font-weight:400;font-size:18px;line-height:24px}.employment-type[_ngcontent-%COMP%]{color:#55699e;background:rgba(161,177,219,.317343);border:1px solid rgba(85,105,158,.3)}.benefits-type[_ngcontent-%COMP%]{color:#988b49;background:rgba(255,207,0,.15);border:1px solid #FFCF00}.e-type[_ngcontent-%COMP%]{width:222px;text-align:center;padding:17px 0;border-radius:8px;font-weight:700}.e-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:8px}.benefits_container[_ngcontent-%COMP%]{padding-bottom:87px}.images_container[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:20px;padding-top:20px}.attached__img[_ngcontent-%COMP%]{width:200px;height:120px}.a_img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:10px}.btn_container[_ngcontent-%COMP%]{position:relative;padding:100px 0 150px}.return-btn[_ngcontent-%COMP%]{position:absolute;padding:18px 26px 16px 52px;background:rgba(57,70,101,.14);border:transparent;border-radius:8px;left:-105px}.return-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:relative;font-family:Proxima Nova;font-style:normal;font-weight:600;font-size:12px;line-height:16px;color:#3a4562}.return-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:"";background:url(Arrow.ccde4da3d1f82e74.png) center no-repeat;width:10px;height:18px;position:absolute;left:-29px;bottom:0}.return-btn[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]:before{animation:.4s linear 0s 1 forwards running-arrow}@keyframes running-arrow{0%{left:-29px}to{left:-39px}}.map_container[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;flex-direction:column;width:402px;height:436px;border-radius:8px;margin-left:135px;margin-top:56px;overflow:hidden}.contact-info-bg[_ngcontent-%COMP%], map[_ngcontent-%COMP%]{height:50%;width:100%}.Contacts-title[_ngcontent-%COMP%]{display:none}.contact-info-bg[_ngcontent-%COMP%]{background-image:url(contact-info-bg.7a845e7bfa5a8e94.png);background-color:#2a3047;background-repeat:no-repeat;background-position:left}.contact-info__header[_ngcontent-%COMP%]{font-family:Proxima Nova;font-style:normal;font-weight:700;font-size:20px;line-height:25px;color:#e7eaf0}.contact-info-content[_ngcontent-%COMP%]{padding:31px 62px}.contact-info__content[_ngcontent-%COMP%]{padding:8px 0;font-style:normal;font-weight:400;font-size:18px;line-height:24px;color:#e8ebf3}.location-mark[_ngcontent-%COMP%]{content:"";display:inline-block;width:13px;height:18px;background:url(map-marker-2.cb5f68faafd2e206.svg)}#my-map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}@media (min-width:415px) and (max-width:1580px){.main[_ngcontent-%COMP%]{padding:15px 5%;width:70%}.aside[_ngcontent-%COMP%]{width:30%}.return-btn[_ngcontent-%COMP%]{left:-5%}.map_container[_ngcontent-%COMP%]{width:100%;margin:20px 0 0}}@media (min-width: 415px) and (max-width: 1079px){.container[_ngcontent-%COMP%]{flex-direction:column}.main[_ngcontent-%COMP%]{width:auto}.btn_container[_ngcontent-%COMP%]{padding-bottom:30px}.Contacts-title[_ngcontent-%COMP%]{display:block}.aside[_ngcontent-%COMP%]{padding:20px;width:auto}}@media only screen and (max-width: 414px){.container[_ngcontent-%COMP%]{flex-direction:column;padding:24px 15px 37px;width:auto;overflow:hidden}.main[_ngcontent-%COMP%], .aside[_ngcontent-%COMP%]{margin:0;padding:0;width:auto}.map_container[_ngcontent-%COMP%]{width:100%;padding:0;margin:0}.title_section[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{width:100%}.underline[_ngcontent-%COMP%]{border-bottom:none}.title[_ngcontent-%COMP%]{border-bottom:solid 1px rgba(58,69,98,.13)}.job-salary[_ngcontent-%COMP%], .btn_container[_ngcontent-%COMP%]{display:none}.e-type[_ngcontent-%COMP%]{padding:17px;width:auto;min-width:122px;text-align:end}.action_section[_ngcontent-%COMP%]{padding-top:24px;font-style:normal;font-weight:400;font-size:16px;line-height:23px}.save[_ngcontent-%COMP%]{margin-left:30px}.save[_ngcontent-%COMP%]:before{content:"";display:block;position:absolute;width:23px;height:22px;left:-30px;background:url(Star.fe534b879e9cf942.png) center no-repeat}#apply-btn-1[_ngcontent-%COMP%]{display:none}.job-title-section[_ngcontent-%COMP%]{margin-top:32px}.post_date[_ngcontent-%COMP%]{font-family:Proxima Nova;font-style:normal;font-weight:300;font-size:13px;line-height:25px;max-width:140px}.job-salary-phone[_ngcontent-%COMP%]{display:flex;flex-direction:column}.job-salary-phone[_ngcontent-%COMP%]   .salary-description[_ngcontent-%COMP%]{text-align:end;font-family:Proxima Nova;font-style:normal;font-weight:400;font-size:18px;line-height:24px}.job-salary-phone[_ngcontent-%COMP%]   .salary-value[_ngcontent-%COMP%]{font-family:Proxima Nova;font-style:normal;font-weight:700;font-size:20px;line-height:25px}.post-date-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.job-description[_ngcontent-%COMP%]{margin-top:14px}.btn-apply-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-left:22px}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{top:7px}.apply[_ngcontent-%COMP%]{margin:30px 0 135px}.additional_container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.additional_section[_ngcontent-%COMP%]{order:1}.attached_section[_ngcontent-%COMP%]{order:0}.mobile_underline[_ngcontent-%COMP%]{border-bottom:solid 1px rgba(58,69,98,.13)}.images_container[_ngcontent-%COMP%]{min-width:120%;flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none;margin-bottom:55px}.attached__img[_ngcontent-%COMP%]:last-of-type{padding-right:80px}.images_container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.attached__img[_ngcontent-%COMP%]{flex:0 0 auto}.Contacts-title[_ngcontent-%COMP%]{display:block;margin-bottom:21px}.additional-title[_ngcontent-%COMP%]{width:80%}}']}),e})()},{path:"**",component:_N}];let SN=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ft({type:e,bootstrap:[ML]}),e.\u0275inj=jr({imports:[Uk,JO,GO,qO,GL,uN,bL.forRoot(IN)]}),e})();(function h2(){F1=!1})(),Vk().bootstrapModule(SN).catch(e=>console.error(e))},943:function(md){md.exports=function(){"use strict";var Rl,Fl,Tn;function Nc(y,Hn){if(Rl)if(Fl){var So="var sharedChunk = {}; ("+Rl+")(sharedChunk); ("+Fl+")(sharedChunk);",ao={};Rl(ao),Tn=Hn(ao),typeof window<"u"&&(Tn.workerUrl=window.URL.createObjectURL(new Blob([So],{type:"text/javascript"})))}else Fl=Hn;else Rl=Hn}return Nc(0,function(y){var Hn=So;function So(s,i,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=h}function ao(s,i,l,h){const m=new Hn(s,i,l,h);return function(_){return m.solve(_)}}So.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(void 0===i&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var m=this.sampleCurveX(l)-s;if(Math.abs(m)<i)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=m/_}var b=0,D=1;for(l=s,h=0;h<20&&(m=this.sampleCurveX(l),!(Math.abs(m-s)<i));h++)s>m?b=l:D=l,l=.5*(D-b)+b;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};const Xt=ao(.25,.1,.25,1);function xe(s,i,l){return Math.min(l,Math.max(i,s))}function Mo(s,i,l){const h=l-i,m=((s-i)%h+h)%h+i;return m===i?l:m}function wi(s,...i){for(const l of i)for(const h in l)s[h]=l[h];return s}let On=1;function Ll(s,i){s.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function Wa(s,i,l){const h={};for(const m in s)h[m]=i.call(l||this,s[m],m,s);return h}function To(s,i,l){const h={};for(const m in s)i.call(l||this,s[m],m,s)&&(h[m]=s[m]);return h}function Vr(s){return Array.isArray(s)?s.map(Vr):"object"==typeof s&&s?Wa(s,Vr):s}const Hi={};function Un(s){Hi[s]||(typeof console<"u"&&console.warn(s),Hi[s]=!0)}function lo(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function co(s){let i=0;for(let l,h,m=0,_=s.length,b=_-1;m<_;b=m++)l=s[m],h=s[b],i+=(h.x-l.x)*(l.y+h.y);return i}function Ci(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function la(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,m,_)=>{const b=m||_;return i[h]=!b||b.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let Ao,Gi,Di=null;function ca(s){if(null==Di){const i=s.navigator?s.navigator.userAgent:null;Di=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Di}function uo(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Qo={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(s){const i=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(s,i=0){const l=window.document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return l.width=s.width,l.height=s.height,h.drawImage(s,0,0,s.width,s.height),h.getImageData(-i,-i,s.width+2*i,s.height+2*i)},resolveURL:s=>(Ao||(Ao=document.createElement("a")),Ao.href=s,Ao.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==Gi&&(Gi=matchMedia("(prefers-reduced-motion: reduce)")),Gi.matches)}};var at=Ur;function Ur(s,i){this.x=s,this.y=i}Ur.prototype={clone:function(){return new Ur(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,i){var l=Math.cos(s),h=Math.sin(s),m=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ur.convert=function(s){return s instanceof Ur?s:Array.isArray(s)?new Ur(s[0],s[1]):s};const Po={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Ei="mapbox-tiles";let on,ua=500,ha=50;function da(){typeof caches>"u"||on||(on=caches.open(Ei))}let rr=1/0;const ko={supported:!1,testSupport:function(s){!Qt&&An&&(pa?At(s):Ro=s)}};let Ro,An,Qt=!1,pa=!1;function At(s){const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,An),s.isContextLost())return;ko.supported=!0}catch{}s.deleteTexture(i),Qt=!0}typeof document<"u"&&(An=document.createElement("img"),An.onload=function(){Ro&&At(Ro),Ro=null,pa=!0},An.onerror=function(){Qt=!0,Ro=null},An.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(qi);class Ii extends Error{constructor(i,l,h,m){super(`AJAXError: ${l} (${i}): ${h}`),this.status=i,this.statusText=l,this.url=h,this.body=m}}const fa=Ci()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function As(s,i){const l=new AbortController,h=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:fa(),signal:l.signal});let m=!1,_=!1;return"json"===s.type&&h.headers.set("Accept","application/json"),((b,D,S)=>{if(_)return;const T=Date.now();fetch(h).then(R=>{return R.ok?(L=R,null,T,void("arrayBuffer"===s.type?L.arrayBuffer():"json"===s.type?L.json():L.text()).then(j=>{_||(m=!0,i(null,j,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(j=>{_||i(new Error(j.message))})):R.blob().then(L=>i(new Ii(R.status,R.statusText,s.url,L)));var L}).catch(R=>{20!==R.code&&i(new Error(R.message))})})(),{cancel:()=>{_=!0,m||l.abort()}}}const Za=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){if(Ci()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i);if(!Ci()){const h=s.url.substring(0,s.url.indexOf("://"));return(Po.REGISTERED_PROTOCOLS[h]||As)(s,i)}}if(!(/^file:/.test(l=s.url)||/^file:/.test(fa())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return As(s,i);if(Ci()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var l;return function(h,m){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(_.responseType="arraybuffer");for(const b in h.headers)_.setRequestHeader(b,h.headers[b]);return"json"===h.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===h.credentials,_.onerror=()=>{m(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let b=_.response;if("json"===h.type)try{b=JSON.parse(_.response)}catch(D){return m(D)}m(null,b,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const b=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});m(new Ii(_.status,_.statusText,h.url,b))}},_.send(h.body),{cancel:()=>_.abort()}}(s,i)},Xa=function(s,i){return Za(wi(s,{type:"arrayBuffer"}),i)};function Ol(s){const i=window.document.createElement("a");return i.href=s,i.protocol===window.document.location.protocol&&i.host===window.document.location.host}const jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Fo,Lo;Fo=[],Lo=0;const Ps=function(s,i){if(ko.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Lo>=Po.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:s,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Fo.push(_),_}Lo++;let l=!1;const h=()=>{if(!l)for(l=!0,Lo--;Fo.length&&Lo<Po.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Fo.shift(),{requestParameters:b,callback:D,cancelled:S}=_;S||(_.cancel=Ps(b,D).cancel)}},m=Xa(s,(_,b,D,S)=>{var T,R;h(),_?i(_):b&&(T=b,R=(T,R)=>{null!=T?i(T):null!=R&&i(null,R,{cacheControl:D,expires:S})},"function"==typeof createImageBitmap?function(L,B){const U=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(U).then(j=>{B(null,j)}).catch(j=>{B(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(T,R):function(L,B){const U=new Image;U.onload=()=>{B(null,U),URL.revokeObjectURL(U.src),U.onload=null,window.requestAnimationFrame(()=>{U.src=jt})},U.onerror=()=>B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(L)],{type:"image/png"});U.src=L.byteLength?URL.createObjectURL(j):jt}(T,R))});return{cancel:()=>{m.cancel(),h()}}};function ma(s,i,l){l[s]&&-1!==l[s].indexOf(i)||(l[s]=l[s]||[],l[s].push(i))}function Oo(s,i,l){if(l&&l[s]){const h=l[s].indexOf(i);-1!==h&&l[s].splice(h,1)}}class ts{constructor(i,l={}){wi(this,l),this.type=i}}class Ka extends ts{constructor(i,l={}){super("error",wi({error:i},l))}}class ns{on(i,l){return this._listeners=this._listeners||{},ma(i,l,this._listeners),this}off(i,l){return Oo(i,l,this._listeners),Oo(i,l,this._oneTimeListeners),this}once(i,l){return this._oneTimeListeners=this._oneTimeListeners||{},ma(i,l,this._oneTimeListeners),this}fire(i,l){"string"==typeof i&&(i=new ts(i,l||{}));const h=i.type;if(this.listens(h)){i.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const D of m)D.call(this,i);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const D of _)Oo(h,D,this._oneTimeListeners),D.call(this,i);const b=this._eventedParent;b&&(wi(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(i))}else i instanceof Ka&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Oe{constructor(i,l,h,m){this.message=(i?`${i}: `:"")+h,m&&(this.identifier=m),null!=l&&l.__line__&&(this.line=l.__line__)}}function ga(s){const i=s.value;return i?[new Oe(s.key,i,"constants have been deprecated as of v8")]:[]}function Wi(s,...i){for(const l of i)for(const h in l)s[h]=l[h];return s}function qt(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Si(s){if(Array.isArray(s))return s.map(Si);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=Si(s[l]);return i}return qt(s)}class Mi extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Ti{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,m]of l)this.bindings[h]=m}concat(i){return new Ti(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const ks={kind:"null"},Le={kind:"number"},Pt={kind:"string"},_t={kind:"boolean"},hr={kind:"color"},No={kind:"object"},pt={kind:"value"},ho={kind:"collator"},dr={kind:"formatted"},Rs={kind:"padding"},Xn={kind:"resolvedImage"};function Ir(s,i){return{kind:"array",itemType:s,N:i}}function hn(s){if("array"===s.kind){const i=hn(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const _r=[ks,Le,Pt,_t,hr,dr,No,Ir(pt),Rs,Xn];function po(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!po(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const l of _r)if(!po(l,i))return null}return`Expected ${hn(s)} but found ${hn(i)} instead.`}function Fs(s,i){return i.some(l=>l.kind===s.kind)}function Ls(s,i){return i.some(l=>"null"===l?null===s:"array"===l?Array.isArray(s):"object"===l?s&&!Array.isArray(s)&&"object"==typeof s:l===typeof s)}var ya,rs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function G(s){return(s=Math.round(s))<0?0:s>255?255:s}function P(s){return G("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function O(s){return(i="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:i>1?1:i;var i}function H(s,i,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(i-s)*l*6:2*l<1?i:3*l<2?s+(i-s)*(2/3-l)*6:s}try{ya={}.parseCSSColor=function(s){var i,l=s.replace(/ /g,"").toLowerCase();if(l in rs)return rs[l].slice();if("#"===l[0])return 4===l.length?(i=parseInt(l.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===l.length&&(i=parseInt(l.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var h=l.indexOf("("),m=l.indexOf(")");if(-1!==h&&m+1===l.length){var _=l.substr(0,h),b=l.substr(h+1,m-(h+1)).split(","),D=1;switch(_){case"rgba":if(4!==b.length)return null;D=O(b.pop());case"rgb":return 3!==b.length?null:[P(b[0]),P(b[1]),P(b[2]),D];case"hsla":if(4!==b.length)return null;D=O(b.pop());case"hsl":if(3!==b.length)return null;var S=(parseFloat(b[0])%360+360)%360/360,T=O(b[1]),R=O(b[2]),L=R<=.5?R*(T+1):R+T-R*T,B=2*R-L;return[G(255*H(B,L,S+1/3)),G(255*H(B,L,S)),G(255*H(B,L,S-1/3)),D];default:return null}}return null}}catch{}class ${constructor(i,l,h,m=1){this.r=i,this.g=l,this.b=h,this.a=m}static parse(i){if(!i)return;if(i instanceof $)return i;if("string"!=typeof i)return;const l=ya(i);return l?new $(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,h,m]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(h)},${m})`}toArray(){const{r:i,g:l,b:h,a:m}=this;return 0===m?[0,0,0,0]:[255*i/m,255*l/m,255*h/m,m]}}$.black=new $(0,0,0,1),$.white=new $(1,1,1,1),$.transparent=new $(0,0,0,0),$.red=new $(1,0,0,1);class ee{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ie{constructor(i,l,h,m,_){this.text=i,this.image=l,this.scale=h,this.fontStack=m,this.textColor=_}}class ne{constructor(i){this.sections=i}static fromString(i){return new ne([new ie(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof ne?i:ne.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}}class te{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof te)return i;if("number"==typeof i)return new te([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if("number"!=typeof l)return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new te(i)}}toString(){return JSON.stringify(this.values)}}class oe{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new oe({name:i,available:!1}):null}}function ye(s,i,l,h){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[s,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[s,i,l,h]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ee(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof $||s instanceof ee||s instanceof ne||s instanceof te||s instanceof oe)return!0;if(Array.isArray(s)){for(const i of s)if(!Ee(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!Ee(s[i]))return!1;return!0}return!1}function ge(s){if(null===s)return ks;if("string"==typeof s)return Pt;if("boolean"==typeof s)return _t;if("number"==typeof s)return Le;if(s instanceof $)return hr;if(s instanceof ee)return ho;if(s instanceof ne)return dr;if(s instanceof te)return Rs;if(s instanceof oe)return Xn;if(Array.isArray(s)){const i=s.length;let l;for(const h of s){const m=ge(h);if(l){if(l===m)continue;l=pt;break}l=m}return Ir(l||pt,i)}return No}function Ke(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof $||s instanceof ne||s instanceof te||s instanceof oe?s.toString():JSON.stringify(s)}class Qe{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ee(i[1]))return l.error("invalid value");const h=i[1];let m=ge(h);const _=l.expectedType;return"array"!==m.kind||0!==m.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(m=_),new Qe(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Be{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const st={string:Pt,number:Le,boolean:_t,object:No};class ct{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,m=1;const _=i[0];if("array"===_){let D,S;if(i.length>2){const T=i[1];if("string"!=typeof T||!(T in st)||"object"===T)return l.error('The item type argument of "array" must be one of string, number, boolean',1);D=st[T],m++}else D=pt;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);S=i[2],m++}h=Ir(D,S)}else{if(!st[_])throw new Error(`Types doesn't contain name = ${_}`);h=st[_]}const b=[];for(;m<i.length;m++){const D=l.parse(i[m],m,pt);if(!D)return null;b.push(D)}return new ct(h,b)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!po(this.type,ge(h)))return h;if(l===this.args.length-1)throw new Be(`Expected value to be of type ${hn(this.type)}, but found ${hn(ge(h))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const $t={"to-boolean":_t,"to-color":hr,"to-number":Le,"to-string":Pt};class ft{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0];if(!$t[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if(("to-boolean"===h||"to-string"===h)&&2!==i.length)return l.error("Expected one argument.");const m=$t[h],_=[];for(let b=1;b<i.length;b++){const D=l.parse(i[b],b,pt);if(!D)return null;_.push(D)}return new ft(m,_)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let l,h;for(const m of this.args){if(l=m.evaluate(i),h=null,l instanceof $)return l;if("string"==typeof l){const _=i.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:ye(l[0],l[1],l[2],l[3]),!h))return new $(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Be(h||`Could not parse color from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}if("padding"===this.type.kind){let l;for(const h of this.args){l=h.evaluate(i);const m=te.parse(l);if(m)return m}throw new Be(`Could not parse padding from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(i),null===l)return 0;const m=Number(l);if(!isNaN(m))return m}throw new Be(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?ne.fromString(Ke(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?oe.fromString(Ke(this.args[0].evaluate(i))):Ke(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const It=["Unknown","Point","LineString","Polygon"];class Ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?It[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=$.parse(i)),l}}class _n{constructor(i,l,h,m){this.name=i,this.type=l,this._evaluate=h,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const h=i[0],m=_n.definitions[h];if(!m)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(m)?m[0]:m.type,b=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,D=b.filter(([T])=>!Array.isArray(T)||T.length===i.length-1);let S=null;for(const[T,R]of D){S=new Qa(l.registry,l.path,null,l.scope);const L=[];let B=!1;for(let U=1;U<i.length;U++){const j=i[U],Q=Array.isArray(T)?T[U-1]:T.type,J=S.parse(j,1+L.length,Q);if(!J){B=!0;break}L.push(J)}if(!B)if(Array.isArray(T)&&T.length!==L.length)S.error(`Expected ${T.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const j=Array.isArray(T)?T[U]:T.type,Q=L[U];S.concat(U+1).checkSubtype(j,Q.type)}if(0===S.errors.length)return new _n(h,_,R,L)}}if(1===D.length)l.errors.push(...S.errors);else{const T=(D.length?D:b).map(([L])=>{return B=L,Array.isArray(B)?`(${B.map(hn).join(", ")})`:`(${hn(B.type)}...)`;var B}).join(" | "),R=[];for(let L=1;L<i.length;L++){const B=l.parse(i[L],1+R.length);if(!B)return null;R.push(hn(B.type))}l.error(`Expected arguments of type ${T}, but found (${R.join(", ")}) instead.`)}return null}static register(i,l){_n.definitions=l;for(const h in l)i[h]=_n}}class zt{constructor(i,l,h){this.type=ho,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const h=i[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const m=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,_t);if(!m)return null;const _=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,_t);if(!_)return null;let b=null;return h.locale&&(b=l.parse(h.locale,1,Pt),!b)?null:new zt(m,_,b)}evaluate(i){return new ee(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const Pn=8192;function Sr(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function is(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function dn(s,i){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(l*m*Pn),Math.round(h*m*Pn)]}function pn(s,i,l){const h=s[0]-i[0],m=s[1]-i[1],_=s[0]-l[0],b=s[1]-l[1];return h*b-_*m==0&&h*_<=0&&m*b<=0}function vn(s,i){let l=!1;for(let b=0,D=i.length;b<D;b++){const S=i[b];for(let T=0,R=S.length;T<R-1;T++){if(pn(s,S[T],S[T+1]))return!1;(m=S[T])[1]>(h=s)[1]!=(_=S[T+1])[1]>h[1]&&h[0]<(_[0]-m[0])*(h[1]-m[1])/(_[1]-m[1])+m[0]&&(l=!l)}}var h,m,_;return l}function Ja(s,i){for(let l=0;l<i.length;l++)if(vn(s,i[l]))return!0;return!1}function Ku(s,i,l,h){const m=h[0]-l[0],_=h[1]-l[1],b=(s[0]-l[0])*_-m*(s[1]-l[1]),D=(i[0]-l[0])*_-m*(i[1]-l[1]);return b>0&&D<0||b<0&&D>0}function Cn(s,i,l){for(const T of l)for(let R=0;R<T.length-1;++R)if((D=[(b=T[R+1])[0]-(_=T[R])[0],b[1]-_[1]])[0]*(S=[(m=i)[0]-(h=s)[0],m[1]-h[1]])[1]-D[1]*S[0]!=0&&Ku(h,m,_,b)&&Ku(_,b,h,m))return!0;var h,m,_,b,D,S;return!1}function mt(s,i){for(let l=0;l<s.length;++l)if(!vn(s[l],i))return!1;for(let l=0;l<s.length-1;++l)if(Cn(s[l],s[l+1],i))return!1;return!0}function zc(s,i){for(let l=0;l<i.length;l++)if(mt(s,i[l]))return!0;return!1}function Bc(s,i,l){const h=[];for(let m=0;m<s.length;m++){const _=[];for(let b=0;b<s[m].length;b++){const D=dn(s[m][b],l);Sr(i,D),_.push(D)}h.push(_)}return h}function ze(s,i,l){const h=[];for(let m=0;m<s.length;m++){const _=Bc(s[m],i,l);h.push(_)}return h}function Ya(s,i,l,h){if(s[0]<l[0]||s[0]>l[2]){const m=.5*h;let _=s[0]-l[0]>m?-h:l[0]-s[0]>m?h:0;0===_&&(_=s[0]-l[2]>m?-h:l[2]-s[0]>m?h:0),s[0]+=_}Sr(i,s)}function Ct(s,i,l,h){const m=Math.pow(2,h.z)*Pn,_=[h.x*Pn,h.y*Pn],b=[];for(const D of s)for(const S of D){const T=[S.x+_[0],S.y+_[1]];Ya(T,i,l,m),b.push(T)}return b}function sn(s,i,l,h){const m=Math.pow(2,h.z)*Pn,_=[h.x*Pn,h.y*Pn],b=[];for(const S of s){const T=[];for(const R of S){const L=[R.x+_[0],R.y+_[1]];Sr(i,L),T.push(L)}b.push(T)}if(i[2]-i[0]<=m/2){(D=i)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const S of b)for(const T of S)Ya(T,i,l,m)}var D;return b}class Os{constructor(i,l){this.type=_t,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ee(i[1])){const h=i[1];if("FeatureCollection"===h.type)for(let m=0;m<h.features.length;++m){const _=h.features[m].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Os(h,h.features[m].geometry)}else if("Feature"===h.type){const m=h.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Os(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new Os(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,h){const m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if("Polygon"===h.type){const D=Bc(h.coordinates,_,b),S=Ct(l.geometry(),m,_,b);if(!is(m,_))return!1;for(const T of S)if(!vn(T,D))return!1}if("MultiPolygon"===h.type){const D=ze(h.coordinates,_,b),S=Ct(l.geometry(),m,_,b);if(!is(m,_))return!1;for(const T of S)if(!Ja(T,D))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,h){const m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if("Polygon"===h.type){const D=Bc(h.coordinates,_,b),S=sn(l.geometry(),m,_,b);if(!is(m,_))return!1;for(const T of S)if(!mt(T,D))return!1}if("MultiPolygon"===h.type){const D=ze(h.coordinates,_,b),S=sn(l.geometry(),m,_,b);if(!is(m,_))return!1;for(const T of S)if(!zc(T,D))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Nl(s){if(s instanceof _n&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Os)return!1;let i=!0;return s.eachChild(l=>{i&&!Nl(l)&&(i=!1)}),i}function _a(s){if(s instanceof _n&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(l=>{i&&!_a(l)&&(i=!1)}),i}function Ns(s,i){if(s instanceof _n&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(h=>{l&&!Ns(h,i)&&(l=!1)}),l}class Mr{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new Mr(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Qa{constructor(i,l=[],h,m=new Ti,_=[]){this.registry=i,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=m,this.errors=_,this.expectedType=h}parse(i,l,h,m,_={}){return l?this.concat(l,h,m)._parse(i,_):this._parse(i,_)}_parse(i,l){function h(m,_,b){return"assert"===b?new ct(_,[m]):"coerce"===b?new ft(_,[m]):m}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=i[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[m];if(_){let b=_.parse(i,this);if(!b)return null;if(this.expectedType){const D=this.expectedType,S=b.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==S.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==S.kind&&"string"!==S.kind)if("padding"!==D.kind||"value"!==S.kind&&"number"!==S.kind&&"array"!==S.kind){if(this.checkSubtype(D,S))return null}else b=h(b,D,l.typeAnnotation||"coerce");else b=h(b,D,l.typeAnnotation||"coerce");else b=h(b,D,l.typeAnnotation||"assert")}if(!(b instanceof Qe)&&"resolvedImage"!==b.type.kind&&Vc(b)){const D=new Ht;try{b=new Qe(b.type,b.evaluate(D))}catch(S){return this.error(S.message),null}}return b}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h){const m="number"==typeof i?this.path.concat(i):this.path,_=h?this.scope.concat(h):this.scope;return new Qa(this.registry,m,l||null,_,this.errors)}error(i,...l){const h=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new Mi(h,i))}checkSubtype(i,l){const h=po(i,l);return h&&this.error(h),h}}function Vc(s){if(s instanceof Mr)return Vc(s.boundExpression);if(s instanceof _n&&"error"===s.name||s instanceof zt||s instanceof Os)return!1;const i=s instanceof ft||s instanceof ct;let l=!0;return s.eachChild(h=>{l=i?l&&Vc(h):l&&h instanceof Qe}),!!l&&Nl(s)&&Ns(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Uc(s,i){const l=s.length-1;let h,m,_=0,b=l,D=0;for(;_<=b;)if(D=Math.floor((_+b)/2),h=s[D],m=s[D+1],h<=i){if(D===l||i<m)return D;_=D+1}else{if(!(h>i))throw new Be("Input is not a number.");b=D-1}return 0}class di{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[m,_]of h)this.labels.push(m),this.outputs.push(_)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,Le);if(!h)return null;const m=[];let _=null;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);for(let b=1;b<i.length;b+=2){const D=1===b?-1/0:i[b],S=i[b+1],T=b,R=b+1;if("number"!=typeof D)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(m.length&&m[m.length-1][0]>=D)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const L=l.parse(S,R,_);if(!L)return null;_=_||L.type,m.push([D,L])}return new di(_,h,m)}evaluate(i){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(i);const m=this.input.evaluate(i);if(m<=l[0])return h[0].evaluate(i);const _=l.length;return m>=l[_-1]?h[_-1].evaluate(i):h[Uc(l,m)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Nn(s,i,l){return s*(1-l)+i*l}var zl=Object.freeze({__proto__:null,number:Nn,color:function(s,i,l){return new $(Nn(s.r,i.r,l),Nn(s.g,i.g,l),Nn(s.b,i.b,l),Nn(s.a,i.a,l))},array:function(s,i,l){return s.map((h,m)=>Nn(h,i[m],l))},padding:function(s,i,l){const h=s.values,m=i.values;return new te([Nn(h[0],m[0],l),Nn(h[1],m[1],l),Nn(h[2],m[2],l),Nn(h[3],m[3],l)])}});const jc=4/29,$c=6/29,Ju=3*$c*$c,uf=Math.PI/180,pi=180/Math.PI;function an(s){return s>.008856451679035631?Math.pow(s,1/3):s/Ju+jc}function Yu(s){return s>$c?s*s*s:Ju*(s-jc)}function Qu(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function eh(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function $e(s){const i=eh(s.r),l=eh(s.g),h=eh(s.b),m=an((.4124564*i+.3575761*l+.1804375*h)/.95047),_=an((.2126729*i+.7151522*l+.072175*h)/1);return{l:116*_-16,a:500*(m-_),b:200*(_-an((.0193339*i+.119192*l+.9503041*h)/1.08883)),alpha:s.a}}function vd(s){let i=(s.l+16)/116,l=isNaN(s.a)?i:i+s.a/500,h=isNaN(s.b)?i:i-s.b/200;return i=1*Yu(i),l=.95047*Yu(l),h=1.08883*Yu(h),new $(Qu(3.2404542*l-1.5371385*i-.4985314*h),Qu(-.969266*l+1.8760108*i+.041556*h),Qu(.0556434*l-.2040259*i+1.0572252*h),s.alpha)}function jr(s,i,l){const h=i-s;return s+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const os={forward:$e,reverse:vd,interpolate:function(s,i,l){return{l:Nn(s.l,i.l,l),a:Nn(s.a,i.a,l),b:Nn(s.b,i.b,l),alpha:Nn(s.alpha,i.alpha,l)}}},el={forward:function(s){const{l:i,a:l,b:h}=$e(s),m=Math.atan2(h,l)*pi;return{h:m<0?m+360:m,c:Math.sqrt(l*l+h*h),l:i,alpha:s.a}},reverse:function(s){const i=s.h*uf,l=s.c;return vd({l:s.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:s.alpha})},interpolate:function(s,i,l){return{h:jr(s.h,i.h,l),c:Nn(s.c,i.c,l),l:Nn(s.l,i.l,l),alpha:Nn(s.alpha,i.alpha,l)}}};var Hc=Object.freeze({__proto__:null,lab:os,hcl:el});class fi{constructor(i,l,h,m,_){this.type=i,this.operator=l,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[b,D]of _)this.labels.push(b),this.outputs.push(D)}static interpolationFactor(i,l,h,m){let _=0;if("exponential"===i.name)_=Gc(l,i.base,h,m);else if("linear"===i.name)_=Gc(l,1,h,m);else if("cubic-bezier"===i.name){const b=i.controlPoints;_=new Hn(b[0],b[1],b[2],b[3]).solve(Gc(l,1,h,m))}return _}static parse(i,l){let[h,m,_,...b]=i;if(!Array.isArray(m)||0===m.length)return l.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const T=m[1];if("number"!=typeof T)return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:T}}else{if("cubic-bezier"!==m[0])return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const T=m.slice(1);if(4!==T.length||T.some(R=>"number"!=typeof R||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:T}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,Le),!_)return null;const D=[];let S=null;"interpolate-hcl"===h||"interpolate-lab"===h?S=hr:l.expectedType&&"value"!==l.expectedType.kind&&(S=l.expectedType);for(let T=0;T<b.length;T+=2){const R=b[T],L=b[T+1],B=T+3,U=T+4;if("number"!=typeof R)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(D.length&&D[D.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const j=l.parse(L,U,S);if(!j)return null;S=S||j.type,D.push([R,j])}return"number"===S.kind||"color"===S.kind||"padding"===S.kind||"array"===S.kind&&"number"===S.itemType.kind&&"number"==typeof S.N?new fi(S,h,m,_,D):l.error(`Type ${hn(S)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(i);const m=this.input.evaluate(i);if(m<=l[0])return h[0].evaluate(i);const _=l.length;if(m>=l[_-1])return h[_-1].evaluate(i);const b=Uc(l,m),D=fi.interpolationFactor(this.interpolation,m,l[b],l[b+1]),S=h[b].evaluate(i),T=h[b+1].evaluate(i);return"interpolate"===this.operator?zl[this.type.kind.toLowerCase()](S,T,D):"interpolate-hcl"===this.operator?el.reverse(el.interpolate(el.forward(S),el.forward(T),D)):os.reverse(os.interpolate(os.forward(S),os.forward(T),D))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Gc(s,i,l,h){const m=h-l,_=s-l;return 0===m?0:1===i?_/m:(Math.pow(i,_)-1)/(Math.pow(i,m)-1)}class tl{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let h=null;const m=l.expectedType;m&&"value"!==m.kind&&(h=m);const _=[];for(const D of i.slice(1)){const S=l.parse(D,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!S)return null;h=h||S.type,_.push(S)}if(!h)throw new Error("No output type");const b=m&&_.some(D=>po(m,D.type));return new tl(b?pt:h,_)}evaluate(i){let l,h=null,m=0;for(const _ of this.args)if(m++,h=_.evaluate(i),h&&h instanceof oe&&!h.available&&(l||(l=h.name),h=null,m===this.args.length&&(h=l)),null!==h)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class zs{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let _=1;_<i.length-1;_+=2){const b=i[_];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const D=l.parse(i[_+1],_+1);if(!D)return null;h.push([b,D])}const m=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return m?new zs(h,m):null}outputDefined(){return this.result.outputDefined()}}class nl{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Le),m=l.parse(i[2],2,Ir(l.expectedType||pt));return h&&m?new nl(m.type.itemType,h,m):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new Be(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Be(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Be(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Bl{constructor(i,l){this.type=_t,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,pt),m=l.parse(i[2],2,pt);return h&&m?Fs(h.type,[_t,Pt,Le,ks,pt])?new Bl(h,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!Ls(l,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${hn(ge(l))} instead.`);if(!Ls(h,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${hn(ge(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Vl{constructor(i,l,h){this.type=Le,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,pt),m=l.parse(i[2],2,pt);if(!h||!m)return null;if(!Fs(h.type,[_t,Pt,Le,ks,pt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(h.type)} instead`);if(4===i.length){const _=l.parse(i[3],3,Le);return _?new Vl(h,m,_):null}return new Vl(h,m)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!Ls(l,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${hn(ge(l))} instead.`);if(!Ls(h,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${hn(ge(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return h.indexOf(l,m)}return h.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class ut{constructor(i,l,h,m,_,b){this.inputType=i,this.type=l,this.input=h,this.cases=m,this.outputs=_,this.otherwise=b}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,m;l.expectedType&&"value"!==l.expectedType.kind&&(m=l.expectedType);const _={},b=[];for(let T=2;T<i.length-1;T+=2){let R=i[T];const L=i[T+1];Array.isArray(R)||(R=[R]);const B=l.concat(T);if(0===R.length)return B.error("Expected at least one branch label.");for(const j of R){if("number"!=typeof j&&"string"!=typeof j)return B.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return B.error("Numeric branch labels must be integer values.");if(h){if(B.checkSubtype(h,ge(j)))return null}else h=ge(j);if(void 0!==_[String(j)])return B.error("Branch labels must be unique.");_[String(j)]=b.length}const U=l.parse(L,T,m);if(!U)return null;m=m||U.type,b.push(U)}const D=l.parse(i[1],1,pt);if(!D)return null;const S=l.parse(i[i.length-1],i.length-1,m);return S?"value"!==D.type.kind&&l.concat(1).checkSubtype(h,D.type)?null:new ut(h,m,D,_,b,S):null}evaluate(i){const l=this.input.evaluate(i);return(ge(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class rl{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const m=[];for(let b=1;b<i.length-1;b+=2){const D=l.parse(i[b],b,_t);if(!D)return null;const S=l.parse(i[b+1],b+1,h);if(!S)return null;m.push([D,S]),h=h||S.type}const _=l.parse(i[i.length-1],i.length-1,h);if(!_)return null;if(!h)throw new Error("Can't infer output type");return new rl(h,m,_)}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ul{constructor(i,l,h,m){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=m}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,pt),m=l.parse(i[2],2,Le);if(!h||!m)return null;if(!Fs(h.type,[Ir(pt),Pt,pt]))return l.error(`Expected first argument to be of type array or string, but found ${hn(h.type)} instead`);if(4===i.length){const _=l.parse(i[3],3,Le);return _?new Ul(h.type,h,m,_):null}return new Ul(h.type,h,m)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!Ls(l,["string","array"]))throw new Be(`Expected first argument to be of type array or string, but found ${hn(ge(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return l.slice(h,m)}return l.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function mi(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function qc(s,i,l,h){return 0===h.compare(i,l)}function il(s,i,l){const h="=="!==s&&"!="!==s;return class mI{constructor(_,b,D){this.type=_t,this.lhs=_,this.rhs=b,this.collator=D,this.hasUntypedArgument="value"===_.type.kind||"value"===b.type.kind}static parse(_,b){if(3!==_.length&&4!==_.length)return b.error("Expected two or three arguments.");const D=_[0];let S=b.parse(_[1],1,pt);if(!S)return null;if(!mi(D,S.type))return b.concat(1).error(`"${D}" comparisons are not supported for type '${hn(S.type)}'.`);let T=b.parse(_[2],2,pt);if(!T)return null;if(!mi(D,T.type))return b.concat(2).error(`"${D}" comparisons are not supported for type '${hn(T.type)}'.`);if(S.type.kind!==T.type.kind&&"value"!==S.type.kind&&"value"!==T.type.kind)return b.error(`Cannot compare types '${hn(S.type)}' and '${hn(T.type)}'.`);h&&("value"===S.type.kind&&"value"!==T.type.kind?S=new ct(T.type,[S]):"value"!==S.type.kind&&"value"===T.type.kind&&(T=new ct(S.type,[T])));let R=null;if(4===_.length){if("string"!==S.type.kind&&"string"!==T.type.kind&&"value"!==S.type.kind&&"value"!==T.type.kind)return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(_[3],3,ho),!R)return null}return new mI(S,T,R)}evaluate(_){const b=this.lhs.evaluate(_),D=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const S=ge(b),T=ge(D);if(S.kind!==T.kind||"string"!==S.kind&&"number"!==S.kind)throw new Be(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${S.kind}, ${T.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const S=ge(b),T=ge(D);if("string"!==S.kind||"string"!==T.kind)return i(_,b,D)}return this.collator?l(_,b,D,this.collator.evaluate(_)):i(_,b,D)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const ss=il("==",function(s,i,l){return i===l},qc),Zi=il("!=",function(s,i,l){return i!==l},function(s,i,l,h){return!qc(0,i,l,h)}),hf=il("<",function(s,i,l){return i<l},function(s,i,l,h){return h.compare(i,l)<0}),df=il(">",function(s,i,l){return i>l},function(s,i,l,h){return h.compare(i,l)>0}),fo=il("<=",function(s,i,l){return i<=l},function(s,i,l,h){return h.compare(i,l)<=0}),En=il(">=",function(s,i,l){return i>=l},function(s,i,l,h){return h.compare(i,l)>=0});class th{constructor(i,l,h,m,_){this.type=Pt,this.number=i,this.locale=l,this.currency=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const h=l.parse(i[1],1,Le);if(!h)return null;const m=i[2];if("object"!=typeof m||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let _=null;if(m.locale&&(_=l.parse(m.locale,1,Pt),!_))return null;let b=null;if(m.currency&&(b=l.parse(m.currency,1,Pt),!b))return null;let D=null;if(m["min-fraction-digits"]&&(D=l.parse(m["min-fraction-digits"],1,Le),!D))return null;let S=null;return m["max-fraction-digits"]&&(S=l.parse(m["max-fraction-digits"],1,Le),!S)?null:new th(h,_,b,D,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Wc{constructor(i){this.type=dr,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const m=[];let _=!1;for(let b=1;b<=i.length-1;++b){const D=i[b];if(_&&"object"==typeof D&&!Array.isArray(D)){_=!1;let S=null;if(D["font-scale"]&&(S=l.parse(D["font-scale"],1,Le),!S))return null;let T=null;if(D["text-font"]&&(T=l.parse(D["text-font"],1,Ir(Pt)),!T))return null;let R=null;if(D["text-color"]&&(R=l.parse(D["text-color"],1,hr),!R))return null;const L=m[m.length-1];L.scale=S,L.font=T,L.textColor=R}else{const S=l.parse(i[b],1,pt);if(!S)return null;const T=S.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:S,scale:null,font:null,textColor:null})}}return new Wc(m)}evaluate(i){return new ne(this.sections.map(l=>{const h=l.content.evaluate(i);return ge(h)===Xn?new ie("",h,null,null,null):new ie(Ke(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class as{constructor(i){this.type=Xn,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const h=l.parse(i[1],1,Pt);return h?new as(h):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),h=oe.fromString(l);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(l)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}}class en{constructor(i){this.type=Le,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${hn(h.type)} instead.`):new en(h):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new Be(`Expected value to be of type string or array, but found ${hn(ge(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const zo={"==":ss,"!=":Zi,">":df,"<":hf,">=":En,"<=":fo,array:ct,at:nl,boolean:ct,case:rl,coalesce:tl,collator:zt,format:Wc,image:as,in:Bl,"index-of":Vl,interpolate:fi,"interpolate-hcl":fi,"interpolate-lab":fi,length:en,let:zs,literal:Qe,match:ut,number:ct,"number-format":th,object:ct,slice:Ul,step:di,string:ct,"to-boolean":ft,"to-color":ft,"to-number":ft,"to-string":ft,var:Mr,within:Os};function jl(s,[i,l,h,m]){i=i.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const _=m?m.evaluate(s):1,b=ye(i,l,h,_);if(b)throw new Be(b);return new $(i/255*_,l/255*_,h/255*_,_)}function $l(s,i){return s in i}function ol(s,i){const l=i[s];return void 0===l?null:l}function $r(s){return{type:s}}function va(s){return{result:"success",value:s}}function xa(s){return{result:"error",value:s}}function Kt(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function nh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Rt(s){return!!s.expression&&s.expression.interpolated}function Jt(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Ft(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function kn(s){return s}function ba(s,i){const l="color"===i.type,h=s.stops&&"object"==typeof s.stops[0][0],m=h||!(h||void 0!==s.property),_=s.type||(Rt(i)?"exponential":"interval");if(l||"padding"===i.type){const T=l?$.parse:te.parse;(s=Wi({},s)).stops&&(s.stops=s.stops.map(R=>[R[0],T(R[1])])),s.default=T(s.default?s.default:i.default)}if(s.colorSpace&&"rgb"!==s.colorSpace&&!Hc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let b,D,S;if("exponential"===_)b=Tr;else if("interval"===_)b=xn;else if("categorical"===_){b=Hr,D=Object.create(null);for(const T of s.stops)D[T[0]]=T[1];S=typeof s.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);b=Gr}if(h){const T={},R=[];for(let U=0;U<s.stops.length;U++){const j=s.stops[U],Q=j[0].zoom;void 0===T[Q]&&(T[Q]={zoom:Q,type:s.type,property:s.property,default:s.default,stops:[]},R.push(Q)),T[Q].stops.push([j[0].value,j[1]])}const L=[];for(const U of R)L.push([T[U].zoom,ba(T[U],i)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:fi.interpolationFactor.bind(void 0,B),zoomStops:L.map(U=>U[0]),evaluate:({zoom:U},j)=>Tr({stops:L,base:s.base},i,U).evaluate(U,j)}}if(m){const T="exponential"===_?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:fi.interpolationFactor.bind(void 0,T),zoomStops:s.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(s,i,R,D,S)}}return{kind:"source",evaluate(T,R){const L=R&&R.properties?R.properties[s.property]:void 0;return void 0===L?lt(s.default,i.default):b(s,i,L,D,S)}}}function lt(s,i,l){return void 0!==s?s:void 0!==i?i:void 0!==l?l:void 0}function Hr(s,i,l,h,m){return lt(typeof l===m?h[l]:void 0,s.default,i.default)}function xn(s,i,l){if("number"!==Jt(l))return lt(s.default,i.default);const h=s.stops.length;if(1===h||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const m=Uc(s.stops.map(_=>_[0]),l);return s.stops[m][1]}function Tr(s,i,l){const h=void 0!==s.base?s.base:1;if("number"!==Jt(l))return lt(s.default,i.default);const m=s.stops.length;if(1===m||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[m-1][0])return s.stops[m-1][1];const _=Uc(s.stops.map(R=>R[0]),l),b=function(R,L,B,U){const j=U-B,Q=R-B;return 0===j?0:1===L?Q/j:(Math.pow(L,Q)-1)/(Math.pow(L,j)-1)}(l,h,s.stops[_][0],s.stops[_+1][0]),D=s.stops[_][1],S=s.stops[_+1][1];let T=zl[i.type]||kn;if(s.colorSpace&&"rgb"!==s.colorSpace){const R=Hc[s.colorSpace];T=(L,B)=>R.reverse(R.interpolate(R.forward(L),R.forward(B),b))}return"function"==typeof D.evaluate?{evaluate(...R){const L=D.evaluate.apply(void 0,R),B=S.evaluate.apply(void 0,R);if(void 0!==L&&void 0!==B)return T(L,B,b)}}:T(D,S,b)}function Gr(s,i,l){switch(i.type){case"color":l=$.parse(l);break;case"formatted":l=ne.fromString(l.toString());break;case"resolvedImage":l=oe.fromString(l.toString());break;case"padding":l=te.parse(l);break;default:Jt(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0)}return lt(l,s.default,i.default)}_n.register(zo,{error:[{kind:"error"},[Pt],(s,[i])=>{throw new Be(i.evaluate(s))}],typeof:[Pt,[pt],(s,[i])=>hn(ge(i.evaluate(s)))],"to-rgba":[Ir(Le,4),[hr],(s,[i])=>i.evaluate(s).toArray()],rgb:[hr,[Le,Le,Le],jl],rgba:[hr,[Le,Le,Le,Le],jl],has:{type:_t,overloads:[[[Pt],(s,[i])=>$l(i.evaluate(s),s.properties())],[[Pt,No],(s,[i,l])=>$l(i.evaluate(s),l.evaluate(s))]]},get:{type:pt,overloads:[[[Pt],(s,[i])=>ol(i.evaluate(s),s.properties())],[[Pt,No],(s,[i,l])=>ol(i.evaluate(s),l.evaluate(s))]]},"feature-state":[pt,[Pt],(s,[i])=>ol(i.evaluate(s),s.featureState||{})],properties:[No,[],s=>s.properties()],"geometry-type":[Pt,[],s=>s.geometryType()],id:[pt,[],s=>s.id()],zoom:[Le,[],s=>s.globals.zoom],"heatmap-density":[Le,[],s=>s.globals.heatmapDensity||0],"line-progress":[Le,[],s=>s.globals.lineProgress||0],accumulated:[pt,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[Le,$r(Le),(s,i)=>{let l=0;for(const h of i)l+=h.evaluate(s);return l}],"*":[Le,$r(Le),(s,i)=>{let l=1;for(const h of i)l*=h.evaluate(s);return l}],"-":{type:Le,overloads:[[[Le,Le],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[Le],(s,[i])=>-i.evaluate(s)]]},"/":[Le,[Le,Le],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[Le,[Le,Le],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[Le,[Le],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[Le,[Le],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[Le,[Le],(s,[i])=>Math.log(i.evaluate(s))],log2:[Le,[Le],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[Le,[Le],(s,[i])=>Math.sin(i.evaluate(s))],cos:[Le,[Le],(s,[i])=>Math.cos(i.evaluate(s))],tan:[Le,[Le],(s,[i])=>Math.tan(i.evaluate(s))],asin:[Le,[Le],(s,[i])=>Math.asin(i.evaluate(s))],acos:[Le,[Le],(s,[i])=>Math.acos(i.evaluate(s))],atan:[Le,[Le],(s,[i])=>Math.atan(i.evaluate(s))],min:[Le,$r(Le),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[Le,$r(Le),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[Le,[Le],(s,[i])=>Math.abs(i.evaluate(s))],round:[Le,[Le],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[Le,[Le],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[Le,[Le],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[_t,[Pt,pt],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[_t,[pt],(s,[i])=>s.id()===i.value],"filter-type-==":[_t,[Pt],(s,[i])=>s.geometryType()===i.value],"filter-<":[_t,[Pt,pt],(s,[i,l])=>{const h=s.properties()[i.value],m=l.value;return typeof h==typeof m&&h<m}],"filter-id-<":[_t,[pt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[_t,[Pt,pt],(s,[i,l])=>{const h=s.properties()[i.value],m=l.value;return typeof h==typeof m&&h>m}],"filter-id->":[_t,[pt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[_t,[Pt,pt],(s,[i,l])=>{const h=s.properties()[i.value],m=l.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[_t,[pt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[_t,[Pt,pt],(s,[i,l])=>{const h=s.properties()[i.value],m=l.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[_t,[pt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[_t,[pt],(s,[i])=>i.value in s.properties()],"filter-has-id":[_t,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[_t,[Ir(Pt)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[_t,[Ir(pt)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[_t,[Pt,Ir(pt)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[_t,[Pt,Ir(pt)],(s,[i,l])=>function(h,m,_,b){for(;_<=b;){const D=_+b>>1;if(m[D]===h)return!0;m[D]>h?b=D-1:_=D+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[$r(_t),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[$r(_t),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[_t,[_t],(s,[i])=>!i.evaluate(s)],"is-supported-script":[_t,[Pt],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[Pt,[Pt],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[Pt,[Pt],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[Pt,$r(pt),(s,i)=>i.map(l=>Ke(l.evaluate(s))).join("")],"resolved-locale":[Pt,[ho],(s,[i])=>i.evaluate(s).resolvedLocale()]});class Bo{constructor(i,l){var h;this.expression=i,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=l?"color"===(h=l).type&&Ft(h.default)?new $(0,0,0,0):"color"===h.type?$.parse(h.default)||null:"padding"===h.type?te.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,h,m,_,b){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,m,_,b){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Be(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function vr(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in zo}function Ar(s,i){const l=new Qa(zo,[],i?function(m){const _={color:hr,string:Pt,number:Le,enum:Pt,boolean:_t,formatted:dr,padding:Rs,resolvedImage:Xn};return"array"===m.type?Ir(_[m.value]||pt,m.length):_[m.type]}(i):void 0),h=l.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return h?va(new Bo(h,i)):xa(l.errors)}class Ge{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!_a(l.expression)}evaluateWithoutErrorHandling(i,l,h,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,m,_,b)}evaluate(i,l,h,m,_,b){return this._styleExpression.evaluate(i,l,h,m,_,b)}}class St{constructor(i,l,h,m){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==i&&!_a(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,l,h,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,m,_,b)}evaluate(i,l,h,m,_,b){return this._styleExpression.evaluate(i,l,h,m,_,b)}interpolationFactor(i,l,h){return this.interpolationType?fi.interpolationFactor(this.interpolationType,i,l,h):0}}function Rn(s,i){const l=Ar(s,i);if("error"===l.result)return l;const h=l.value.expression,m=Nl(h);if(!m&&!Kt(i))return xa([new Mi("","data expressions not supported")]);const _=Ns(h,["zoom"]);if(!_&&!nh(i))return xa([new Mi("","zoom expressions not supported")]);const b=mo(h);return b||_?b instanceof Mi?xa([b]):b instanceof fi&&!Rt(i)?xa([new Mi("",'"interpolate" expressions cannot be used with this property')]):va(b?new St(m?"camera":"composite",l.value,b.labels,b instanceof fi?b.interpolation:void 0):new Ge(m?"constant":"source",l.value)):xa([new Mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Pr{constructor(i,l){this._parameters=i,this._specification=l,Wi(this,ba(this._parameters,this._specification))}static deserialize(i){return new Pr(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function mo(s){let i=null;if(s instanceof zs)i=mo(s.result);else if(s instanceof tl){for(const l of s.args)if(i=mo(l),i)break}else(s instanceof di||s instanceof fi)&&s.input instanceof _n&&"zoom"===s.input.name&&(i=s);return i instanceof Mi||s.eachChild(l=>{const h=mo(l);h instanceof Mi?i=h:!i&&h?i=new Mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new Mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Dn(s){const i=s.key,l=s.value,h=s.valueSpec||{},m=s.objectElementValidators||{},_=s.style,b=s.styleSpec;let D=[];const S=Jt(l);if("object"!==S)return[new Oe(i,l,`object expected, ${S} found`)];for(const T in l){const R=T.split(".")[0],L=h[R]||h["*"];let B;if(m[R])B=m[R];else if(h[R])B=Wr;else if(m["*"])B=m["*"];else{if(!h["*"]){D.push(new Oe(i,l[T],`unknown property "${T}"`));continue}B=Wr}D=D.concat(B({key:(i&&`${i}.`)+T,value:l[T],valueSpec:L,style:_,styleSpec:b,object:l,objectKey:T},l))}for(const T in h)m[T]||h[T].required&&void 0===h[T].default&&void 0===l[T]&&D.push(new Oe(i,l,`missing required property "${T}"`));return D}function ls(s){const i=s.value,l=s.valueSpec,h=s.style,m=s.styleSpec,_=s.key,b=s.arrayElementValidator||Wr;if("array"!==Jt(i))return[new Oe(_,i,`array expected, ${Jt(i)} found`)];if(l.length&&i.length!==l.length)return[new Oe(_,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Oe(_,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let D={type:l.value,values:l.values};m.$version<7&&(D.function=l.function),"object"===Jt(l.value)&&(D=l.value);let S=[];for(let T=0;T<i.length;T++)S=S.concat(b({array:i,arrayIndex:T,value:i[T],valueSpec:D,style:h,styleSpec:m,key:`${_}[${T}]`}));return S}function zn(s){const i=s.key,l=s.value,h=s.valueSpec;let m=Jt(l);return"number"===m&&l!=l&&(m="NaN"),"number"!==m?[new Oe(i,l,`number expected, ${m} found`)]:"minimum"in h&&l<h.minimum?[new Oe(i,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new Oe(i,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function wa(s){const i=s.valueSpec,l=qt(s.value.type);let h,m,_,b={};const D="categorical"!==l&&void 0===s.value.property,S=!D,T="array"===Jt(s.value.stops)&&"array"===Jt(s.value.stops[0])&&"object"===Jt(s.value.stops[0][0]),R=Dn({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(U){if("identity"===l)return[new Oe(U.key,U.value,'identity function may not have a "stops" property')];let j=[];const Q=U.value;return j=j.concat(ls({key:U.key,value:Q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:L})),"array"===Jt(Q)&&0===Q.length&&j.push(new Oe(U.key,Q,"array must have at least one stop")),j},default:function(U){return Wr({key:U.key,value:U.value,valueSpec:i,style:U.style,styleSpec:U.styleSpec})}}});return"identity"===l&&D&&R.push(new Oe(s.key,s.value,'missing required property "property"')),"identity"===l||s.value.stops||R.push(new Oe(s.key,s.value,'missing required property "stops"')),"exponential"===l&&s.valueSpec.expression&&!Rt(s.valueSpec)&&R.push(new Oe(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(S&&!Kt(s.valueSpec)?R.push(new Oe(s.key,s.value,"property functions not supported")):D&&!nh(s.valueSpec)&&R.push(new Oe(s.key,s.value,"zoom functions not supported"))),"categorical"!==l&&!T||void 0!==s.value.property||R.push(new Oe(s.key,s.value,'"property" property is required')),R;function L(U){let j=[];const Q=U.value,J=U.key;if("array"!==Jt(Q))return[new Oe(J,Q,`array expected, ${Jt(Q)} found`)];if(2!==Q.length)return[new Oe(J,Q,`array length 2 expected, length ${Q.length} found`)];if(T){if("object"!==Jt(Q[0]))return[new Oe(J,Q,`object expected, ${Jt(Q[0])} found`)];if(void 0===Q[0].zoom)return[new Oe(J,Q,"object stop key must have zoom")];if(void 0===Q[0].value)return[new Oe(J,Q,"object stop key must have value")];if(_&&_>qt(Q[0].zoom))return[new Oe(J,Q[0].zoom,"stop zoom values must appear in ascending order")];qt(Q[0].zoom)!==_&&(_=qt(Q[0].zoom),m=void 0,b={}),j=j.concat(Dn({key:`${J}[0]`,value:Q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:zn,value:B}}))}else j=j.concat(B({key:`${J}[0]`,value:Q[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},Q));return vr(Si(Q[1]))?j.concat([new Oe(`${J}[1]`,Q[1],"expressions are not allowed in function stops.")]):j.concat(Wr({key:`${J}[1]`,value:Q[1],valueSpec:i,style:U.style,styleSpec:U.styleSpec}))}function B(U,j){const Q=Jt(U.value),J=qt(U.value),ce=null!==U.value?U.value:j;if(h){if(Q!==h)return[new Oe(U.key,ce,`${Q} stop domain type must match previous stop domain type ${h}`)]}else h=Q;if("number"!==Q&&"string"!==Q&&"boolean"!==Q)return[new Oe(U.key,ce,"stop domain value must be a number, string, or boolean")];if("number"!==Q&&"categorical"!==l){let fe=`number expected, ${Q} found`;return Kt(i)&&void 0===l&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(U.key,ce,fe)]}return"categorical"!==l||"number"!==Q||isFinite(J)&&Math.floor(J)===J?"categorical"!==l&&"number"===Q&&void 0!==m&&J<m?[new Oe(U.key,ce,"stop domain values must appear in ascending order")]:(m=J,"categorical"===l&&J in b?[new Oe(U.key,ce,"stop domain values must be unique")]:(b[J]=!0,[])):[new Oe(U.key,ce,`integer expected, found ${J}`)]}}function Xi(s){const i=("property"===s.expressionContext?Rn:Ar)(Si(s.value),s.valueSpec);if("error"===i.result)return i.value.map(h=>new Oe(`${s.key}${h.key}`,s.value,h.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!l.outputDefined())return[new Oe(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!_a(l))return[new Oe(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext&&!_a(l))return[new Oe(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Ns(l,["zoom","feature-state"]))return[new Oe(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!Nl(l))return[new Oe(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mt(s){const i=s.key,l=s.value,h=s.valueSpec,m=[];return Array.isArray(h.values)?-1===h.values.indexOf(qt(l))&&m.push(new Oe(i,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(qt(l))&&m.push(new Oe(i,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),m}function Vo(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Vo(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}const Ca={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Da(s){if(null==s)return{filter:()=>!0,needGeometry:!1};Vo(s)||(s=Uo(s));const i=Ar(s,Ca);if("error"===i.result)throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,m)=>i.value.evaluate(l,h,{},m),needGeometry:xr(s)}}function cs(s,i){return s<i?-1:s>i?1:0}function xr(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(xr(s[i]))return!0;return!1}function Uo(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?us(s[1],s[2],"=="):"!="===i?Bs(us(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?us(s[1],s[2],i):"any"===i?(l=s.slice(1),["any"].concat(l.map(Uo))):"all"===i?["all"].concat(s.slice(1).map(Uo)):"none"===i?["all"].concat(s.slice(1).map(Uo).map(Bs)):"in"===i?oi(s[1],s.slice(2)):"!in"===i?Bs(oi(s[1],s.slice(2))):"has"===i?go(s[1]):"!has"===i?Bs(go(s[1])):"within"!==i||s;var l}function us(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function oi(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(cs)]]:["filter-in-small",s,["literal",i]]}}function go(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Bs(s){return["!",s]}function fn(s){return Vo(Si(s.value))?Xi(Wi({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rh(s)}function rh(s){const i=s.value,l=s.key;if("array"!==Jt(i))return[new Oe(l,i,`array expected, ${Jt(i)} found`)];const h=s.styleSpec;let m,_=[];if(i.length<1)return[new Oe(l,i,"filter array must have at least 1 element")];switch(_=_.concat(Mt({key:`${l}[0]`,value:i[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),qt(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===qt(i[1])&&_.push(new Oe(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&_.push(new Oe(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=Jt(i[1]),"string"!==m&&_.push(new Oe(`${l}[1]`,i[1],`string expected, ${m} found`)));for(let b=2;b<i.length;b++)m=Jt(i[b]),"$type"===qt(i[1])?_=_.concat(Mt({key:`${l}[${b}]`,value:i[b],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&_.push(new Oe(`${l}[${b}]`,i[b],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)_=_.concat(rh({key:`${l}[${b}]`,value:i[b],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=Jt(i[1]),2!==i.length?_.push(new Oe(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==m&&_.push(new Oe(`${l}[1]`,i[1],`string expected, ${m} found`));break;case"within":m=Jt(i[1]),2!==i.length?_.push(new Oe(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==m&&_.push(new Oe(`${l}[1]`,i[1],`object expected, ${m} found`))}return _}function sl(s,i){const l=s.key,h=s.style,m=s.styleSpec,_=s.value,b=s.objectKey,D=m[`${i}_${s.layerType}`];if(!D)return[];const S=b.match(/^(.*)-transition$/);if("paint"===i&&S&&D[S[1]]&&D[S[1]].transition)return Wr({key:l,value:_,valueSpec:m.transition,style:h,styleSpec:m});const T=s.valueSpec||D[b];if(!T)return[new Oe(l,_,`unknown property "${b}"`)];let R;if("string"===Jt(_)&&Kt(T)&&!T.tokens&&(R=/^{([^}]+)}$/.exec(_)))return[new Oe(l,_,`"${b}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const L=[];return"symbol"===s.layerType&&("text-field"===b&&h&&!h.glyphs&&L.push(new Oe(l,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&Ft(Si(_))&&"identity"===qt(_.type)&&L.push(new Oe(l,_,'"text-font" does not support identity functions'))),L.concat(Wr({key:s.key,value:_,valueSpec:T,style:h,styleSpec:m,expressionContext:"property",propertyType:i,propertyKey:b}))}function al(s){return sl(s,"paint")}function Hl(s){return sl(s,"layout")}function Ea(s){let i=[];const l=s.value,h=s.key,m=s.style,_=s.styleSpec;l.type||l.ref||i.push(new Oe(h,l,'either "type" or "ref" is required'));let b=qt(l.type);const D=qt(l.ref);if(l.id){const S=qt(l.id);for(let T=0;T<s.arrayIndex;T++){const R=m.layers[T];qt(R.id)===S&&i.push(new Oe(h,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let S;["type","source","source-layer","filter","layout"].forEach(T=>{T in l&&i.push(new Oe(h,l[T],`"${T}" is prohibited for ref layers`))}),m.layers.forEach(T=>{qt(T.id)===D&&(S=T)}),S?S.ref?i.push(new Oe(h,l.ref,"ref cannot reference another ref layer")):b=qt(S.type):i.push(new Oe(h,l.ref,`ref layer "${D}" not found`))}else if("background"!==b)if(l.source){const S=m.sources&&m.sources[l.source],T=S&&qt(S.type);S?"vector"===T&&"raster"===b?i.push(new Oe(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===T&&"raster"!==b?i.push(new Oe(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==T||l["source-layer"]?"raster-dem"===T&&"hillshade"!==b?i.push(new Oe(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]||"geojson"===T&&S.lineMetrics||i.push(new Oe(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Oe(h,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Oe(h,l.source,`source "${l.source}" not found`))}else i.push(new Oe(h,l,'missing required property "source"'));return i=i.concat(Dn({key:h,value:l,valueSpec:_.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wr({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:fn,layout:S=>Dn({layer:l,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":T=>Hl(Wi({layerType:b},T))}}),paint:S=>Dn({layer:l,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":T=>al(Wi({layerType:b},T))}})}})),i}function jo(s){const i=s.value,l=s.key,h=Jt(i);return"string"!==h?[new Oe(l,i,`string expected, ${h} found`)]:[]}const hs={promoteId:function({key:s,value:i}){if("string"===Jt(i))return jo({key:s,value:i});{const l=[];for(const h in i)l.push(...jo({key:`${s}.${h}`,value:i[h]}));return l}}};function Qn(s){const i=s.value,l=s.key,h=s.styleSpec,m=s.style;if(!i.type)return[new Oe(l,i,'"type" is required')];const _=qt(i.type);let b;switch(_){case"vector":case"raster":case"raster-dem":return b=Dn({key:l,value:i,valueSpec:h[`source_${_.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:hs}),b;case"geojson":if(b=Dn({key:l,value:i,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:hs}),i.cluster)for(const D in i.clusterProperties){const[S,T]=i.clusterProperties[D],R="string"==typeof S?[S,["accumulated"],["get",D]]:S;b.push(...Xi({key:`${l}.${D}.map`,value:T,expressionContext:"cluster-map"})),b.push(...Xi({key:`${l}.${D}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return b;case"video":return Dn({key:l,value:i,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return Dn({key:l,value:i,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new Oe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mt({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:h})}}function ll(s){const i=s.value,l=s.styleSpec,h=l.light,m=s.style;let _=[];const b=Jt(i);if(void 0===i)return _;if("object"!==b)return _=_.concat([new Oe("light",i,`object expected, ${b} found`)]),_;for(const D in i){const S=D.match(/^(.*)-transition$/);_=_.concat(S&&h[S[1]]&&h[S[1]].transition?Wr({key:D,value:i[D],valueSpec:l.transition,style:m,styleSpec:l}):h[D]?Wr({key:D,value:i[D],valueSpec:h[D],style:m,styleSpec:l}):[new Oe(D,i[D],`unknown property "${D}"`)])}return _}function In(s){const i=s.value,l=s.styleSpec,h=l.terrain,m=s.style;let _=[];const b=Jt(i);if(void 0===i)return _;if("object"!==b)return _=_.concat([new Oe("terrain",i,`object expected, ${b} found`)]),_;for(const D in i)_=_.concat(h[D]?Wr({key:D,value:i[D],valueSpec:h[D],style:m,styleSpec:l}):[new Oe(D,i[D],`unknown property "${D}"`)]);return _}const qr={"*":()=>[],array:ls,boolean:function(s){const i=s.value,l=s.key,h=Jt(i);return"boolean"!==h?[new Oe(l,i,`boolean expected, ${h} found`)]:[]},number:zn,color:function(s){const i=s.key,l=s.value,h=Jt(l);return"string"!==h?[new Oe(i,l,`color expected, ${h} found`)]:null===ya(l)?[new Oe(i,l,`color expected, "${l}" found`)]:[]},constants:ga,enum:Mt,filter:fn,function:wa,layer:Ea,object:Dn,source:Qn,light:ll,terrain:In,string:jo,formatted:function(s){return 0===jo(s).length?[]:Xi(s)},resolvedImage:function(s){return 0===jo(s).length?[]:Xi(s)},padding:function(s){const i=s.key,l=s.value;if("array"===Jt(l)){if(l.length<1||l.length>4)return[new Oe(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const h={type:"number"};let m=[];for(let _=0;_<l.length;_++)m=m.concat(Wr({key:`${i}[${_}]`,value:l[_],valueSpec:h}));return m}return zn({key:i,value:l,valueSpec:{}})}};function Wr(s){const i=s.value,l=s.valueSpec,h=s.styleSpec;return l.expression&&Ft(qt(i))?wa(s):l.expression&&vr(Si(i))?Xi(s):l.type&&qr[l.type]?qr[l.type](s):Dn(Wi({},s,{valueSpec:l.type?h[l.type]:l}))}function Gl(s){const i=s.value,l=s.key,h=jo(s);return h.length||(-1===i.indexOf("{fontstack}")&&h.push(new Oe(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&h.push(new Oe(l,i,'"glyphs" url must include a "{range}" token'))),h}function Ki(s,i=ve){let l=[];return l=l.concat(Wr({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,objectElementValidators:{glyphs:Gl,"*":()=>[]}})),s.constants&&(l=l.concat(ga({key:"constants",value:s.constants,style:s,styleSpec:i}))),Ai(l)}function Ai(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function $o(s){return function(...i){return Ai(s.apply(this,i))}}Ki.source=$o(Qn),Ki.light=$o(ll),Ki.terrain=$o(In),Ki.layer=$o(Ea),Ki.filter=$o(fn),Ki.paintProperty=$o(al),Ki.layoutProperty=$o(Hl);const ql=Ki,Zc=ql.light,xd=ql.paintProperty,pf=ql.layoutProperty;function Xc(s,i){let l=!1;if(i&&i.length)for(const h of i)s.fire(new Ka(new Error(h.message))),l=!0;return l}class Wl{constructor(i,l,h){const m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const b=new Int32Array(this.arrayBuffer);i=b[0],this.d=(l=b[1])+2*(h=b[2]);for(let S=0;S<this.d*this.d;S++){const T=b[3+S],R=b[3+S+1];m.push(T===R?null:b.subarray(T,R))}const D=b[3+m.length+1];this.keys=b.subarray(b[3+m.length],D),this.bboxes=b.subarray(D),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let b=0;b<this.d*this.d;b++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=h,this.scale=l/i,this.uid=0;const _=h/l*i;this.min=-_,this.max=i+_}insert(i,l,h,m,_){this._forEachCell(l,h,m,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,h,m,_,b){this.cells[_].push(b)}query(i,l,h,m,_){const b=this.min,D=this.max;if(i<=b&&l<=b&&D<=h&&D<=m&&!_)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(i,l,h,m,this._queryCell,S,{},_),S}}_queryCell(i,l,h,m,_,b,D,S){const T=this.cells[_];if(null!==T){const R=this.keys,L=this.bboxes;for(let B=0;B<T.length;B++){const U=T[B];if(void 0===D[U]){const j=4*U;(S?S(L[j+0],L[j+1],L[j+2],L[j+3]):i<=L[j+2]&&l<=L[j+3]&&h>=L[j+0]&&m>=L[j+1])?(D[U]=!0,b.push(R[U])):D[U]=!1}}}}_forEachCell(i,l,h,m,_,b,D,S){const T=this._convertToCellCoord(i),R=this._convertToCellCoord(l),L=this._convertToCellCoord(h),B=this._convertToCellCoord(m);for(let U=T;U<=L;U++)for(let j=R;j<=B;j++){const Q=this.d*j+U;if((!S||S(this._convertFromCellCoord(U),this._convertFromCellCoord(j),this._convertFromCellCoord(U+1),this._convertFromCellCoord(j+1)))&&_.call(this,i,l,h,m,Q,b,D,S))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let h=0;for(let b=0;b<this.cells.length;b++)h+=this.cells[b].length;const m=new Int32Array(l+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let _=l;for(let b=0;b<i.length;b++){const D=i[b];m[3+b]=_,m.set(D,_),_+=D.length}return m[3+i.length]=_,m.set(this.keys,_),_+=this.keys.length,m[3+i.length+1]=_,m.set(this.bboxes,_),_+=this.bboxes.length,m.buffer}static serialize(i,l){const h=i.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(i){return new Wl(i.buffer)}}const ds={};function Xe(s,i,l={}){if(ds[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),ds[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Xe("Object",Object),Xe("TransferableGridIndex",Wl),Xe("Color",$),Xe("Error",Error),Xe("AJAXError",Ii),Xe("ResolvedImage",oe),Xe("StylePropertyFunction",Pr),Xe("StyleExpression",Bo,{omit:["_evaluator"]}),Xe("ZoomDependentExpression",St),Xe("ZoomConstantExpression",Ge),Xe("CompoundExpression",_n,{omit:["_evaluate"]});for(const s in zo)zo[s]._classRegistryKey||Xe(`Expression_${s}`,zo[s]);function bd(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Ia(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob)return s;if(bd(s)||uo(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return i&&i.push(l.buffer),l}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(Ia(h,i));return l}if("object"==typeof s){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!ds[h])throw new Error(`${h} is not registered.`);const m=l.serialize?l.serialize(s,i):{};if(l.serialize){if(i&&m===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in s){if(!s.hasOwnProperty(_)||ds[h].omit.indexOf(_)>=0)continue;const b=s[_];m[_]=ds[h].shallow.indexOf(_)>=0?b:Ia(b,i)}s instanceof Error&&(m.message=s.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(m.$name=h),m}throw new Error("can't serialize object of type "+typeof s)}function Vs(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||bd(s)||uo(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Vs);if("object"==typeof s){const i=s.$name||"Object";if(!ds[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=ds[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const m of Object.keys(s)){if("$name"===m)continue;const _=s[m];h[m]=ds[i].shallow.indexOf(m)>=0?_:Vs(_)}return h}throw new Error("can't deserialize object of type "+typeof s)}class ih{constructor(){this.first=!0}update(i,l){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}const je={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Kc(s){for(const i of s)if(sh(i.charCodeAt(0)))return!0;return!1}function ff(s){for(const i of s)if(!oh(i.charCodeAt(0)))return!1;return!0}function oh(s){return!(je.Arabic(s)||je["Arabic Supplement"](s)||je["Arabic Extended-A"](s)||je["Arabic Presentation Forms-A"](s)||je["Arabic Presentation Forms-B"](s))}function sh(s){return!(746!==s&&747!==s&&(s<4352||!(je["Bopomofo Extended"](s)||je.Bopomofo(s)||je["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||je["CJK Compatibility Ideographs"](s)||je["CJK Compatibility"](s)||je["CJK Radicals Supplement"](s)||je["CJK Strokes"](s)||!(!je["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||je["CJK Unified Ideographs Extension A"](s)||je["CJK Unified Ideographs"](s)||je["Enclosed CJK Letters and Months"](s)||je["Hangul Compatibility Jamo"](s)||je["Hangul Jamo Extended-A"](s)||je["Hangul Jamo Extended-B"](s)||je["Hangul Jamo"](s)||je["Hangul Syllables"](s)||je.Hiragana(s)||je["Ideographic Description Characters"](s)||je.Kanbun(s)||je["Kangxi Radicals"](s)||je["Katakana Phonetic Extensions"](s)||je.Katakana(s)&&12540!==s||!(!je["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!je["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||je["Unified Canadian Aboriginal Syllabics"](s)||je["Unified Canadian Aboriginal Syllabics Extended"](s)||je["Vertical Forms"](s)||je["Yijing Hexagram Symbols"](s)||je["Yi Syllables"](s)||je["Yi Radicals"](s))))}function Jc(s){return!(sh(s)||(i=s,je["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||je["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||je["Letterlike Symbols"](i)||je["Number Forms"](i)||je["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||je["Control Pictures"](i)&&9251!==i||je["Optical Character Recognition"](i)||je["Enclosed Alphanumerics"](i)||je["Geometric Shapes"](i)||je["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||je["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||je["CJK Symbols and Punctuation"](i)||je.Katakana(i)||je["Private Use Area"](i)||je["CJK Compatibility Forms"](i)||je["Small Form Variants"](i)||je["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Zl(s){return s>=1424&&s<=2303||je["Arabic Presentation Forms-A"](s)||je["Arabic Presentation Forms-B"](s)}function mf(s,i){return!(!i&&Zl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||je.Khmer(s))}function wd(s){for(const i of s)if(Zl(i.charCodeAt(0)))return!0;return!1}const ah="deferred",Ho="loading",Yc="loaded";let Zr=null,Xr="unavailable",ps=null;const lh=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(Xr="error"),Zr&&Zr(s)};function Us(){Xl.fire(new ts("pluginStateChange",{pluginStatus:Xr,pluginURL:ps}))}const Xl=new ns,cl=function(){return Xr},Kl=function(){if(Xr!==ah||!ps)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Xr=Ho,Us(),ps&&Xa({url:ps},s=>{s?lh(s):(Xr=Yc,Us())})},Pi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Xr===Yc||null!=Pi.applyArabicShaping,isLoading:()=>Xr===Ho,setState(s){if(!Ci())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Xr=s.pluginStatus,ps=s.pluginURL},isParsed(){if(!Ci())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=Pi.applyArabicShaping&&null!=Pi.processBidirectionalText&&null!=Pi.processStyledBidirectionalText},getPluginURL(){if(!Ci())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ps}};class Gt{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ih,this.transition={})}isSupportedScript(i){return function(l,h){for(const m of l)if(!mf(m.charCodeAt(0),h))return!1;return!0}(i,Pi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class js{constructor(i,l){this.property=i,this.value=l,this.expression=function(h,m){if(Ft(h))return new Pr(h,m);if(vr(h)){const _=Rn(h,m);if("error"===_.result)throw new Error(_.value.map(b=>`${b.key}: ${b.message}`).join(", "));return _.value}{let _=h;return"color"===m.type&&"string"==typeof h?_=$.parse(h):"padding"!==m.type||"number"!=typeof h&&!Array.isArray(h)||(_=te.parse(h)),{kind:"constant",evaluate:()=>_}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,h){return this.property.possiblyEvaluate(this,i,l,h)}}class Jl{constructor(i){this.property=i,this.value=new js(i,void 0)}transitioned(i,l){return new ch(this.property,this.value,l,wi({},i.transition,this.transition),i.now)}untransitioned(){return new ch(this.property,this.value,null,{},0)}}class Yl{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Vr(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Jl(this._values[i].property)),this._values[i].value=new js(this._values[i].property,null===l?void 0:Vr(l))}getTransition(i){return Vr(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Jl(this._values[i].property)),this._values[i].transition=Vr(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(i[l]=h);const m=this.getTransition(l);void 0!==m&&(i[`${l}-transition`]=m)}return i}transitioned(i,l){const h=new Cd(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(i,l._values[m]);return h}untransitioned(){const i=new Cd(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class ch{constructor(i,l,h,m,_){this.property=i,this.value=l,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,i.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const m=i.now||0,_=this.value.possiblyEvaluate(i,l,h),b=this.prior;if(b){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return b.possiblyEvaluate(i,l,h);{const D=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(i,l,h),_,function(S){if(S<=0)return 0;if(S>=1)return 1;const T=S*S,R=T*S;return 4*(S<.5?R:3*(S-T)+R-.75)}(D))}}return _}}class Cd{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const m=new Ql(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(i,l,h);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class er{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Vr(this._values[i].value)}setValue(i,l){this._values[i]=new js(this._values[i].property,null===l?void 0:Vr(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(i[l]=h)}return i}possiblyEvaluate(i,l,h){const m=new Ql(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(i,l,h);return m}}class yo{constructor(i,l,h){this.property=i,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,h,m){return this.property.evaluate(this.value,this.parameters,i,l,h,m)}}class Ql{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Je{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,h){const m=zl[this.specification.type];return m?m(i,l,h):i}}class et{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,m){return new yo(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},h,m)}:i.expression,l)}interpolate(i,l,h){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new yo(this,{kind:"constant",value:void 0},i.parameters);const m=zl[this.specification.type];return m?new yo(this,{kind:"constant",value:m(i.value.value,l.value.value,h)},i.parameters):i}evaluate(i,l,h,m,_,b){return"constant"===i.kind?i.value:i.evaluate(l,h,m,_,b)}}class Sa extends et{possiblyEvaluate(i,l,h,m){if(void 0===i.value)return new yo(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const _=i.expression.evaluate(l,null,{},h,m),b="resolvedImage"===i.property.specification.type&&"string"!=typeof _?_.name:_,D=this._calculate(b,b,b,l);return new yo(this,{kind:"constant",value:D},l)}if("camera"===i.expression.kind){const _=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new yo(this,{kind:"constant",value:_},l)}return new yo(this,i.expression,l)}evaluate(i,l,h,m,_,b){if("source"===i.kind){const D=i.evaluate(l,h,m,_,b);return this._calculate(D,D,D,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},h,m),i.evaluate({zoom:Math.floor(l.zoom)},h,m),i.evaluate({zoom:Math.floor(l.zoom)+1},h,m),l):i.value}_calculate(i,l,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class ul{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,m){if(void 0!==i.value){if("constant"===i.expression.kind){const _=i.expression.evaluate(l,null,{},h,m);return this._calculate(_,_,_,l)}return this._calculate(i.expression.evaluate(new Gt(Math.floor(l.zoom-1),l)),i.expression.evaluate(new Gt(Math.floor(l.zoom),l)),i.expression.evaluate(new Gt(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class gi{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,m){return!!i.expression.evaluate(l,null,{},h,m)}interpolate(){return!1}}class bn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const h=i[l];h.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new js(h,void 0),_=this.defaultTransitionablePropertyValues[l]=new Jl(h);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate({})}}}Xe("DataDrivenProperty",et),Xe("DataConstantProperty",Je),Xe("CrossFadedDataDrivenProperty",Sa),Xe("CrossFadedProperty",ul),Xe("ColorRampProperty",gi);const fs="-transition";class yi extends ns{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new er(l.layout)),l.paint)){this._transitionablePaint=new Yl(l.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ql(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,h={}){null!=l&&this._validate(pf,`layers.${this.id}.layout.${i}`,i,l,h)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(fs)?this._transitionablePaint.getTransition(i.slice(0,-fs.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,h={}){if(null!=l&&this._validate(xd,`layers.${this.id}.paint.${i}`,i,l,h))return!1;if(i.endsWith(fs))return this._transitionablePaint.setTransition(i.slice(0,-fs.length),l||void 0),!1;{const m=this._transitionablePaint._values[i],_="cross-faded-data-driven"===m.property.specification["property-type"],b=m.value.isDataDriven(),D=m.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const S=this._transitionablePaint._values[i].value;return S.isDataDriven()||b||_||this._handleOverridablePaintPropertyUpdate(i,D,S)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),To(i,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(i,l,h,m,_={}){return(!_||!1!==_.validate)&&Xc(this,i.call(ql,{key:l,layerType:this.type,objectKey:h,value:m,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof yo&&Kt(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const uh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kr{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gn(s,i=1){let l=0,h=0;return{members:s.map(m=>{const _=uh[m.type].BYTES_PER_ELEMENT,b=l=vt(l,Math.max(i,_)),D=m.components||1;return h=Math.max(h,_),l+=_*D,{name:m.name,type:m.type,components:D,offset:b}}),size:vt(l,Math.max(h,i)),alignment:i}}function vt(s,i){return Math.ceil(s/i)*i}class ms extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const m=2*i;return this.int16[m+0]=l,this.int16[m+1]=h,i}}ms.prototype.bytesPerElement=4,Xe("StructArrayLayout2i4",ms);class f extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,m)}emplace(i,l,h,m,_){const b=4*i;return this.int16[b+0]=l,this.int16[b+1]=h,this.int16[b+2]=m,this.int16[b+3]=_,i}}f.prototype.bytesPerElement=8,Xe("StructArrayLayout4i8",f);class o extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,h,m,_,b)}emplace(i,l,h,m,_,b,D){const S=6*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=m,this.int16[S+3]=_,this.int16[S+4]=b,this.int16[S+5]=D,i}}o.prototype.bytesPerElement=12,Xe("StructArrayLayout2i4i12",o);class c extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,h,m,_,b)}emplace(i,l,h,m,_,b,D){const S=4*i,T=8*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.uint8[T+4]=m,this.uint8[T+5]=_,this.uint8[T+6]=b,this.uint8[T+7]=D,i}}c.prototype.bytesPerElement=8,Xe("StructArrayLayout2i4ub8",c);class d extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const m=2*i;return this.float32[m+0]=l,this.float32[m+1]=h,i}}d.prototype.bytesPerElement=8,Xe("StructArrayLayout2f8",d);class g extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b,D,S,T,R){const L=this.length;return this.resize(L+1),this.emplace(L,i,l,h,m,_,b,D,S,T,R)}emplace(i,l,h,m,_,b,D,S,T,R,L){const B=10*i;return this.uint16[B+0]=l,this.uint16[B+1]=h,this.uint16[B+2]=m,this.uint16[B+3]=_,this.uint16[B+4]=b,this.uint16[B+5]=D,this.uint16[B+6]=S,this.uint16[B+7]=T,this.uint16[B+8]=R,this.uint16[B+9]=L,i}}g.prototype.bytesPerElement=20,Xe("StructArrayLayout10ui20",g);class x extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b,D,S,T,R,L,B){const U=this.length;return this.resize(U+1),this.emplace(U,i,l,h,m,_,b,D,S,T,R,L,B)}emplace(i,l,h,m,_,b,D,S,T,R,L,B,U){const j=12*i;return this.int16[j+0]=l,this.int16[j+1]=h,this.int16[j+2]=m,this.int16[j+3]=_,this.uint16[j+4]=b,this.uint16[j+5]=D,this.uint16[j+6]=S,this.uint16[j+7]=T,this.int16[j+8]=R,this.int16[j+9]=L,this.int16[j+10]=B,this.int16[j+11]=U,i}}x.prototype.bytesPerElement=24,Xe("StructArrayLayout4i4ui4i24",x);class C extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const _=3*i;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=m,i}}C.prototype.bytesPerElement=12,Xe("StructArrayLayout3f12",C);class E extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}E.prototype.bytesPerElement=4,Xe("StructArrayLayout1ul4",E);class M extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b,D,S,T){const R=this.length;return this.resize(R+1),this.emplace(R,i,l,h,m,_,b,D,S,T)}emplace(i,l,h,m,_,b,D,S,T,R){const L=10*i,B=5*i;return this.int16[L+0]=l,this.int16[L+1]=h,this.int16[L+2]=m,this.int16[L+3]=_,this.int16[L+4]=b,this.int16[L+5]=D,this.uint32[B+3]=S,this.uint16[L+8]=T,this.uint16[L+9]=R,i}}M.prototype.bytesPerElement=20,Xe("StructArrayLayout6i1ul2ui20",M);class A extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,h,m,_,b)}emplace(i,l,h,m,_,b,D){const S=6*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=m,this.int16[S+3]=_,this.int16[S+4]=b,this.int16[S+5]=D,i}}A.prototype.bytesPerElement=12,Xe("StructArrayLayout2i2i2i12",A);class F extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,h,m,_)}emplace(i,l,h,m,_,b){const D=4*i,S=8*i;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=m,this.int16[S+6]=_,this.int16[S+7]=b,i}}F.prototype.bytesPerElement=16,Xe("StructArrayLayout2f1f2i16",F);class z extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,m)}emplace(i,l,h,m,_){const b=12*i,D=3*i;return this.uint8[b+0]=l,this.uint8[b+1]=h,this.float32[D+1]=m,this.float32[D+2]=_,i}}z.prototype.bytesPerElement=12,Xe("StructArrayLayout2ub2f12",z);class V extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const _=3*i;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=m,i}}V.prototype.bytesPerElement=6,Xe("StructArrayLayout3ui6",V);class X extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q,J,ce){const fe=this.length;return this.resize(fe+1),this.emplace(fe,i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q,J,ce)}emplace(i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q,J,ce,fe){const se=24*i,de=12*i,De=48*i;return this.int16[se+0]=l,this.int16[se+1]=h,this.uint16[se+2]=m,this.uint16[se+3]=_,this.uint32[de+2]=b,this.uint32[de+3]=D,this.uint32[de+4]=S,this.uint16[se+10]=T,this.uint16[se+11]=R,this.uint16[se+12]=L,this.float32[de+7]=B,this.float32[de+8]=U,this.uint8[De+36]=j,this.uint8[De+37]=Q,this.uint8[De+38]=J,this.uint32[de+10]=ce,this.int16[se+22]=fe,i}}X.prototype.bytesPerElement=48,Xe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",X);class W extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q,J,ce,fe,se,de,De,we,We,Ye,Ve,Fe,ke,Ue){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q,J,ce,fe,se,de,De,we,We,Ye,Ve,Fe,ke,Ue)}emplace(i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q,J,ce,fe,se,de,De,we,We,Ye,Ve,Fe,ke,Ue,Ne){const Te=34*i,it=17*i;return this.int16[Te+0]=l,this.int16[Te+1]=h,this.int16[Te+2]=m,this.int16[Te+3]=_,this.int16[Te+4]=b,this.int16[Te+5]=D,this.int16[Te+6]=S,this.int16[Te+7]=T,this.uint16[Te+8]=R,this.uint16[Te+9]=L,this.uint16[Te+10]=B,this.uint16[Te+11]=U,this.uint16[Te+12]=j,this.uint16[Te+13]=Q,this.uint16[Te+14]=J,this.uint16[Te+15]=ce,this.uint16[Te+16]=fe,this.uint16[Te+17]=se,this.uint16[Te+18]=de,this.uint16[Te+19]=De,this.uint16[Te+20]=we,this.uint16[Te+21]=We,this.uint16[Te+22]=Ye,this.uint32[it+12]=Ve,this.float32[it+13]=Fe,this.float32[it+14]=ke,this.float32[it+15]=Ue,this.float32[it+16]=Ne,i}}W.prototype.bytesPerElement=68,Xe("StructArrayLayout8i15ui1ul4f68",W);class Z extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Z.prototype.bytesPerElement=4,Xe("StructArrayLayout1f4",Z);class re extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const _=3*i;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=m,i}}re.prototype.bytesPerElement=6,Xe("StructArrayLayout3i6",re);class ae extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const _=4*i;return this.uint32[2*i+0]=l,this.uint16[_+2]=h,this.uint16[_+3]=m,i}}ae.prototype.bytesPerElement=8,Xe("StructArrayLayout1ul2ui8",ae);class he extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const m=2*i;return this.uint16[m+0]=l,this.uint16[m+1]=h,i}}he.prototype.bytesPerElement=4,Xe("StructArrayLayout2ui4",he);class K extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}K.prototype.bytesPerElement=2,Xe("StructArrayLayout1ui2",K);class pe extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,m)}emplace(i,l,h,m,_){const b=4*i;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=m,this.float32[b+3]=_,i}}pe.prototype.bytesPerElement=16,Xe("StructArrayLayout4f16",pe);class ue extends Kr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new at(this.anchorPointX,this.anchorPointY)}}ue.prototype.size=20;class _e extends M{get(i){return new ue(this,i)}}Xe("CollisionBoxArray",_e);class be extends Kr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}be.prototype.size=48;class Se extends X{get(i){return new be(this,i)}}Xe("PlacedSymbolArray",Se);class me extends Kr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}me.prototype.size=68;class He extends W{get(i){return new me(this,i)}}Xe("SymbolInstanceArray",He);class Re extends Z{getoffsetX(i){return this.float32[1*i+0]}}Xe("GlyphOffsetArray",Re);class qe extends re{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Xe("SymbolLineVertexArray",qe);class xt extends Kr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}xt.prototype.size=8;class Dt extends ae{get(i){return new xt(this,i)}}Xe("FeatureIndexArray",Dt);class rt extends ms{}class ln extends ms{}class tn extends ms{}class Bt extends o{}class Vt extends c{}class cn extends d{}class ir extends g{}class Ji extends x{}class ki extends C{}class Yi extends E{}class _o extends A{}class Ri extends z{}class si extends V{}class $n extends he{}const Qi=Gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Lt}=Qi;class kt{constructor(i=[]){this.segments=i}prepareSegment(i,l,h,m){let _=this.segments[this.segments.length-1];return i>kt.MAX_VERTEX_ARRAY_LENGTH&&Un(`Max vertices per segment is ${kt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>kt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==m&&(_.sortKey=m),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,m){return new kt([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function un(s,i){return 256*(s=xe(Math.floor(s),0,255))+xe(Math.floor(i),0,255)}kt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xe("SegmentVector",kt);const pr=Gn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fr={exports:{}},vo=function(s,i){var l,h,m,_,b,D,S,T;for(h=s.length-(l=3&s.length),m=i,b=3432918353,D=461845907,T=0;T<h;)S=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24,++T,m=27492+(65535&(_=5*(65535&(m=(m^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*D+(((S>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,l){case 3:S^=(255&s.charCodeAt(T+2))<<16;case 2:S^=(255&s.charCodeAt(T+1))<<8;case 1:m^=S=(65535&(S=(S=(65535&(S^=255&s.charCodeAt(T)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*D+(((S>>>16)*D&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},Ma=function(s,i){for(var l,h=s.length,m=i^h,_=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(_)|(255&s.charCodeAt(++_))<<8|(255&s.charCodeAt(++_))<<16|(255&s.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:m^=(255&s.charCodeAt(_+2))<<16;case 2:m^=(255&s.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};fr.exports=vo,fr.exports.murmur3=vo,fr.exports.murmur2=Ma;class Go{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,h,m){this.ids.push(ec(i)),this.positions.push(l,h,m)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=ec(i);let h=0,m=this.ids.length-1;for(;h<m;){const b=h+m>>1;this.ids[b]>=l?m=b:h=b+1}const _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(i,l){const h=new Float64Array(i.ids),m=new Uint32Array(i.positions);return tc(h,m,0,h.length-1),l&&l.push(h.buffer,m.buffer),{ids:h,positions:m}}static deserialize(i){const l=new Go;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function ec(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:fr.exports(String(s))}function tc(s,i,l,h){for(;l<h;){const m=s[l+h>>1];let _=l-1,b=h+1;for(;;){do{_++}while(s[_]<m);do{b--}while(s[b]>m);if(_>=b)break;gs(s,_,b),gs(i,3*_,3*b),gs(i,3*_+1,3*b+1),gs(i,3*_+2,3*b+2)}b-l<h-b?(tc(s,i,l,b),l=b+1):(tc(s,i,b+1,h),h=b)}}function gs(s,i,l){const h=s[i];s[i]=s[l],s[l]=h}Xe("FeaturePositionMap",Go);class ai{constructor(i,l){this.gl=i.gl,this.location=l}}class eo extends ai{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class nc extends ai{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class gf extends ai{constructor(i,l){super(i,l),this.current=$.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Qc=new Float32Array(16);function eu(s){return[un(255*s.r,255*s.g),un(255*s.b,255*s.a)]}class tu{constructor(i,l,h){this.value=i,this.uniformNames=l.map(m=>`u_${m}`),this.type=h}setUniform(i,l,h){i.set(h.constantOr(this.value))}getBinding(i,l,h){return"color"===this.type?new gf(i,l):new eo(i,l)}}class rc{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,h,m){const _="u_pattern_to"===m?this.patternTo:"u_pattern_from"===m?this.patternFrom:"u_pixel_ratio_to"===m?this.pixelRatioTo:"u_pixel_ratio_from"===m?this.pixelRatioFrom:null;_&&i.set(_)}getBinding(i,l,h){return"u_pattern"===h.substr(0,9)?new nc(i,l):new eo(i,l)}}class Ta{constructor(i,l,h,m){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,l,h,m,_){const b=this.paintVertexArray.length,D=this.expression.evaluate(new Gt(0),l,{},m,[],_);this.paintVertexArray.resize(i),this._setPaintValue(b,i,D)}updatePaintArray(i,l,h,m){const _=this.expression.evaluate({zoom:0},h,m);this._setPaintValue(i,l,_)}_setPaintValue(i,l,h){if("color"===this.type){const m=eu(h);for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=i;m<l;m++)this.paintVertexArray.emplace(m,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ys{constructor(i,l,h,m,_,b){this.expression=i,this.uniformNames=l.map(D=>`u_${D}_t`),this.type=h,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(i,l,h,m,_){const b=this.expression.evaluate(new Gt(this.zoom),l,{},m,[],_),D=this.expression.evaluate(new Gt(this.zoom+1),l,{},m,[],_),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,b,D)}updatePaintArray(i,l,h,m){const _=this.expression.evaluate({zoom:this.zoom},h,m),b=this.expression.evaluate({zoom:this.zoom+1},h,m);this._setPaintValue(i,l,_,b)}_setPaintValue(i,l,h,m){if("color"===this.type){const _=eu(h),b=eu(m);for(let D=i;D<l;D++)this.paintVertexArray.emplace(D,_[0],_[1],b[0],b[1])}else{for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,m=xe(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(m)}getBinding(i,l,h){return new eo(i,l)}}class qo{constructor(i,l,h,m,_,b){this.expression=i,this.type=l,this.useIntegerZoom=h,this.zoom=m,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(i,l,h){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(m,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,m,_){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(i,l,h,m){if(!m||!h)return;const{min:_,mid:b,max:D}=h,S=m[_],T=m[b],R=m[D];if(S&&T&&R)for(let L=i;L<l;L++)this.zoomInPaintVertexArray.emplace(L,T.tl[0],T.tl[1],T.br[0],T.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],T.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,T.tl[0],T.tl[1],T.br[0],T.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],T.pixelRatio,R.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,pr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,pr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Dd{constructor(i,l,h){this.binders={},this._buffers=[];const m=[];for(const _ in i.paint._values){if(!h(_))continue;const b=i.paint.get(_);if(!(b instanceof yo&&Kt(b.property.specification)))continue;const D=hh(_,i.type),S=b.value,T=b.property.specification.type,R=b.property.useIntegerZoom,L=b.property.specification["property-type"],B="cross-faded"===L||"cross-faded-data-driven"===L;if("constant"===S.kind)this.binders[_]=B?new rc(S.value,D):new tu(S.value,D,T),m.push(`/u_${_}`);else if("source"===S.kind||B){const U=Ed(_,T,"source");this.binders[_]=B?new qo(S,T,R,l,U,i.id):new Ta(S,D,T,U),m.push(`/a_${_}`)}else{const U=Ed(_,T,"composite");this.binders[_]=new ys(S,D,T,R,l,U),m.push(`/z_${_}`)}}this.cacheKey=m.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof Ta||l instanceof ys?l.maxValue:0}populatePaintArrays(i,l,h,m,_){for(const b in this.binders){const D=this.binders[b];(D instanceof Ta||D instanceof ys||D instanceof qo)&&D.populatePaintArray(i,l,h,m,_)}}setConstantPatternPositions(i,l){for(const h in this.binders){const m=this.binders[h];m instanceof rc&&m.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,h,m,_){let b=!1;for(const D in i){const S=l.getPositions(D);for(const T of S){const R=h.feature(T.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof Ta||B instanceof ys||B instanceof qo)&&!0===B.expression.isStateDependent){const U=m.paint.get(L);B.expression=U.value,B.updatePaintArray(T.start,T.end,R,i[D],_),b=!0}}}}return b}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof tu||h instanceof rc)&&i.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ta||h instanceof ys)for(let m=0;m<h.paintVertexAttributes.length;m++)i.push(h.paintVertexAttributes[m].name);else if(h instanceof qo)for(let m=0;m<pr.members.length;m++)i.push(pr.members[m].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof tu||h instanceof rc||h instanceof ys)for(const m of h.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const h=[];for(const m in this.binders){const _=this.binders[m];if(_ instanceof tu||_ instanceof rc||_ instanceof ys)for(const b of _.uniformNames)if(l[b]){const D=_.getBinding(i,l[b],b);h.push({name:b,property:m,binding:D})}}return h}setUniforms(i,l,h,m){for(const{name:_,property:b,binding:D}of l)this.binders[b].setUniform(D,m,h.get(b),_)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(i&&h instanceof qo){const m=2===i.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(h instanceof Ta||h instanceof ys)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof Ta||h instanceof ys||h instanceof qo)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof Ta||l instanceof ys||l instanceof qo)&&l.destroy()}}}class Aa{constructor(i,l,h=(()=>!0)){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new Dd(m,l,h);this.needsUpload=!1,this._featureMap=new Go,this._bufferOffset=0}populatePaintArrays(i,l,h,m,_,b){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(i,l,m,_,b);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,m){for(const _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(i,this._featureMap,l,_,m)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function hh(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Ed(s,i,l){const m={"line-pattern":{source:ir,composite:ir},"fill-pattern":{source:ir,composite:ir},"fill-extrusion-pattern":{source:ir,composite:ir}}[s];return m&&m[l]||{color:{source:d,composite:pe},number:{source:Z,composite:d}}[i][l]}Xe("ConstantBinder",tu),Xe("CrossFadedConstantBinder",rc),Xe("SourceExpressionBinder",Ta),Xe("CrossFadedCompositeBinder",qo),Xe("CompositeExpressionBinder",ys),Xe("ProgramConfiguration",Dd,{omit:["_buffers"]}),Xe("ProgramConfigurationSet",Aa);var tr=8192;const Pa=Math.pow(2,14)-1,yf=-Pa-1;function xo(s){const i=tr/s.extent,l=s.loadGeometry();for(let h=0;h<l.length;h++){const m=l[h];for(let _=0;_<m.length;_++){const b=m[_],D=Math.round(b.x*i),S=Math.round(b.y*i);b.x=xe(D,yf,Pa),b.y=xe(S,yf,Pa),(D<b.x||D>b.x+1||S<b.y||S>b.y+1)&&Un("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function $s(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?xo(s):[]}}function hl(s,i,l,h,m){s.emplaceBack(2*i+(h+1)/2,2*l+(m+1)/2)}class _f{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ln,this.indexArray=new si,this.segments=new kt,this.programConfigurations=new Aa(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){const m=this.layers[0],_=[];let b=null,D=!1;"circle"===m.type&&(b=m.layout.get("circle-sort-key"),D=!b.isConstant());for(const{feature:S,id:T,index:R,sourceLayerIndex:L}of i){const B=this.layers[0]._featureFilter.needGeometry,U=$s(S,B);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),U,h))continue;const j=D?b.evaluate(U,{},h):void 0,Q={id:T,properties:S.properties,type:S.type,sourceLayerIndex:L,index:R,geometry:B?U.geometry:xo(S),patterns:{},sortKey:j};_.push(Q)}D&&_.sort((S,T)=>S.sortKey-T.sortKey);for(const S of _){const{geometry:T,index:R,sourceLayerIndex:L}=S,B=i[R].feature;this.addFeature(S,T,R,h),l.featureIndex.insert(B,T,R,L,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Lt),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,m){for(const _ of l)for(const b of _){const D=b.x,S=b.y;if(D<0||D>=tr||S<0||S>=tr)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),R=T.vertexLength;hl(this.layoutVertexArray,D,S,-1,-1),hl(this.layoutVertexArray,D,S,1,-1),hl(this.layoutVertexArray,D,S,1,1),hl(this.layoutVertexArray,D,S,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},m)}}function Id(s,i){for(let l=0;l<s.length;l++)if(Hs(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Hs(s,i[l]))return!0;return!!Sd(s,i)}function vf(s,i,l){return!!Hs(s,i)||!!ru(i,s,l)}function xf(s,i){if(1===s.length)return iu(i,s[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let m=0;m<h.length;m++)if(Hs(s,h[m]))return!0}for(let l=0;l<s.length;l++)if(iu(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Sd(s,i[l]))return!0;return!1}function _s(s,i,l){if(s.length>1){if(Sd(s,i))return!0;for(let h=0;h<i.length;h++)if(ru(i[h],s,l))return!0}for(let h=0;h<s.length;h++)if(ru(s[h],i,l))return!0;return!1}function Sd(s,i){if(0===s.length||0===i.length)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],m=s[l+1];for(let _=0;_<i.length-1;_++)if(nu(h,m,i[_],i[_+1]))return!0}return!1}function nu(s,i,l,h){return lo(s,l,h)!==lo(i,l,h)&&lo(s,i,l)!==lo(s,i,h)}function ru(s,i,l){const h=l*l;if(1===i.length)return s.distSqr(i[0])<h;for(let m=1;m<i.length;m++)if(dh(s,i[m-1],i[m])<h)return!0;return!1}function dh(s,i,l){const h=i.distSqr(l);if(0===h)return s.distSqr(i);const m=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/h;return s.distSqr(m<0?i:m>1?l:l.sub(i)._mult(m)._add(i))}function iu(s,i){let l,h,m,_=!1;for(let b=0;b<s.length;b++){l=s[b];for(let D=0,S=l.length-1;D<l.length;S=D++)h=l[D],m=l[S],h.y>i.y!=m.y>i.y&&i.x<(m.x-h.x)*(i.y-h.y)/(m.y-h.y)+h.x&&(_=!_)}return _}function Hs(s,i){let l=!1;for(let h=0,m=s.length-1;h<s.length;m=h++){const _=s[h],b=s[m];_.y>i.y!=b.y>i.y&&i.x<(b.x-_.x)*(i.y-_.y)/(b.y-_.y)+_.x&&(l=!l)}return l}function Og(s,i,l){const h=l[0],m=l[2];if(s.x<h.x&&i.x<h.x||s.x>m.x&&i.x>m.x||s.y<h.y&&i.y<h.y||s.y>m.y&&i.y>m.y)return!1;const _=lo(s,i,l[0]);return _!==lo(s,i,l[1])||_!==lo(s,i,l[2])||_!==lo(s,i,l[3])}function ic(s,i,l){const h=i.paint.get(s).value;return"constant"===h.kind?h.value:l.programConfigurations.get(i.id).getMaxValue(s)}function ou(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function su(s,i,l,h,m){if(!i[0]&&!i[1])return s;const _=at.convert(i)._mult(m);"viewport"===l&&_._rotate(-h);const b=[];for(let D=0;D<s.length;D++)b.push(s[D].sub(_));return b}Xe("CircleBucket",_f,{omit:["layers"]});const bf=new bn({"circle-sort-key":new et(ve.layout_circle["circle-sort-key"])});var Ng={paint:new bn({"circle-radius":new et(ve.paint_circle["circle-radius"]),"circle-color":new et(ve.paint_circle["circle-color"]),"circle-blur":new et(ve.paint_circle["circle-blur"]),"circle-opacity":new et(ve.paint_circle["circle-opacity"]),"circle-translate":new Je(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Je(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Je(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Je(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new et(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new et(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new et(ve.paint_circle["circle-stroke-opacity"])}),layout:bf},br=1e-6,mr=typeof Float32Array<"u"?Float32Array:Array;function wf(){var s=new mr(9);return mr!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function ph(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Md(s,i,l){var h=i[0],m=i[1],_=i[2],b=i[3],D=i[4],S=i[5],T=i[6],R=i[7],L=i[8],B=i[9],U=i[10],j=i[11],Q=i[12],J=i[13],ce=i[14],fe=i[15],se=l[0],de=l[1],De=l[2],we=l[3];return s[0]=se*h+de*D+De*L+we*Q,s[1]=se*m+de*S+De*B+we*J,s[2]=se*_+de*T+De*U+we*ce,s[3]=se*b+de*R+De*j+we*fe,s[4]=(se=l[4])*h+(de=l[5])*D+(De=l[6])*L+(we=l[7])*Q,s[5]=se*m+de*S+De*B+we*J,s[6]=se*_+de*T+De*U+we*ce,s[7]=se*b+de*R+De*j+we*fe,s[8]=(se=l[8])*h+(de=l[9])*D+(De=l[10])*L+(we=l[11])*Q,s[9]=se*m+de*S+De*B+we*J,s[10]=se*_+de*T+De*U+we*ce,s[11]=se*b+de*R+De*j+we*fe,s[12]=(se=l[12])*h+(de=l[13])*D+(De=l[14])*L+(we=l[15])*Q,s[13]=se*m+de*S+De*B+we*J,s[14]=se*_+de*T+De*U+we*ce,s[15]=se*b+de*R+De*j+we*fe,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var vs,s,zg=Md;function Jr(){var s=new mr(3);return mr!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function fh(s,i,l){var h=new mr(3);return h[0]=s,h[1]=i,h[2]=l,h}function mh(s,i,l){var h=i[0],m=i[1],_=i[2],b=i[3];return s[0]=l[0]*h+l[4]*m+l[8]*_+l[12]*b,s[1]=l[1]*h+l[5]*m+l[9]*_+l[13]*b,s[2]=l[2]*h+l[6]*m+l[10]*_+l[14]*b,s[3]=l[3]*h+l[7]*m+l[11]*_+l[15]*b,s}function Td(){var s=new mr(4);return mr!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function oc(s,i){const l=mh([],[s.x,s.y,0,1],i);return new at(l[0]/l[3],l[1]/l[3])}Jr(),vs=new mr(4),mr!=Float32Array&&(vs[0]=0,vs[1]=0,vs[2]=0,vs[3]=0),Jr(),fh(1,0,0),fh(0,1,0),Td(),Td(),wf(),s=new mr(2),mr!=Float32Array&&(s[0]=0,s[1]=0);class dl extends _f{}Xe("HeatmapBucket",dl,{omit:["layers"]});var sc={paint:new bn({"heatmap-radius":new et(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new et(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Je(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gi(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Je(ve.paint_heatmap["heatmap-opacity"])})};function ka(s,{width:i,height:l},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*l*h)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${i*l*h}`)}else m=new Uint8Array(i*l*h);return s.width=i,s.height=l,s.data=m,s}function Ad(s,{width:i,height:l},h){if(i===s.width&&l===s.height)return;const m=ka({},{width:i,height:l},h);au(s,m,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},h),s.width=i,s.height=l,s.data=m.data}function au(s,i,l,h,m,_){if(0===m.width||0===m.height)return i;if(m.width>s.width||m.height>s.height||l.x>s.width-m.width||l.y>s.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||h.x>i.width-m.width||h.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,D=i.data;if(b===D)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<m.height;S++){const T=((l.y+S)*s.width+l.x)*_,R=((h.y+S)*i.width+h.x)*_;for(let L=0;L<m.width*_;L++)D[R+L]=b[T+L]}return i}class xs{constructor(i,l){ka(this,i,1,l)}resize(i){Ad(this,i,1)}clone(){return new xs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,m,_){au(i,l,h,m,_,1)}}class bo{constructor(i,l){ka(this,i,4,l)}resize(i){Ad(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,m,_){au(i,l,h,m,_,4)}}function Cf(s){const i={},l=s.resolution||256,h=s.clips?s.clips.length:1,m=s.image||new bo({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const _=(b,D,S)=>{i[s.evaluationKey]=S;const T=s.expression.evaluate(i);m.data[b+D+0]=Math.floor(255*T.r/T.a),m.data[b+D+1]=Math.floor(255*T.g/T.a),m.data[b+D+2]=Math.floor(255*T.b/T.a),m.data[b+D+3]=Math.floor(255*T.a)};if(s.clips)for(let b=0,D=0;b<h;++b,D+=4*l)for(let S=0,T=0;S<l;S++,T+=4){const R=S/(l-1),{start:L,end:B}=s.clips[b];_(D,T,L*(1-R)+B*R)}else for(let b=0,D=0;b<l;b++,D+=4)_(0,D,b/(l-1));return m}Xe("AlphaImage",xs),Xe("RGBAImage",bo);var dt={paint:new bn({"hillshade-illumination-direction":new Je(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Je(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Je(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Je(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Je(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Je(ve.paint_hillshade["hillshade-accent-color"])})};const Tx=Gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ax}=Tx;var Pd={exports:{}};function kd(s,i,l){l=l||2;var h,m,_,b,D,S,T,R=i&&i.length,L=R?i[0]*l:s.length,B=Bg(s,0,L,l,!0),U=[];if(!B||B.next===B.prev)return U;if(R&&(B=function(Q,J,ce,fe){var se,de,De,we=[];for(se=0,de=J.length;se<de;se++)(De=Bg(Q,J[se]*fe,se<de-1?J[se+1]*fe:Q.length,fe,!1))===De.next&&(De.steiner=!0),we.push(to(De));for(we.sort(Rd),se=0;se<we.length;se++)ce=cu(we[se],ce);return ce}(s,i,B,l)),s.length>80*l){h=_=s[0],m=b=s[1];for(var j=l;j<L;j+=l)(D=s[j])<h&&(h=D),(S=s[j+1])<m&&(m=S),D>_&&(_=D),S>b&&(b=S);T=0!==(T=Math.max(_-h,b-m))?32767/T:0}return gh(B,U,l,h,m,T,0),U}function Bg(s,i,l,h,m){var _,b;if(m===Fa(s,i,l,h)>0)for(_=i;_<l;_+=h)b=Od(_,s[_],s[_+1],b);else for(_=l-h;_>=i;_-=h)b=Od(_,s[_],s[_+1],b);return b&&Ra(b,b.next)&&(Yr(b),b=b.next),b}function ac(s,i){if(!s)return s;i||(i=s);var l,h=s;do{if(l=!1,h.steiner||!Ra(h,h.next)&&0!==Bn(h.prev,h,h.next))h=h.next;else{if(Yr(h),(h=i=h.prev)===h.next)break;l=!0}}while(l||h!==i);return i}function gh(s,i,l,h,m,_,b){if(s){!b&&_&&function(R,L,B,U){var j=R;do{0===j.z&&(j.z=Fd(j.x,j.y,L,B,U)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==R);j.prevZ.nextZ=null,j.prevZ=null,function(Q){var J,ce,fe,se,de,De,we,We,Ye=1;do{for(ce=Q,Q=null,de=null,De=0;ce;){for(De++,fe=ce,we=0,J=0;J<Ye&&(we++,fe=fe.nextZ);J++);for(We=Ye;we>0||We>0&&fe;)0!==we&&(0===We||!fe||ce.z<=fe.z)?(se=ce,ce=ce.nextZ,we--):(se=fe,fe=fe.nextZ,We--),de?de.nextZ=se:Q=se,se.prevZ=de,de=se;ce=fe}de.nextZ=null,Ye*=2}while(De>1)}(j)}(s,h,m,_);for(var D,S,T=s;s.prev!==s.next;)if(D=s.prev,S=s.next,_?Px(s,h,m,_):lu(s))i.push(D.i/l|0),i.push(s.i/l|0),i.push(S.i/l|0),Yr(s),s=S.next,T=S.next;else if((s=S)===T){b?1===b?gh(s=kx(ac(s),i,l),i,l,h,m,_,2):2===b&&wr(s,i,l,h,m,_):gh(ac(s),i,l,h,m,_,1);break}}}function lu(s){var i=s.prev,l=s,h=s.next;if(Bn(i,l,h)>=0)return!1;for(var m=i.x,_=l.x,b=h.x,D=i.y,S=l.y,T=h.y,R=m<_?m<b?m:b:_<b?_:b,L=D<S?D<T?D:T:S<T?S:T,B=m>_?m>b?m:b:_>b?_:b,U=D>S?D>T?D:T:S>T?S:T,j=h.next;j!==i;){if(j.x>=R&&j.x<=B&&j.y>=L&&j.y<=U&&Li(m,D,_,S,b,T,j.x,j.y)&&Bn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Px(s,i,l,h){var m=s.prev,_=s,b=s.next;if(Bn(m,_,b)>=0)return!1;for(var D=m.x,S=_.x,T=b.x,R=m.y,L=_.y,B=b.y,U=D<S?D<T?D:T:S<T?S:T,j=R<L?R<B?R:B:L<B?L:B,Q=D>S?D>T?D:T:S>T?S:T,J=R>L?R>B?R:B:L>B?L:B,ce=Fd(U,j,i,l,h),fe=Fd(Q,J,i,l,h),se=s.prevZ,de=s.nextZ;se&&se.z>=ce&&de&&de.z<=fe;){if(se.x>=U&&se.x<=Q&&se.y>=j&&se.y<=J&&se!==m&&se!==b&&Li(D,R,S,L,T,B,se.x,se.y)&&Bn(se.prev,se,se.next)>=0||(se=se.prevZ,de.x>=U&&de.x<=Q&&de.y>=j&&de.y<=J&&de!==m&&de!==b&&Li(D,R,S,L,T,B,de.x,de.y)&&Bn(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;se&&se.z>=ce;){if(se.x>=U&&se.x<=Q&&se.y>=j&&se.y<=J&&se!==m&&se!==b&&Li(D,R,S,L,T,B,se.x,se.y)&&Bn(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;de&&de.z<=fe;){if(de.x>=U&&de.x<=Q&&de.y>=j&&de.y<=J&&de!==m&&de!==b&&Li(D,R,S,L,T,B,de.x,de.y)&&Bn(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function kx(s,i,l){var h=s;do{var m=h.prev,_=h.next.next;!Ra(m,_)&&Ld(m,h,h.next,_)&&vh(m,_)&&vh(_,m)&&(i.push(m.i/l|0),i.push(h.i/l|0),i.push(_.i/l|0),Yr(h),Yr(h.next),h=s=_),h=h.next}while(h!==s);return ac(h)}function wr(s,i,l,h,m,_){var b=s;do{for(var D=b.next.next;D!==b.prev;){if(b.i!==D.i&&Df(b,D)){var S=Vg(b,D);return b=ac(b,b.next),S=ac(S,S.next),gh(b,i,l,h,m,_,0),void gh(S,i,l,h,m,_,0)}D=D.next}b=b.next}while(b!==s)}function Rd(s,i){return s.x-i.x}function cu(s,i){var l=function(m,_){var b,D=_,S=m.x,T=m.y,R=-1/0;do{if(T<=D.y&&T>=D.next.y&&D.next.y!==D.y){var L=D.x+(T-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(L<=S&&L>R&&(R=L,b=D.x<D.next.x?D:D.next,L===S))return b}D=D.next}while(D!==_);if(!b)return null;var B,U=b,j=b.x,Q=b.y,J=1/0;D=b;do{S>=D.x&&D.x>=j&&S!==D.x&&Li(T<Q?S:R,T,j,Q,T<Q?R:S,T,D.x,D.y)&&(B=Math.abs(T-D.y)/(S-D.x),vh(D,m)&&(B<J||B===J&&(D.x>b.x||D.x===b.x&&Rx(b,D)))&&(b=D,J=B)),D=D.next}while(D!==U);return b}(s,i);if(!l)return i;var h=Vg(l,s);return ac(h,h.next),ac(l,l.next)}function Rx(s,i){return Bn(s.prev,s,i.prev)<0&&Bn(i.next,s,s.next)<0}function Fd(s,i,l,h,m){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function to(s){var i=s,l=s;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==s);return l}function Li(s,i,l,h,m,_,b,D){return(m-b)*(i-D)>=(s-b)*(_-D)&&(s-b)*(h-D)>=(l-b)*(i-D)&&(l-b)*(_-D)>=(m-b)*(h-D)}function Df(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,h){var m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==h.i&&m.next.i!==h.i&&Ld(m,m.next,l,h))return!0;m=m.next}while(m!==l);return!1}(s,i)&&(vh(s,i)&&vh(i,s)&&function(l,h){var m=l,_=!1,b=(l.x+h.x)/2,D=(l.y+h.y)/2;do{m.y>D!=m.next.y>D&&m.next.y!==m.y&&b<(m.next.x-m.x)*(D-m.y)/(m.next.y-m.y)+m.x&&(_=!_),m=m.next}while(m!==l);return _}(s,i)&&(Bn(s.prev,s,i.prev)||Bn(s,i.prev,i))||Ra(s,i)&&Bn(s.prev,s,s.next)>0&&Bn(i.prev,i,i.next)>0)}function Bn(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function Ra(s,i){return s.x===i.x&&s.y===i.y}function Ld(s,i,l,h){var m=_h(Bn(s,i,l)),_=_h(Bn(s,i,h)),b=_h(Bn(l,h,s)),D=_h(Bn(l,h,i));return m!==_&&b!==D||!(0!==m||!yh(s,l,i))||!(0!==_||!yh(s,h,i))||!(0!==b||!yh(l,s,h))||!(0!==D||!yh(l,i,h))}function yh(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function _h(s){return s>0?1:s<0?-1:0}function vh(s,i){return Bn(s.prev,s,s.next)<0?Bn(s,i,s.next)>=0&&Bn(s,s.prev,i)>=0:Bn(s,i,s.prev)<0||Bn(s,s.next,i)<0}function Vg(s,i){var l=new uu(s.i,s.x,s.y),h=new uu(i.i,i.x,i.y),m=s.next,_=i.prev;return s.next=i,i.prev=s,l.next=m,m.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function Od(s,i,l,h){var m=new uu(s,i,l);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function Yr(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function uu(s,i,l){this.i=s,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fa(s,i,l,h){for(var m=0,_=i,b=l-h;_<l;_+=h)m+=(s[b]-s[_])*(s[_+1]+s[b+1]),b=_;return m}function Fx(s,i,l,h,m){Nd(s,i,l||0,h||s.length-1,m||Ug)}function Nd(s,i,l,h,m){for(;h>l;){if(h-l>600){var _=h-l+1,b=i-l+1,D=Math.log(_),S=.5*Math.exp(2*D/3),T=.5*Math.sqrt(D*S*(_-S)/_)*(b-_/2<0?-1:1);Nd(s,i,Math.max(l,Math.floor(i-b*S/_+T)),Math.min(h,Math.floor(i+(_-b)*S/_+T)),m)}var R=s[i],L=l,B=h;for(hu(s,l,i),m(s[h],R)>0&&hu(s,l,h);L<B;){for(hu(s,L,B),L++,B--;m(s[L],R)<0;)L++;for(;m(s[B],R)>0;)B--}0===m(s[l],R)?hu(s,l,B):hu(s,++B,h),B<=i&&(l=B+1),i<=B&&(h=B-1)}}function hu(s,i,l){var h=s[i];s[i]=s[l],s[l]=h}function Ug(s,i){return s<i?-1:s>i?1:0}function zd(s,i){const l=s.length;if(l<=1)return[s];const h=[];let m,_;for(let b=0;b<l;b++){const D=co(s[b]);0!==D&&(s[b].area=Math.abs(D),void 0===_&&(_=D<0),_===D<0?(m&&h.push(m),m=[s[b]]):m.push(s[b]))}if(m&&h.push(m),i>1)for(let b=0;b<h.length;b++)h[b].length<=i||(Fx(h[b],i,1,h[b].length-1,jg),h[b]=h[b].slice(0,i));return h}function jg(s,i){return i.area-s.area}function Bd(s,i,l){const h=l.patternDependencies;let m=!1;for(const _ of i){const b=_.paint.get(`${s}-pattern`);b.isConstant()||(m=!0);const D=b.constantOr(null);D&&(m=!0,h[D.to]=!0,h[D.from]=!0)}return m}function Vd(s,i,l,h,m){const _=m.patternDependencies;for(const b of i){const D=b.paint.get(`${s}-pattern`).value;if("constant"!==D.kind){let S=D.evaluate({zoom:h-1},l,{},m.availableImages),T=D.evaluate({zoom:h},l,{},m.availableImages),R=D.evaluate({zoom:h+1},l,{},m.availableImages);S=S&&S.name?S.name:S,T=T&&T.name?T.name:T,R=R&&R.name?R.name:R,_[S]=!0,_[T]=!0,_[R]=!0,l.patterns[b.id]={min:S,mid:T,max:R}}}return l}Pd.exports=kd,Pd.exports.default=kd,kd.deviation=function(s,i,l,h){var m=i&&i.length,_=Math.abs(Fa(s,0,m?i[0]*l:s.length,l));if(m)for(var b=0,D=i.length;b<D;b++)_-=Math.abs(Fa(s,i[b]*l,b<D-1?i[b+1]*l:s.length,l));var S=0;for(b=0;b<h.length;b+=3){var T=h[b]*l,R=h[b+1]*l,L=h[b+2]*l;S+=Math.abs((s[T]-s[L])*(s[R+1]-s[T+1])-(s[T]-s[R])*(s[L+1]-s[T+1]))}return 0===_&&0===S?0:Math.abs((S-_)/_)},kd.flatten=function(s){for(var i=s[0][0].length,l={vertices:[],holes:[],dimensions:i},h=0,m=0;m<s.length;m++){for(var _=0;_<s[m].length;_++)for(var b=0;b<i;b++)l.vertices.push(s[m][_][b]);m>0&&l.holes.push(h+=s[m-1].length)}return l};class du{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new tn,this.indexArray=new si,this.indexArray2=new $n,this.programConfigurations=new Aa(i.layers,i.zoom),this.segments=new kt,this.segments2=new kt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=Bd("fill",this.layers,l);const m=this.layers[0].layout.get("fill-sort-key"),_=!m.isConstant(),b=[];for(const{feature:D,id:S,index:T,sourceLayerIndex:R}of i){const L=this.layers[0]._featureFilter.needGeometry,B=$s(D,L);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),B,h))continue;const U=_?m.evaluate(B,{},h,l.availableImages):void 0,j={id:S,properties:D.properties,type:D.type,sourceLayerIndex:R,index:T,geometry:L?B.geometry:xo(D),patterns:{},sortKey:U};b.push(j)}_&&b.sort((D,S)=>D.sortKey-S.sortKey);for(const D of b){const{geometry:S,index:T,sourceLayerIndex:R}=D;if(this.hasPattern){const L=Vd("fill",this.layers,D,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(D,S,T,h,{});l.featureIndex.insert(i[T].feature,S,T,R,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ax),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,h,m,_){for(const b of zd(l,500)){let D=0;for(const U of b)D+=U.length;const S=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),T=S.vertexLength,R=[],L=[];for(const U of b){if(0===U.length)continue;U!==b[0]&&L.push(R.length/2);const j=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Q=j.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Q+U.length-1,Q),R.push(U[0].x),R.push(U[0].y);for(let J=1;J<U.length;J++)this.layoutVertexArray.emplaceBack(U[J].x,U[J].y),this.indexArray2.emplaceBack(Q+J-1,Q+J),R.push(U[J].x),R.push(U[J].y);j.vertexLength+=U.length,j.primitiveLength+=U.length}const B=Pd.exports(R,L);for(let U=0;U<B.length;U+=3)this.indexArray.emplaceBack(T+B[U],T+B[U+1],T+B[U+2]);S.vertexLength+=D,S.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,m)}}Xe("FillBucket",du,{omit:["layers","patternFeatures"]});const xh=new bn({"fill-sort-key":new et(ve.layout_fill["fill-sort-key"])});var Lx={paint:new bn({"fill-antialias":new Je(ve.paint_fill["fill-antialias"]),"fill-opacity":new et(ve.paint_fill["fill-opacity"]),"fill-color":new et(ve.paint_fill["fill-color"]),"fill-outline-color":new et(ve.paint_fill["fill-outline-color"]),"fill-translate":new Je(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Je(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Sa(ve.paint_fill["fill-pattern"])}),layout:xh};const pu=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ud=Gn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bh}=pu;var La={},$g=at,Ef=pl;function pl(s,i,l,h,m){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=m,s.readFields(fu,this,i)}function fu(s,i,l){1==s?i.id=l.readVarint():2==s?function(h,m){for(var _=h.readVarint()+h.pos;h.pos<_;){var b=m._keys[h.readVarint()],D=m._values[h.readVarint()];m.properties[b]=D}}(l,i):3==s?i.type=l.readVarint():4==s&&(i._geometry=l.pos)}function lc(s){for(var i,l,h=0,m=0,_=s.length,b=_-1;m<_;b=m++)h+=((l=s[b]).x-(i=s[m]).x)*(i.y+l.y);return h}pl.types=["Unknown","Point","LineString","Polygon"],pl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,h=1,m=0,_=0,b=0,D=[];s.pos<l;){if(m<=0){var S=s.readVarint();h=7&S,m=S>>3}if(m--,1===h||2===h)_+=s.readSVarint(),b+=s.readSVarint(),1===h&&(i&&D.push(i),i=[]),i.push(new $g(_,b));else{if(7!==h)throw new Error("unknown command "+h);i&&i.push(i[0].clone())}}return i&&D.push(i),D},pl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,h=0,m=0,_=0,b=1/0,D=-1/0,S=1/0,T=-1/0;s.pos<i;){if(h<=0){var R=s.readVarint();l=7&R,h=R>>3}if(h--,1===l||2===l)(m+=s.readSVarint())<b&&(b=m),m>D&&(D=m),(_+=s.readSVarint())<S&&(S=_),_>T&&(T=_);else if(7!==l)throw new Error("unknown command "+l)}return[b,S,D,T]},pl.prototype.toGeoJSON=function(s,i,l){var h,m,_=this.extent*Math.pow(2,l),b=this.extent*s,D=this.extent*i,S=this.loadGeometry(),T=pl.types[this.type];function R(U){for(var j=0;j<U.length;j++){var Q=U[j];U[j]=[360*(Q.x+b)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+D)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(h=0;h<S.length;h++)L[h]=S[h][0];R(S=L);break;case 2:for(h=0;h<S.length;h++)R(S[h]);break;case 3:for(S=function(U){var j=U.length;if(j<=1)return[U];for(var Q,J,ce=[],fe=0;fe<j;fe++){var se=lc(U[fe]);0!==se&&(void 0===J&&(J=se<0),J===se<0?(Q&&ce.push(Q),Q=[U[fe]]):Q.push(U[fe]))}return Q&&ce.push(Q),ce}(S),h=0;h<S.length;h++)for(m=0;m<S[h].length;m++)R(S[h][m])}1===S.length?S=S[0]:T="Multi"+T;var B={type:"Feature",geometry:{type:T,coordinates:S},properties:this.properties};return"id"in this&&(B.id=this.id),B};var Hg=Ef,ot=jd;function jd(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(or,this,i),this.length=this._features.length}function or(s,i,l){15===s?i.version=l.readVarint():1===s?i.name=l.readString():5===s?i.extent=l.readVarint():2===s?i._features.push(l.pos):3===s?i._keys.push(l.readString()):4===s&&i._values.push(function(h){for(var m=null,_=h.readVarint()+h.pos;h.pos<_;){var b=h.readVarint()>>3;m=1===b?h.readString():2===b?h.readFloat():3===b?h.readDouble():4===b?h.readVarint64():5===b?h.readVarint():6===b?h.readSVarint():7===b?h.readBoolean():null}return m}(l))}jd.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new Hg(this._pbf,i,this.extent,this._keys,this._values)};var $d=ot;function mu(s,i,l){if(3===s){var h=new $d(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}La.VectorTile=function(s,i){this.layers=s.readFields(mu,{},i)},La.VectorTileFeature=Ef,La.VectorTileLayer=ot;const Gg=La.VectorTileFeature.types,Hd=Math.pow(2,13);function gu(s,i,l,h,m,_,b,D){s.emplaceBack(i,l,2*Math.floor(h*Hd)+b,m*Hd*2,_*Hd*2,Math.round(D))}class yu{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Bt,this.centroidVertexArray=new rt,this.indexArray=new si,this.programConfigurations=new Aa(i.layers,i.zoom),this.segments=new kt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.features=[],this.hasPattern=Bd("fill-extrusion",this.layers,l);for(const{feature:m,id:_,index:b,sourceLayerIndex:D}of i){const S=this.layers[0]._featureFilter.needGeometry,T=$s(m,S);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),T,h))continue;const R={id:_,sourceLayerIndex:D,index:b,geometry:S?T.geometry:xo(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Vd("fill-extrusion",this.layers,R,this.zoom,l)):this.addFeature(R,R.geometry,b,h,{}),l.featureIndex.insert(m,R.geometry,b,D,this.index,!0)}}addFeatures(i,l,h){for(const m of this.features){const{geometry:_}=m;this.addFeature(m,_,m.index,l,h)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,bh),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Ud.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,h,m,_){const b={x:0,y:0,vertexCount:0};for(const D of zd(l,500)){let S=0;for(const j of D)S+=j.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const j of D){if(0===j.length||If(j))continue;let Q=0;for(let J=0;J<j.length;J++){const ce=j[J];if(J>=1){const fe=j[J-1];if(!_u(ce,fe)){T.vertexLength+4>kt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const se=ce.sub(fe)._perp()._unit(),de=fe.dist(ce);Q+de>32768&&(Q=0),gu(this.layoutVertexArray,ce.x,ce.y,se.x,se.y,0,0,Q),gu(this.layoutVertexArray,ce.x,ce.y,se.x,se.y,0,1,Q),b.x+=2*ce.x,b.y+=2*ce.y,b.vertexCount+=2,Q+=de,gu(this.layoutVertexArray,fe.x,fe.y,se.x,se.y,0,0,Q),gu(this.layoutVertexArray,fe.x,fe.y,se.x,se.y,0,1,Q),b.x+=2*fe.x,b.y+=2*fe.y,b.vertexCount+=2;const De=T.vertexLength;this.indexArray.emplaceBack(De,De+2,De+1),this.indexArray.emplaceBack(De+1,De+2,De+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+S>kt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),"Polygon"!==Gg[i.type])continue;const R=[],L=[],B=T.vertexLength;for(const j of D)if(0!==j.length){j!==D[0]&&L.push(R.length/2);for(let Q=0;Q<j.length;Q++){const J=j[Q];gu(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),b.x+=J.x,b.y+=J.y,b.vertexCount+=1,R.push(J.x),R.push(J.y)}}const U=Pd.exports(R,L);for(let j=0;j<U.length;j+=3)this.indexArray.emplaceBack(B+U[j],B+U[j+2],B+U[j+1]);T.primitiveLength+=U.length/3,T.vertexLength+=S}for(let D=0;D<b.vertexCount;D++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,m)}}function _u(s,i){return s.x===i.x&&(s.x<0||s.x>tr)||s.y===i.y&&(s.y<0||s.y>tr)}function If(s){return s.every(i=>i.x<0)||s.every(i=>i.x>tr)||s.every(i=>i.y<0)||s.every(i=>i.y>tr)}Xe("FillExtrusionBucket",yu,{omit:["layers","features"]});var vu={paint:new bn({"fill-extrusion-opacity":new Je(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new et(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Je(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Je(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Sa(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new et(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new et(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Je(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function xu(s,i){return s.x*i.x+s.y*i.y}function Gd(s,i){if(1===s.length){let l=0;const h=i[l++];let m;for(;!m||h.equals(m);)if(m=i[l++],!m)return 1/0;for(;l<i.length;l++){const _=i[l],b=s[0],D=m.sub(h),S=_.sub(h),T=b.sub(h),R=xu(D,D),L=xu(D,S),B=xu(S,S),U=xu(T,D),j=xu(T,S),Q=R*B-L*L,J=(B*U-L*j)/Q,ce=(R*j-L*U)/Q,fe=h.z*(1-J-ce)+m.z*J+_.z*ce;if(isFinite(fe))return fe}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}const bu=Gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wh}=bu,Sf=Gn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qg}=Sf,Wg=La.VectorTileFeature.types,cc=Math.cos(Math.PI/180*37.5),uc=Math.pow(2,14)/.5;class qd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Vt,this.layoutVertexArray2=new cn,this.indexArray=new si,this.programConfigurations=new Aa(i.layers,i.zoom),this.segments=new kt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=Bd("line",this.layers,l);const m=this.layers[0].layout.get("line-sort-key"),_=!m.isConstant(),b=[];for(const{feature:D,id:S,index:T,sourceLayerIndex:R}of i){const L=this.layers[0]._featureFilter.needGeometry,B=$s(D,L);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),B,h))continue;const U=_?m.evaluate(B,{},h):void 0,j={id:S,properties:D.properties,type:D.type,sourceLayerIndex:R,index:T,geometry:L?B.geometry:xo(D),patterns:{},sortKey:U};b.push(j)}_&&b.sort((D,S)=>D.sortKey-S.sortKey);for(const D of b){const{geometry:S,index:T,sourceLayerIndex:R}=D;if(this.hasPattern){const L=Vd("line",this.layers,D,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(D,S,T,h,{});l.featureIndex.insert(i[T].feature,S,T,R,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,qg)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,wh),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,h,m,_){const b=this.layers[0].layout,D=b.get("line-join").evaluate(i,{}),S=b.get("line-cap"),T=b.get("line-miter-limit"),R=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const L of l)this.addLine(L,i,D,S,T,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,m)}addLine(i,l,h,m,_,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<i.length-1;ce++)this.totalDistance+=i[ce].dist(i[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===Wg[l.type];let S=i.length;for(;S>=2&&i[S-1].equals(i[S-2]);)S--;let T=0;for(;T<S-1&&i[T].equals(i[T+1]);)T++;if(S<(D?3:2))return;"bevel"===h&&(_=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let B,U,j,Q,J;this.e1=this.e2=-1,D&&(B=i[S-2],J=i[T].sub(B)._unit()._perp());for(let ce=T;ce<S;ce++){if(j=ce===S-1?D?i[T+1]:void 0:i[ce+1],j&&i[ce].equals(j))continue;J&&(Q=J),B&&(U=B),B=i[ce],J=j?j.sub(B)._unit()._perp():Q,Q=Q||J;let fe=Q.add(J);0===fe.x&&0===fe.y||fe._unit();const se=Q.x*J.x+Q.y*J.y,de=fe.x*J.x+fe.y*J.y,De=0!==de?1/de:1/0,we=2*Math.sqrt(2-2*de),We=de<cc&&U&&j,Ye=Q.x*J.y-Q.y*J.x>0;if(We&&ce>T){const ke=B.dist(U);if(ke>2*R){const Ue=B.sub(B.sub(U)._mult(R/ke)._round());this.updateDistance(U,Ue),this.addCurrentVertex(Ue,Q,0,0,L),U=Ue}}const Ve=U&&j;let Fe=Ve?h:D?"butt":m;if(Ve&&"round"===Fe&&(De<b?Fe="miter":De<=2&&(Fe="fakeround")),"miter"===Fe&&De>_&&(Fe="bevel"),"bevel"===Fe&&(De>2&&(Fe="flipbevel"),De<_&&(Fe="miter")),U&&this.updateDistance(U,B),"miter"===Fe)fe._mult(De),this.addCurrentVertex(B,fe,0,0,L);else if("flipbevel"===Fe){if(De>100)fe=J.mult(-1);else{const ke=De*Q.add(J).mag()/Q.sub(J).mag();fe._perp()._mult(ke*(Ye?-1:1))}this.addCurrentVertex(B,fe,0,0,L),this.addCurrentVertex(B,fe.mult(-1),0,0,L)}else if("bevel"===Fe||"fakeround"===Fe){const ke=-Math.sqrt(De*De-1),Ue=Ye?ke:0,Ne=Ye?0:ke;if(U&&this.addCurrentVertex(B,Q,Ue,Ne,L),"fakeround"===Fe){const Te=Math.round(180*we/Math.PI/20);for(let it=1;it<Te;it++){let nt=it/Te;if(.5!==nt){const Sn=nt-.5;nt+=nt*Sn*(nt-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*Sn*Sn+(.848013+se*(.215638*se-1.06021)))}const Tt=J.sub(Q)._mult(nt)._add(Q)._unit()._mult(Ye?-1:1);this.addHalfVertex(B,Tt.x,Tt.y,!1,Ye,0,L)}}j&&this.addCurrentVertex(B,J,-Ue,-Ne,L)}else if("butt"===Fe)this.addCurrentVertex(B,fe,0,0,L);else if("square"===Fe){const ke=U?1:-1;this.addCurrentVertex(B,fe,ke,ke,L)}else"round"===Fe&&(U&&(this.addCurrentVertex(B,Q,0,0,L),this.addCurrentVertex(B,Q,1,1,L,!0)),j&&(this.addCurrentVertex(B,J,-1,-1,L,!0),this.addCurrentVertex(B,J,0,0,L)));if(We&&ce<S-1){const ke=B.dist(j);if(ke>2*R){const Ue=B.add(j.sub(B)._mult(R/ke)._round());this.updateDistance(B,Ue),this.addCurrentVertex(Ue,J,0,0,L),B=Ue}}}}addCurrentVertex(i,l,h,m,_,b=!1){const D=l.y*m-l.x,S=-l.y-l.x*m;this.addHalfVertex(i,l.x+l.y*h,l.y-l.x*h,b,!1,h,_),this.addHalfVertex(i,D,S,b,!0,-m,_),this.distance>uc/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(i,l,h,m,_,b))}addHalfVertex({x:i,y:l},h,m,_,b,D,S){const T=.5*(this.lineClips?this.scaledDistance*(uc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(l<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(0===D?0:D<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),S.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}Xe("LineBucket",qd,{omit:["layers","patternFeatures"]});const Ox=new bn({"line-cap":new Je(ve.layout_line["line-cap"]),"line-join":new et(ve.layout_line["line-join"]),"line-miter-limit":new Je(ve.layout_line["line-miter-limit"]),"line-round-limit":new Je(ve.layout_line["line-round-limit"]),"line-sort-key":new et(ve.layout_line["line-sort-key"])});var Wd={paint:new bn({"line-opacity":new et(ve.paint_line["line-opacity"]),"line-color":new et(ve.paint_line["line-color"]),"line-translate":new Je(ve.paint_line["line-translate"]),"line-translate-anchor":new Je(ve.paint_line["line-translate-anchor"]),"line-width":new et(ve.paint_line["line-width"]),"line-gap-width":new et(ve.paint_line["line-gap-width"]),"line-offset":new et(ve.paint_line["line-offset"]),"line-blur":new et(ve.paint_line["line-blur"]),"line-dasharray":new ul(ve.paint_line["line-dasharray"]),"line-pattern":new Sa(ve.paint_line["line-pattern"]),"line-gradient":new gi(ve.paint_line["line-gradient"])}),layout:Ox};const Mf=new class extends et{possiblyEvaluate(s,i){return i=new Gt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(s,i)}evaluate(s,i,l,h){return i=wi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(s,i,l,h)}}(Wd.paint.properties["line-width"].specification);function Zg(s,i){return i>0?i+2*s:s}Mf.useIntegerZoom=!0;const Xg=Gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kg=Gn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jg=Gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Gn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wu=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tf=Gn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yg(s,i,l){return s.sections.forEach(h=>{h.text=function(m,_,b){const D=_.layout.get("text-transform").evaluate(b,{});return"uppercase"===D?m=m.toLocaleUpperCase():"lowercase"===D&&(m=m.toLocaleLowerCase()),Pi.applyArabicShaping&&(m=Pi.applyArabicShaping(m)),m}(h.text,i,l)}),s}Gn([{name:"triangle",components:3,type:"Uint16"}]),Gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gn([{type:"Float32",name:"offsetX"}]),Gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const hc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Ch=wn,Qg=function(s,i,l,h,m){var _,b,D=8*m-h-1,S=(1<<D)-1,T=S>>1,R=-7,L=l?m-1:0,B=l?-1:1,U=s[i+L];for(L+=B,_=U&(1<<-R)-1,U>>=-R,R+=D;R>0;_=256*_+s[i+L],L+=B,R-=8);for(b=_&(1<<-R)-1,_>>=-R,R+=h;R>0;b=256*b+s[i+L],L+=B,R-=8);if(0===_)_=1-T;else{if(_===S)return b?NaN:1/0*(U?-1:1);b+=Math.pow(2,h),_-=T}return(U?-1:1)*b*Math.pow(2,_-h)},Dh=function(s,i,l,h,m,_){var b,D,S,T=8*_-m-1,R=(1<<T)-1,L=R>>1,B=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,U=h?0:_-1,j=h?1:-1,Q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(D=isNaN(i)?1:0,b=R):(b=Math.floor(Math.log(i)/Math.LN2),i*(S=Math.pow(2,-b))<1&&(b--,S*=2),(i+=b+L>=1?B/S:B*Math.pow(2,1-L))*S>=2&&(b++,S/=2),b+L>=R?(D=0,b=R):b+L>=1?(D=(i*S-1)*Math.pow(2,m),b+=L):(D=i*Math.pow(2,L-1)*Math.pow(2,m),b=0));m>=8;s[l+U]=255&D,U+=j,D/=256,m-=8);for(b=b<<m|D,T+=m;T>0;s[l+U]=255&b,U+=j,b/=256,T-=8);s[l+U-j]|=128*Q};function wn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}wn.Varint=0,wn.Fixed64=1,wn.Bytes=2,wn.Fixed32=5;var Gs,dc=4294967296,Eh=1/dc,fl=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function qs(s){return s.type===wn.Bytes?s.readVarint()+s.pos:s.pos+1}function ey(s,i,l){var h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(var m=l.pos-1;m>=s;m--)l.buf[m+h]=l.buf[m]}function Ih(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function Zd(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function Af(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function Pf(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function kf(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function Rf(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function ty(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function ny(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function ry(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function Sh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function fc(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function Ws(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}function Cu(s,i,l){1===s&&l.readMessage(iy,i)}function iy(s,i,l){if(3===s){const{id:h,bitmap:m,width:_,height:b,left:D,top:S,advance:T}=l.readMessage(Nx,{});i.push({id:h,bitmap:new xs({width:_+6,height:b+6},m),metrics:{width:_,height:b,left:D,top:S,advance:T}})}}function Nx(s,i,l){1===s?i.id=l.readVarint():2===s?i.bitmap=l.readBytes():3===s?i.width=l.readVarint():4===s?i.height=l.readVarint():5===s?i.left=l.readSVarint():6===s?i.top=l.readSVarint():7===s&&(i.advance=l.readVarint())}function oy(s){let i=0,l=0;for(const b of s)i+=b.w*b.h,l=Math.max(l,b.w);s.sort((b,D)=>D.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let m=0,_=0;for(const b of s)for(let D=h.length-1;D>=0;D--){const S=h[D];if(!(b.w>S.w||b.h>S.h)){if(b.x=S.x,b.y=S.y,_=Math.max(_,b.y+b.h),m=Math.max(m,b.x+b.w),b.w===S.w&&b.h===S.h){const T=h.pop();D<h.length&&(h[D]=T)}else b.h===S.h?(S.x+=b.w,S.w-=b.w):b.w===S.w?(S.y+=b.h,S.h-=b.h):(h.push({x:S.x+b.w,y:S.y,w:S.w-b.w,h:b.h}),S.y+=b.h,S.h-=b.h);break}}return{w:m,h:_,fill:i/(m*_)||0}}wn.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),m=h>>3,_=this.pos;this.type=7&h,s(m,i,this),this.pos===_&&this.skip(h)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Sh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Ws(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Sh(this.buf,this.pos)+Sh(this.buf,this.pos+4)*dc;return this.pos+=8,s},readSFixed64:function(){var s=Sh(this.buf,this.pos)+Ws(this.buf,this.pos+4)*dc;return this.pos+=8,s},readFloat:function(){var s=Qg(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Qg(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,h=this.buf;return i=127&(l=h[this.pos++]),l<128?i:(i|=(127&(l=h[this.pos++]))<<7,l<128?i:(i|=(127&(l=h[this.pos++]))<<14,l<128?i:(i|=(127&(l=h[this.pos++]))<<21,l<128?i:function(m,_,b){var D,S,T=b.buf;if(D=(112&(S=T[b.pos++]))>>4,S<128||(D|=(127&(S=T[b.pos++]))<<3,S<128)||(D|=(127&(S=T[b.pos++]))<<10,S<128)||(D|=(127&(S=T[b.pos++]))<<17,S<128)||(D|=(127&(S=T[b.pos++]))<<24,S<128)||(D|=(1&(S=T[b.pos++]))<<31,S<128))return function pc(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(m,D,_);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&fl?fl.decode(this.buf.subarray(i,s)):function(l,h,m){for(var _="",b=h;b<m;){var D,S,T,R=l[b],L=null,B=R>239?4:R>223?3:R>191?2:1;if(b+B>m)break;1===B?R<128&&(L=R):2===B?128==(192&(D=l[b+1]))&&(L=(31&R)<<6|63&D)<=127&&(L=null):3===B?(S=l[b+2],128==(192&(D=l[b+1]))&&128==(192&S)&&((L=(15&R)<<12|(63&D)<<6|63&S)<=2047||L>=55296&&L<=57343)&&(L=null)):4===B&&(S=l[b+2],T=l[b+3],128==(192&(D=l[b+1]))&&128==(192&S)&&128==(192&T)&&((L=(15&R)<<18|(63&D)<<12|(63&S)<<6|63&T)<=65535||L>=1114112)&&(L=null)),null===L?(L=65533,B=1):L>65535&&(L-=65536,_+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),_+=String.fromCharCode(L),b+=B}return _}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==wn.Bytes)return s.push(this.readVarint(i));var l=qs(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==wn.Bytes)return s.push(this.readSVarint());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==wn.Bytes)return s.push(this.readBoolean());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==wn.Bytes)return s.push(this.readFloat());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==wn.Bytes)return s.push(this.readDouble());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==wn.Bytes)return s.push(this.readFixed32());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==wn.Bytes)return s.push(this.readSFixed32());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==wn.Bytes)return s.push(this.readFixed64());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==wn.Bytes)return s.push(this.readSFixed64());var i=qs(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===wn.Varint)for(;this.buf[this.pos++]>127;);else if(i===wn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===wn.Fixed32)this.pos+=4;else{if(i!==wn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),fc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),fc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),fc(this.buf,-1&s,this.pos),fc(this.buf,Math.floor(s*Eh),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),fc(this.buf,-1&s,this.pos),fc(this.buf,Math.floor(s*Eh),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var h,m,_,D;if(i>=0?(h=i%4294967296|0,m=i/4294967296|0):(m=~(-i/4294967296),4294967295^(h=~(-i%4294967296))?h=h+1|0:(h=0,m=m+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),_=h,(D=l).buf[D.pos++]=127&_|128,_>>>=7,D.buf[D.pos++]=127&_|128,_>>>=7,D.buf[D.pos++]=127&_|128,_>>>=7,D.buf[D.pos++]=127&_|128,D.buf[D.pos]=127&(_>>>=7),function(_,b){var D=(7&_)<<4;b.buf[b.pos++]|=D|((_>>>=3)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_)))))}(m,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(h,m,_){for(var b,D,S=0;S<m.length;S++){if((b=m.charCodeAt(S))>55295&&b<57344){if(!D){b>56319||S+1===m.length?(h[_++]=239,h[_++]=191,h[_++]=189):D=b;continue}if(b<56320){h[_++]=239,h[_++]=191,h[_++]=189,D=b;continue}b=D-55296<<10|b-56320|65536,D=null}else D&&(h[_++]=239,h[_++]=191,h[_++]=189,D=null);b<128?h[_++]=b:(b<2048?h[_++]=b>>6|192:(b<65536?h[_++]=b>>12|224:(h[_++]=b>>18|240,h[_++]=b>>12&63|128),h[_++]=b>>6&63|128),h[_++]=63&b|128)}return _}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&ey(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),Dh(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Dh(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var h=this.pos-l;h>=128&&ey(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,i,l){this.writeTag(s,wn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,Ih,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,Zd,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,kf,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,Af,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,Pf,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,Rf,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,ty,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,ny,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,ry,i)},writeBytesField:function(s,i){this.writeTag(s,wn.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,wn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,wn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,wn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,wn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,wn.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,wn.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,wn.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,wn.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,wn.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,Boolean(i))}};class Ff{constructor(i,{pixelRatio:l,version:h,stretchX:m,stretchY:_,content:b}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=m,this.stretchY=_,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class sy{constructor(i,l){const h={},m={};this.haveRenderCallbacks=[];const _=[];this.addImages(i,h,_),this.addImages(l,m,_);const{w:b,h:D}=oy(_),S=new bo({width:b||1,height:D||1});for(const T in i){const R=i[T],L=h[T].paddedRect;bo.copy(R.data,S,{x:0,y:0},{x:L.x+1,y:L.y+1},R.data)}for(const T in l){const R=l[T],L=m[T].paddedRect,B=L.x+1,U=L.y+1,j=R.data.width,Q=R.data.height;bo.copy(R.data,S,{x:0,y:0},{x:B,y:U},R.data),bo.copy(R.data,S,{x:0,y:Q-1},{x:B,y:U-1},{width:j,height:1}),bo.copy(R.data,S,{x:0,y:0},{x:B,y:U+Q},{width:j,height:1}),bo.copy(R.data,S,{x:j-1,y:0},{x:B-1,y:U},{width:1,height:Q}),bo.copy(R.data,S,{x:0,y:0},{x:B+j,y:U},{width:1,height:Q})}this.image=S,this.iconPositions=h,this.patternPositions=m}addImages(i,l,h){for(const m in i){const _=i[m],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};h.push(b),l[m]=new Ff(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),l)}patchUpdatedImage(i,l,h){if(!i||!l||i.version===l.version)return;i.version=l.version;const[m,_]=i.tl;h.update(l.data,void 0,{x:m,y:_})}}Xe("ImagePosition",Ff),Xe("ImageAtlas",sy),y.WritingMode=void 0,(Gs=y.WritingMode||(y.WritingMode={}))[Gs.none=0]="none",Gs[Gs.horizontal=1]="horizontal",Gs[Gs.vertical=2]="vertical",Gs[Gs.horizontalOnly=3]="horizontalOnly";class mc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const h=new mc;return h.scale=i||1,h.fontStack=l,h}static forImage(i){const l=new mc;return l.imageName=i,l}}class gc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const h=new gc;for(let m=0;m<i.sections.length;m++){const _=i.sections[m];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let h=0;h<i.length;h++){const m=i.charCodeAt(h+1)||null,_=i.charCodeAt(h-1)||null;l+=m&&Jc(m)&&!hc[i[h+1]]||_&&Jc(_)&&!hc[i[h-1]]||!hc[i[h]]?i[h]:hc[i[h]]}return l}(this.text)}trim(){let i=0;for(let h=0;h<this.text.length&&Th[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&Th[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new gc;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(mc.forText(i.scale,i.fontStack||l));const h=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(h)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void Un("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(mc.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Un("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mh(s,i,l,h,m,_,b,D,S,T,R,L,B,U,j,Q){const J=gc.fromFeature(s,m);let ce;L===y.WritingMode.vertical&&J.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:se}=Pi;if(fe&&1===J.sections.length){ce=[];const we=fe(J.toString(),Ph(J,T,_,i,h,U,j));for(const We of we){const Ye=new gc;Ye.text=We,Ye.sections=J.sections;for(let Ve=0;Ve<We.length;Ve++)Ye.sectionIndex.push(0);ce.push(Ye)}}else if(se){ce=[];const we=se(J.text,J.sectionIndex,Ph(J,T,_,i,h,U,j));for(const We of we){const Ye=new gc;Ye.text=We[0],Ye.sectionIndex=We[1],Ye.sections=J.sections,ce.push(Ye)}}else ce=function(we,We){const Ye=[],Ve=we.text;let Fe=0;for(const ke of We)Ye.push(we.substring(Fe,ke)),Fe=ke;return Fe<Ve.length&&Ye.push(we.substring(Fe,Ve.length)),Ye}(J,Ph(J,T,_,i,h,U,j));const de=[],De={positionedLines:de,text:J.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(we,We,Ye,Ve,Fe,ke,Ue,Ne,Te,it,nt,Tt){let Sn=0,Mn=-17,ar=0,no=0;const mn="right"===Ne?1:"left"===Ne?0:.5;let Wn=0;for(const Kn of Fe){Kn.trim();const Rr=Kn.getMaxScale(),Qr=24*(Rr-1),ei={positionedGlyphs:[],lineOffset:0};we.positionedLines[Wn]=ei;const _i=ei.positionedGlyphs;let li=0;if(!Kn.length()){Mn+=ke,++Wn;continue}for(let cr=0;cr<Kn.length();cr++){const Ot=Kn.getSection(cr),zi=Kn.getSectionIndex(cr),Fr=Kn.getCharCode(cr);let ti=0,Co=null,ci=null,Dr=null,Xs=24;const Do=!(Te===y.WritingMode.horizontal||!nt&&!sh(Fr)||nt&&(Th[Fr]||(lr=Fr,je.Arabic(lr)||je["Arabic Supplement"](lr)||je["Arabic Extended-A"](lr)||je["Arabic Presentation Forms-A"](lr)||je["Arabic Presentation Forms-B"](lr))));if(Ot.imageName){const Eo=Ve[Ot.imageName];if(!Eo)continue;Dr=Ot.imageName,we.iconsInText=we.iconsInText||!0,ci=Eo.paddedRect;const Bi=Eo.displaySize;Ot.scale=24*Ot.scale/Tt,Co={width:Bi[0],height:Bi[1],left:1,top:-3,advance:Do?Bi[1]:Bi[0]},ti=Qr+(24-Bi[1]*Ot.scale),Xs=Co.advance;const Cs=Do?Bi[0]*Ot.scale-24*Rr:Bi[1]*Ot.scale-24*Rr;Cs>0&&Cs>li&&(li=Cs)}else{const Eo=Ye[Ot.fontStack],Bi=Eo&&Eo[Fr];if(Bi&&Bi.rect)ci=Bi.rect,Co=Bi.metrics;else{const Cs=We[Ot.fontStack],jh=Cs&&Cs[Fr];if(!jh)continue;Co=jh.metrics}ti=24*(Rr-Ot.scale)}Do?(we.verticalizable=!0,_i.push({glyph:Fr,imageName:Dr,x:Sn,y:Mn+ti,vertical:Do,scale:Ot.scale,fontStack:Ot.fontStack,sectionIndex:zi,metrics:Co,rect:ci}),Sn+=Xs*Ot.scale+it):(_i.push({glyph:Fr,imageName:Dr,x:Sn,y:Mn+ti,vertical:Do,scale:Ot.scale,fontStack:Ot.fontStack,sectionIndex:zi,metrics:Co,rect:ci}),Sn+=Co.advance*Ot.scale+it)}0!==_i.length&&(ar=Math.max(Sn-it,ar),zx(_i,0,_i.length-1,mn,li)),Sn=0;const Vn=ke*Rr+li;ei.lineOffset=Math.max(li,Qr),Mn+=Vn,no=Math.max(Vn,no),++Wn}var lr;const gr=Mn- -17,{horizontalAlign:gn,verticalAlign:Cr}=Lf(Ue);(function(Kn,Rr,Qr,ei,_i,li,Vn,cr,Ot){const zi=(Rr-Qr)*_i;let Fr=0;Fr=li!==Vn?-cr*ei- -17:(-ei*Ot+.5)*Vn;for(const ti of Kn)for(const Co of ti.positionedGlyphs)Co.x+=zi,Co.y+=Fr})(we.positionedLines,mn,gn,Cr,ar,no,ke,gr,Fe.length),we.top+=-Cr*gr,we.bottom=we.top+gr,we.left+=-gn*ar,we.right=we.left+ar}(De,i,l,h,ce,b,D,S,L,T,B,Q),!function(we){for(const We of we)if(0!==We.positionedGlyphs.length)return!1;return!0}(de)&&De}const Th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ay={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ah(s,i,l,h,m,_){if(i.imageName){const b=h[i.imageName];return b?b.displaySize[0]*i.scale*24/_+m:0}{const b=l[i.fontStack],D=b&&b[s];return D?D.metrics.advance*i.scale+m:0}}function bs(s,i,l,h){const m=Math.pow(s-i,2);return h?s<i?m/2:2*m:m+Math.abs(l)*l}function Du(s,i,l){let h=0;return 10===s&&(h-=1e4),l&&(h+=150),40!==s&&65288!==s||(h+=50),41!==i&&65289!==i||(h+=50),h}function Kd(s,i,l,h,m,_){let b=null,D=bs(i,l,m,_);for(const S of h){const T=bs(i-S.x,l,m,_)+S.badness;T<=D&&(b=S,D=T)}return{index:s,x:i,priorBreak:b,badness:D}}function Jd(s){return s?Jd(s.priorBreak).concat(s.index):[]}function Ph(s,i,l,h,m,_,b){if("point"!==_)return[];if(!s)return[];const D=[],S=function(B,U,j,Q,J,ce){let fe=0;for(let se=0;se<B.length();se++){const de=B.getSection(se);fe+=Ah(B.getCharCode(se),de,Q,J,U,ce)}return fe/Math.max(1,Math.ceil(fe/j))}(s,i,l,h,m,b),T=s.text.indexOf("\u200b")>=0;let R=0;for(let B=0;B<s.length();B++){const U=s.getSection(B),j=s.getCharCode(B);if(Th[j]||(R+=Ah(j,U,h,m,i,b)),B<s.length()-1){const Q=!((L=j)<11904||!(je["Bopomofo Extended"](L)||je.Bopomofo(L)||je["CJK Compatibility Forms"](L)||je["CJK Compatibility Ideographs"](L)||je["CJK Compatibility"](L)||je["CJK Radicals Supplement"](L)||je["CJK Strokes"](L)||je["CJK Symbols and Punctuation"](L)||je["CJK Unified Ideographs Extension A"](L)||je["CJK Unified Ideographs"](L)||je["Enclosed CJK Letters and Months"](L)||je["Halfwidth and Fullwidth Forms"](L)||je.Hiragana(L)||je["Ideographic Description Characters"](L)||je["Kangxi Radicals"](L)||je["Katakana Phonetic Extensions"](L)||je.Katakana(L)||je["Vertical Forms"](L)||je["Yi Radicals"](L)||je["Yi Syllables"](L)));(ay[j]||Q||U.imageName)&&D.push(Kd(B+1,R,S,D,Du(j,s.getCharCode(B+1),Q&&T),!1))}}var L;return Jd(Kd(s.length(),R,S,D,0,!0))}function Lf(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function zx(s,i,l,h,m){if(!h&&!m)return;const _=s[l],b=(s[l].x+_.metrics.advance*_.scale)*h;for(let D=i;D<=l;D++)s[D].x-=b,s[D].y+=m}function Bx(s,i,l){const{horizontalAlign:h,verticalAlign:m}=Lf(l),_=i[0]-s.displaySize[0]*h,b=i[1]-s.displaySize[1]*m;return{image:s,top:b,bottom:b+s.displaySize[1],left:_,right:_+s.displaySize[0]}}function kh(s,i,l,h,m,_){const b=s.image;let D;if(b.content){const J=b.content,ce=b.pixelRatio||1;D=[J[0]/ce,J[1]/ce,b.displaySize[0]-J[2]/ce,b.displaySize[1]-J[3]/ce]}const S=i.left*_,T=i.right*_;let R,L,B,U;"width"===l||"both"===l?(U=m[0]+S-h[3],L=m[0]+T+h[1]):(U=m[0]+(S+T-b.displaySize[0])/2,L=U+b.displaySize[0]);const j=i.top*_,Q=i.bottom*_;return"height"===l||"both"===l?(R=m[1]+j-h[0],B=m[1]+Q+h[2]):(R=m[1]+(j+Q-b.displaySize[1])/2,B=R+b.displaySize[1]),{image:b,top:R,right:L,bottom:B,left:U,collisionPadding:D}}const Wo=128;function ly(s,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new Gt(s+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:m}=l;let _=0;for(;_<h.length&&h[_]<=s;)_++;_=Math.max(0,_-1);let b=_;for(;b<h.length&&h[b]<s+1;)b++;b=Math.min(h.length-1,b);const D=h[_],S=h[b];return"composite"===l.kind?{kind:"composite",minZoom:D,maxZoom:S,interpolationType:m}:{kind:"camera",minZoom:D,maxZoom:S,minSize:l.evaluate(new Gt(D)),maxSize:l.evaluate(new Gt(S)),interpolationType:m}}}class ml extends at{constructor(i,l,h,m){super(i,l),this.angle=h,void 0!==m&&(this.segment=m)}clone(){return new ml(this.x,this.y,this.angle,this.segment)}}function Yd(s,i,l,h,m){if(void 0===i.segment)return!0;let _=i,b=i.segment+1,D=0;for(;D>-l/2;){if(b--,b<0)return!1;D-=s[b].dist(_),_=s[b]}D+=s[b].dist(s[b+1]),b++;const S=[];let T=0;for(;D<l/2;){const R=s[b],L=s[b+1];if(!L)return!1;let B=s[b-1].angleTo(R)-R.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:D,angleDelta:B}),T+=B;D-S[0].distance>h;)T-=S.shift().angleDelta;if(T>m)return!1;b++,D+=R.dist(L)}return!0}function Of(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function Nf(s,i,l){return s?.6*i*l:0}function zf(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function cy(s,i,l,h,m,_){const b=Nf(l,m,_),D=zf(l,h)*_;let S=0;const T=Of(s)/2;for(let R=0;R<s.length-1;R++){const L=s[R],B=s[R+1],U=L.dist(B);if(S+U>T){const j=(T-S)/U,Q=Nn(L.x,B.x,j),J=Nn(L.y,B.y,j),ce=new ml(Q,J,B.angleTo(L),R);return ce._round(),!b||Yd(s,ce,D,b,i)?ce:void 0}S+=U}}function Bf(s,i,l,h,m,_,b,D,S){const T=Nf(h,_,b),R=zf(h,m),L=R*b,B=0===s[0].x||s[0].x===S||0===s[0].y||s[0].y===S;return i-L<i/4&&(i=L+i/4),Eu(s,B?i/2*D%i:(R/2+2*_)*b*D%i,i,T,l,L,B,!1,S)}function Eu(s,i,l,h,m,_,b,D,S){const T=_/2,R=Of(s);let L=0,B=i-l,U=[];for(let j=0;j<s.length-1;j++){const Q=s[j],J=s[j+1],ce=Q.dist(J),fe=J.angleTo(Q);for(;B+l<L+ce;){B+=l;const se=(B-L)/ce,de=Nn(Q.x,J.x,se),De=Nn(Q.y,J.y,se);if(de>=0&&de<S&&De>=0&&De<S&&B-T>=0&&B+T<=R){const we=new ml(de,De,fe,j);we._round(),h&&!Yd(s,we,_,h,m)||U.push(we)}}L+=ce}return D||U.length||b||(U=Eu(s,L/2,l,h,m,_,b,!0,S)),U}function Vf(s,i,l,h,m){const _=[];for(let b=0;b<s.length;b++){const D=s[b];let S;for(let T=0;T<D.length-1;T++){let R=D[T],L=D[T+1];R.x<i&&L.x<i||(R.x<i?R=new at(i,R.y+(i-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x<i&&(L=new at(i,R.y+(i-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y<l&&L.y<l||(R.y<l?R=new at(R.x+(l-R.y)/(L.y-R.y)*(L.x-R.x),l)._round():L.y<l&&(L=new at(R.x+(l-R.y)/(L.y-R.y)*(L.x-R.x),l)._round()),R.x>=h&&L.x>=h||(R.x>=h?R=new at(h,R.y+(h-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x>=h&&(L=new at(h,R.y+(h-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y>=m&&L.y>=m||(R.y>=m?R=new at(R.x+(m-R.y)/(L.y-R.y)*(L.x-R.x),m)._round():L.y>=m&&(L=new at(R.x+(m-R.y)/(L.y-R.y)*(L.x-R.x),m)._round()),S&&R.equals(S[S.length-1])||(S=[R],_.push(S)),S.push(L)))))}}return _}function Rh(s,i,l,h){const m=[],_=s.image,b=_.pixelRatio,D=_.paddedRect.w-2,S=_.paddedRect.h-2,T=s.right-s.left,R=s.bottom-s.top,L=_.stretchX||[[0,D]],B=_.stretchY||[[0,S]],U=(ke,Ue)=>ke+Ue[1]-Ue[0],j=L.reduce(U,0),Q=B.reduce(U,0),J=D-j,ce=S-Q;let fe=0,se=j,de=0,De=Q,we=0,We=J,Ye=0,Ve=ce;if(_.content&&h){const ke=_.content;fe=Fh(L,0,ke[0]),de=Fh(B,0,ke[1]),se=Fh(L,ke[0],ke[2]),De=Fh(B,ke[1],ke[3]),we=ke[0]-fe,Ye=ke[1]-de,We=ke[2]-ke[0]-se,Ve=ke[3]-ke[1]-De}const Fe=(ke,Ue,Ne,Te)=>{const it=Lh(ke.stretch-fe,se,T,s.left),nt=Oh(ke.fixed-we,We,ke.stretch,j),Tt=Lh(Ue.stretch-de,De,R,s.top),Sn=Oh(Ue.fixed-Ye,Ve,Ue.stretch,Q),Mn=Lh(Ne.stretch-fe,se,T,s.left),ar=Oh(Ne.fixed-we,We,Ne.stretch,j),no=Lh(Te.stretch-de,De,R,s.top),mn=Oh(Te.fixed-Ye,Ve,Te.stretch,Q),Wn=new at(it,Tt),lr=new at(Mn,Tt),gr=new at(Mn,no),gn=new at(it,no),Cr=new at(nt/b,Sn/b),Kn=new at(ar/b,mn/b),Rr=i*Math.PI/180;if(Rr){const _i=Math.sin(Rr),li=Math.cos(Rr),Vn=[li,-_i,_i,li];Wn._matMult(Vn),lr._matMult(Vn),gn._matMult(Vn),gr._matMult(Vn)}const Qr=ke.stretch+ke.fixed,ei=Ue.stretch+Ue.fixed;return{tl:Wn,tr:lr,bl:gn,br:gr,tex:{x:_.paddedRect.x+1+Qr,y:_.paddedRect.y+1+ei,w:Ne.stretch+Ne.fixed-Qr,h:Te.stretch+Te.fixed-ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cr,pixelOffsetBR:Kn,minFontScaleX:We/b/T,minFontScaleY:Ve/b/R,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){const ke=sr(L,J,j),Ue=sr(B,ce,Q);for(let Ne=0;Ne<ke.length-1;Ne++){const Te=ke[Ne],it=ke[Ne+1];for(let nt=0;nt<Ue.length-1;nt++)m.push(Fe(Te,Ue[nt],it,Ue[nt+1]))}}else m.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:S+1}));return m}function Fh(s,i,l){let h=0;for(const m of s)h+=Math.max(i,Math.min(l,m[1]))-Math.max(i,Math.min(l,m[0]));return h}function sr(s,i,l){const h=[{fixed:-1,stretch:0}];for(const[m,_]of s){const b=h[h.length-1];h.push({fixed:m-b.stretch,stretch:b.stretch}),h.push({fixed:m-b.stretch,stretch:b.stretch+(_-m)})}return h.push({fixed:i+1,stretch:l}),h}function Lh(s,i,l,h){return s/i*l+h}function Oh(s,i,l,h){return s-i*l/h}Xe("Anchor",ml);class Oa{constructor(i,l,h,m,_,b,D,S,T,R){if(this.boxStartIndex=i.length,T){let L=b.top,B=b.bottom;const U=b.collisionPadding;U&&(L-=U[1],B+=U[3]);let j=B-L;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let L=b.top*D-S[0],B=b.bottom*D+S[2],U=b.left*D-S[3],j=b.right*D+S[1];const Q=b.collisionPadding;if(Q&&(U-=Q[0]*D,L-=Q[1]*D,j+=Q[2]*D,B+=Q[3]*D),R){const J=new at(U,L),ce=new at(j,L),fe=new at(U,B),se=new at(j,B),de=R*Math.PI/180;J._rotate(de),ce._rotate(de),fe._rotate(de),se._rotate(de),U=Math.min(J.x,ce.x,fe.x,se.x),j=Math.max(J.x,ce.x,fe.x,se.x),L=Math.min(J.y,ce.y,fe.y,se.y),B=Math.max(J.y,ce.y,fe.y,se.y)}i.emplaceBack(l.x,l.y,U,L,j,B,h,m,_)}this.boxEndIndex=i.length}}class Uf{constructor(i=[],l=uy){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,m=l[i];for(;i>0;){const _=i-1>>1,b=l[_];if(h(m,b)>=0)break;l[i]=b,i=_}l[i]=m}_down(i){const{data:l,compare:h}=this,m=this.length>>1,_=l[i];for(;i<m;){let b=1+(i<<1),D=l[b];const S=b+1;if(S<this.length&&h(l[S],D)<0&&(b=S,D=l[S]),h(D,_)>=0)break;l[i]=D,i=b}l[i]=_}}function uy(s,i){return s<i?-1:s>i?1:0}function hy(s,i=1,l=!1){let h=1/0,m=1/0,_=-1/0,b=-1/0;const D=s[0];for(let U=0;U<D.length;U++){const j=D[U];(!U||j.x<h)&&(h=j.x),(!U||j.y<m)&&(m=j.y),(!U||j.x>_)&&(_=j.x),(!U||j.y>b)&&(b=j.y)}const S=Math.min(_-h,b-m);let T=S/2;const R=new Uf([],dy);if(0===S)return new at(h,m);for(let U=h;U<_;U+=S)for(let j=m;j<b;j+=S)R.push(new yc(U+T,j+T,T,s));let L=function(U){let j=0,Q=0,J=0;const ce=U[0];for(let fe=0,se=ce.length,de=se-1;fe<se;de=fe++){const De=ce[fe],we=ce[de],We=De.x*we.y-we.x*De.y;Q+=(De.x+we.x)*We,J+=(De.y+we.y)*We,j+=3*We}return new yc(Q/j,J/j,0,U)}(s),B=R.length;for(;R.length;){const U=R.pop();(U.d>L.d||!L.d)&&(L=U,l&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,B)),U.max-L.d<=i||(T=U.h/2,R.push(new yc(U.p.x-T,U.p.y-T,T,s)),R.push(new yc(U.p.x+T,U.p.y-T,T,s)),R.push(new yc(U.p.x-T,U.p.y+T,T,s)),R.push(new yc(U.p.x+T,U.p.y+T,T,s)),B+=4)}return l&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function dy(s,i){return i.max-s.max}function yc(s,i,l,h){this.p=new at(s,i),this.h=l,this.d=function(m,_){let b=!1,D=1/0;for(let S=0;S<_.length;S++){const T=_[S];for(let R=0,L=T.length,B=L-1;R<L;B=R++){const U=T[R],j=T[B];U.y>m.y!=j.y>m.y&&m.x<(j.x-U.x)*(m.y-U.y)/(j.y-U.y)+U.x&&(b=!b),D=Math.min(D,dh(m,U,j))}}return(b?1:-1)*Math.sqrt(D)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const Qd=Number.POSITIVE_INFINITY;function py(s,i){return i[1]!==Qd?function(l,h,m){let _=0,b=0;switch(h=Math.abs(h),m=Math.abs(m),l){case"top-right":case"top-left":case"top":b=m-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-m}switch(l){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,b]}(s,i[0],i[1]):function(l,h){let m=0,_=0;h<0&&(h=0);const b=h/Math.sqrt(2);switch(l){case"top-right":case"top-left":_=b-7;break;case"bottom-right":case"bottom-left":_=7-b;break;case"bottom":_=7-h;break;case"top":_=h-7}switch(l){case"top-right":case"bottom-right":m=-b;break;case"top-left":case"bottom-left":m=b;break;case"left":m=h;break;case"right":m=-h}return[m,_]}(s,i[0])}function jf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Iu(s,i,l,h,m,_,b,D,S,T,R){let L=_.textMaxSize.evaluate(i,{});void 0===L&&(L=b);const B=s.layers[0].layout,U=B.get("icon-offset").evaluate(i,{},R),j=tp(l.horizontal),Q=b/24,J=s.tilePixelRatio*Q,ce=s.tilePixelRatio*L/24,fe=s.tilePixelRatio*D,se=s.tilePixelRatio*B.get("symbol-spacing"),de=B.get("text-padding")*s.tilePixelRatio,De=function(Te,it,nt,Tt=1){const Sn=Te.get("icon-padding").evaluate(it,{},nt),Mn=Sn&&Sn.values;return[Mn[0]*Tt,Mn[1]*Tt,Mn[2]*Tt,Mn[3]*Tt]}(B,i,R,s.tilePixelRatio),we=B.get("text-max-angle")/180*Math.PI,We="viewport"!==B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ye="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ve=B.get("symbol-placement"),Fe=se/2,ke=B.get("icon-text-fit");let Ue;h&&"none"!==ke&&(s.allowVerticalPlacement&&l.vertical&&(Ue=kh(h,l.vertical,ke,B.get("icon-text-fit-padding"),U,Q)),j&&(h=kh(h,j,ke,B.get("icon-text-fit-padding"),U,Q)));const Ne=(Te,it)=>{it.x<0||it.x>=tr||it.y<0||it.y>=tr||function(nt,Tt,Sn,Mn,ar,no,mn,Wn,lr,gr,gn,Cr,Kn,Rr,Qr,ei,_i,li,Vn,cr,Ot,zi,Fr,ti,Co){const ci=nt.addToLineVertexArray(Tt,Sn);let Dr,Xs,Do,Eo,Bi=0,Cs=0,jh=0,vi=0,ku=-1,Ru=-1;const Ks={};let ap=fr.exports(""),lp=0,xl=0;if(void 0===Wn._unevaluatedLayout.getValue("text-radial-offset")?[lp,xl]=Wn.layout.get("text-offset").evaluate(Ot,{},ti).map(xi=>24*xi):(lp=24*Wn.layout.get("text-radial-offset").evaluate(Ot,{},ti),xl=Qd),nt.allowVerticalPlacement&&Mn.vertical){const xi=Wn.layout.get("text-rotate").evaluate(Ot,{},ti)+90;Do=new Oa(lr,Tt,gr,gn,Cr,Mn.vertical,Kn,Rr,Qr,xi),mn&&(Eo=new Oa(lr,Tt,gr,gn,Cr,mn,_i,li,Qr,xi))}if(ar){const xi=Wn.layout.get("icon-rotate").evaluate(Ot,{}),Ds="none"!==Wn.layout.get("icon-text-fit"),Fu=Rh(ar,xi,Fr,Ds),Lu=mn?Rh(mn,xi,Fr,Ds):void 0;Xs=new Oa(lr,Tt,gr,gn,Cr,ar,_i,li,!1,xi),Bi=4*Fu.length;const sm=nt.iconSizeData;let za=null;"source"===sm.kind?(za=[Wo*Wn.layout.get("icon-size").evaluate(Ot,{})],za[0]>ws&&Un(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===sm.kind&&(za=[Wo*zi.compositeIconSizes[0].evaluate(Ot,{},ti),Wo*zi.compositeIconSizes[1].evaluate(Ot,{},ti)],(za[0]>ws||za[1]>ws)&&Un(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,Fu,za,cr,Vn,Ot,y.WritingMode.none,Tt,ci.lineStartIndex,ci.lineLength,-1,ti),ku=nt.icon.placedSymbolArray.length-1,Lu&&(Cs=4*Lu.length,nt.addSymbols(nt.icon,Lu,za,cr,Vn,Ot,y.WritingMode.vertical,Tt,ci.lineStartIndex,ci.lineLength,-1,ti),Ru=nt.icon.placedSymbolArray.length-1)}const nm=Object.keys(Mn.horizontal);for(const xi of nm){const Ds=Mn.horizontal[xi];if(!Dr){ap=fr.exports(Ds.text);const Lu=Wn.layout.get("text-rotate").evaluate(Ot,{},ti);Dr=new Oa(lr,Tt,gr,gn,Cr,Ds,Kn,Rr,Qr,Lu)}const Fu=1===Ds.positionedLines.length;if(jh+=ep(nt,Tt,Ds,no,Wn,Qr,Ot,ei,ci,Mn.vertical?y.WritingMode.horizontal:y.WritingMode.horizontalOnly,Fu?nm:[xi],Ks,ku,zi,ti),Fu)break}Mn.vertical&&(vi+=ep(nt,Tt,Mn.vertical,no,Wn,Qr,Ot,ei,ci,y.WritingMode.vertical,["vertical"],Ks,Ru,zi,ti));const gy=Dr?Dr.boxStartIndex:nt.collisionBoxArray.length,cp=Dr?Dr.boxEndIndex:nt.collisionBoxArray.length,up=Do?Do.boxStartIndex:nt.collisionBoxArray.length,rm=Do?Do.boxEndIndex:nt.collisionBoxArray.length,jx=Xs?Xs.boxStartIndex:nt.collisionBoxArray.length,wc=Xs?Xs.boxEndIndex:nt.collisionBoxArray.length,hp=Eo?Eo.boxStartIndex:nt.collisionBoxArray.length,im=Eo?Eo.boxEndIndex:nt.collisionBoxArray.length;let Zo=-1;const Cc=(xi,Ds)=>xi&&xi.circleDiameter?Math.max(xi.circleDiameter,Ds):Ds;Zo=Cc(Dr,Zo),Zo=Cc(Do,Zo),Zo=Cc(Xs,Zo),Zo=Cc(Eo,Zo);const om=Zo>-1?1:0;om&&(Zo*=Co/24),nt.glyphOffsetArray.length>=gl.MAX_GLYPHS&&Un("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ot.sortKey&&nt.addToSortKeyRanges(nt.symbolInstances.length,Ot.sortKey),nt.symbolInstances.emplaceBack(Tt.x,Tt.y,Ks.right>=0?Ks.right:-1,Ks.center>=0?Ks.center:-1,Ks.left>=0?Ks.left:-1,Ks.vertical||-1,ku,Ru,ap,gy,cp,up,rm,jx,wc,hp,im,gr,jh,vi,Bi,Cs,om,0,Kn,lp,xl,Zo)}(s,it,Te,l,h,m,Ue,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,J,[de,de,de,de],We,S,fe,De,Ye,U,i,_,T,R,b)};if("line"===Ve)for(const Te of Vf(i.geometry,0,0,tr,tr)){const it=Bf(Te,se,we,l.vertical||j,h,24,ce,s.overscaling,tr);for(const nt of it){const Tt=j;Tt&&$f(s,Tt.text,Fe,nt)||Ne(Te,nt)}}else if("line-center"===Ve){for(const Te of i.geometry)if(Te.length>1){const it=cy(Te,we,l.vertical||j,h,24,ce);it&&Ne(Te,it)}}else if("Polygon"===i.type)for(const Te of zd(i.geometry,0)){const it=hy(Te,16);Ne(Te[0],new ml(it.x,it.y,0))}else if("LineString"===i.type)for(const Te of i.geometry)Ne(Te,new ml(Te[0].x,Te[0].y,0));else if("Point"===i.type)for(const Te of i.geometry)for(const it of Te)Ne([it],new ml(it.x,it.y,0))}const ws=32640;function ep(s,i,l,h,m,_,b,D,S,T,R,L,B,U,j){const Q=function(fe,se,de,De,we,We,Ye,Ve){const Fe=De.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,ke=[];for(const Ue of se.positionedLines)for(const Ne of Ue.positionedGlyphs){if(!Ne.rect)continue;const Te=Ne.rect||{};let it=4,nt=!0,Tt=1,Sn=0;const Mn=(we||Ve)&&Ne.vertical,ar=Ne.metrics.advance*Ne.scale/2;if(Ve&&se.verticalizable){const Vn=24*(Ne.scale-1),cr=(24-Ne.metrics.width*Ne.scale)/2;Sn=Ue.lineOffset/2-(Ne.imageName?-cr:Vn)}if(Ne.imageName){const Vn=Ye[Ne.imageName];nt=Vn.sdf,Tt=Vn.pixelRatio,it=1/Tt}const no=we?[Ne.x+ar,Ne.y]:[0,0];let mn=we?[0,0]:[Ne.x+ar+de[0],Ne.y+de[1]-Sn],Wn=[0,0];Mn&&(Wn=mn,mn=[0,0]);const lr=(Ne.metrics.left-it)*Ne.scale-ar+mn[0],gr=(-Ne.metrics.top-it)*Ne.scale+mn[1],gn=lr+Te.w*Ne.scale/Tt,Cr=gr+Te.h*Ne.scale/Tt,Kn=new at(lr,gr),Rr=new at(gn,gr),Qr=new at(lr,Cr),ei=new at(gn,Cr);if(Mn){const Vn=new at(-ar,ar- -17),cr=-Math.PI/2,Ot=12-ar,zi=new at(22-Ot,-(Ne.imageName?Ot:0)),Fr=new at(...Wn);Kn._rotateAround(cr,Vn)._add(zi)._add(Fr),Rr._rotateAround(cr,Vn)._add(zi)._add(Fr),Qr._rotateAround(cr,Vn)._add(zi)._add(Fr),ei._rotateAround(cr,Vn)._add(zi)._add(Fr)}if(Fe){const Vn=Math.sin(Fe),cr=Math.cos(Fe),Ot=[cr,-Vn,Vn,cr];Kn._matMult(Ot),Rr._matMult(Ot),Qr._matMult(Ot),ei._matMult(Ot)}const _i=new at(0,0),li=new at(0,0);ke.push({tl:Kn,tr:Rr,bl:Qr,br:ei,tex:Te,writingMode:se.writingMode,glyphOffset:no,sectionIndex:Ne.sectionIndex,isSDF:nt,pixelOffsetTL:_i,pixelOffsetBR:li,minFontScaleX:0,minFontScaleY:0})}return ke}(0,l,D,m,_,b,h,s.allowVerticalPlacement),J=s.textSizeData;let ce=null;"source"===J.kind?(ce=[Wo*m.layout.get("text-size").evaluate(b,{})],ce[0]>ws&&Un(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===J.kind&&(ce=[Wo*U.compositeTextSizes[0].evaluate(b,{},j),Wo*U.compositeTextSizes[1].evaluate(b,{},j)],(ce[0]>ws||ce[1]>ws)&&Un(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,Q,ce,D,_,b,T,i,S.lineStartIndex,S.lineLength,B,j);for(const fe of R)L[fe]=s.text.placedSymbolArray.length-1;return 4*Q.length}function tp(s){for(const i in s)return s[i];return null}function $f(s,i,l,h){const m=s.compareText;if(i in m){const _=m[i];for(let b=_.length-1;b>=0;b--)if(h.dist(_[b])<l)return!0}else m[i]=[];return m[i].push(h),!1}const fy=La.VectorTileFeature.types,Hf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Su(s,i,l,h,m,_,b,D,S,T,R,L,B){const U=D?Math.min(ws,Math.round(D[0])):0,j=D?Math.min(ws,Math.round(D[1])):0;s.emplaceBack(i,l,Math.round(32*h),Math.round(32*m),_,b,(U<<1)+(S?1:0),j,16*T,16*R,256*L,256*B)}function Mu(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function Vx(s){for(const i of s.sections)if(wd(i.text))return!0;return!1}class np{constructor(i){this.layoutVertexArray=new Ji,this.indexArray=new si,this.programConfigurations=i,this.segments=new kt,this.dynamicLayoutVertexArray=new ki,this.opacityVertexArray=new Yi,this.placedSymbolArray=new Se}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,h,m){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Xg.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Kg.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Hf,!0),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xe("SymbolBuffers",np);class Tu{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new kt,this.collisionVertexArray=new Ri}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Jg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Xe("CollisionBuffers",Tu);class gl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(b=>b.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ph([]),this.placementViewportMatrix=ph([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ly(this.zoom,l["text-size"]),this.iconSizeData=ly(this.zoom,l["icon-size"]);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap="never"!==vc(h,"text-overlap","text-allow-overlap")||"never"!==vc(h,"icon-overlap","icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&!m.isConstant(),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===h.get("symbol-placement")&&(this.writingModes=h.get("text-writing-mode").map(b=>y.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=i.sourceID}createArrays(){this.text=new np(new Aa(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new np(new Aa(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Re,this.lineVertexArray=new qe,this.symbolInstances=new He}calculateGlyphDependencies(i,l,h,m,_){for(let b=0;b<i.length;b++)if(l[i.charCodeAt(b)]=!0,(h||m)&&_){const D=hc[i.charAt(b)];D&&(l[D.charCodeAt(0)]=!0)}}populate(i,l,h){const m=this.layers[0],_=m.layout,b=_.get("text-font"),D=_.get("text-field"),S=_.get("icon-image"),T=("constant"!==D.value.kind||D.value.value instanceof ne&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),R="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!T&&!R)return;const B=l.iconDependencies,U=l.glyphDependencies,j=l.availableImages,Q=new Gt(this.zoom);for(const{feature:J,id:ce,index:fe,sourceLayerIndex:se}of i){const de=m._featureFilter.needGeometry,De=$s(J,de);if(!m._featureFilter.filter(Q,De,h))continue;let we,We;if(de||(De.geometry=xo(J)),T){const Ve=m.getValueAndResolveTokens("text-field",De,h,j),Fe=ne.factory(Ve);Vx(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===cl()||this.hasRTLText&&Pi.isParsed())&&(we=Yg(Fe,m,De))}if(R){const Ve=m.getValueAndResolveTokens("icon-image",De,h,j);We=Ve instanceof oe?Ve:oe.fromString(Ve)}if(!we&&!We)continue;const Ye=this.sortFeaturesByKey?L.evaluate(De,{},h):void 0;if(this.features.push({id:ce,text:we,icon:We,index:fe,sourceLayerIndex:se,geometry:De.geometry,properties:J.properties,type:fy[J.type],sortKey:Ye}),We&&(B[We.name]=!0),we){const Ve=b.evaluate(De,{},h).join(","),Fe="viewport"!==_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(y.WritingMode.vertical)>=0;for(const ke of we.sections)if(ke.image)B[ke.image.name]=!0;else{const Ue=Kc(we.toString()),Ne=ke.fontStack||Ve,Te=U[Ne]=U[Ne]||{};this.calculateGlyphDependencies(ke.text,Te,Fe,this.allowVerticalPlacement,Ue)}}}"line"===_.get("symbol-placement")&&(this.features=function(J){const ce={},fe={},se=[];let de=0;function De(Ve){se.push(J[Ve]),de++}function we(Ve,Fe,ke){const Ue=fe[Ve];return delete fe[Ve],fe[Fe]=Ue,se[Ue].geometry[0].pop(),se[Ue].geometry[0]=se[Ue].geometry[0].concat(ke[0]),Ue}function We(Ve,Fe,ke){const Ue=ce[Fe];return delete ce[Fe],ce[Ve]=Ue,se[Ue].geometry[0].shift(),se[Ue].geometry[0]=ke[0].concat(se[Ue].geometry[0]),Ue}function Ye(Ve,Fe,ke){const Ue=ke?Fe[0][Fe[0].length-1]:Fe[0][0];return`${Ve}:${Ue.x}:${Ue.y}`}for(let Ve=0;Ve<J.length;Ve++){const Fe=J[Ve],ke=Fe.geometry,Ue=Fe.text?Fe.text.toString():null;if(!Ue){De(Ve);continue}const Ne=Ye(Ue,ke),Te=Ye(Ue,ke,!0);if(Ne in fe&&Te in ce&&fe[Ne]!==ce[Te]){const it=We(Ne,Te,ke),nt=we(Ne,Te,se[it].geometry);delete ce[Ne],delete fe[Te],fe[Ye(Ue,se[nt].geometry,!0)]=nt,se[it].geometry=null}else Ne in fe?we(Ne,Te,ke):Te in ce?We(Ne,Te,ke):(De(Ve),ce[Ne]=de-1,fe[Te]=de-1)}return se.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ce)=>J.sortKey-ce.sortKey)}update(i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(void 0!==i.segment){let m=i.dist(l[i.segment+1]),_=i.dist(l[i.segment]);const b={};for(let D=i.segment+1;D<l.length;D++)b[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:m},D<l.length-1&&(m+=l[D+1].dist(l[D]));for(let D=i.segment||0;D>=0;D--)b[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:_},D>0&&(_+=l[D-1].dist(l[D]));for(let D=0;D<l.length;D++){const S=b[D];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,m,_,b,D,S,T,R,L,B){const U=i.indexArray,j=i.layoutVertexArray,Q=i.segments.prepareSegment(4*l.length,j,U,this.canOverlap?b.sortKey:void 0),J=this.glyphOffsetArray.length,ce=Q.vertexLength,fe=this.allowVerticalPlacement&&D===y.WritingMode.vertical?Math.PI/2:0,se=b.text&&b.text.sections;for(let de=0;de<l.length;de++){const{tl:De,tr:we,bl:We,br:Ye,tex:Ve,pixelOffsetTL:Fe,pixelOffsetBR:ke,minFontScaleX:Ue,minFontScaleY:Ne,glyphOffset:Te,isSDF:it,sectionIndex:nt}=l[de],Tt=Q.vertexLength,Sn=Te[1];Su(j,S.x,S.y,De.x,Sn+De.y,Ve.x,Ve.y,h,it,Fe.x,Fe.y,Ue,Ne),Su(j,S.x,S.y,we.x,Sn+we.y,Ve.x+Ve.w,Ve.y,h,it,ke.x,Fe.y,Ue,Ne),Su(j,S.x,S.y,We.x,Sn+We.y,Ve.x,Ve.y+Ve.h,h,it,Fe.x,ke.y,Ue,Ne),Su(j,S.x,S.y,Ye.x,Sn+Ye.y,Ve.x+Ve.w,Ve.y+Ve.h,h,it,ke.x,ke.y,Ue,Ne),Mu(i.dynamicLayoutVertexArray,S,fe),U.emplaceBack(Tt,Tt+1,Tt+2),U.emplaceBack(Tt+1,Tt+2,Tt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),de!==l.length-1&&nt===l[de+1].sectionIndex||i.programConfigurations.populatePaintArrays(j.length,b,b.index,{},B,se&&se[nt])}i.placedSymbolArray.emplaceBack(S.x,S.y,J,this.glyphOffsetArray.length-J,ce,T,R,S.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],D,0,!1,0,L)}_addCollisionDebugVertex(i,l,h,m,_,b){return l.emplaceBack(0,0),i.emplaceBack(h.x,h.y,m,_,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(i,l,h,m,_,b,D){const S=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),T=S.vertexLength,R=_.layoutVertexArray,L=_.collisionVertexArray,B=D.anchorX,U=D.anchorY;this._addCollisionDebugVertex(R,L,b,B,U,new at(i,l)),this._addCollisionDebugVertex(R,L,b,B,U,new at(h,l)),this._addCollisionDebugVertex(R,L,b,B,U,new at(h,m)),this._addCollisionDebugVertex(R,L,b,B,U,new at(i,m)),S.vertexLength+=4;const j=_.indexArray;j.emplaceBack(T,T+1),j.emplaceBack(T+1,T+2),j.emplaceBack(T+2,T+3),j.emplaceBack(T+3,T),S.primitiveLength+=4}addDebugCollisionBoxes(i,l,h,m){for(let _=i;_<l;_++){const b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,m?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tu(_o,wu.members,$n),this.iconCollisionBox=new Tu(_o,wu.members,$n);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,h,m,_,b,D,S,T){const R={};for(let L=l;L<h;L++){const B=i.get(L);R.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.textFeatureIndex=B.featureIndex;break}for(let L=m;L<_;L++){const B=i.get(L);R.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalTextFeatureIndex=B.featureIndex;break}for(let L=b;L<D;L++){const B=i.get(L);R.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.iconFeatureIndex=B.featureIndex;break}for(let L=S;L<T;L++){const B=i.get(L);R.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalIconFeatureIndex=B.featureIndex;break}return R}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),m=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<m;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),m=[],_=[],b=[];for(let D=0;D<this.symbolInstances.length;++D){b.push(D);const S=this.symbolInstances.get(D);m.push(0|Math.round(l*S.anchorX+h*S.anchorY)),_.push(S.featureIndex)}return b.sort((D,S)=>m[D]-m[S]||_[S]-_[D]),b}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((m,_,b)=>{m>=0&&b.indexOf(m)===_&&this.addIndicesForPlacedSymbol(this.text,m)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xe("SymbolBucket",gl,{omit:["layers","collisionBoxArray","features","compareText"]}),gl.MAX_GLYPHS=65535,gl.addDynamicAttributes=Mu;const Gf=new bn({"symbol-placement":new Je(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Je(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Je(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new et(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Je(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Je(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Je(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Je(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Je(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Je(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new et(ve.layout_symbol["icon-size"]),"icon-text-fit":new Je(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Je(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new et(ve.layout_symbol["icon-image"]),"icon-rotate":new et(ve.layout_symbol["icon-rotate"]),"icon-padding":new et(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Je(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new et(ve.layout_symbol["icon-offset"]),"icon-anchor":new et(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Je(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Je(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Je(ve.layout_symbol["text-rotation-alignment"]),"text-field":new et(ve.layout_symbol["text-field"]),"text-font":new et(ve.layout_symbol["text-font"]),"text-size":new et(ve.layout_symbol["text-size"]),"text-max-width":new et(ve.layout_symbol["text-max-width"]),"text-line-height":new Je(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new et(ve.layout_symbol["text-letter-spacing"]),"text-justify":new et(ve.layout_symbol["text-justify"]),"text-radial-offset":new et(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Je(ve.layout_symbol["text-variable-anchor"]),"text-anchor":new et(ve.layout_symbol["text-anchor"]),"text-max-angle":new Je(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Je(ve.layout_symbol["text-writing-mode"]),"text-rotate":new et(ve.layout_symbol["text-rotate"]),"text-padding":new Je(ve.layout_symbol["text-padding"]),"text-keep-upright":new Je(ve.layout_symbol["text-keep-upright"]),"text-transform":new et(ve.layout_symbol["text-transform"]),"text-offset":new et(ve.layout_symbol["text-offset"]),"text-allow-overlap":new Je(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new Je(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new Je(ve.layout_symbol["text-ignore-placement"]),"text-optional":new Je(ve.layout_symbol["text-optional"])});var Zs={paint:new bn({"icon-opacity":new et(ve.paint_symbol["icon-opacity"]),"icon-color":new et(ve.paint_symbol["icon-color"]),"icon-halo-color":new et(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new et(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new et(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Je(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Je(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new et(ve.paint_symbol["text-opacity"]),"text-color":new et(ve.paint_symbol["text-color"],{runtimeType:hr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new et(ve.paint_symbol["text-halo-color"]),"text-halo-width":new et(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new et(ve.paint_symbol["text-halo-blur"]),"text-translate":new Je(ve.paint_symbol["text-translate"]),"text-translate-anchor":new Je(ve.paint_symbol["text-translate-anchor"])}),layout:Gf};class qf{constructor(i){if(void 0===i.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:ks,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xe("FormatSectionOverride",qf,{omit:["defaultValue"]});class _c extends yi{constructor(i){super(i,Zs)}recalculate(i,l){if(super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const _ of h)m.indexOf(_)<0&&m.push(_);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,h,m){const _=this.layout.get(i).evaluate(l,{},h,m),b=this._unevaluatedLayout._values[i];return b.isDataDriven()||vr(b.value)||!_?_:(D=l.properties,_.replace(/{([^{}]+)}/g,(T,R)=>R in D?String(D[R]):""));var D}createBucket(i){return new gl(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Zs.paint.overridableProperties){if(!_c.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new qf(l),m=new Bo(h,l.property.specification);let _=null;_="constant"===l.value.kind||"source"===l.value.kind?new Ge("source",m):new St("composite",m,l.value.zoomStops),this.paint._values[i]=new yo(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&_c.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),m=Zs.paint.properties[l];let _=!1;const b=D=>{for(const S of D)if(m.overrides&&m.overrides.hasOverride(S))return void(_=!0)};if("constant"===h.value.kind&&h.value.value instanceof ne)b(h.value.value.sections);else if("source"===h.value.kind){const D=T=>{_||(T instanceof Qe&&ge(T.value)===dr?b(T.value.sections):T instanceof Wc?b(T.sections):T.eachChild(D))},S=h.value;S._styleExpression&&D(S._styleExpression.expression)}return _}}function vc(s,i,l){let h="never";const m=s.get(i);return m?h=m:s.get(l)&&(h="always"),h}var my={paint:new bn({"background-color":new Je(ve.paint_background["background-color"]),"background-pattern":new ul(ve.paint_background["background-pattern"]),"background-opacity":new Je(ve.paint_background["background-opacity"])})},rp={paint:new bn({"raster-opacity":new Je(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new Je(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Je(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Je(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Je(ve.paint_raster["raster-saturation"]),"raster-contrast":new Je(ve.paint_raster["raster-contrast"]),"raster-resampling":new Je(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Je(ve.paint_raster["raster-fade-duration"])})};class Nh extends yi{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Na={circle:class extends yi{constructor(s){super(s,Ng)}createBucket(s){return new _f(s)}queryRadius(s){const i=s;return ic("circle-radius",this,i)+ic("circle-stroke-width",this,i)+ou(this.paint.get("circle-translate"))}queryIntersectsFeature(s,i,l,h,m,_,b,D){const S=su(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,b),T=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l),R="map"===this.paint.get("circle-pitch-alignment"),L=R?S:(j=D,S.map(Q=>oc(Q,j))),B=R?T*b:T;var j;for(const U of h)for(const j of U){const Q=R?j:oc(j,D);let J=B;const ce=mh([],[j.x,j.y,0,1],D);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?J*=ce[3]/_.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(J*=_.cameraToCenterDistance/ce[3]),vf(L,Q,J))return!0}return!1}},heatmap:class extends yi{constructor(s){super(s,sc),this._updateColorRamp()}createBucket(s){return new dl(s)}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends yi{constructor(s){super(s,dt)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends yi{constructor(s){super(s,Lx)}recalculate(s,i){super.recalculate(s,i);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new du(s)}queryRadius(){return ou(this.paint.get("fill-translate"))}queryIntersectsFeature(s,i,l,h,m,_,b){return xf(su(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,b),h)}isTileClipped(){return!0}},"fill-extrusion":class extends yi{constructor(s){super(s,vu)}createBucket(s){return new yu(s)}queryRadius(){return ou(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,i,l,h,m,_,b,D){const S=su(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,b),T=this.paint.get("fill-extrusion-height").evaluate(i,l),R=this.paint.get("fill-extrusion-base").evaluate(i,l),L=function(U,j,Q,J){const ce=[];for(const fe of U){const se=[fe.x,fe.y,0,1];mh(se,se,j),ce.push(new at(se[0]/se[3],se[1]/se[3]))}return ce}(S,D),B=function(U,j,Q,J){const ce=[],fe=[],se=J[8]*j,de=J[9]*j,De=J[10]*j,we=J[11]*j,We=J[8]*Q,Ye=J[9]*Q,Ve=J[10]*Q,Fe=J[11]*Q;for(const ke of U){const Ue=[],Ne=[];for(const Te of ke){const it=Te.x,nt=Te.y,Tt=J[0]*it+J[4]*nt+J[12],Sn=J[1]*it+J[5]*nt+J[13],Mn=J[2]*it+J[6]*nt+J[14],ar=J[3]*it+J[7]*nt+J[15],no=Mn+De,mn=ar+we,Wn=Tt+We,lr=Sn+Ye,gr=Mn+Ve,gn=ar+Fe,Cr=new at((Tt+se)/mn,(Sn+de)/mn);Cr.z=no/mn,Ue.push(Cr);const Kn=new at(Wn/gn,lr/gn);Kn.z=gr/gn,Ne.push(Kn)}ce.push(Ue),fe.push(Ne)}return[ce,fe]}(h,R,T,D);return function(U,j,Q){let J=1/0;xf(Q,j)&&(J=Gd(Q,j[0]));for(let ce=0;ce<j.length;ce++){const fe=j[ce],se=U[ce];for(let de=0;de<fe.length-1;de++){const De=fe[de],we=[De,fe[de+1],se[de+1],se[de],De];Id(Q,we)&&(J=Math.min(J,Gd(Q,we)))}}return J!==1/0&&J}(B[0],B[1],L)}},line:class extends yi{constructor(s){super(s,Wd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){"line-gradient"===s&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof di,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,i){super.recalculate(s,i),this.paint._values["line-floorwidth"]=Mf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new qd(s)}queryRadius(s){const i=s,l=Zg(ic("line-width",this,i),ic("line-gap-width",this,i)),h=ic("line-offset",this,i);return l/2+Math.abs(h)+ou(this.paint.get("line-translate"))}queryIntersectsFeature(s,i,l,h,m,_,b){const D=su(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,b),S=b/2*Zg(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),T=this.paint.get("line-offset").evaluate(i,l);return T&&(h=function(R,L){const B=[];for(let U=0;U<R.length;U++){const j=R[U],Q=[];for(let J=0;J<j.length;J++){const ce=j[J-1],fe=j[J],se=j[J+1],de=0===J?new at(0,0):fe.sub(ce)._unit()._perp(),De=J===j.length-1?new at(0,0):se.sub(fe)._unit()._perp(),we=de._add(De)._unit(),We=we.x*De.x+we.y*De.y;0!==We&&we._mult(1/We),Q.push(we._mult(L)._add(fe))}B.push(Q)}return B}(h,T*b)),function(R,L,B){for(let U=0;U<L.length;U++){const j=L[U];if(R.length>=3)for(let Q=0;Q<j.length;Q++)if(Hs(R,j[Q]))return!0;if(_s(R,j,B))return!0}return!1}(D,h,S)}isTileClipped(){return!0}},symbol:_c,background:class extends yi{constructor(s){super(s,my)}},raster:class extends yi{constructor(s){super(s,rp)}}};class Wf{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const zh=6371008.8;class qn{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qn(Mo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,m=i.lat*l,_=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((i.lng-this.lng)*l);return zh*Math.acos(Math.min(_,1))}toBounds(i=0){const l=360*i/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new yl(new qn(this.lng-h,this.lat-l),new qn(this.lng+h,this.lat+l))}static convert(i){if(i instanceof qn)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new qn(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new qn(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class yl{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof qn?new qn(i.lng,i.lat):qn.convert(i),this}setSouthWest(i){return this._sw=i instanceof qn?new qn(i.lng,i.lat):qn.convert(i),this}extend(i){const l=this._sw,h=this._ne;let m,_;if(i instanceof qn)m=i,_=i;else{if(!(i instanceof yl))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(yl.convert(i)):this.extend(qn.convert(i)):this;if(m=i._sw,_=i._ne,!m||!_)return this}return l||h?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new qn(m.lng,m.lat),this._ne=new qn(_.lng,_.lat)),this}getCenter(){return new qn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qn(this.getWest(),this.getNorth())}getSouthEast(){return new qn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:h}=qn.convert(i);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}static convert(i){return i instanceof yl?i:i&&new yl(i)}}const ip=2*Math.PI*zh;function _l(s){return ip*Math.cos(s*Math.PI/180)}function Zf(s){return(180+s)/360}function Xf(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Kf(s,i){return s/_l(i)}function op(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class xc{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=qn.convert(i);return new xc(Zf(h.lng),Xf(h.lat),Kf(l,h.lat))}toLngLat(){return new qn(360*this.x-180,op(this.y))}toAltitude(){return this.z*_l(op(this.y))}meterInMercatorCoordinateUnits(){return 1/ip*(i=op(this.y),1/Math.cos(i*Math.PI/180));var i}}function Jf(s,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class Bh{constructor(i,l,h){if(i<0||i>25||h<0||h>=Math.pow(2,i)||l<0||l>=Math.pow(2,i))throw new Error(`x=${l}, y=${h}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=h,this.key=Vh(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,h){const m=(b=this.y,D=this.z,S=Jf(256*(_=this.x),256*(b=Math.pow(2,D)-b-1),D),T=Jf(256*(_+1),256*(b+1),D),S[0]+","+S[1]+","+T[0]+","+T[1]);var _,b,D,S,T;const R=function(L,B,U){let j,Q="";for(let J=L;J>0;J--)j=1<<J-1,Q+=(B&j?1:0)+(U&j?2:0);return Q}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,m)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new at((i.x*l-this.x)*tr,(i.y*l-this.y)*tr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yf{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Vh(i,l.z,l.z,l.x,l.y)}}class Oi{constructor(i,l,h,m,_){if(i<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${h}`);this.overscaledZ=i,this.wrap=l,this.canonical=new Bh(h,+m,+_),this.key=Vh(l,i,h,m,_)}clone(){return new Oi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new Oi(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oi(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-i;return i>this.canonical.z?Vh(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Vh(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Oi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new Oi(l,this.wrap,l,h,m),new Oi(l,this.wrap,l,h+1,m),new Oi(l,this.wrap,l,h,m+1),new Oi(l,this.wrap,l,h+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Oi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Oi(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new xc(i.x-this.wrap,i.y))}}function Vh(s,i,l,h,m){(s*=2)<0&&(s=-1*s-1);const _=1<<l;return(_*_*s+_*m+h).toString(36)+l.toString(36)+i.toString(36)}Xe("CanonicalTileID",Bh),Xe("OverscaledTileID",Oi,{omit:["posMatrix"]});class Qf{constructor(i,l,h){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return void Un(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const m=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=h||"mapbox";for(let _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let _=0;_<m;_++)for(let b=0;b<m;b++){const D=this.get(_,b);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(i,l){const h=new Uint8Array(this.data.buffer),m=4*this._idx(i,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[m],h[m+1],h[m+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,h){return(256*i*256+256*l+h)/10-1e4}_unpackTerrarium(i,l,h){return 256*i+l+h/256-32768}getPixels(){return new bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,_=l*this.dim+this.dim,b=h*this.dim,D=h*this.dim+this.dim;switch(l){case-1:m=_-1;break;case 1:_=m+1}switch(h){case-1:b=D-1;break;case 1:D=b+1}const S=-l*this.dim,T=-h*this.dim;for(let R=b;R<D;R++)for(let L=m;L<_;L++)this.data[this._idx(L,R)]=i.data[this._idx(L+S,R+T)]}}Xe("DEMData",Qf);class bc{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class em{constructor(i,l,h,m,_){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=h,i._y=m,this.properties=i.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(i[l]=this[l]);return i}}class vl{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Wl(tr,16,0),this.grid3D=new Wl(tr,16,0),this.featureIndexArray=new Dt,this.promoteId=l}insert(i,l,h,m,_,b){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,_);const S=b?this.grid3D:this.grid;for(let T=0;T<l.length;T++){const R=l[T],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const U=R[B];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}L[0]<tr&&L[1]<tr&&L[2]>=0&&L[3]>=0&&S.insert(D,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new La.VectorTile(new Ch(this.rawTileData)).layers,this.sourceLayerCoder=new bc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,h,m){this.loadVTLayers();const _=i.params||{},b=tr/i.tileSize/i.scale,D=Da(_.filter),S=i.queryGeometry,T=i.queryPadding*b,R=tm(S),L=this.grid.query(R.minX-T,R.minY-T,R.maxX+T,R.maxY+T),B=tm(i.cameraQueryGeometry),U=this.grid3D.query(B.minX-T,B.minY-T,B.maxX+T,B.maxY+T,(J,ce,fe,se)=>function(de,De,we,We,Ye){for(const Fe of de)if(De<=Fe.x&&we<=Fe.y&&We>=Fe.x&&Ye>=Fe.y)return!0;const Ve=[new at(De,we),new at(De,Ye),new at(We,Ye),new at(We,we)];if(de.length>2)for(const Fe of Ve)if(Hs(de,Fe))return!0;for(let Fe=0;Fe<de.length-1;Fe++)if(Og(de[Fe],de[Fe+1],Ve))return!0;return!1}(i.cameraQueryGeometry,J-T,ce-T,fe+T,se+T));for(const J of U)L.push(J);L.sort(Ux);const j={};let Q;for(let J=0;J<L.length;J++){const ce=L[J];if(ce===Q)continue;Q=ce;const fe=this.featureIndexArray.get(ce);let se=null;this.loadMatchingFeature(j,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,D,_.layers,_.availableImages,l,h,m,(de,De,we)=>(se||(se=xo(de)),De.queryIntersectsFeature(S,de,we,se,this.z,i.transform,b,i.pixelPosMatrix)))}return j}loadMatchingFeature(i,l,h,m,_,b,D,S,T,R,L){const B=this.bucketLayerIDs[l];if(b&&!function(J,ce){for(let fe=0;fe<J.length;fe++)if(ce.indexOf(J[fe])>=0)return!0;return!1}(b,B))return;const U=this.sourceLayerCoder.decode(h),j=this.vtLayers[U].feature(m);if(_.needGeometry){const J=$s(j,!0);if(!_.filter(new Gt(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!_.filter(new Gt(this.tileID.overscaledZ),j))return;const Q=this.getId(j,U);for(let J=0;J<B.length;J++){const ce=B[J];if(b&&b.indexOf(ce)<0)continue;const fe=S[ce];if(!fe)continue;let se={};Q&&R&&(se=R.getState(fe.sourceLayer||"_geojsonTileLayer",Q));const de=wi({},T[ce]);de.paint=Ni(de.paint,fe.paint,j,se,D),de.layout=Ni(de.layout,fe.layout,j,se,D);const De=!L||L(j,fe,se);if(!De)continue;const we=new em(j,this.z,this.x,this.y,Q);we.layer=de;let We=i[ce];void 0===We&&(We=i[ce]=[]),We.push({featureIndex:m,feature:we,intersectionZ:De})}}lookupSymbolFeatures(i,l,h,m,_,b,D,S){const T={};this.loadVTLayers();const R=Da(_);for(const L of i)this.loadMatchingFeature(T,h,m,L,R,b,D,S,l);return T}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){let h=i.id;return this.promoteId&&(h=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof h&&(h=Number(h))),h}}function Ni(s,i,l,h,m){return Wa(s,(_,b)=>{const D=i instanceof Ql?i.get(b):null;return D&&D.evaluate?D.evaluate(l,h,m):D})}function tm(s){let i=1/0,l=1/0,h=-1/0,m=-1/0;for(const _ of s)i=Math.min(i,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),m=Math.max(m,_.y);return{minX:i,minY:l,maxX:h,maxY:m}}function Ux(s,i){return i-s}var Uh;Xe("FeatureIndex",vl,{omit:["rawTileData","sourceLayerCoder"]}),y.PerformanceMarkers=void 0,(Uh=y.PerformanceMarkers||(y.PerformanceMarkers={})).create="create",Uh.load="load",Uh.fullLoad="fullLoad";let wo=null,Au=[];const sp=1e3/30,Pu={mark(s){performance.mark(s)},frame(s){const i=s;null!=wo&&Au.push(i-wo),wo=i},clearMetrics(){wo=null,Au=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const s in y.PerformanceMarkers)performance.clearMarks(y.PerformanceMarkers[s])},getPerformanceMetrics(){performance.measure("loadTime",y.PerformanceMarkers.create,y.PerformanceMarkers.load),performance.measure("fullLoadTime",y.PerformanceMarkers.create,y.PerformanceMarkers.fullLoad);const s=performance.getEntriesByName("loadTime")[0].duration,i=performance.getEntriesByName("fullLoadTime")[0].duration,l=Au.length,h=1/(Au.reduce((_,b)=>_+b,0)/l/1e3),m=Au.filter(_=>_>sp).reduce((_,b)=>_+(b-sp)/sp,0);return{loadTime:s,fullLoadTime:i,fps:h,percentDroppedFrames:m/(l+m)*100}}};y.AJAXError=Ii,y.ARRAY_TYPE=mr,y.Actor=class{constructor(s,i,l){this.target=s,this.parent=i,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ll(["receive","process"],this),this.invoker=new Wf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ci()?s:window}send(s,i,l,h,m=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[_]=l);const b=ca(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:s,hasCallback:!!l,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:Ia(i,b)},b),{cancel:()=>{l&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const i=s.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){delete this.tasks[l];const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h()}else Ci()||i.mustQueue?(this.tasks[l]=i,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,i)}process(){if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){if("<response>"===i.type){const l=this.callbacks[s];delete this.callbacks[s],l&&(i.error?l(Vs(i.error)):l(null,Vs(i.data)))}else{let l=!1;const h=ca(this.globalScope)?void 0:[],m=i.hasCallback?(D,S)=>{l=!0,delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:D?Ia(D):null,data:Ia(S,h)},h)}:D=>{l=!0};let _=null;const b=Vs(i.data);if(this.parent[i.type])_=this.parent[i.type](i.sourceMapId,b,m);else if(this.parent.getWorkerSource){const D=i.type.split(".");_=this.parent.getWorkerSource(i.sourceMapId,D[0],b.source)[D[1]](b,m)}else m(new Error(`Could not find function ${i.type}`));!l&&_&&_.cancel&&(this.cancelCallbacks[s]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},y.AlphaImage=xs,y.CanonicalTileID=Bh,y.CollisionBoxArray=_e,y.CollisionCircleLayoutArray=class extends F{},y.Color=$,y.DEMData=Qf,y.DataConstantProperty=Je,y.DictionaryCoder=bc,y.EXTENT=tr,y.ErrorEvent=Ka,y.EvaluationParameters=Gt,y.Event=ts,y.Evented=ns,y.FeatureIndex=vl,y.FillBucket=du,y.FillExtrusionBucket=yu,y.GeoJSONFeature=em,y.ImageAtlas=sy,y.ImagePosition=Ff,y.LineBucket=qd,y.LineStripIndexArray=class extends K{},y.LngLat=qn,y.LngLatBounds=yl,y.MercatorCoordinate=xc,y.ONE_EM=24,y.OverscaledTileID=Oi,y.PerformanceUtils=Pu,y.PosArray=rt,y.Properties=bn,y.QuadTriangleArray=class extends V{},y.RGBAImage=bo,y.RasterBoundsArray=class extends f{},y.RequestPerformance=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return 0===s.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},y.ResourceType=qi,y.SegmentVector=kt,y.SymbolBucket=gl,y.Transitionable=Yl,y.TriangleIndexArray=si,y.Uniform1f=eo,y.Uniform1i=class extends ai{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},y.Uniform2f=class extends ai{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},y.Uniform3f=class extends ai{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},y.Uniform4f=nc,y.UniformColor=gf,y.UniformMatrix4f=class extends ai{constructor(s,i){super(s,i),this.current=Qc}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},y.UnwrappedTileID=Yf,y.ValidationError=Oe,y.ZoomHistory=ih,y.add=function(s,i,l){return s[0]=i[0]+l[0],s[1]=i[1]+l[1],s[2]=i[2]+l[2],s},y.addDynamicAttributes=Mu,y.asyncAll=function(s,i,l){if(!s.length)return l(null,[]);let h=s.length;const m=new Array(s.length);let _=null;s.forEach((b,D)=>{i(b,(S,T)=>{S&&(_=S),m[D]=T,0==--h&&l(_,m)})})},y.bezier=ao,y.bindAll=Ll,y.cacheEntryPossiblyAdded=function(s){rr++,rr>ha&&(s.getActor().send("enforceCacheSizeLimit",ua),rr=0)},y.clamp=xe,y.clearTileCache=function(s){const i=caches.delete(Ei);s&&i.catch(s).then(()=>s())},y.clipLine=Vf,y.clone=function(s){var i=new mr(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},y.clone$1=Vr,y.clone$2=function(s){var i=new mr(3);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i},y.collisionCircleLayout=Tf,y.config=Po,y.copy=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},y.create=function(){var s=new mr(16);return mr!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},y.create$1=wf,y.createExpression=Ar,y.createFilter=Da,y.createLayout=Gn,y.createStyleLayer=function(s){return"custom"===s.type?new Nh(s):new Na[s.type](s)},y.cross=function(s,i,l){var h=i[0],m=i[1],_=i[2],b=l[0],D=l[1],S=l[2];return s[0]=m*S-_*D,s[1]=_*b-h*S,s[2]=h*D-m*b,s},y.dot=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]},y.dot$1=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},y.ease=Xt,y.emitValidationErrors=Xc,y.enforceCacheSizeLimit=function(s){da(),on&&on.then(i=>{i.keys().then(l=>{for(let h=0;h<l.length-s;h++)i.delete(l[h])})})},y.equals=function(s,i){var l=s[0],h=s[1],m=s[2],_=s[3],b=s[4],D=s[5],S=s[6],T=s[7],R=s[8],L=s[9],B=s[10],U=s[11],j=s[12],Q=s[13],J=s[14],ce=s[15],fe=i[0],se=i[1],de=i[2],De=i[3],we=i[4],We=i[5],Ye=i[6],Ve=i[7],Fe=i[8],ke=i[9],Ue=i[10],Ne=i[11],Te=i[12],it=i[13],nt=i[14],Tt=i[15];return Math.abs(l-fe)<=br*Math.max(1,Math.abs(l),Math.abs(fe))&&Math.abs(h-se)<=br*Math.max(1,Math.abs(h),Math.abs(se))&&Math.abs(m-de)<=br*Math.max(1,Math.abs(m),Math.abs(de))&&Math.abs(_-De)<=br*Math.max(1,Math.abs(_),Math.abs(De))&&Math.abs(b-we)<=br*Math.max(1,Math.abs(b),Math.abs(we))&&Math.abs(D-We)<=br*Math.max(1,Math.abs(D),Math.abs(We))&&Math.abs(S-Ye)<=br*Math.max(1,Math.abs(S),Math.abs(Ye))&&Math.abs(T-Ve)<=br*Math.max(1,Math.abs(T),Math.abs(Ve))&&Math.abs(R-Fe)<=br*Math.max(1,Math.abs(R),Math.abs(Fe))&&Math.abs(L-ke)<=br*Math.max(1,Math.abs(L),Math.abs(ke))&&Math.abs(B-Ue)<=br*Math.max(1,Math.abs(B),Math.abs(Ue))&&Math.abs(U-Ne)<=br*Math.max(1,Math.abs(U),Math.abs(Ne))&&Math.abs(j-Te)<=br*Math.max(1,Math.abs(j),Math.abs(Te))&&Math.abs(Q-it)<=br*Math.max(1,Math.abs(Q),Math.abs(it))&&Math.abs(J-nt)<=br*Math.max(1,Math.abs(J),Math.abs(nt))&&Math.abs(ce-Tt)<=br*Math.max(1,Math.abs(ce),Math.abs(Tt))},y.evaluateSizeForFeature=function(s,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:m}){return"source"===s.kind?h/Wo:"composite"===s.kind?Nn(h/Wo,m/Wo,l):i},y.evaluateSizeForZoom=function(s,i){let l=0,h=0;if("constant"===s.kind)h=s.layoutSize;else if("source"!==s.kind){const{interpolationType:m,minZoom:_,maxZoom:b}=s,D=m?xe(fi.interpolationFactor(m,i,_,b),0,1):0;"camera"===s.kind?h=Nn(s.minSize,s.maxSize,D):l=D}return{uSizeT:l,uSize:h}},y.evaluateVariableOffset=py,y.evented=Xl,y.exported=Qo,y.exported$1=ko,y.extend=wi,y.filterObject=To,y.fromRotation=function(s,i){var l=Math.sin(i),h=Math.cos(i);return s[0]=h,s[1]=l,s[2]=0,s[3]=-l,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},y.fromScaling=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},y.getAnchorAlignment=Lf,y.getAnchorJustification=jf,y.getArrayBuffer=Xa,y.getImage=Ps,y.getJSON=function(s,i){return Za(wi(s,{type:"json"}),i)},y.getOverlapMode=vc,y.getRTLTextPluginStatus=cl,y.getReferrer=fa,y.getVideo=function(s,i){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let h=0;h<s.length;h++){const m=window.document.createElement("source");Ol(s[h])||(l.crossOrigin="Anonymous"),m.src=s[h],l.appendChild(m)}return{cancel:()=>{}}},y.identity=ph,y.invert=function(s,i){var l=i[0],h=i[1],m=i[2],_=i[3],b=i[4],D=i[5],S=i[6],T=i[7],R=i[8],L=i[9],B=i[10],U=i[11],j=i[12],Q=i[13],J=i[14],ce=i[15],fe=l*D-h*b,se=l*S-m*b,de=l*T-_*b,De=h*S-m*D,we=h*T-_*D,We=m*T-_*S,Ye=R*Q-L*j,Ve=R*J-B*j,Fe=R*ce-U*j,ke=L*J-B*Q,Ue=L*ce-U*Q,Ne=B*ce-U*J,Te=fe*Ne-se*Ue+de*ke+De*Fe-we*Ve+We*Ye;return Te?(s[0]=(D*Ne-S*Ue+T*ke)*(Te=1/Te),s[1]=(m*Ue-h*Ne-_*ke)*Te,s[2]=(Q*We-J*we+ce*De)*Te,s[3]=(B*we-L*We-U*De)*Te,s[4]=(S*Fe-b*Ne-T*Ve)*Te,s[5]=(l*Ne-m*Fe+_*Ve)*Te,s[6]=(J*de-j*We-ce*se)*Te,s[7]=(R*We-B*de+U*se)*Te,s[8]=(b*Ue-D*Fe+T*Ye)*Te,s[9]=(h*Fe-l*Ue-_*Ye)*Te,s[10]=(j*we-Q*de+ce*fe)*Te,s[11]=(L*de-R*we-U*fe)*Te,s[12]=(D*Ve-b*ke-S*Ye)*Te,s[13]=(l*ke-h*Ve+m*Ye)*Te,s[14]=(Q*se-j*De-J*fe)*Te,s[15]=(R*De-L*se+B*fe)*Te,s):null},y.isImageBitmap=uo,y.isSafari=ca,y.isWorker=Ci,y.keysDifference=function(s,i){const l=[];for(const h in s)h in i||l.push(h);return l},y.lazyLoadRTLTextPlugin=function(){Pi.isLoading()||Pi.isLoaded()||"deferred"!==cl()||Kl()},y.makeRequest=Za,y.mapObject=Wa,y.mercatorXfromLng=Zf,y.mercatorYfromLat=Xf,y.mercatorZfromAltitude=Kf,y.mul=zg,y.mul$1=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},y.multiply=Md,y.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},y.normalize=function(s,i){var l=i[0],h=i[1],m=i[2],_=l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),s[0]=i[0]*_,s[1]=i[1]*_,s[2]=i[2]*_,s},y.number=Nn,y.ortho=function(s,i,l,h,m,_,b){var D=1/(i-l),S=1/(h-m),T=1/(_-b);return s[0]=-2*D,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*T,s[11]=0,s[12]=(i+l)*D,s[13]=(m+h)*S,s[14]=(b+_)*T,s[15]=1,s},y.parseCacheControl=la,y.parseGlyphPbf=function(s){return new Ch(s).readFields(Cu,[])},y.pbf=Ch,y.performSymbolLayout=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=tr/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0].layout,l=s.bucket.layers[0]._unevaluatedLayout._values,h={layoutIconSize:l["icon-size"].possiblyEvaluate(new Gt(s.bucket.zoom+1),s.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Gt(s.bucket.zoom+1),s.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Gt(18))};if("composite"===s.bucket.textSizeData.kind){const{minZoom:S,maxZoom:T}=s.bucket.textSizeData;h.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Gt(S),s.canonical),l["text-size"].possiblyEvaluate(new Gt(T),s.canonical)]}if("composite"===s.bucket.iconSizeData.kind){const{minZoom:S,maxZoom:T}=s.bucket.iconSizeData;h.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Gt(S),s.canonical),l["icon-size"].possiblyEvaluate(new Gt(T),s.canonical)]}const m=24*i.get("text-line-height"),_="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),b=i.get("text-keep-upright"),D=i.get("text-size");for(const S of s.bucket.features){const T=i.get("text-font").evaluate(S,{},s.canonical).join(","),R=D.evaluate(S,{},s.canonical),L=h.layoutTextSize.evaluate(S,{},s.canonical),B=h.layoutIconSize.evaluate(S,{},s.canonical),U={horizontal:{},vertical:void 0},j=S.text;let Q,J=[0,0];if(j){const se=j.toString(),de=24*i.get("text-letter-spacing").evaluate(S,{},s.canonical),De=ff(se)?de:0,we=i.get("text-anchor").evaluate(S,{},s.canonical),We=i.get("text-variable-anchor");if(!We){const Ue=i.get("text-radial-offset").evaluate(S,{},s.canonical);J=Ue?py(we,[24*Ue,Qd]):i.get("text-offset").evaluate(S,{},s.canonical).map(Ne=>24*Ne)}let Ye=_?"center":i.get("text-justify").evaluate(S,{},s.canonical);const Ve=i.get("symbol-placement"),Fe="point"===Ve?24*i.get("text-max-width").evaluate(S,{},s.canonical):0,ke=()=>{s.bucket.allowVerticalPlacement&&Kc(se)&&(U.vertical=Mh(j,s.glyphMap,s.glyphPositions,s.imagePositions,T,Fe,m,we,"left",De,J,y.WritingMode.vertical,!0,Ve,L,R))};if(!_&&We){const Ue="auto"===Ye?We.map(Te=>jf(Te)):[Ye];let Ne=!1;for(let Te=0;Te<Ue.length;Te++){const it=Ue[Te];if(!U.horizontal[it])if(Ne)U.horizontal[it]=U.horizontal[0];else{const nt=Mh(j,s.glyphMap,s.glyphPositions,s.imagePositions,T,Fe,m,"center",it,De,J,y.WritingMode.horizontal,!1,Ve,L,R);nt&&(U.horizontal[it]=nt,Ne=1===nt.positionedLines.length)}}ke()}else{"auto"===Ye&&(Ye=jf(we));const Ue=Mh(j,s.glyphMap,s.glyphPositions,s.imagePositions,T,Fe,m,we,Ye,De,J,y.WritingMode.horizontal,!1,Ve,L,R);Ue&&(U.horizontal[Ye]=Ue),ke(),Kc(se)&&_&&b&&(U.vertical=Mh(j,s.glyphMap,s.glyphPositions,s.imagePositions,T,Fe,m,we,Ye,De,J,y.WritingMode.vertical,!1,Ve,L,R))}}let ce=!1;if(S.icon&&S.icon.name){const se=s.imageMap[S.icon.name];se&&(Q=Bx(s.imagePositions[S.icon.name],i.get("icon-offset").evaluate(S,{},s.canonical),i.get("icon-anchor").evaluate(S,{},s.canonical)),ce=!!se.sdf,void 0===s.bucket.sdfIcons?s.bucket.sdfIcons=ce:s.bucket.sdfIcons!==ce&&Un("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==s.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(s.bucket.iconsNeedLinear=!0))}const fe=tp(U.horizontal)||U.vertical;s.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||Q)&&Iu(s.bucket,S,U,Q,s.imageMap,h,L,B,J,ce,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},y.perspective=function(s,i,l,h,m){var _,b=1/Math.tan(i/2);return s[0]=b/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=m&&m!==1/0?(s[10]=(m+h)*(_=1/(h-m)),s[14]=2*m*h*_):(s[10]=-1,s[14]=-2*h),s},y.pick=function(s,i){const l={};for(let h=0;h<i.length;h++){const m=i[h];m in s&&(l[m]=s[m])}return l},y.plugin=Pi,y.pointGeometry=at,y.polygonIntersectsPolygon=Id,y.potpack=oy,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Xe,y.registerForPluginStateChange=function(s){return s({pluginStatus:Xr,pluginURL:ps}),Xl.on("pluginStateChange",s),s},y.renderColorRamp=Cf,y.rotateX=function(s,i,l){var h=Math.sin(l),m=Math.cos(l),_=i[4],b=i[5],D=i[6],S=i[7],T=i[8],R=i[9],L=i[10],B=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=_*m+T*h,s[5]=b*m+R*h,s[6]=D*m+L*h,s[7]=S*m+B*h,s[8]=T*m-_*h,s[9]=R*m-b*h,s[10]=L*m-D*h,s[11]=B*m-S*h,s},y.rotateZ=function(s,i,l){var h=Math.sin(l),m=Math.cos(l),_=i[0],b=i[1],D=i[2],S=i[3],T=i[4],R=i[5],L=i[6],B=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=_*m+T*h,s[1]=b*m+R*h,s[2]=D*m+L*h,s[3]=S*m+B*h,s[4]=T*m-_*h,s[5]=R*m-b*h,s[6]=L*m-D*h,s[7]=B*m-S*h,s},y.scale=function(s,i,l){var h=l[0],m=l[1],_=l[2];return s[0]=i[0]*h,s[1]=i[1]*h,s[2]=i[2]*h,s[3]=i[3]*h,s[4]=i[4]*m,s[5]=i[5]*m,s[6]=i[6]*m,s[7]=i[7]*m,s[8]=i[8]*_,s[9]=i[9]*_,s[10]=i[10]*_,s[11]=i[11]*_,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},y.scale$1=function(s,i,l){return s[0]=i[0]*l,s[1]=i[1]*l,s[2]=i[2]*l,s},y.setCacheLimits=function(s,i){ua=s,ha=i},y.setRTLTextPlugin=function(s,i,l=!1){if(Xr===ah||Xr===Ho||Xr===Yc)throw new Error("setRTLTextPlugin cannot be called multiple times.");ps=Qo.resolveURL(s),Xr=ah,Zr=i,Us(),l||Kl()},y.spec=ve,y.sphericalToCartesian=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}},y.sqrLen=function(s){var i=s[0],l=s[1];return i*i+l*l},y.sub=function(s,i,l){return s[0]=i[0]-l[0],s[1]=i[1]-l[1],s[2]=i[2]-l[2],s},y.toEvaluationFeature=$s,y.transformMat3=function(s,i,l){var h=i[0],m=i[1],_=i[2];return s[0]=h*l[0]+m*l[3]+_*l[6],s[1]=h*l[1]+m*l[4]+_*l[7],s[2]=h*l[2]+m*l[5]+_*l[8],s},y.transformMat4=mh,y.transformMat4$1=function(s,i,l){var h=i[0],m=i[1];return s[0]=l[0]*h+l[4]*m+l[12],s[1]=l[1]*h+l[5]*m+l[13],s},y.translate=function(s,i,l){var h,m,_,b,D,S,T,R,L,B,U,j,Q=l[0],J=l[1],ce=l[2];return i===s?(s[12]=i[0]*Q+i[4]*J+i[8]*ce+i[12],s[13]=i[1]*Q+i[5]*J+i[9]*ce+i[13],s[14]=i[2]*Q+i[6]*J+i[10]*ce+i[14],s[15]=i[3]*Q+i[7]*J+i[11]*ce+i[15]):(m=i[1],_=i[2],b=i[3],D=i[4],S=i[5],T=i[6],R=i[7],L=i[8],B=i[9],U=i[10],j=i[11],s[0]=h=i[0],s[1]=m,s[2]=_,s[3]=b,s[4]=D,s[5]=S,s[6]=T,s[7]=R,s[8]=L,s[9]=B,s[10]=U,s[11]=j,s[12]=h*Q+D*J+L*ce+i[12],s[13]=m*Q+S*J+B*ce+i[13],s[14]=_*Q+T*J+U*ce+i[14],s[15]=b*Q+R*J+j*ce+i[15]),s},y.triggerPluginCompletionEvent=lh,y.unicodeBlockLookup=je,y.uniqueId=function(){return On++},y.validateCustomStyleLayer=function(s){const i=[],l=s.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},y.validateLight=Zc,y.validateStyle=ql,y.vectorTile=La,y.warnOnce=Un,y.wrap=Mo}),Nc(0,function(y){function Hn(G){const P=typeof G;if("number"===P||"boolean"===P||"string"===P||null==G)return JSON.stringify(G);if(Array.isArray(G)){let $="[";for(const ee of G)$+=`${Hn(ee)},`;return`${$}]`}const O=Object.keys(G).sort();let H="{";for(let $=0;$<O.length;$++)H+=`${JSON.stringify(O[$])}:${Hn(G[O[$]])},`;return`${H}}`}function So(G){let P="";for(const O of y.refProperties)P+=`/${Hn(G[O])}`;return P}class ao{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,O){for(const $ of P){this._layerConfigs[$.id]=$;const ee=this._layers[$.id]=y.createStyleLayer($);ee._featureFilter=y.createFilter(ee.filter),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(const $ of O)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};const H=function($,ee){const ie={};for(let te=0;te<$.length;te++){const oe=ee&&ee[$[te].id]||So($[te]);ee&&(ee[$[te].id]=oe);let ye=ie[oe];ye||(ye=ie[oe]=[]),ye.push($[te])}const ne=[];for(const te in ie)ne.push(ie[te]);return ne}(Object.values(this._layerConfigs),this.keyCache);for(const $ of H){const ee=$.map(Ee=>this._layers[Ee.id]),ie=ee[0];if("none"===ie.visibility)continue;const ne=ie.source||"";let te=this.familiesBySource[ne];te||(te=this.familiesBySource[ne]={});const oe=ie.sourceLayer||"_geojsonTileLayer";let ye=te[oe];ye||(ye=te[oe]=[]),ye.push(ee)}}}class Xt{constructor(P){const O={},H=[];for(const ne in P){const te=P[ne],oe=O[ne]={};for(const ye in te){const Ee=te[+ye];if(!Ee||0===Ee.bitmap.width||0===Ee.bitmap.height)continue;const ge={x:0,y:0,w:Ee.bitmap.width+2,h:Ee.bitmap.height+2};H.push(ge),oe[ye]={rect:ge,metrics:Ee.metrics}}}const{w:$,h:ee}=y.potpack(H),ie=new y.AlphaImage({width:$||1,height:ee||1});for(const ne in P){const te=P[ne];for(const oe in te){const ye=te[+oe];if(!ye||0===ye.bitmap.width||0===ye.bitmap.height)continue;const Ee=O[ne][oe].rect;y.AlphaImage.copy(ye.bitmap,ie,{x:0,y:0},{x:Ee.x+1,y:Ee.y+1},ye.bitmap)}}this.image=ie,this.positions=O}}y.register("GlyphAtlas",Xt);class xe{constructor(P){this.tileID=new y.OverscaledTileID(P.tileID.overscaledZ,P.tileID.wrap,P.tileID.canonical.z,P.tileID.canonical.x,P.tileID.canonical.y),this.uid=P.uid,this.zoom=P.zoom,this.pixelRatio=P.pixelRatio,this.tileSize=P.tileSize,this.source=P.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=P.showCollisionBoxes,this.collectResourceTiming=!!P.collectResourceTiming,this.returnDependencies=!!P.returnDependencies,this.promoteId=P.promoteId}parse(P,O,H,$,ee){this.status="parsing",this.data=P,this.collisionBoxArray=new y.CollisionBoxArray;const ie=new y.DictionaryCoder(Object.keys(P.layers).sort()),ne=new y.FeatureIndex(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const te={},oe={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},ye=O.familiesBySource[this.source];for(const ft in ye){const It=P.layers[ft];if(!It)continue;1===It.version&&y.warnOnce(`Vector tile source "${this.source}" layer "${ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=ie.encode(ft),_n=[];for(let zt=0;zt<It.length;zt++){const Pn=It.feature(zt),Sr=ne.getId(Pn,ft);_n.push({feature:Pn,id:Sr,index:zt,sourceLayerIndex:Ht})}for(const zt of ye[ft]){const Pn=zt[0];Pn.source!==this.source&&y.warnOnce(`layer.source = ${Pn.source} does not equal this.source = ${this.source}`),Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||"none"!==Pn.visibility&&(Mo(zt,this.zoom,H),(te[Pn.id]=Pn.createBucket({index:ne.bucketLayerIDs.length,layers:zt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source})).populate(_n,oe,this.tileID.canonical),ne.bucketLayerIDs.push(zt.map(Sr=>Sr.id)))}}let Ee,ge,Ke,Qe;const Be=y.mapObject(oe.glyphDependencies,ft=>Object.keys(ft).map(Number));Object.keys(Be).length?$.send("getGlyphs",{uid:this.uid,stacks:Be},(ft,It)=>{Ee||(Ee=ft,ge=It,$t.call(this))}):ge={};const st=Object.keys(oe.iconDependencies);st.length?$.send("getImages",{icons:st,source:this.source,tileID:this.tileID,type:"icons"},(ft,It)=>{Ee||(Ee=ft,Ke=It,$t.call(this))}):Ke={};const ct=Object.keys(oe.patternDependencies);function $t(){if(Ee)return ee(Ee);if(ge&&Ke&&Qe){const ft=new Xt(ge),It=new y.ImageAtlas(Ke,Qe);for(const Ht in te){const _n=te[Ht];_n instanceof y.SymbolBucket?(Mo(_n.layers,this.zoom,H),y.performSymbolLayout({bucket:_n,glyphMap:ge,glyphPositions:ft.positions,imageMap:Ke,imagePositions:It.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_n.hasPattern&&(_n instanceof y.LineBucket||_n instanceof y.FillBucket||_n instanceof y.FillExtrusionBucket)&&(Mo(_n.layers,this.zoom,H),_n.addFeatures(oe,this.tileID.canonical,It.patternPositions))}this.status="done",ee(null,{buckets:Object.values(te).filter(Ht=>!Ht.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ft.image,imageAtlas:It,glyphMap:this.returnDependencies?ge:null,iconMap:this.returnDependencies?Ke:null,glyphPositions:this.returnDependencies?ft.positions:null})}}ct.length?$.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"patterns"},(ft,It)=>{Ee||(Ee=ft,Qe=It,$t.call(this))}):Qe={},$t.call(this)}}function Mo(G,P,O){const H=new y.EvaluationParameters(P);for(const $ of G)$.recalculate(H,O)}function wi(G,P){const O=y.getArrayBuffer(G.request,(H,$,ee,ie)=>{H?P(H):$&&P(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf($)),rawData:$,cacheControl:ee,expires:ie})});return()=>{O.cancel(),P()}}class On{constructor(P,O,H,$){this.actor=P,this.layerIndex=O,this.availableImages=H,this.loadVectorData=$||wi,this.loading={},this.loaded={}}loadTile(P,O){const H=P.uid;this.loading||(this.loading={});const $=!!(P&&P.request&&P.request.collectResourceTiming)&&new y.RequestPerformance(P.request),ee=this.loading[H]=new xe(P);ee.abort=this.loadVectorData(P,(ie,ne)=>{if(delete this.loading[H],ie||!ne)return ee.status="done",this.loaded[H]=ee,O(ie);const te=ne.rawData,oe={};ne.expires&&(oe.expires=ne.expires),ne.cacheControl&&(oe.cacheControl=ne.cacheControl);const ye={};if($){const Ee=$.finish();Ee&&(ye.resourceTiming=JSON.parse(JSON.stringify(Ee)))}ee.vectorTile=ne.vectorTile,ee.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ee,ge)=>{if(Ee||!ge)return O(Ee);O(null,y.extend({rawTileData:te.slice(0)},ge,oe,ye))}),this.loaded=this.loaded||{},this.loaded[H]=ee})}reloadTile(P,O){const H=this.loaded,$=P.uid,ee=this;if(H&&H[$]){const ie=H[$];ie.showCollisionBoxes=P.showCollisionBoxes;const ne=(te,oe)=>{const ye=ie.reloadCallback;ye&&(delete ie.reloadCallback,ie.parse(ie.vectorTile,ee.layerIndex,this.availableImages,ee.actor,ye)),O(te,oe)};"parsing"===ie.status?ie.reloadCallback=ne:"done"===ie.status&&(ie.vectorTile?ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,ne):ne())}}abortTile(P,O){const H=this.loading,$=P.uid;H&&H[$]&&H[$].abort&&(H[$].abort(),delete H[$]),O()}removeTile(P,O){const H=this.loaded,$=P.uid;H&&H[$]&&delete H[$],O()}}class Ll{constructor(){this.loaded={}}loadTile(P,O){const{uid:H,encoding:$,rawImageData:ee}=P,ie=y.isImageBitmap(ee)?this.getImageData(ee):ee,ne=new y.DEMData(H,ie,$);this.loaded=this.loaded||{},this.loaded[H]=ne,O(null,ne)}getImageData(P){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const O=this.offscreenCanvasContext.getImageData(-1,-1,P.width+2,P.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:O.width,height:O.height},O.data)}removeTile(P){const O=this.loaded,H=P.uid;O&&O[H]&&delete O[H]}}var Wa=function G(P,O){var H,$=P&&P.type;if("FeatureCollection"===$)for(H=0;H<P.features.length;H++)G(P.features[H],O);else if("GeometryCollection"===$)for(H=0;H<P.geometries.length;H++)G(P.geometries[H],O);else if("Feature"===$)G(P.geometry,O);else if("Polygon"===$)To(P.coordinates,O);else if("MultiPolygon"===$)for(H=0;H<P.coordinates.length;H++)To(P.coordinates[H],O);return P};function To(G,P){if(0!==G.length){Vr(G[0],P);for(var O=1;O<G.length;O++)Vr(G[O],!P)}}function Vr(G,P){for(var O=0,H=0,$=0,ee=G.length,ie=ee-1;$<ee;ie=$++){var ne=(G[$][0]-G[ie][0])*(G[ie][1]+G[$][1]),te=O+ne;H+=Math.abs(O)>=Math.abs(ne)?O-te+ne:ne-te+O,O=te}O+H>=0!=!!P&&G.reverse()}const Hi=y.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Un{constructor(P){this._feature=P,this.extent=y.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(1===this._feature.type){const P=[];for(const O of this._feature.geometry)P.push([new y.pointGeometry(O[0],O[1])]);return P}{const P=[];for(const O of this._feature.geometry){const H=[];for(const $ of O)H.push(new y.pointGeometry($[0],$[1]));P.push(H)}return P}}toGeoJSON(P,O,H){return Hi.call(this,P,O,H)}}class lo{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=P.length,this._features=P}feature(P){return new Un(this._features[P])}}var co={exports:{}},Ci=y.pointGeometry,la=y.vectorTile.VectorTileFeature,Ao=Gi;function Gi(G,P){this.options=P||{},this.features=G,this.length=G.length}function Di(G,P){this.id="number"==typeof G.id?G.id:void 0,this.type=G.type,this.rawGeometry=1===G.type?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=P||4096}Gi.prototype.feature=function(G){return new Di(this.features[G],this.options.extent)},Di.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var P=0;P<G.length;P++){for(var O=G[P],H=[],$=0;$<O.length;$++)H.push(new Ci(O[$][0],O[$][1]));this.geometry.push(H)}return this.geometry},Di.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,P=1/0,O=-1/0,H=1/0,$=-1/0,ee=0;ee<G.length;ee++)for(var ie=G[ee],ne=0;ne<ie.length;ne++){var te=ie[ne];P=Math.min(P,te.x),O=Math.max(O,te.x),H=Math.min(H,te.y),$=Math.max($,te.y)}return[P,H,O,$]},Di.prototype.toGeoJSON=la.prototype.toGeoJSON;var ca=y.pbf,uo=Ao;function Qo(G){var P=new ca;return function(O,H){for(var $ in O.layers)H.writeMessage(3,at,O.layers[$])}(G,P),P.finish()}function at(G,P){var O;P.writeVarintField(15,G.version||1),P.writeStringField(1,G.name||""),P.writeVarintField(5,G.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<G.length;O++)H.feature=G.feature(O),P.writeMessage(2,Ur,H);var $=H.keys;for(O=0;O<$.length;O++)P.writeStringField(3,$[O]);var ee=H.values;for(O=0;O<ee.length;O++)P.writeMessage(4,ua,ee[O])}function Ur(G,P){var O=G.feature;void 0!==O.id&&P.writeVarintField(1,O.id),P.writeMessage(2,Po,G),P.writeVarintField(3,O.type),P.writeMessage(4,es,O)}function Po(G,P){var O=G.feature,H=G.keys,$=G.values,ee=G.keycache,ie=G.valuecache;for(var ne in O.properties){var te=O.properties[ne],oe=ee[ne];if(null!==te){void 0===oe&&(H.push(ne),ee[ne]=oe=H.length-1),P.writeVarint(oe);var ye=typeof te;"string"!==ye&&"boolean"!==ye&&"number"!==ye&&(te=JSON.stringify(te));var Ee=ye+":"+te,ge=ie[Ee];void 0===ge&&($.push(te),ie[Ee]=ge=$.length-1),P.writeVarint(ge)}}}function Ei(G,P){return(P<<3)+(7&G)}function on(G){return G<<1^G>>31}function es(G,P){for(var O=G.loadGeometry(),H=G.type,$=0,ee=0,ie=O.length,ne=0;ne<ie;ne++){var te=O[ne],oe=1;1===H&&(oe=te.length),P.writeVarint(Ei(1,oe));for(var ye=3===H?te.length-1:te.length,Ee=0;Ee<ye;Ee++){1===Ee&&1!==H&&P.writeVarint(Ei(2,ye-1));var ge=te[Ee].x-$,Ke=te[Ee].y-ee;P.writeVarint(on(ge)),P.writeVarint(on(Ke)),$+=ge,ee+=Ke}3===H&&P.writeVarint(Ei(7,1))}}function ua(G,P){var O=typeof G;"string"===O?P.writeStringField(1,G):"boolean"===O?P.writeBooleanField(7,G):"number"===O&&(G%1!=0?P.writeDoubleField(3,G):G<0?P.writeSVarintField(6,G):P.writeVarintField(5,G))}function ha(G,P,O,H,$,ee){if($-H<=O)return;const ie=H+$>>1;da(G,P,ie,H,$,ee%2),ha(G,P,O,H,ie-1,ee+1),ha(G,P,O,ie+1,$,ee+1)}function da(G,P,O,H,$,ee){for(;$>H;){if($-H>600){const oe=$-H+1,ye=O-H+1,Ee=Math.log(oe),ge=.5*Math.exp(2*Ee/3),Ke=.5*Math.sqrt(Ee*ge*(oe-ge)/oe)*(ye-oe/2<0?-1:1);da(G,P,O,Math.max(H,Math.floor(O-ye*ge/oe+Ke)),Math.min($,Math.floor(O+(oe-ye)*ge/oe+Ke)),ee)}const ie=P[2*O+ee];let ne=H,te=$;for(rr(G,P,H,O),P[2*$+ee]>ie&&rr(G,P,H,$);ne<te;){for(rr(G,P,ne,te),ne++,te--;P[2*ne+ee]<ie;)ne++;for(;P[2*te+ee]>ie;)te--}P[2*H+ee]===ie?rr(G,P,H,te):(te++,rr(G,P,te,$)),te<=O&&(H=te+1),O<=te&&($=te-1)}}function rr(G,P,O,H){ko(G,O,H),ko(P,2*O,2*H),ko(P,2*O+1,2*H+1)}function ko(G,P,O){const H=G[P];G[P]=G[O],G[O]=H}function Ro(G,P,O,H){const $=G-O,ee=P-H;return $*$+ee*ee}co.exports=Qo,co.exports.fromVectorTileJs=Qo,co.exports.fromGeojsonVt=function(G,P){P=P||{};var O={};for(var H in G)O[H]=new uo(G[H].features,P),O[H].name=H,O[H].version=P.version,O[H].extent=P.extent;return Qo({layers:O})},co.exports.GeoJSONWrapper=uo;const An=G=>G[0],Qt=G=>G[1];class pa{constructor(P,O=An,H=Qt,$=64,ee=Float64Array){this.nodeSize=$,this.points=P;const ie=P.length<65536?Uint16Array:Uint32Array,ne=this.ids=new ie(P.length),te=this.coords=new ee(2*P.length);for(let oe=0;oe<P.length;oe++)ne[oe]=oe,te[2*oe]=O(P[oe]),te[2*oe+1]=H(P[oe]);ha(ne,te,$,0,ne.length-1,0)}range(P,O,H,$){return function(ee,ie,ne,te,oe,ye,Ee){const ge=[0,ee.length-1,0],Ke=[];let Qe,Be;for(;ge.length;){const st=ge.pop(),ct=ge.pop(),$t=ge.pop();if(ct-$t<=Ee){for(let Ht=$t;Ht<=ct;Ht++)Qe=ie[2*Ht],Be=ie[2*Ht+1],Qe>=ne&&Qe<=oe&&Be>=te&&Be<=ye&&Ke.push(ee[Ht]);continue}const ft=Math.floor(($t+ct)/2);Qe=ie[2*ft],Be=ie[2*ft+1],Qe>=ne&&Qe<=oe&&Be>=te&&Be<=ye&&Ke.push(ee[ft]);const It=(st+1)%2;(0===st?ne<=Qe:te<=Be)&&(ge.push($t),ge.push(ft-1),ge.push(It)),(0===st?oe>=Qe:ye>=Be)&&(ge.push(ft+1),ge.push(ct),ge.push(It))}return Ke}(this.ids,this.coords,P,O,H,$,this.nodeSize)}within(P,O,H){return function($,ee,ie,ne,te,oe){const ye=[0,$.length-1,0],Ee=[],ge=te*te;for(;ye.length;){const Ke=ye.pop(),Qe=ye.pop(),Be=ye.pop();if(Qe-Be<=oe){for(let It=Be;It<=Qe;It++)Ro(ee[2*It],ee[2*It+1],ie,ne)<=ge&&Ee.push($[It]);continue}const st=Math.floor((Be+Qe)/2),ct=ee[2*st],$t=ee[2*st+1];Ro(ct,$t,ie,ne)<=ge&&Ee.push($[st]);const ft=(Ke+1)%2;(0===Ke?ie-te<=ct:ne-te<=$t)&&(ye.push(Be),ye.push(st-1),ye.push(ft)),(0===Ke?ie+te>=ct:ne+te>=$t)&&(ye.push(st+1),ye.push(Qe),ye.push(ft))}return Ee}(this.ids,this.coords,P,O,H,this.nodeSize)}}const At={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},qi=Math.fround||(Ii=new Float32Array(1),G=>(Ii[0]=+G,Ii[0]));var Ii;class fa{constructor(P){this.options=Ps(Object.create(At),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:O,minZoom:H,maxZoom:$,nodeSize:ee}=this.options;O&&console.time("total time");const ie=`prepare ${P.length} points`;O&&console.time(ie),this.points=P;let ne=[];for(let te=0;te<P.length;te++)P[te].geometry&&ne.push(Za(P[te],te));this.trees[$+1]=new pa(ne,ma,Oo,ee,Float32Array),O&&console.timeEnd(ie);for(let te=$;te>=H;te--){const oe=+Date.now();ne=this._cluster(ne,te),this.trees[te]=new pa(ne,ma,Oo,ee,Float32Array),O&&console.log("z%d: %d clusters in %dms",te,ne.length,+Date.now()-oe)}return O&&console.timeEnd("total time"),this}getClusters(P,O){let H=((P[0]+180)%360+360)%360-180;const $=Math.max(-90,Math.min(90,P[1]));let ee=180===P[2]?180:((P[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)H=-180,ee=180;else if(H>ee){const ye=this.getClusters([H,$,180,ie],O),Ee=this.getClusters([-180,$,ee,ie],O);return ye.concat(Ee)}const ne=this.trees[this._limitZoom(O)],te=ne.range(jt(H),Fo(ie),jt(ee),Fo($)),oe=[];for(const ye of te){const Ee=ne.points[ye];oe.push(Ee.numPoints?Xa(Ee):this.points[Ee.index])}return oe}getChildren(P){const O=this._getOriginId(P),H=this._getOriginZoom(P),$="No cluster with the specified id.",ee=this.trees[H];if(!ee)throw new Error($);const ie=ee.points[O];if(!ie)throw new Error($);const ne=this.options.radius/(this.options.extent*Math.pow(2,H-1)),te=ee.within(ie.x,ie.y,ne),oe=[];for(const ye of te){const Ee=ee.points[ye];Ee.parentId===P&&oe.push(Ee.numPoints?Xa(Ee):this.points[Ee.index])}if(0===oe.length)throw new Error($);return oe}getLeaves(P,O,H){const $=[];return this._appendLeaves($,P,O=O||10,H=H||0,0),$}getTile(P,O,H){const $=this.trees[this._limitZoom(P)],ee=Math.pow(2,P),{extent:ie,radius:ne}=this.options,te=ne/ie,oe=(H-te)/ee,ye=(H+1+te)/ee,Ee={features:[]};return this._addTileFeatures($.range((O-te)/ee,oe,(O+1+te)/ee,ye),$.points,O,H,ee,Ee),0===O&&this._addTileFeatures($.range(1-te/ee,oe,1,ye),$.points,ee,H,ee,Ee),O===ee-1&&this._addTileFeatures($.range(0,oe,te/ee,ye),$.points,-1,H,ee,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(P){let O=this._getOriginZoom(P)-1;for(;O<=this.options.maxZoom;){const H=this.getChildren(P);if(O++,1!==H.length)break;P=H[0].properties.cluster_id}return O}_appendLeaves(P,O,H,$,ee){const ie=this.getChildren(O);for(const ne of ie){const te=ne.properties;if(te&&te.cluster?ee+te.point_count<=$?ee+=te.point_count:ee=this._appendLeaves(P,te.cluster_id,H,$,ee):ee<$?ee++:P.push(ne),P.length===H)break}return ee}_addTileFeatures(P,O,H,$,ee,ie){for(const ne of P){const te=O[ne],oe=te.numPoints;let ye,Ee,ge;if(oe)ye=Ol(te),Ee=te.x,ge=te.y;else{const Be=this.points[te.index];ye=Be.properties,Ee=jt(Be.geometry.coordinates[0]),ge=Fo(Be.geometry.coordinates[1])}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Ee*ee-H)),Math.round(this.options.extent*(ge*ee-$))]],tags:ye};let Qe;oe?Qe=te.id:this.options.generateId?Qe=te.index:this.points[te.index].id&&(Qe=this.points[te.index].id),void 0!==Qe&&(Ke.id=Qe),ie.features.push(Ke)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(Math.floor(+P),this.options.maxZoom+1))}_cluster(P,O){const H=[],{radius:$,extent:ee,reduce:ie,minPoints:ne}=this.options,te=$/(ee*Math.pow(2,O));for(let oe=0;oe<P.length;oe++){const ye=P[oe];if(ye.zoom<=O)continue;ye.zoom=O;const Ee=this.trees[O+1],ge=Ee.within(ye.x,ye.y,te),Ke=ye.numPoints||1;let Qe=Ke;for(const Be of ge){const st=Ee.points[Be];st.zoom>O&&(Qe+=st.numPoints||1)}if(Qe>Ke&&Qe>=ne){let Be=ye.x*Ke,st=ye.y*Ke,ct=ie&&Ke>1?this._map(ye,!0):null;const $t=(oe<<5)+(O+1)+this.points.length;for(const ft of ge){const It=Ee.points[ft];if(It.zoom<=O)continue;It.zoom=O;const Ht=It.numPoints||1;Be+=It.x*Ht,st+=It.y*Ht,It.parentId=$t,ie&&(ct||(ct=this._map(ye,!0)),ie(ct,this._map(It)))}ye.parentId=$t,H.push(As(Be/Qe,st/Qe,$t,Qe,ct))}else if(H.push(ye),Qe>1)for(const Be of ge){const st=Ee.points[Be];st.zoom<=O||(st.zoom=O,H.push(st))}}return H}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,O){if(P.numPoints)return O?Ps({},P.properties):P.properties;const H=this.points[P.index].properties,$=this.options.map(H);return O&&$===H?Ps({},$):$}}function As(G,P,O,H,$){return{x:qi(G),y:qi(P),zoom:1/0,id:O,parentId:-1,numPoints:H,properties:$}}function Za(G,P){const[O,H]=G.geometry.coordinates;return{x:qi(jt(O)),y:qi(Fo(H)),zoom:1/0,index:P,parentId:-1}}function Xa(G){return{type:"Feature",id:G.id,properties:Ol(G),geometry:{type:"Point",coordinates:[(P=G.x,360*(P-.5)),Lo(G.y)]}};var P}function Ol(G){const P=G.numPoints,O=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return Ps(Ps({},G.properties),{cluster:!0,cluster_id:G.id,point_count:P,point_count_abbreviated:O})}function jt(G){return G/360+.5}function Fo(G){const P=Math.sin(G*Math.PI/180),O=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return O<0?0:O>1?1:O}function Lo(G){const P=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function Ps(G,P){for(const O in P)G[O]=P[O];return G}function ma(G){return G.x}function Oo(G){return G.y}function ts(G,P,O,H){for(var $,ee=H,ie=O-P>>1,ne=O-P,te=G[P],oe=G[P+1],ye=G[O],Ee=G[O+1],ge=P+3;ge<O;ge+=3){var Ke=Ka(G[ge],G[ge+1],te,oe,ye,Ee);if(Ke>ee)$=ge,ee=Ke;else if(Ke===ee){var Qe=Math.abs(ge-ie);Qe<ne&&($=ge,ne=Qe)}}ee>H&&($-P>3&&ts(G,P,$,H),G[$+2]=ee,O-$>3&&ts(G,$,O,H))}function Ka(G,P,O,H,$,ee){var ie=$-O,ne=ee-H;if(0!==ie||0!==ne){var te=((G-O)*ie+(P-H)*ne)/(ie*ie+ne*ne);te>1?(O=$,H=ee):te>0&&(O+=ie*te,H+=ne*te)}return(ie=G-O)*ie+(ne=P-H)*ne}function ns(G,P,O,H){var $={id:void 0===G?null:G,type:P,geometry:O,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ee){var ie=ee.geometry,ne=ee.type;if("Point"===ne||"MultiPoint"===ne||"LineString"===ne)ve(ee,ie);else if("Polygon"===ne||"MultiLineString"===ne)for(var te=0;te<ie.length;te++)ve(ee,ie[te]);else if("MultiPolygon"===ne)for(te=0;te<ie.length;te++)for(var oe=0;oe<ie[te].length;oe++)ve(ee,ie[te][oe])}($),$}function ve(G,P){for(var O=0;O<P.length;O+=3)G.minX=Math.min(G.minX,P[O]),G.minY=Math.min(G.minY,P[O+1]),G.maxX=Math.max(G.maxX,P[O]),G.maxY=Math.max(G.maxY,P[O+1])}function Oe(G,P,O,H){if(P.geometry){var $=P.geometry.coordinates,ee=P.geometry.type,ie=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),ne=[],te=P.id;if(O.promoteId?te=P.properties[O.promoteId]:O.generateId&&(te=H||0),"Point"===ee)ga($,ne);else if("MultiPoint"===ee)for(var oe=0;oe<$.length;oe++)ga($[oe],ne);else if("LineString"===ee)Wi($,ne,ie,!1);else if("MultiLineString"===ee){if(O.lineMetrics){for(oe=0;oe<$.length;oe++)Wi($[oe],ne=[],ie,!1),G.push(ns(te,"LineString",ne,P.properties));return}qt($,ne,ie,!1)}else if("Polygon"===ee)qt($,ne,ie,!0);else{if("MultiPolygon"!==ee){if("GeometryCollection"===ee){for(oe=0;oe<P.geometry.geometries.length;oe++)Oe(G,{id:te,geometry:P.geometry.geometries[oe],properties:P.properties},O,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(oe=0;oe<$.length;oe++){var ye=[];qt($[oe],ye,ie,!0),ne.push(ye)}}G.push(ns(te,ee,ne,P.properties))}}function ga(G,P){P.push(Si(G[0])),P.push(Mi(G[1])),P.push(0)}function Wi(G,P,O,H){for(var $,ee,ie=0,ne=0;ne<G.length;ne++){var te=Si(G[ne][0]),oe=Mi(G[ne][1]);P.push(te),P.push(oe),P.push(0),ne>0&&(ie+=H?($*oe-te*ee)/2:Math.sqrt(Math.pow(te-$,2)+Math.pow(oe-ee,2))),$=te,ee=oe}var ye=P.length-3;P[2]=1,ts(P,0,ye,O),P[ye+2]=1,P.size=Math.abs(ie),P.start=0,P.end=P.size}function qt(G,P,O,H){for(var $=0;$<G.length;$++){var ee=[];Wi(G[$],ee,O,H),P.push(ee)}}function Si(G){return G/360+.5}function Mi(G){var P=Math.sin(G*Math.PI/180),O=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return O<0?0:O>1?1:O}function Ti(G,P,O,H,$,ee,ie,ne){if(H/=P,ee>=(O/=P)&&ie<H)return G;if(ie<O||ee>=H)return null;for(var te=[],oe=0;oe<G.length;oe++){var ye=G[oe],Ee=ye.geometry,ge=ye.type,Ke=0===$?ye.minX:ye.minY,Qe=0===$?ye.maxX:ye.maxY;if(Ke>=O&&Qe<H)te.push(ye);else if(!(Qe<O||Ke>=H)){var Be=[];if("Point"===ge||"MultiPoint"===ge)ks(Ee,Be,O,H,$);else if("LineString"===ge)Le(Ee,Be,O,H,$,!1,ne.lineMetrics);else if("MultiLineString"===ge)_t(Ee,Be,O,H,$,!1);else if("Polygon"===ge)_t(Ee,Be,O,H,$,!0);else if("MultiPolygon"===ge)for(var st=0;st<Ee.length;st++){var ct=[];_t(Ee[st],ct,O,H,$,!0),ct.length&&Be.push(ct)}if(Be.length){if(ne.lineMetrics&&"LineString"===ge){for(st=0;st<Be.length;st++)te.push(ns(ye.id,ge,Be[st],ye.tags));continue}"LineString"!==ge&&"MultiLineString"!==ge||(1===Be.length?(ge="LineString",Be=Be[0]):ge="MultiLineString"),"Point"!==ge&&"MultiPoint"!==ge||(ge=3===Be.length?"Point":"MultiPoint"),te.push(ns(ye.id,ge,Be,ye.tags))}}}return te.length?te:null}function ks(G,P,O,H,$){for(var ee=0;ee<G.length;ee+=3){var ie=G[ee+$];ie>=O&&ie<=H&&(P.push(G[ee]),P.push(G[ee+1]),P.push(G[ee+2]))}}function Le(G,P,O,H,$,ee,ie){for(var ne,te,oe=Pt(G),ye=0===$?No:pt,Ee=G.start,ge=0;ge<G.length-3;ge+=3){var Ke=G[ge],Qe=G[ge+1],Be=G[ge+2],st=G[ge+3],ct=G[ge+4],$t=0===$?Ke:Qe,ft=0===$?st:ct,It=!1;ie&&(ne=Math.sqrt(Math.pow(Ke-st,2)+Math.pow(Qe-ct,2))),$t<O?ft>O&&(te=ye(oe,Ke,Qe,st,ct,O),ie&&(oe.start=Ee+ne*te)):$t>H?ft<H&&(te=ye(oe,Ke,Qe,st,ct,H),ie&&(oe.start=Ee+ne*te)):hr(oe,Ke,Qe,Be),ft<O&&$t>=O&&(te=ye(oe,Ke,Qe,st,ct,O),It=!0),ft>H&&$t<=H&&(te=ye(oe,Ke,Qe,st,ct,H),It=!0),!ee&&It&&(ie&&(oe.end=Ee+ne*te),P.push(oe),oe=Pt(G)),ie&&(Ee+=ne)}var Ht=G.length-3;Ke=G[Ht],Qe=G[Ht+1],Be=G[Ht+2],($t=0===$?Ke:Qe)>=O&&$t<=H&&hr(oe,Ke,Qe,Be),Ht=oe.length-3,ee&&Ht>=3&&(oe[Ht]!==oe[0]||oe[Ht+1]!==oe[1])&&hr(oe,oe[0],oe[1],oe[2]),oe.length&&P.push(oe)}function Pt(G){var P=[];return P.size=G.size,P.start=G.start,P.end=G.end,P}function _t(G,P,O,H,$,ee){for(var ie=0;ie<G.length;ie++)Le(G[ie],P,O,H,$,ee,!1)}function hr(G,P,O,H){G.push(P),G.push(O),G.push(H)}function No(G,P,O,H,$,ee){var ie=(ee-P)/(H-P);return G.push(ee),G.push(O+($-O)*ie),G.push(1),ie}function pt(G,P,O,H,$,ee){var ie=(ee-O)/($-O);return G.push(P+(H-P)*ie),G.push(ee),G.push(1),ie}function ho(G,P){for(var O=[],H=0;H<G.length;H++){var $,ee=G[H],ie=ee.type;if("Point"===ie||"MultiPoint"===ie||"LineString"===ie)$=dr(ee.geometry,P);else if("MultiLineString"===ie||"Polygon"===ie){$=[];for(var ne=0;ne<ee.geometry.length;ne++)$.push(dr(ee.geometry[ne],P))}else if("MultiPolygon"===ie)for($=[],ne=0;ne<ee.geometry.length;ne++){for(var te=[],oe=0;oe<ee.geometry[ne].length;oe++)te.push(dr(ee.geometry[ne][oe],P));$.push(te)}O.push(ns(ee.id,ie,$,ee.tags))}return O}function dr(G,P){var O=[];O.size=G.size,void 0!==G.start&&(O.start=G.start,O.end=G.end);for(var H=0;H<G.length;H+=3)O.push(G[H]+P,G[H+1],G[H+2]);return O}function Rs(G,P){if(G.transformed)return G;var O,H,$,ee=1<<G.z,ie=G.x,ne=G.y;for(O=0;O<G.features.length;O++){var te=G.features[O],oe=te.geometry,ye=te.type;if(te.geometry=[],1===ye)for(H=0;H<oe.length;H+=2)te.geometry.push(Xn(oe[H],oe[H+1],P,ee,ie,ne));else for(H=0;H<oe.length;H++){var Ee=[];for($=0;$<oe[H].length;$+=2)Ee.push(Xn(oe[H][$],oe[H][$+1],P,ee,ie,ne));te.geometry.push(Ee)}}return G.transformed=!0,G}function Xn(G,P,O,H,$,ee){return[Math.round(O*(G*H-$)),Math.round(O*(P*H-ee))]}function Ir(G,P,O,H,$){for(var ee=P===$.maxZoom?0:$.tolerance/((1<<P)*$.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:H,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<G.length;ne++){ie.numFeatures++,hn(ie,G[ne],ee,$);var te=G[ne].minX,oe=G[ne].minY,ye=G[ne].maxX,Ee=G[ne].maxY;te<ie.minX&&(ie.minX=te),oe<ie.minY&&(ie.minY=oe),ye>ie.maxX&&(ie.maxX=ye),Ee>ie.maxY&&(ie.maxY=Ee)}return ie}function hn(G,P,O,H){var $=P.geometry,ee=P.type,ie=[];if("Point"===ee||"MultiPoint"===ee)for(var ne=0;ne<$.length;ne+=3)ie.push($[ne]),ie.push($[ne+1]),G.numPoints++,G.numSimplified++;else if("LineString"===ee)_r(ie,$,G,O,!1,!1);else if("MultiLineString"===ee||"Polygon"===ee)for(ne=0;ne<$.length;ne++)_r(ie,$[ne],G,O,"Polygon"===ee,0===ne);else if("MultiPolygon"===ee)for(var te=0;te<$.length;te++){var oe=$[te];for(ne=0;ne<oe.length;ne++)_r(ie,oe[ne],G,O,!0,0===ne)}if(ie.length){var ye=P.tags||null;if("LineString"===ee&&H.lineMetrics){for(var Ee in ye={},P.tags)ye[Ee]=P.tags[Ee];ye.mapbox_clip_start=$.start/$.size,ye.mapbox_clip_end=$.end/$.size}var ge={geometry:ie,type:"Polygon"===ee||"MultiPolygon"===ee?3:"LineString"===ee||"MultiLineString"===ee?2:1,tags:ye};null!==P.id&&(ge.id=P.id),G.features.push(ge)}}function _r(G,P,O,H,$,ee){var ie=H*H;if(H>0&&P.size<($?ie:H))O.numPoints+=P.length/3;else{for(var ne=[],te=0;te<P.length;te+=3)(0===H||P[te+2]>ie)&&(O.numSimplified++,ne.push(P[te]),ne.push(P[te+1])),O.numPoints++;$&&function(oe,ye){for(var Ee=0,ge=0,Ke=oe.length,Qe=Ke-2;ge<Ke;Qe=ge,ge+=2)Ee+=(oe[ge]-oe[Qe])*(oe[ge+1]+oe[Qe+1]);if(Ee>0===ye)for(ge=0,Ke=oe.length;ge<Ke/2;ge+=2){var Be=oe[ge],st=oe[ge+1];oe[ge]=oe[Ke-2-ge],oe[ge+1]=oe[Ke-1-ge],oe[Ke-2-ge]=Be,oe[Ke-1-ge]=st}}(ne,ee),G.push(ne)}}function po(G,P){var O=(P=this.options=function($,ee){for(var ie in ee)$[ie]=ee[ie];return $}(Object.create(this.options),P)).debug;if(O&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var $,ee,ie,ne,te,oe,H=function($,ee){var ie=[];if("FeatureCollection"===$.type)for(var ne=0;ne<$.features.length;ne++)Oe(ie,$.features[ne],ee,ne);else Oe(ie,"Feature"===$.type?$:{geometry:$},ee);return ie}(G,P);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=$=H,te=Ti($,1,-1-(ie=(ee=P).buffer/ee.extent),ie,0,-1,2,ee),oe=Ti($,1,1-ie,2+ie,0,-1,2,ee),(te||oe)&&(ne=Ti($,1,-ie,1+ie,0,-1,2,ee)||[],te&&(ne=ho(te,1).concat(ne)),oe&&(ne=ne.concat(ho(oe,-1)))),(H=ne).length&&this.splitTile(H,0,0,0),O&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fs(G,P,O){return 32*((1<<G)*O+P)+G}function Ls(G,P){const O=G.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const H=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!H)return P(null,null);const $=new lo(H.features);let ee=co.exports($);0===ee.byteOffset&&ee.byteLength===ee.buffer.byteLength||(ee=new Uint8Array(ee)),P(null,{vectorTile:$,rawData:ee.buffer})}po.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},po.prototype.splitTile=function(G,P,O,H,$,ee,ie){for(var ne=[G,P,O,H],te=this.options,oe=te.debug;ne.length;){H=ne.pop(),O=ne.pop(),P=ne.pop(),G=ne.pop();var ye=1<<P,Ee=Fs(P,O,H),ge=this.tiles[Ee];if(!ge&&(oe>1&&console.time("creation"),ge=this.tiles[Ee]=Ir(G,P,O,H,te),this.tileCoords.push({z:P,x:O,y:H}),oe)){oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,O,H,ge.numFeatures,ge.numPoints,ge.numSimplified),console.timeEnd("creation"));var Ke="z"+P;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(ge.source=G,$){if(P===te.maxZoom||P===$)continue;var Qe=1<<$-P;if(O!==Math.floor(ee/Qe)||H!==Math.floor(ie/Qe))continue}else if(P===te.indexMaxZoom||ge.numPoints<=te.indexMaxPoints)continue;if(ge.source=null,0!==G.length){oe>1&&console.time("clipping");var Be,st,ct,$t,ft,It,Ht=.5*te.buffer/te.extent,_n=.5-Ht,zt=.5+Ht,Pn=1+Ht;Be=st=ct=$t=null,ft=Ti(G,ye,O-Ht,O+zt,0,ge.minX,ge.maxX,te),It=Ti(G,ye,O+_n,O+Pn,0,ge.minX,ge.maxX,te),G=null,ft&&(Be=Ti(ft,ye,H-Ht,H+zt,1,ge.minY,ge.maxY,te),st=Ti(ft,ye,H+_n,H+Pn,1,ge.minY,ge.maxY,te),ft=null),It&&(ct=Ti(It,ye,H-Ht,H+zt,1,ge.minY,ge.maxY,te),$t=Ti(It,ye,H+_n,H+Pn,1,ge.minY,ge.maxY,te),It=null),oe>1&&console.timeEnd("clipping"),ne.push(Be||[],P+1,2*O,2*H),ne.push(st||[],P+1,2*O,2*H+1),ne.push(ct||[],P+1,2*O+1,2*H),ne.push($t||[],P+1,2*O+1,2*H+1)}}},po.prototype.getTile=function(G,P,O){var H=this.options,$=H.extent,ee=H.debug;if(G<0||G>24)return null;var ie=1<<G,ne=Fs(G,P=(P%ie+ie)%ie,O);if(this.tiles[ne])return Rs(this.tiles[ne],$);ee>1&&console.log("drilling down to z%d-%d-%d",G,P,O);for(var te,oe=G,ye=P,Ee=O;!te&&oe>0;)oe--,ye=Math.floor(ye/2),Ee=Math.floor(Ee/2),te=this.tiles[Fs(oe,ye,Ee)];return te&&te.source?(ee>1&&console.log("found parent tile z%d-%d-%d",oe,ye,Ee),ee>1&&console.time("drilling down"),this.splitTile(te.source,oe,ye,Ee,G,P,O),ee>1&&console.timeEnd("drilling down"),this.tiles[ne]?Rs(this.tiles[ne],$):null):null};class ya extends On{constructor(P,O,H,$){super(P,O,H,Ls),$&&(this.loadGeoJSON=$)}loadData(P,O){var H;null===(H=this._pendingRequest)||void 0===H||H.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const $=!!(P&&P.request&&P.request.collectResourceTiming)&&new y.RequestPerformance(P.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(P,(ee,ie)=>{if(delete this._pendingCallback,delete this._pendingRequest,ee||!ie)return O(ee);if("object"!=typeof ie)return O(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{Wa(ie,!0);try{if(P.filter){const te=y.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===te.result)throw new Error(te.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));const oe=ie.features.filter(ye=>te.value.evaluate({zoom:0},ye));ie={type:"FeatureCollection",features:oe}}this._geoJSONIndex=P.cluster?new fa(function({superclusterOptions:te,clusterProperties:oe}){if(!oe||!te)return te;const ye={},Ee={},ge={accumulated:null,zoom:0},Ke={properties:null},Qe=Object.keys(oe);for(const Be of Qe){const[st,ct]=oe[Be],$t=y.createExpression(ct),ft=y.createExpression("string"==typeof st?[st,["accumulated"],["get",Be]]:st);ye[Be]=$t.value,Ee[Be]=ft.value}return te.map=Be=>{Ke.properties=Be;const st={};for(const ct of Qe)st[ct]=ye[ct].evaluate(ge,Ke);return st},te.reduce=(Be,st)=>{Ke.properties=st;for(const ct of Qe)ge.accumulated=Be[ct],Be[ct]=Ee[ct].evaluate(ge,Ke)},te}(P)).load(ie.features):new po(te=ie,P.geojsonVtOptions)}catch(te){return O(te)}this.loaded={};const ne={};if($){const te=$.finish();te&&(ne.resourceTiming={},ne.resourceTiming[P.source]=JSON.parse(JSON.stringify(te)))}O(null,ne)}var te})}reloadTile(P,O){const H=this.loaded;return H&&H[P.uid]?super.reloadTile(P,O):this.loadTile(P,O)}loadGeoJSON(P,O){if(P.request)return y.getJSON(P.request,O);if("string"==typeof P.data)try{O(null,JSON.parse(P.data))}catch{O(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}else O(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(P,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(P,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(H){O(H)}}getClusterChildren(P,O){try{O(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(H){O(H)}}getClusterLeaves(P,O){try{O(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(H){O(H)}}}class rs{constructor(P){this.self=P,this.actor=new y.Actor(P,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:On,geojson:ya},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,H)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=H},this.self.registerRTLTextPlugin=O=>{if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=O.applyArabicShaping,y.plugin.processBidirectionalText=O.processBidirectionalText,y.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(P,O){this.referrer=O}setImages(P,O,H){this.availableImages[P]=O;for(const $ in this.workerSources[P]){const ee=this.workerSources[P][$];for(const ie in ee)ee[ie].availableImages=O}H()}setLayers(P,O,H){this.getLayerIndex(P).replace(O),H()}updateLayers(P,O,H){this.getLayerIndex(P).update(O.layers,O.removedIds),H()}loadTile(P,O,H){this.getWorkerSource(P,O.type,O.source).loadTile(O,H)}loadDEMTile(P,O,H){this.getDEMWorkerSource(P,O.source).loadTile(O,H)}reloadTile(P,O,H){this.getWorkerSource(P,O.type,O.source).reloadTile(O,H)}abortTile(P,O,H){this.getWorkerSource(P,O.type,O.source).abortTile(O,H)}removeTile(P,O,H){this.getWorkerSource(P,O.type,O.source).removeTile(O,H)}removeDEMTile(P,O){this.getDEMWorkerSource(P,O.source).removeTile(O)}removeSource(P,O,H){if(!this.workerSources[P]||!this.workerSources[P][O.type]||!this.workerSources[P][O.type][O.source])return;const $=this.workerSources[P][O.type][O.source];delete this.workerSources[P][O.type][O.source],void 0!==$.removeSource?$.removeSource(O,H):H()}loadWorkerSource(P,O,H){try{this.self.importScripts(O.url),H()}catch($){H($.toString())}}syncRTLPluginState(P,O,H){try{y.plugin.setState(O);const $=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&null!=$){this.self.importScripts($);const ee=y.plugin.isParsed();H(ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${$}`),ee)}}catch($){H($.toString())}}getAvailableImages(P){let O=this.availableImages[P];return O||(O=[]),O}getLayerIndex(P){let O=this.layerIndexes[P];return O||(O=this.layerIndexes[P]=new ao),O}getWorkerSource(P,O,H){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][O]||(this.workerSources[P][O]={}),this.workerSources[P][O][H]||(this.workerSources[P][O][H]=new this.workerSourceTypes[O]({send:(ee,ie,ne)=>{this.actor.send(ee,ie,ne,P)}},this.getLayerIndex(P),this.getAvailableImages(P))),this.workerSources[P][O][H]}getDEMWorkerSource(P,O){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][O]||(this.demWorkerSources[P][O]=new Ll),this.demWorkerSources[P][O]}enforceCacheSizeLimit(P,O){y.enforceCacheSizeLimit(O)}}return y.isWorker()&&(self.worker=new rs(self)),rs}),Nc(0,function(y){var Hn=So;function So(f){return o=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,g,x=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(x);try{g=new Worker(C),d=!0}catch{d=!1}return g&&g.terminate(),URL.revokeObjectURL(C),d}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var d=document.createElement("canvas");d.width=d.height=1;var g=d.getContext("2d");if(!g)return!1;var x=g.getImageData(0,0,1,1);return x&&x.width===d.width}()||(void 0===ao[c=o&&o.failIfMajorPerformanceCaveat]&&(ao[c]=function(d){var g,C,E,M,x=(C=d,E=document.createElement("canvas"),(M=Object.create(So.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,E.getContext("webgl",M)||E.getContext("experimental-webgl",M));if(!x)return!1;try{g=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!g||x.isContextLost())&&(x.shaderSource(g,"void main() {}"),x.compileShader(g),!0===x.getShaderParameter(g,x.COMPILE_STATUS))}(c)),!ao[c]||document.documentMode));var o,c}var ao={};function Xt(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let c=0;c<f.length;c++)if(!Xt(f[c],o[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==o){if("object"!=typeof o||Object.keys(f).length!==Object.keys(o).length)return!1;for(const c in f)if(!Xt(f[c],o[c]))return!1;return!0}return f===o}So.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class xe{static testProp(o){if(!xe.docStyle)return o[0];for(let c=0;c<o.length;c++)if(o[c]in xe.docStyle)return o[c];return o[0]}static create(o,c,d){const g=window.document.createElement(o);return void 0!==c&&(g.className=c),d&&d.appendChild(g),g}static createNS(o,c){return window.document.createElementNS(o,c)}static disableDrag(){xe.docStyle&&xe.selectProp&&(xe.userSelect=xe.docStyle[xe.selectProp],xe.docStyle[xe.selectProp]="none")}static enableDrag(){xe.docStyle&&xe.selectProp&&(xe.docStyle[xe.selectProp]=xe.userSelect)}static setTransform(o,c){o.style[xe.transformProp]=c}static addEventListener(o,c,d,g={}){o.addEventListener(c,d,"passive"in g?g:g.capture)}static removeEventListener(o,c,d,g={}){o.removeEventListener(c,d,"passive"in g?g:g.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",xe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",xe.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",xe.suppressClickInternal,!0)},0)}static mousePos(o,c){const d=o.getBoundingClientRect();return new y.pointGeometry(c.clientX-d.left-o.clientLeft,c.clientY-d.top-o.clientTop)}static touchPos(o,c){const d=o.getBoundingClientRect(),g=[];for(let x=0;x<c.length;x++)g.push(new y.pointGeometry(c[x].clientX-d.left-o.clientLeft,c[x].clientY-d.top-o.clientTop));return g}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}xe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,xe.selectProp=xe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),xe.transformProp=xe.testProp(["transform","WebkitTransform"]);class Mo{constructor(o){this._transformRequestFn=o}transformRequest(o,c){return this._transformRequestFn&&this._transformRequestFn(o,c)||{url:o}}normalizeSpriteURL(o,c,d){const g=function(x){const C=x.match(wi);if(!C)throw new Error(`Unable to parse URL "${x}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(o);return g.path+=`${c}${d}`,function(x){const C=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${C}`}(g)}setTransformRequest(o){this._transformRequestFn=o}}const wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class On{constructor(o,c,d,g){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(c,g)}update(o,c,d){const{width:g,height:x}=o,C=!(this.size&&this.size[0]===g&&this.size[1]===x||d),{context:E}=this,{gl:M}=E;if(this.useMipmap=Boolean(c&&c.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!c||!1!==c.premultiply)),C)this.size=[g,x],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||y.isImageBitmap(o)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,g,x,0,this.format,M.UNSIGNED_BYTE,o.data);else{const{x:A,y:F}=d||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||y.isImageBitmap(o)?M.texSubImage2D(M.TEXTURE_2D,0,A,F,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,A,F,g,x,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(o,c,d){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),d!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=x.LINEAR),o!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,d||o),this.filter=o),c!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Ll(f){const{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class Wa extends y.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:d}of this.requestors)this._notify(c,d);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,c){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let d=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new y.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),d=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new y.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),d=!1),this._validateContent(c.content,c)||(this.fire(new y.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),d=!1),d}_validateStretch(o,c){if(!o)return!0;let d=0;for(const g of o){if(g[0]<d||g[1]<g[0]||c<g[1])return!1;d=g[1]}return!0}_validateContent(o,c){return!(o&&(4!==o.length||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){const d=this.images[o];if(d.data.width!==c.data.width||d.data.height!==c.data.height)throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=d.version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let d=!0;if(!this.isLoaded())for(const g of o)this.images[g]||(d=!1);this.isLoaded()||d?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const d={};for(const g of o){this.images[g]||this.fire(new y.Event("styleimagemissing",{id:g}));const x=this.images[g];x?d[g]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:y.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,d)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],d=this.getImage(o);if(!d)return null;if(c&&c.position.version===d.version)return c.position;if(c)c.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},x=new y.ImagePosition(g,d);this.patterns[o]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new On(o,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:c,h:d}=y.potpack(o),g=this.atlasImage;g.resize({width:c||1,height:d||1});for(const x in this.patterns){const{bin:C}=this.patterns[x],E=C.x+1,M=C.y+1,A=this.images[x].data,F=A.width,z=A.height;y.RGBAImage.copy(A,g,{x:0,y:0},{x:E,y:M},{width:F,height:z}),y.RGBAImage.copy(A,g,{x:0,y:z-1},{x:E,y:M-1},{width:F,height:1}),y.RGBAImage.copy(A,g,{x:0,y:0},{x:E,y:M+z},{width:F,height:1}),y.RGBAImage.copy(A,g,{x:F-1,y:0},{x:E-1,y:M},{width:1,height:z}),y.RGBAImage.copy(A,g,{x:0,y:0},{x:E+F,y:M},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const d=this.images[c];d||y.warnOnce(`Image with ID: "${c}" was not found`),Ll(d)&&this.updateImage(c,d)}}}const To=1e20;function Vr(f,o,c,d,g,x,C,E,M){for(let A=o;A<o+d;A++)Hi(f,c*x+A,x,g,C,E,M);for(let A=c;A<c+g;A++)Hi(f,A*x+o,1,d,C,E,M)}function Hi(f,o,c,d,g,x,C){x[0]=0,C[0]=-To,C[1]=To,g[0]=f[o];for(let E=1,M=0,A=0;E<d;E++){g[E]=f[o+E*c];const F=E*E;do{const z=x[M];A=(g[E]-g[z]+F-z*z)/(E-z)/2}while(A<=C[M]&&--M>-1);M++,x[M]=E,C[M]=A,C[M+1]=To}for(let E=0,M=0;E<d;E++){for(;C[M+1]<E;)M++;const A=x[M],F=E-A;f[o+E*c]=g[A]+F*F}}class Un{constructor(o,c){this.requestManager=o,this.localIdeographFontFamily=c,this.entries={}}setURL(o){this.url=o}getGlyphs(o,c){const d=[];for(const g in o)for(const x of o[g])d.push({stack:g,id:x});y.asyncAll(d,({stack:g,id:x},C)=>{let E=this.entries[g];E||(E=this.entries[g]={glyphs:{},requests:{},ranges:{}});let M=E.glyphs[x];if(void 0!==M)return void C(null,{stack:g,id:x,glyph:M});if(M=this._tinySDF(E,g,x),M)return E.glyphs[x]=M,void C(null,{stack:g,id:x,glyph:M});const A=Math.floor(x/256);if(256*A>65535)return void C(new Error("glyphs > 65535 not supported"));if(E.ranges[A])return void C(null,{stack:g,id:x,glyph:M});let F=E.requests[A];F||(F=E.requests[A]=[],Un.loadGlyphRange(g,A,this.url,this.requestManager,(z,V)=>{if(V){for(const X in V)this._doesCharSupportLocalGlyph(+X)||(E.glyphs[+X]=V[+X]);E.ranges[A]=!0}for(const X of F)X(z,V);delete E.requests[A]})),F.push((z,V)=>{z?C(z):V&&C(null,{stack:g,id:x,glyph:V[x]||null})})},(g,x)=>{if(g)c(g);else if(x){const C={};for(const{stack:E,id:M,glyph:A}of x)(C[E]||(C[E]={}))[M]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};c(null,C)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(y.unicodeBlockLookup["CJK Unified Ideographs"](o)||y.unicodeBlockLookup["Hangul Syllables"](o)||y.unicodeBlockLookup.Hiragana(o)||y.unicodeBlockLookup.Katakana(o))}_tinySDF(o,c,d){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let x=o.tinySDF;if(!x){let E="400";/bold/i.test(c)?E="900":/medium/i.test(c)?E="500":/light/i.test(c)&&(E="200"),x=o.tinySDF=new Un.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:g,fontWeight:E})}const C=x.draw(String.fromCharCode(d));return{id:d,bitmap:new y.AlphaImage({width:C.width||30,height:C.height||30},C.data),metrics:{width:C.glyphWidth||24,height:C.glyphHeight||24,left:C.glyphLeft||0,top:C.glyphTop-27||-8,advance:C.glyphAdvance||24}}}}Un.loadGlyphRange=function(f,o,c,d,g){const x=256*o,C=x+255,E=d.transformRequest(c.replace("{fontstack}",f).replace("{range}",`${x}-${C}`),y.ResourceType.Glyphs);y.getArrayBuffer(E,(M,A)=>{if(M)g(M);else if(A){const F={};for(const z of y.parseGlyphPbf(A))F[z.id]=z;g(null,F)}})},Un.TinySDF=class{constructor({fontSize:f=24,buffer:o=3,radius:c=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:C="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=c;const E=this.size=f+4*o,M=this._createCanvas(E),A=this.ctx=M.getContext("2d",{willReadFrequently:!0});A.font=`${C} ${x} ${f}px ${g}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(f){const o=document.createElement("canvas");return o.width=o.height=f,o}draw(f){const{width:o,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(f),C=Math.ceil(c),E=Math.min(this.size-this.buffer,Math.ceil(x-g)),M=Math.min(this.size-this.buffer,C+Math.ceil(d)),A=E+2*this.buffer,F=M+2*this.buffer,z=Math.max(A*F,0),V=new Uint8ClampedArray(z),X={data:V,width:A,height:F,glyphWidth:E,glyphHeight:M,glyphTop:C,glyphLeft:0,glyphAdvance:o};if(0===E||0===M)return X;const{ctx:W,buffer:Z,gridInner:re,gridOuter:ae}=this;W.clearRect(Z,Z,E,M),W.fillText(f,Z,Z+C);const he=W.getImageData(Z,Z,E,M);ae.fill(To,0,z),re.fill(0,0,z);for(let K=0;K<M;K++)for(let pe=0;pe<E;pe++){const ue=he.data[4*(K*E+pe)+3]/255;if(0===ue)continue;const _e=(K+Z)*A+pe+Z;if(1===ue)ae[_e]=0,re[_e]=To;else{const be=.5-ue;ae[_e]=be>0?be*be:0,re[_e]=be<0?be*be:0}}Vr(ae,0,0,A,F,A,this.f,this.v,this.z),Vr(re,Z,Z,E,M,A,this.f,this.v,this.z);for(let K=0;K<z;K++){const pe=Math.sqrt(ae[K])-Math.sqrt(re[K]);V[K]=Math.round(255-255*(pe/this.radius+this.cutoff))}return X}};const lo=new y.Properties({anchor:new y.DataConstantProperty(y.spec.light.anchor),position:new class{constructor(){this.specification=y.spec.light.position}possiblyEvaluate(f,o){return y.sphericalToCartesian(f.expression.evaluate(o))}interpolate(f,o,c){return{x:y.number(f.x,o.x,c),y:y.number(f.y,o.y,c),z:y.number(f.z,o.z,c)}}},color:new y.DataConstantProperty(y.spec.light.color),intensity:new y.DataConstantProperty(y.spec.light.intensity)}),co="-transition";class Ci extends y.Evented{constructor(o){super(),this._transitionable=new y.Transitionable(lo),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(y.validateLight,o,c))for(const d in o){const g=o[d];d.endsWith(co)?this._transitionable.setTransition(d.slice(0,-co.length),g):this._transitionable.setValue(d,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,d){return(!d||!1!==d.validate)&&y.emitValidationErrors(this,o.call(y.validateStyle,y.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:y.spec})))}}class la{constructor(o,c){this.width=o,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,c){const d=o.join(",")+String(c);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(o,c)),this.dashEntry[d]}getDashRanges(o,c,d){const g=[];let x=o.length%2==1?-o[o.length-1]*d:0,C=o[0]*d,E=!0;g.push({left:x,right:C,isDash:E,zeroLength:0===o[0]});let M=o[0];for(let A=1;A<o.length;A++){E=!E;const F=o[A];x=M*d,M+=F,C=M*d,g.push({left:x,right:C,isDash:E,zeroLength:0===F})}return g}addRoundDash(o,c,d){const g=c/2;for(let x=-d;x<=d;x++){const C=this.width*(this.nextRow+d+x);let E=0,M=o[E];for(let A=0;A<this.width;A++){A/M.right>1&&(M=o[++E]);const F=Math.abs(A-M.left),z=Math.abs(A-M.right),V=Math.min(F,z);let X;const W=x/d*(g+1);if(M.isDash){const Z=g-Math.abs(W);X=Math.sqrt(V*V+Z*Z)}else X=g-Math.sqrt(V*V+W*W);this.data[C+A]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(o){for(let E=o.length-1;E>=0;--E){const M=o[E],A=o[E+1];M.zeroLength?o.splice(E,1):A&&A.isDash===M.isDash&&(A.left=M.left,o.splice(E,1))}const c=o[0],d=o[o.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const g=this.width*this.nextRow;let x=0,C=o[x];for(let E=0;E<this.width;E++){E/C.right>1&&(C=o[++x]);const M=Math.abs(E-C.left),A=Math.abs(E-C.right),F=Math.min(M,A);this.data[g+E]=Math.max(0,Math.min(255,(C.isDash?F:-F)+128))}}addDash(o,c){const d=c?7:0,g=2*d+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;let x=0;for(let E=0;E<o.length;E++)x+=o[E];if(0!==x){const E=this.width/x,M=this.getDashRanges(o,this.width,E);c?this.addRoundDash(M,E,d):this.addRegularDash(M)}const C={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:x};return this.nextRow+=g,this.dirty=!0,C}bind(o){const c=o.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}class Ao{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=y.uniqueId();const d=this.workerPool.acquire(this.id);for(let g=0;g<d.length;g++){const x=new Ao.Actor(d[g],c,this.id);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,c,d){y.asyncAll(this.actors,(g,x)=>{g.send(o,c,x)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Gi(f,o,c){const d=function(g,x){if(g)return c(g);if(x){const C=y.pick(y.extend(x,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(C.vectorLayers=x.vector_layers,C.vectorLayerIds=C.vectorLayers.map(E=>E.id)),c(null,C)}};return f.url?y.getJSON(o.transformRequest(f.url,y.ResourceType.Source),d):y.exported.frame(()=>d(null,f))}Ao.Actor=y.Actor;class Di{constructor(o,c,d){this.bounds=y.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=d||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),d=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*c),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*c),C=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=d&&o.x<x&&o.y>=g&&o.y<C}}class ca extends y.Evented{constructor(o,c,d,g){if(super(),this.id=o,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(c,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gi(this._options,this.map._requestManager,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new y.ErrorEvent(o)):c&&(y.extend(this,c),c.bounds&&(this.tileBounds=new Di(c.bounds,this.minzoom,this.maxzoom)),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return y.extend({},this._options)}loadTile(o,c){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(d,y.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(C,E){return delete o.request,o.aborted?c(null):C&&404!==C.status?c(C):(E&&E.resourceTiming&&(o.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&o.setExpiryData(E),o.loadVectorData(E,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,o.actor&&"expired"!==o.state?"loading"===o.state?o.reloadCallback=c:o.request=o.actor.send("reloadTile",g,x.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",g,x.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class uo extends y.Evented{constructor(o,c,d,g){super(),this.id=o,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},c),y.extend(this,y.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gi(this._options,this.map._requestManager,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new y.ErrorEvent(o)):c&&(y.extend(this,c),c.bounds&&(this.tileBounds=new Di(c.bounds,this.minzoom,this.maxzoom)),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return y.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=y.getImage(this.map._requestManager.transformRequest(d,y.ResourceType.Tile),(g,x,C)=>{if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(g)o.state="errored",c(g);else if(x){this.map._refreshExpiredTiles&&o.setExpiryData(C);const E=this.map.painter.context,M=E.gl;o.texture=this.map.painter.getTileTexture(x.width),o.texture?o.texture.update(x,{useMipmap:!0}):(o.texture=new On(E,x,M.RGBA,{useMipmap:!0}),o.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),o.state="loaded",y.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}}let Qo;class at extends uo{constructor(o,c,d,g){super(o,c,d,g),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,c){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function g(x,C){x&&(o.state="errored",c(x)),C&&(o.dem=C,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",c(null))}o.request=y.getImage(this.map._requestManager.transformRequest(d,y.ResourceType.Tile),function(x,C){if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(x)o.state="errored",c(x);else if(C){this.map._refreshExpiredTiles&&o.setExpiryData(C),delete C.cacheControl,delete C.expires;const E=y.isImageBitmap(C)&&(null==Qo&&(Qo=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),Qo)?C:y.exported.getImageData(C,1),M={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:E,encoding:this.encoding};o.actor&&"expired"!==o.state||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",M,g.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const c=o.canonical,d=Math.pow(2,c.z),g=(c.x-1+d)%d,x=0===c.x?o.wrap-1:o.wrap,C=(c.x+1+d)%d,E=c.x+1===d?o.wrap+1:o.wrap,M={};return M[new y.OverscaledTileID(o.overscaledZ,x,c.z,g,c.y).key]={backfilled:!1},M[new y.OverscaledTileID(o.overscaledZ,E,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(M[new y.OverscaledTileID(o.overscaledZ,x,c.z,g,c.y-1).key]={backfilled:!1},M[new y.OverscaledTileID(o.overscaledZ,o.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},M[new y.OverscaledTileID(o.overscaledZ,E,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<d&&(M[new y.OverscaledTileID(o.overscaledZ,x,c.z,g,c.y+1).key]={backfilled:!1},M[new y.OverscaledTileID(o.overscaledZ,o.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},M[new y.OverscaledTileID(o.overscaledZ,E,c.z,C,c.y+1).key]={backfilled:!1}),M}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class Ur extends y.Evented{constructor(o,c,d,g){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(g),this._data=c.data,this._options=y.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*x,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*x,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:y.EXTENT,radius:(c.clusterRadius||50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},c),this}getClusterChildren(o,c){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},c),this}getClusterLeaves(o,c,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:c,offset:d},g),this}_updateWorkerData(o){const c=y.extend({},this.workerOptions),d=this._data;"string"==typeof d?(c.request=this.map._requestManager.transformRequest(y.exported.resolveURL(d),y.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(d),this._pendingLoads++,this.fire(new y.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,c,(g,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return void this.fire(new y.Event("dataabort",{dataType:"source",sourceDataType:o}));let C=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(C=x.resourceTiming[this.id].slice(0)),g)return void this.fire(new y.ErrorEvent(g));const E={dataType:"source",sourceDataType:o};this._collectResourceTiming&&C&&C.length>0&&y.extend(E,{resourceTiming:C}),this.fire(new y.Event("data",E))})}loaded(){return 0===this._pendingLoads}loadTile(o,c){const d=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const g={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(d,g,(x,C)=>(delete o.request,o.unloadVectorData(),o.aborted?c(null):x?c(x):(o.loadVectorData(C,this.map.painter,"reloadTile"===d),c(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return y.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Po=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ei extends y.Evented{constructor(o,c,d,g){super(),this.id=o,this.dispatcher=d,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=c}load(o,c){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),(d,g)=>{this._loaded=!0,d?this.fire(new y.ErrorEvent(d)):g&&(this.image=g,o&&(this.coordinates=o),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const c=o.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(g){let x=1/0,C=1/0,E=-1/0,M=-1/0;for(const V of g)x=Math.min(x,V.x),C=Math.min(C,V.y),E=Math.max(E,V.x),M=Math.max(M,V.y);const A=Math.max(E-x,M-C),F=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,F);return new y.CanonicalTileID(F,Math.floor((x+E)/2*z),Math.floor((C+M)/2*z))}(c),this.minzoom=this.maxzoom=this.tileID.z;const d=c.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new y.RasterBoundsArray,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,c=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Po.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new On(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const d in this.tiles){const g=this.tiles[d];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class on extends Ei{constructor(o,c,d,g){super(o,c,d,g),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const c of o.urls)this.urls.push(this.map._requestManager.transformRequest(c,y.ResourceType.Source).url);y.getVideo(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new y.ErrorEvent(c)):d&&(this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const c=this.video.seekable;o<c.start(0)||o>c.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const o=this.map.painter.context,c=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Po.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new On(o,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const d in this.tiles){const g=this.tiles[d];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class es extends Ei{constructor(o,c,d,g){super(o,c,d,g),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(C=>"number"!=typeof C))||this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context,d=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Po.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new On(c,this.canvas,d.RGBA,{premultiply:!0});for(const g in this.tiles){const x=this.tiles[g];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const ua={vector:ca,raster:uo,"raster-dem":at,geojson:Ur,video:on,image:Ei,canvas:es};function ha(f,o){const c=y.create();return y.translate(c,c,[1,1,0]),y.scale(c,c,[.5*f.width,.5*f.height,1]),y.multiply(c,c,f.calculatePosMatrix(o.toUnwrapped()))}function da(f,o,c,d,g,x){const C=function(z,V,X){if(z)for(const W of z){const Z=V[W];if(Z&&Z.source===X&&"fill-extrusion"===Z.type)return!0}else for(const W in V){const Z=V[W];if(Z.source===X&&"fill-extrusion"===Z.type)return!0}return!1}(g&&g.layers,o,f.id),E=x.maxPitchScaleFactor(),M=f.tilesIn(d,E,C);M.sort(rr);const A=[];for(const z of M)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(o,c,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,g,x,E,ha(f.transform,z.tileID))});const F=function(z){const V={},X={};for(const W of z){const Z=W.queryResults,re=W.wrappedTileID,ae=X[re]=X[re]||{};for(const he in Z){const K=Z[he],pe=ae[he]=ae[he]||{},ue=V[he]=V[he]||[];for(const _e of K)pe[_e.featureIndex]||(pe[_e.featureIndex]=!0,ue.push(_e))}}return V}(A);for(const z in F)F[z].forEach(V=>{const X=V.feature,W=f.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=W});return F}function rr(f,o){const c=f.tileID,d=o.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}class ko{constructor(o,c){this.tileID=o,this.uid=y.uniqueId(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const c=o+this.timeAdded;c<y.exported.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(c=>o.saveTileTexture(c)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,c,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(g,x){const C={};if(!x)return C;for(const E of g){const M=E.layerIds.map(A=>x.getLayer(A)).filter(Boolean);if(0!==M.length){E.layers=M,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(A=>M.filter(F=>F.id===A)[0]));for(const A of M)C[A.id]=E}}return C}(o.buckets,c.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof y.SymbolBucket){if(this.hasSymbolBuckets=!0,!d)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof y.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,y.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(g).queryRadius(x))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new y.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(o)}const c=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new On(o,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new On(o,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,c,d,g,x,C,E,M,A,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:F,transform:M,params:E,queryPadding:this.queryPadding*A},o,c,d):{}}querySourceFeatures(o,c){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),x=c?c.sourceLayer:"",C=g._geojsonTileLayer||g[x];if(!C)return;const E=y.createFilter(c&&c.filter),{z:M,x:A,y:F}=this.tileID.canonical,z={z:M,x:A,y:F};for(let V=0;V<C.length;V++){const X=C.feature(V);if(E.needGeometry){const re=y.toEvaluationFeature(X,!0);if(!E.filter(new y.EvaluationParameters(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!E.filter(new y.EvaluationParameters(this.tileID.overscaledZ),X))continue;const W=d.getId(X,x),Z=new y.GeoJSONFeature(X,M,A,F,W);Z.tile=z,o.push(Z)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const c=this.expirationTime;if(o.cacheControl){const d=y.parseCacheControl(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(c)if(this.expirationTime<c)g=!0;else{const x=this.expirationTime-c;x?this.expirationTime=d+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!c.style.hasLayer(g))continue;const x=this.buckets[g],C=x.layers[0].sourceLayer||"_geojsonTileLayer",E=d[C],M=o[C];if(!E||!M||0===Object.keys(M).length)continue;x.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=c&&c.style&&c.style.getLayer(g);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=y.exported.now()+o}setDependencies(o,c){const d={};for(const g of c)d[g]=!0;this.dependencies[o]=d}hasDependency(o,c){for(const d of o){const g=this.dependencies[d];if(g)for(const x of c)if(g[x])return!0}return!1}}class Ro{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(const o in this.data)for(const c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,d){const g=o.wrapped().key;void 0===this.data[g]&&(this.data[g]=[]);const x={value:c,timeout:void 0};if(void 0!==d&&(x.timeout=setTimeout(()=>{this.remove(o,x)},d)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){const c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;const d=o.wrapped().key,g=void 0===c?0:this.data[d].indexOf(c),x=this.data[d][g];return this.data[d].splice(g,1),x.timeout&&clearTimeout(x.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(x.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){const c=[];for(const d in this.data)for(const g of this.data[d])o(g.value)||c.push(g);for(const d of c)this.remove(d.value.tileID,d)}}class An{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,d){const g=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][g]=this.stateChanges[o][g]||{},y.extend(this.stateChanges[o][g],d),null===this.deletedStates[o]){this.deletedStates[o]={};for(const x in this.state[o])x!==g&&(this.deletedStates[o][x]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][g]){this.deletedStates[o][g]={};for(const x in this.state[o][g])d[x]||(this.deletedStates[o][g][x]=null)}else for(const x in d)this.deletedStates[o]&&this.deletedStates[o][g]&&null===this.deletedStates[o][g][x]&&delete this.deletedStates[o][g][x]}removeFeatureState(o,c,d){if(null===this.deletedStates[o])return;const g=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&void 0!==c)null!==this.deletedStates[o][g]&&(this.deletedStates[o][g]=this.deletedStates[o][g]||{},this.deletedStates[o][g][d]=null);else if(void 0!==c)if(this.stateChanges[o]&&this.stateChanges[o][g])for(d in this.deletedStates[o][g]={},this.stateChanges[o][g])this.deletedStates[o][g][d]=null;else this.deletedStates[o][g]=null;else this.deletedStates[o]=null}getState(o,c){const d=String(c),g=y.extend({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const x=this.deletedStates[o][c];if(null===x)return{};for(const C in x)delete g[C]}return g}initializeTileState(o,c){o.setFeatureState(this.state,c)}coalesceChanges(o,c){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const C in this.stateChanges[g])this.state[g][C]||(this.state[g][C]={}),y.extend(this.state[g][C],this.stateChanges[g][C]),x[C]=this.state[g][C];d[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(null===this.deletedStates[g])for(const C in this.state[g])x[C]={},this.state[g][C]={};else for(const C in this.deletedStates[g]){if(null===this.deletedStates[g][C])this.state[g][C]={};else for(const E of Object.keys(this.deletedStates[g][C]))delete this.state[g][C][E];x[C]=this.state[g][C]}d[g]=d[g]||{},y.extend(d[g],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const g in o)o[g].setFeatureState(d,c)}}class Qt extends y.Evented{constructor(o,c,d){super(),this.id=o,this.dispatcher=d,this.on("data",g=>{"source"===g.dataType&&"metadata"===g.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===g.dataType&&"content"===g.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(g,x,C,E){const M=new ua[x.type](g,x,C,E);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return y.bindAll(["load","abort","unload","serialize","prepare"],M),M}(o,c,d,this),this._tiles={},this._cache=new Ro(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new An}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const c=this._tiles[o];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,c){return this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new y.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const d=this._tiles[c];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(pa).map(o=>o.key)}getRenderableIds(o){const c=[];for(const d in this._tiles)this._isIdRenderable(d,o)&&c.push(this._tiles[d]);return o?c.sort((d,g)=>{const x=d.tileID,C=g.tileID,E=new y.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new y.pointGeometry(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||M.y-E.y||M.x-E.x}).map(d=>d.tileID.key):c.map(d=>d.tileID).sort(pa).map(d=>d.key)}hasRenderableParent(o){const c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(o,"reloading")}}_reloadTile(o,c){const d=this._tiles[o];d&&("loading"!==d.state&&(d.state=c),this._loadTile(d,this._tileLoaded.bind(this,d,o,c)))}_tileLoaded(o,c,d,g){if(g)return o.state="errored",void(404!==g.status?this._source.fire(new y.ErrorEvent(g,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=y.exported.now(),"expired"===d&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),"raster-dem"===this.getSource().type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new y.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const c=this.getRenderableIds();for(let g=0;g<c.length;g++){const x=c[g];if(o.neighboringTiles&&o.neighboringTiles[x]){const C=this.getTileByID(x);d(o,C),d(C,o)}}function d(g,x){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let C=x.tileID.canonical.x-g.tileID.canonical.x;const E=x.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),A=x.tileID.key;0===C&&0===E||Math.abs(E)>1||(Math.abs(C)>1&&(1===Math.abs(C+M)?C+=M:1===Math.abs(C-M)&&(C-=M)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,C,E),g.neighboringTiles&&g.neighboringTiles[A]&&(g.neighboringTiles[A].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,d,g){for(const x in this._tiles){let C=this._tiles[x];if(g[x]||!C.hasData()||C.tileID.overscaledZ<=c||C.tileID.overscaledZ>d)continue;let E=C.tileID;for(;C&&C.tileID.overscaledZ>c+1;){const A=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[A.key],C&&C.hasData()&&(E=A)}let M=E;for(;M.overscaledZ>c;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){g[E.key]=E;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=c?d:null}for(let d=o.overscaledZ-1;d>=c;d--){const g=o.scaledTo(d),x=this._getLoadedTile(g);if(x)return x}}_getLoadedTile(o){const c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const c=Math.ceil(o.width/this._source.tileSize)+1,d=Math.ceil(o.height/this._source.tileSize)+1,g=Math.floor(c*d*5),x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(o){const c=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,c){const d={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),d[x.tileID.key]=x}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(o,c){if(this.transform=o,this.terrain=c,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new y.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(d=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c}),this._source.hasTile&&(d=d.filter(A=>this._source.hasTile(A)))):d=[];const g=o.coveringZoomLevel(this._source),x=Math.max(g-Qt.maxOverzooming,this._source.minzoom),C=Math.max(g+Qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const F of d)if(F.canonical.z>this._source.minzoom){const z=F.scaledTo(F.canonical.z-1);A[z.key]=z;const V=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));A[V.key]=V}d=d.concat(Object.values(A))}const E=this._updateRetainedTiles(d,g);if(At(this._source.type)){const A={},F={},z=Object.keys(E);for(const V of z){const X=E[V],W=this._tiles[V];if(!W||W.fadeEndTime&&W.fadeEndTime<=y.exported.now())continue;const Z=this.findLoadedParent(X,x);Z&&(this._addTile(Z.tileID),A[Z.tileID.key]=Z.tileID),F[V]=X}this._retainLoadedChildren(F,g,C,E);for(const V in A)E[V]||(this._coveredTiles[V]=!0,E[V]=A[V]);if(c){const V={},X={};for(const W of d)this._tiles[W.key].hasData()?V[W.key]=W:X[W.key]=W;for(const W in X){const Z=X[W].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(V[Z[0].key]=E[Z[0].key]=Z[0],V[Z[1].key]=E[Z[1].key]=Z[1],V[Z[2].key]=E[Z[2].key]=Z[2],V[Z[3].key]=E[Z[3].key]=Z[3],delete X[W])}for(const W in X){const Z=this.findLoadedParent(X[W],this._source.minzoom);if(Z){V[Z.tileID.key]=E[Z.tileID.key]=Z.tileID;for(const re in V)V[re].isChildOf(Z.tileID)&&delete V[re]}}for(const W in this._tiles)V[W]||(this._coveredTiles[W]=!0)}}for(const A in E)this._tiles[A].clearFadeHold();const M=y.keysDifference(this._tiles,E);for(const A of M){const F=this._tiles[A];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,c){const d={},g={},x=Math.max(c-Qt.maxOverzooming,this._source.minzoom),C=Math.max(c+Qt.maxUnderzooming,this._source.minzoom),E={};for(const M of o){const A=this._addTile(M);d[M.key]=M,A.hasData()||c<this._source.maxzoom&&(E[M.key]=M)}this._retainLoadedChildren(E,c,C,d);for(const M of o){let A=this._tiles[M.key];if(A.hasData())continue;if(c+1>this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],V=this.getTile(z);if(V&&V.hasData()){d[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(d[z[0].key]&&d[z[1].key]&&d[z[2].key]&&d[z[3].key])continue}let F=A.wasRequested();for(let z=M.overscaledZ-1;z>=x;--z){const V=M.scaledTo(z);if(g[V.key]||(g[V.key]=!0,A=this.getTile(V),!A&&F&&(A=this._addTile(V)),A&&(d[V.key]=V,F=A.wasRequested(),A.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const c=[];let d,g=this._tiles[o].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}c.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(x),d)break;g=x}for(const x of c)this._loadedParentTiles[x]=d}}_addTile(o){let c=this._tiles[o.key];if(c)return c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));const d=c;return c||(c=new ko(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))),c.uses++,this._tiles[o.key]=c,d||this._source.fire(new y.Event("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=c.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&"reloading"!==c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,c,d){const g=[],x=this.transform;if(!x)return g;const C=d?x.getCameraQueryGeometry(o):o,E=o.map(W=>x.pointCoordinate(W,this.terrain)),M=C.map(W=>x.pointCoordinate(W,this.terrain)),A=this.getIds();let F=1/0,z=1/0,V=-1/0,X=-1/0;for(const W of M)F=Math.min(F,W.x),z=Math.min(z,W.y),V=Math.max(V,W.x),X=Math.max(X,W.y);for(let W=0;W<A.length;W++){const Z=this._tiles[A[W]];if(Z.holdingForFade())continue;const re=Z.tileID,ae=Math.pow(2,x.zoom-Z.tileID.overscaledZ),he=c*Z.queryPadding*y.EXTENT/Z.tileSize/ae,K=[re.getTilePoint(new y.MercatorCoordinate(F,z)),re.getTilePoint(new y.MercatorCoordinate(V,X))];if(K[0].x-he<y.EXTENT&&K[0].y-he<y.EXTENT&&K[1].x+he>=0&&K[1].y+he>=0){const pe=E.map(_e=>re.getTilePoint(_e)),ue=M.map(_e=>re.getTilePoint(_e));g.push({tile:Z,tileID:re,queryGeometry:pe,cameraQueryGeometry:ue,scale:ae})}}return g}getVisibleCoordinates(o){const c=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of c)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(At(this._source.type))for(const o in this._tiles){const c=this._tiles[o];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=y.exported.now())return!0}return!1}setFeatureState(o,c,d){this._state.updateState(o=o||"_geojsonTileLayer",c,d)}removeFeatureState(o,c,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,d)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,d){const g=this._tiles[o];g&&g.setDependencies(c,d)}reloadTilesForDependencies(o,c){for(const d in this._tiles)this._tiles[d].hasDependency(o,c)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(o,c))}}function pa(f,o){const c=Math.abs(2*f.wrap)-+(f.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return f.overscaledZ-o.overscaledZ||d-c||o.canonical.y-f.canonical.y||o.canonical.x-f.canonical.x}function At(f){return"raster"===f||"image"===f||"video"===f}Qt.maxOverzooming=10,Qt.maxUnderzooming=3;const qi="mapboxgl_preloaded_worker_pool";class Ii{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Ii.workerCount;)this.workers.push(new Worker(ms.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qi]}numActive(){return Object.keys(this.active).length}}const fa=Math.floor(y.exported.hardwareConcurrency/2);let As;function Za(){return As||(As=new Ii),As}function Xa(f,o){const c={};for(const d in f)"ref"!==d&&(c[d]=f[d]);return y.refProperties.forEach(d=>{d in o&&(c[d]=o[d])}),c}function Ol(f){f=f.slice();const o=Object.create(null);for(let c=0;c<f.length;c++)o[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=Xa(f[c],o[f[c].ref]));return f}Ii.workerCount=Math.max(Math.min(fa,6),1);const jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Fo(f,o,c){c.push({command:jt.addSource,args:[f,o[f]]})}function Lo(f,o,c){o.push({command:jt.removeSource,args:[f]}),c[f]=!0}function Ps(f,o,c,d){Lo(f,c,d),Fo(f,o,c)}function ma(f,o,c){let d;for(d in f[c])if(Object.prototype.hasOwnProperty.call(f[c],d)&&"data"!==d&&!Xt(f[c][d],o[c][d]))return!1;for(d in o[c])if(Object.prototype.hasOwnProperty.call(o[c],d)&&"data"!==d&&!Xt(f[c][d],o[c][d]))return!1;return!0}function Oo(f,o,c,d,g,x){let C;for(C in o=o||{},f=f||{})Object.prototype.hasOwnProperty.call(f,C)&&(Xt(f[C],o[C])||c.push({command:x,args:[d,C,o[C],g]}));for(C in o)Object.prototype.hasOwnProperty.call(o,C)&&!Object.prototype.hasOwnProperty.call(f,C)&&(Xt(f[C],o[C])||c.push({command:x,args:[d,C,o[C],g]}))}function ts(f){return f.id}function Ka(f,o){return f[o.id]=o,f}class ns{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=y.clamp(o,0,1);let c=1,d=this._distances[c];const g=o*this.paddedLength+this.padding;for(;d<g&&c<this._distances.length;)d=this._distances[++c];const x=c-1,C=this._distances[x],E=d-C,M=E>0?(g-C)/E:0;return this.points[x].mult(1-M).add(this.points[c].mult(M))}}function ve(f,o){let c=!0;return"always"===f||"never"!==f&&"never"!==o||(c=!1),c}class Oe{constructor(o,c,d){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/d),this.yCellCount=Math.ceil(c/d);for(let C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,d,g,x){this._forEachCell(c,d,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(o,c,d,g){this._forEachCell(c-g,d-g,c+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(d),this.circles.push(g)}_insertBoxCell(o,c,d,g,x,C){this.boxCells[x].push(C)}_insertCircleCell(o,c,d,g,x,C){this.circleCells[x].push(C)}_query(o,c,d,g,x,C,E){if(d<0||o>this.width||g<0||c>this.height)return[];const M=[];if(o<=0&&c<=0&&this.width<=d&&this.height<=g){if(x)return[{key:null,x1:o,y1:c,x2:d,y2:g}];for(let A=0;A<this.boxKeys.length;A++)M.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const F=this.circles[3*A],z=this.circles[3*A+1],V=this.circles[3*A+2];M.push({key:this.circleKeys[A],x1:F-V,y1:z-V,x2:F+V,y2:z+V})}}else this._forEachCell(o,c,d,g,this._queryCell,M,{hitTest:x,overlapMode:C,seenUids:{box:{},circle:{}}},E);return M}query(o,c,d,g){return this._query(o,c,d,g,!1,null)}hitTest(o,c,d,g,x,C){return this._query(o,c,d,g,!0,x,C).length>0}hitTestCircle(o,c,d,g,x){const C=o-d,E=o+d,M=c-d,A=c+d;if(E<0||C>this.width||A<0||M>this.height)return!1;const F=[];return this._forEachCell(C,M,E,A,this._queryCellCircle,F,{hitTest:!0,overlapMode:g,circle:{x:o,y:c,radius:d},seenUids:{box:{},circle:{}}},x),F.length>0}_queryCell(o,c,d,g,x,C,E,M){const{seenUids:A,hitTest:F,overlapMode:z}=E,V=this.boxCells[x];if(null!==V){const W=this.bboxes;for(const Z of V)if(!A.box[Z]){A.box[Z]=!0;const re=4*Z,ae=this.boxKeys[Z];if(o<=W[re+2]&&c<=W[re+3]&&d>=W[re+0]&&g>=W[re+1]&&(!M||M(ae))&&(!F||!ve(z,ae.overlapMode))&&(C.push({key:ae,x1:W[re],y1:W[re+1],x2:W[re+2],y2:W[re+3]}),F))return!0}}const X=this.circleCells[x];if(null!==X){const W=this.circles;for(const Z of X)if(!A.circle[Z]){A.circle[Z]=!0;const re=3*Z,ae=this.circleKeys[Z];if(this._circleAndRectCollide(W[re],W[re+1],W[re+2],o,c,d,g)&&(!M||M(ae))&&(!F||!ve(z,ae.overlapMode))){const he=W[re],K=W[re+1],pe=W[re+2];if(C.push({key:ae,x1:he-pe,y1:K-pe,x2:he+pe,y2:K+pe}),F)return!0}}}return!1}_queryCellCircle(o,c,d,g,x,C,E,M){const{circle:A,seenUids:F,overlapMode:z}=E,V=this.boxCells[x];if(null!==V){const W=this.bboxes;for(const Z of V)if(!F.box[Z]){F.box[Z]=!0;const re=4*Z,ae=this.boxKeys[Z];if(this._circleAndRectCollide(A.x,A.y,A.radius,W[re+0],W[re+1],W[re+2],W[re+3])&&(!M||M(ae))&&!ve(z,ae.overlapMode))return C.push(!0),!0}}const X=this.circleCells[x];if(null!==X){const W=this.circles;for(const Z of X)if(!F.circle[Z]){F.circle[Z]=!0;const re=3*Z,ae=this.circleKeys[Z];if(this._circlesCollide(W[re],W[re+1],W[re+2],A.x,A.y,A.radius)&&(!M||M(ae))&&!ve(z,ae.overlapMode))return C.push(!0),!0}}}_forEachCell(o,c,d,g,x,C,E,M){const A=this._convertToXCellCoord(o),F=this._convertToYCellCoord(c),z=this._convertToXCellCoord(d),V=this._convertToYCellCoord(g);for(let X=A;X<=z;X++)for(let W=F;W<=V;W++)if(x.call(this,o,c,d,g,this.xCellCount*W+X,C,E,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,d,g,x,C){const E=g-o,M=x-c,A=d+C;return A*A>E*E+M*M}_circleAndRectCollide(o,c,d,g,x,C,E){const M=(C-g)/2,A=Math.abs(o-(g+M));if(A>M+d)return!1;const F=(E-x)/2,z=Math.abs(c-(x+F));if(z>F+d)return!1;if(A<=M||z<=F)return!0;const V=A-M,X=z-F;return V*V+X*X<=d*d}}function ga(f,o,c,d,g){const x=y.create();return o?(y.scale(x,x,[1/g,1/g,1]),c||y.rotateZ(x,x,d.angle)):y.multiply(x,d.labelPlaneMatrix,f),x}function Wi(f,o,c,d,g){if(o){const x=y.clone(f);return y.scale(x,x,[g,g,1]),c||y.rotateZ(x,x,-d.angle),x}return d.glCoordMatrix}function qt(f,o,c){let d;c?(d=[f.x,f.y,c(f.x,f.y),1],y.transformMat4(d,d,o)):(d=[f.x,f.y,0,1],ho(d,d,o));const g=d[3];return{point:new y.pointGeometry(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function Si(f,o){return.5+f/o*.5}function Mi(f,o){const c=f[0]/f[3],d=f[1]/f[3];return c>=-o[0]&&c<=o[0]&&d>=-o[1]&&d<=o[1]}function Ti(f,o,c,d,g,x,C,E,M,A){const F=d?f.textSizeData:f.iconSizeData,z=y.evaluateSizeForZoom(F,c.transform.zoom),V=[256/c.width*2+1,256/c.height*2+1],X=d?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;X.clear();const W=f.lineVertexArray,Z=d?f.text.placedSymbolArray:f.icon.placedSymbolArray,re=c.transform.width/c.transform.height;let ae=!1;for(let he=0;he<Z.length;he++){const K=Z.get(he);if(K.hidden||K.writingMode===y.WritingMode.vertical&&!ae){pt(K.numGlyphs,X);continue}let pe;if(ae=!1,A?(pe=[K.anchorX,K.anchorY,A(K.anchorX,K.anchorY),1],y.transformMat4(pe,pe,o)):(pe=[K.anchorX,K.anchorY,0,1],ho(pe,pe,o)),!Mi(pe,V)){pt(K.numGlyphs,X);continue}const ue=Si(c.transform.cameraToCenterDistance,pe[3]),_e=y.evaluateSizeForFeature(F,z,K),be=C?_e/ue:_e*ue,Se=new y.pointGeometry(K.anchorX,K.anchorY),me=qt(Se,g,A).point,He={},Re=Pt(K,be,!1,E,o,g,x,f.glyphOffsetArray,W,X,me,Se,He,re,M,A);ae=Re.useVertical,(Re.notEnoughRoom||ae||Re.needsFlipping&&Pt(K,be,!0,E,o,g,x,f.glyphOffsetArray,W,X,me,Se,He,re,M,A).notEnoughRoom)&&pt(K.numGlyphs,X)}d?f.text.dynamicLayoutVertexBuffer.updateData(X):f.icon.dynamicLayoutVertexBuffer.updateData(X)}function ks(f,o,c,d,g,x,C,E,M,A,F,z,V){const X=E.glyphStartIndex+E.numGlyphs,W=E.lineStartIndex,Z=E.lineStartIndex+E.lineLength,re=o.getoffsetX(E.glyphStartIndex),ae=o.getoffsetX(X-1),he=hr(f*re,c,d,g,x,C,E.segment,W,Z,M,A,F,z,V);if(!he)return null;const K=hr(f*ae,c,d,g,x,C,E.segment,W,Z,M,A,F,z,V);return K?{first:he,last:K}:null}function Le(f,o,c,d){return f===y.WritingMode.horizontal&&Math.abs(c.y-o.y)>Math.abs(c.x-o.x)*d?{useVertical:!0}:(f===y.WritingMode.vertical?o.y<c.y:o.x>c.x)?{needsFlipping:!0}:null}function Pt(f,o,c,d,g,x,C,E,M,A,F,z,V,X,W,Z){const re=o/24,ae=f.lineOffsetX*re,he=f.lineOffsetY*re;let K;if(f.numGlyphs>1){const pe=f.glyphStartIndex+f.numGlyphs,ue=f.lineStartIndex,_e=f.lineStartIndex+f.lineLength,be=ks(re,E,ae,he,c,F,z,f,M,x,V,W,Z);if(!be)return{notEnoughRoom:!0};const Se=qt(be.first.point,C,Z).point,me=qt(be.last.point,C,Z).point;if(d&&!c){const He=Le(f.writingMode,Se,me,X);if(He)return He}K=[be.first];for(let He=f.glyphStartIndex+1;He<pe-1;He++)K.push(hr(re*E.getoffsetX(He),ae,he,c,F,z,f.segment,ue,_e,M,x,V,W,Z));K.push(be.last)}else{if(d&&!c){const ue=qt(z,g,Z).point,_e=f.lineStartIndex+f.segment+1,be=new y.pointGeometry(M.getx(_e),M.gety(_e)),Se=qt(be,g,Z),me=Se.signedDistanceFromCamera>0?Se.point:_t(z,be,ue,1,g,Z),He=Le(f.writingMode,ue,me,X);if(He)return He}const pe=hr(re*E.getoffsetX(f.glyphStartIndex),ae,he,c,F,z,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,M,x,V,W,Z);if(!pe)return{notEnoughRoom:!0};K=[pe]}for(const pe of K)y.addDynamicAttributes(A,pe.point,pe.angle);return{}}function _t(f,o,c,d,g,x){const C=qt(f.add(f.sub(o)._unit()),g,x).point,E=c.sub(C);return c.add(E._mult(d/E.mag()))}function hr(f,o,c,d,g,x,C,E,M,A,F,z,V,X){const W=d?f-o:f+o;let Z=W>0?1:-1,re=0;d&&(Z*=-1,re=Math.PI),Z<0&&(re+=Math.PI);let ae=Z>0?E+C:E+C+1,he=g,K=g,pe=0,ue=0;const _e=Math.abs(W),be=[];for(;pe+ue<=_e;){if(ae+=Z,ae<E||ae>=M)return null;if(K=he,be.push(he),he=z[ae],void 0===he){const qe=new y.pointGeometry(A.getx(ae),A.gety(ae)),xt=qt(qe,F,X);if(xt.signedDistanceFromCamera>0)he=z[ae]=xt.point;else{const Dt=ae-Z;he=_t(0===pe?x:new y.pointGeometry(A.getx(Dt),A.gety(Dt)),qe,K,_e-pe+1,F,X)}}pe+=ue,ue=K.dist(he)}const Se=(_e-pe)/ue,me=he.sub(K),He=me.mult(Se)._add(K);He._add(me._unit()._perp()._mult(c*Z));const Re=re+Math.atan2(he.y-K.y,he.x-K.x);return be.push(He),{point:He,angle:V?Re:0,path:be}}const No=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pt(f,o){for(let c=0;c<f;c++){const d=o.length;o.resize(d+4),o.float32.set(No,3*d)}}function ho(f,o,c){const d=o[0],g=o[1];return f[0]=c[0]*d+c[4]*g+c[12],f[1]=c[1]*d+c[5]*g+c[13],f[3]=c[3]*d+c[7]*g+c[15],f}const dr=100;class Rs{constructor(o,c=new Oe(o.width+200,o.height+200,25),d=new Oe(o.width+200,o.height+200,25)){this.transform=o,this.grid=c,this.ignoredGrid=d,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+dr,this.screenBottomBoundary=o.height+dr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,c,d,g,x,C){const E=this.projectAndGetPerspectiveRatio(g,o.anchorPointX,o.anchorPointY,C),M=d*E.perspectiveRatio,A=o.x1*M+E.point.x,F=o.y1*M+E.point.y,z=o.x2*M+E.point.x,V=o.y2*M+E.point.y;return!this.isInsideGrid(A,F,z,V)||"always"!==c&&this.grid.hitTest(A,F,z,V,c,x)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,F,z,V],offscreen:this.isOffscreen(A,F,z,V)}}placeCollisionCircles(o,c,d,g,x,C,E,M,A,F,z,V,X,W){const Z=[],re=new y.pointGeometry(c.anchorX,c.anchorY),ae=qt(re,C,W),he=Si(this.transform.cameraToCenterDistance,ae.signedDistanceFromCamera),K=(F?x/he:x*he)/y.ONE_EM,pe=qt(re,E,W).point,ue=ks(K,g,c.lineOffsetX*K,c.lineOffsetY*K,!1,pe,re,c,d,E,{},!1,W);let _e=!1,be=!1,Se=!0;if(ue){const me=.5*V*he+X,He=new y.pointGeometry(-100,-100),Re=new y.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),qe=new ns,xt=ue.first,Dt=ue.last;let rt=[];for(let Bt=xt.path.length-1;Bt>=1;Bt--)rt.push(xt.path[Bt]);for(let Bt=1;Bt<Dt.path.length;Bt++)rt.push(Dt.path[Bt]);const ln=2.5*me;if(M){const Bt=rt.map(Vt=>qt(Vt,M,W));rt=Bt.some(Vt=>Vt.signedDistanceFromCamera<=0)?[]:Bt.map(Vt=>Vt.point)}let tn=[];if(rt.length>0){const Bt=rt[0].clone(),Vt=rt[0].clone();for(let cn=1;cn<rt.length;cn++)Bt.x=Math.min(Bt.x,rt[cn].x),Bt.y=Math.min(Bt.y,rt[cn].y),Vt.x=Math.max(Vt.x,rt[cn].x),Vt.y=Math.max(Vt.y,rt[cn].y);tn=Bt.x>=He.x&&Vt.x<=Re.x&&Bt.y>=He.y&&Vt.y<=Re.y?[rt]:Vt.x<He.x||Bt.x>Re.x||Vt.y<He.y||Bt.y>Re.y?[]:y.clipLine([rt],He.x,He.y,Re.x,Re.y)}for(const Bt of tn){qe.reset(Bt,.25*me);let Vt=0;Vt=qe.length<=.5*me?1:Math.ceil(qe.paddedLength/ln)+1;for(let cn=0;cn<Vt;cn++){const ir=cn/Math.max(Vt-1,1),Ji=qe.lerp(ir),ki=Ji.x+dr,Yi=Ji.y+dr;Z.push(ki,Yi,me,0);const _o=ki-me,Ri=Yi-me,si=ki+me,$n=Yi+me;if(Se=Se&&this.isOffscreen(_o,Ri,si,$n),be=be||this.isInsideGrid(_o,Ri,si,$n),"always"!==o&&this.grid.hitTestCircle(ki,Yi,me,o,z)&&(_e=!0,!A))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!A&&_e||!be||he<this.perspectiveRatioCutoff?[]:Z,offscreen:Se,collisionDetected:_e}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let d=1/0,g=1/0,x=-1/0,C=-1/0;for(const F of o){const z=new y.pointGeometry(F.x+dr,F.y+dr);d=Math.min(d,z.x),g=Math.min(g,z.y),x=Math.max(x,z.x),C=Math.max(C,z.y),c.push(z)}const E=this.grid.query(d,g,x,C).concat(this.ignoredGrid.query(d,g,x,C)),M={},A={};for(const F of E){const z=F.key;if(void 0===M[z.bucketInstanceId]&&(M[z.bucketInstanceId]={}),M[z.bucketInstanceId][z.featureIndex])continue;const V=[new y.pointGeometry(F.x1,F.y1),new y.pointGeometry(F.x2,F.y1),new y.pointGeometry(F.x2,F.y2),new y.pointGeometry(F.x1,F.y2)];y.polygonIntersectsPolygon(c,V)&&(M[z.bucketInstanceId][z.featureIndex]=!0,void 0===A[z.bucketInstanceId]&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(o,c,d,g,x,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:C,overlapMode:c},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,d,g,x,C){const E=d?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:x,collisionGroupID:C,overlapMode:c};for(let A=0;A<o.length;A+=4)E.insertCircle(M,o[A],o[A+1],o[A+2])}projectAndGetPerspectiveRatio(o,c,d,g){let x;return g?(x=[c,d,g(c,d),1],y.transformMat4(x,x,o)):(x=[c,d,0,1],ho(x,x,o)),{point:new y.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+dr,(-x[1]/x[3]+1)/2*this.transform.height+dr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(o,c,d,g){return d<dr||o>=this.screenRightBoundary||g<dr||c>this.screenBottomBoundary}isInsideGrid(o,c,d,g){return d>=0&&o<this.gridRightBoundary&&g>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=y.identity([]);return y.translate(o,o,[-100,-100,0]),o}}function Xn(f,o,c){return o*(y.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}class Ir{constructor(o,c,d,g){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):g&&d?1:0,this.placed=d}isHidden(){return 0===this.opacity&&!this.placed}}class hn{constructor(o,c,d,g,x){this.text=new Ir(o?o.text:null,c,d,x),this.icon=new Ir(o?o.icon:null,c,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _r{constructor(o,c,d){this.text=o,this.icon=c,this.skipFade=d}}class po{constructor(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]}}class Fs{constructor(o,c,d,g,x){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=x}}class Ls{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:d=>d.collisionGroupID===c}}return this.collisionGroups[o]}}function ya(f,o,c,d,g){const{horizontalAlign:x,verticalAlign:C}=y.getAnchorAlignment(f),E=-(x-.5)*o,M=-(C-.5)*c,A=y.evaluateVariableOffset(f,d);return new y.pointGeometry(E+A[0]*g,M+A[1]*g)}function rs(f,o,c,d,g,x){const{x1:C,x2:E,y1:M,y2:A,anchorPointX:F,anchorPointY:z}=f,V=new y.pointGeometry(o,c);return d&&V._rotate(g?x:-x),{x1:C+V.x,y1:M+V.y,x2:E+V.x,y2:A+V.y,anchorPointX:F,anchorPointY:z}}class G{constructor(o,c,d,g,x){this.transform=o.clone(),this.terrain=c,this.collisionIndex=new Rs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ls(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,d,g){const x=d.getBucket(c),C=d.latestFeatureIndex;if(!x||!C||c.id!==x.layerIds[0])return;const E=d.collisionBoxArray,M=x.layers[0].layout,A=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),F=d.tileSize/y.EXTENT,z=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),V="map"===M.get("text-pitch-alignment"),X="map"===M.get("text-rotation-alignment"),W=Xn(d,1,this.transform.zoom),Z=ga(z,V,X,this.transform,W);let re=null;if(V){const he=Wi(z,V,X,this.transform,W);re=y.multiply([],this.transform.labelPlaneMatrix,he)}this.retainedQueryData[x.bucketInstanceId]=new Fs(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,d.tileID);const ae={bucket:x,layout:M,posMatrix:z,textLabelPlaneMatrix:Z,labelToScreenMatrix:re,scale:A,textPixelRatio:F,holdingForFade:d.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const he of x.sortKeyRanges){const{sortKey:K,symbolInstanceStart:pe,symbolInstanceEnd:ue}=he;o.push({sortKey:K,symbolInstanceStart:pe,symbolInstanceEnd:ue,parameters:ae})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(o,c,d,g,x,C,E,M,A,F,z,V,X,W,Z,re){const ae=[V.textOffset0,V.textOffset1],he=ya(o,d,g,ae,x),K=this.collisionIndex.placeCollisionBox(rs(c,he.x,he.y,C,E,this.transform.angle),z,M,A,F.predicate,re);if((!Z||0!==this.collisionIndex.placeCollisionBox(rs(Z,he.x,he.y,C,E,this.transform.angle),z,M,A,F.predicate,re).box.length)&&K.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[V.crossTileID].anchor),0===V.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:ae,width:d,height:g,anchor:o,textBoxScale:x,prevAnchor:pe},this.markUsedJustification(X,o,V,W),X.allowVerticalPlacement&&(this.markUsedOrientation(X,W,V),this.placedOrientations[V.crossTileID]=W),{shift:he,placedGlyphBoxes:K}}}placeLayerBucketPart(o,c,d){const{bucket:g,layout:x,posMatrix:C,textLabelPlaneMatrix:E,labelToScreenMatrix:M,textPixelRatio:A,holdingForFade:F,collisionBoxArray:z,partiallyEvaluatedTextSize:V,collisionGroup:X}=o.parameters,W=x.get("text-optional"),Z=x.get("icon-optional"),re=y.getOverlapMode(x,"text-overlap","text-allow-overlap"),ae="always"===re,he=y.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),K="always"===he,pe="map"===x.get("text-rotation-alignment"),ue="map"===x.get("text-pitch-alignment"),_e="none"!==x.get("icon-text-fit"),be="viewport-y"===x.get("symbol-z-order"),Se=ae&&(K||!g.hasIconData()||Z),me=K&&(ae||!g.hasTextData()||W);!g.collisionArrays&&z&&g.deserializeCollisionBoxes(z);const He=(Re,qe)=>{if(c[Re.crossTileID])return;if(F)return void(this.placements[Re.crossTileID]=new _r(!1,!1,!1));let xt=!1,Dt=!1,rt=!0,ln=null,tn={box:null,offscreen:null},Bt={box:null,offscreen:null},Vt=null,cn=null,ir=null,Ji=0,ki=0,Yi=0;qe.textFeatureIndex?Ji=qe.textFeatureIndex:Re.useRuntimeCollisionCircles&&(Ji=Re.featureIndex),qe.verticalTextFeatureIndex&&(ki=qe.verticalTextFeatureIndex);const _o=this.retainedQueryData[g.bucketInstanceId].tileID,Ri=this.terrain?(Lt,kt)=>this.terrain.getElevation(_o,Lt,kt):null;for(const Lt of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const kt=qe[Lt];kt&&(kt.elevation=Ri?Ri(kt.anchorPointX,kt.anchorPointY):0)}const si=qe.textBox;if(si){const Lt=un=>{let pr=y.WritingMode.horizontal;if(g.allowVerticalPlacement&&!un&&this.prevPlacement){const fr=this.prevPlacement.placedOrientations[Re.crossTileID];fr&&(this.placedOrientations[Re.crossTileID]=fr,pr=fr,this.markUsedOrientation(g,pr,Re))}return pr},kt=(un,pr)=>{if(g.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(const fr of g.writingModes)if(fr===y.WritingMode.vertical?(tn=pr(),Bt=tn):tn=un(),tn&&tn.box&&tn.box.length)break}else tn=un()};if(x.get("text-variable-anchor")){let un=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Re.crossTileID]){const Fn=this.prevPlacement.variableOffsets[Re.crossTileID];un.indexOf(Fn.anchor)>0&&(un=un.filter(Fi=>Fi!==Fn.anchor),un.unshift(Fn.anchor))}const pr=(Fn,Fi,vo)=>{const Ma=Fn.x2-Fn.x1,Go=Fn.y2-Fn.y1,ec=Re.textBoxScale,tc=_e&&"never"===he?Fi:null;let gs={box:[],offscreen:!1};const ai="never"!==re?2*un.length:un.length;for(let eo=0;eo<ai;++eo){const nc=this.attemptAnchorPlacement(un[eo%un.length],Fn,Ma,Go,ec,pe,ue,A,C,X,eo>=un.length?re:"never",Re,g,vo,tc,Ri);if(nc&&(gs=nc.placedGlyphBoxes,gs&&gs.box&&gs.box.length)){xt=!0,ln=nc.shift;break}}return gs};kt(()=>pr(si,qe.iconBox,y.WritingMode.horizontal),()=>{const Fn=qe.verticalTextBox;return g.allowVerticalPlacement&&!(tn&&tn.box&&tn.box.length)&&Re.numVerticalGlyphVertices>0&&Fn?pr(Fn,qe.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),tn&&(xt=tn.box,rt=tn.offscreen);const fr=Lt(tn&&tn.box);if(!xt&&this.prevPlacement){const Fn=this.prevPlacement.variableOffsets[Re.crossTileID];Fn&&(this.variableOffsets[Re.crossTileID]=Fn,this.markUsedJustification(g,Fn.anchor,Re,fr))}}else{const un=(pr,fr)=>{const Fn=this.collisionIndex.placeCollisionBox(pr,re,A,C,X.predicate,Ri);return Fn&&Fn.box&&Fn.box.length&&(this.markUsedOrientation(g,fr,Re),this.placedOrientations[Re.crossTileID]=fr),Fn};kt(()=>un(si,y.WritingMode.horizontal),()=>{const pr=qe.verticalTextBox;return g.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&pr?un(pr,y.WritingMode.vertical):{box:null,offscreen:null}}),Lt(tn&&tn.box&&tn.box.length)}}if(Vt=tn,xt=Vt&&Vt.box&&Vt.box.length>0,rt=Vt&&Vt.offscreen,Re.useRuntimeCollisionCircles){const Lt=g.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),kt=y.evaluateSizeForFeature(g.textSizeData,V,Lt),un=x.get("text-padding");cn=this.collisionIndex.placeCollisionCircles(re,Lt,g.lineVertexArray,g.glyphOffsetArray,kt,C,E,M,d,ue,X.predicate,Re.collisionCircleDiameter,un,Ri),cn.circles.length&&cn.collisionDetected&&!d&&y.warnOnce("Collisions detected, but collision boxes are not shown"),xt=ae||cn.circles.length>0&&!cn.collisionDetected,rt=rt&&cn.offscreen}if(qe.iconFeatureIndex&&(Yi=qe.iconFeatureIndex),qe.iconBox){const Lt=kt=>{const un=_e&&ln?rs(kt,ln.x,ln.y,pe,ue,this.transform.angle):kt;return this.collisionIndex.placeCollisionBox(un,he,A,C,X.predicate,Ri)};Bt&&Bt.box&&Bt.box.length&&qe.verticalIconBox?(ir=Lt(qe.verticalIconBox),Dt=ir.box.length>0):(ir=Lt(qe.iconBox),Dt=ir.box.length>0),rt=rt&&ir.offscreen}const $n=W||0===Re.numHorizontalGlyphVertices&&0===Re.numVerticalGlyphVertices,Qi=Z||0===Re.numIconVertices;if($n||Qi?Qi?$n||(Dt=Dt&&xt):xt=Dt&&xt:Dt=xt=Dt&&xt,xt&&Vt&&Vt.box&&this.collisionIndex.insertCollisionBox(Vt.box,re,x.get("text-ignore-placement"),g.bucketInstanceId,Bt&&Bt.box&&ki?ki:Ji,X.ID),Dt&&ir&&this.collisionIndex.insertCollisionBox(ir.box,he,x.get("icon-ignore-placement"),g.bucketInstanceId,Yi,X.ID),cn&&(xt&&this.collisionIndex.insertCollisionCircles(cn.circles,re,x.get("text-ignore-placement"),g.bucketInstanceId,Ji,X.ID),d)){const Lt=g.bucketInstanceId;let kt=this.collisionCircleArrays[Lt];void 0===kt&&(kt=this.collisionCircleArrays[Lt]=new po);for(let un=0;un<cn.circles.length;un+=4)kt.circles.push(cn.circles[un+0]),kt.circles.push(cn.circles[un+1]),kt.circles.push(cn.circles[un+2]),kt.circles.push(cn.collisionDetected?1:0)}if(0===Re.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===g.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Re.crossTileID]=new _r(xt||Se,Dt||me,rt||g.justReloaded),c[Re.crossTileID]=!0};if(be){if(0!==o.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const Re=g.getSortedSymbolIndexes(this.transform.angle);for(let qe=Re.length-1;qe>=0;--qe){const xt=Re[qe];He(g.symbolInstances.get(xt),g.collisionArrays[xt])}}else for(let Re=o.symbolInstanceStart;Re<o.symbolInstanceEnd;Re++)He(g.symbolInstances.get(Re),g.collisionArrays[Re]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[g.bucketInstanceId];y.invert(Re.invProjMatrix,C),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(o,c,d,g){let x;x=g===y.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(c)];const C=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const E of C)E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=x>=0&&E!==x?0:d.crossTileID)}markUsedOrientation(o,c,d){const g=c===y.WritingMode.horizontal||c===y.WritingMode.horizontalOnly?c:0,x=c===y.WritingMode.vertical?c:0,C=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const E of C)o.text.placedSymbolArray.get(E).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let d=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const g=c?c.symbolFadeChange(o):1,x=c?c.opacities:{},C=c?c.variableOffsets:{},E=c?c.placedOrientations:{};for(const M in this.placements){const A=this.placements[M],F=x[M];F?(this.opacities[M]=new hn(F,g,A.text,A.icon),d=d||A.text!==F.text.placed||A.icon!==F.icon.placed):(this.opacities[M]=new hn(null,g,A.text,A.icon,A.skipFade),d=d||A.text||A.icon)}for(const M in x){const A=x[M];if(!this.opacities[M]){const F=new hn(A,g,!1,!1);F.isHidden()||(this.opacities[M]=F,d=d||A.text.placed||A.icon.placed)}}for(const M in C)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=C[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);if(c&&void 0===c.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const d={};for(const g of c){const x=g.getBucket(o);x&&g.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,d,g.collisionBoxArray)}}updateBucketOpacities(o,c,d){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const g=o.layers[0].layout,x=new hn(null,0,!1,!1,!0),C=g.get("text-allow-overlap"),E=g.get("icon-allow-overlap"),M=g.get("text-variable-anchor"),A="map"===g.get("text-rotation-alignment"),F="map"===g.get("text-pitch-alignment"),z="none"!==g.get("icon-text-fit"),V=new hn(null,0,C&&(E||!o.hasIconData()||g.get("icon-optional")),E&&(C||!o.hasTextData()||g.get("text-optional")),!0);!o.collisionArrays&&d&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(d);const X=(W,Z,re)=>{for(let ae=0;ae<Z/4;ae++)W.opacityVertexArray.emplaceBack(re)};for(let W=0;W<o.symbolInstances.length;W++){const Z=o.symbolInstances.get(W),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ae,crossTileID:he}=Z;let K=this.opacities[he];c[he]?K=x:K||(K=V,this.opacities[he]=K),c[he]=!0;const pe=Z.numIconVertices>0,ue=this.placedOrientations[Z.crossTileID],_e=ue===y.WritingMode.vertical,be=ue===y.WritingMode.horizontal||ue===y.WritingMode.horizontalOnly;if(re>0||ae>0){const Se=oe(K.text);X(o.text,re,_e?ye:Se),X(o.text,ae,be?ye:Se);const me=K.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(o.text.placedSymbolArray.get(qe).hidden=me||_e?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=me||be?1:0);const He=this.variableOffsets[Z.crossTileID];He&&this.markUsedJustification(o,He.anchor,Z,ue);const Re=this.placedOrientations[Z.crossTileID];Re&&(this.markUsedJustification(o,"left",Z,Re),this.markUsedOrientation(o,Re,Z))}if(pe){const Se=oe(K.icon),me=!(z&&Z.verticalPlacedIconSymbolIndex&&_e);Z.placedIconSymbolIndex>=0&&(X(o.icon,Z.numIconVertices,me?Se:ye),o.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=K.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(X(o.icon,Z.numVerticalIconVertices,me?ye:Se),o.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=K.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Se=o.collisionArrays[W];if(Se){let me=new y.pointGeometry(0,0);if(Se.textBox||Se.verticalTextBox){let Re=!0;if(M){const qe=this.variableOffsets[he];qe?(me=ya(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale),A&&me._rotate(F?this.transform.angle:-this.transform.angle)):Re=!1}Se.textBox&&P(o.textCollisionBox.collisionVertexArray,K.text.placed,!Re||_e,me.x,me.y),Se.verticalTextBox&&P(o.textCollisionBox.collisionVertexArray,K.text.placed,!Re||be,me.x,me.y)}const He=Boolean(!be&&Se.verticalIconBox);Se.iconBox&&P(o.iconCollisionBox.collisionVertexArray,K.icon.placed,He,z?me.x:0,z?me.y:0),Se.verticalIconBox&&P(o.iconCollisionBox.collisionVertexArray,K.icon.placed,!He,z?me.x:0,z?me.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=W.invProjMatrix,o.placementViewportMatrix=W.viewportMatrix,o.collisionCircleArray=W.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const d=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*d>o}setStale(){this.stale=!0}}function P(f,o,c,d,g){f.emplaceBack(o?1:0,c?1:0,d||0,g||0),f.emplaceBack(o?1:0,c?1:0,d||0,g||0),f.emplaceBack(o?1:0,c?1:0,d||0,g||0),f.emplaceBack(o?1:0,c?1:0,d||0,g||0)}const O=Math.pow(2,25),H=Math.pow(2,24),$=Math.pow(2,17),ee=Math.pow(2,16),ie=Math.pow(2,9),ne=Math.pow(2,8),te=Math.pow(2,1);function oe(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const o=f.placed?1:0,c=Math.floor(127*f.opacity);return c*O+o*H+c*$+o*ee+c*ie+o*ne+c*te+o}const ye=0;class Ee{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,c,d,g,x){const C=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(C,g,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((E,M)=>E.sortKey-M.sortKey));this._currentPartIndex<C.length;)if(c.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,x())return!0;return!1}}class ge{constructor(o,c,d,g,x,C,E,M){this.placement=new G(o,c,C,E,M),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,c,d){const g=y.exported.now(),x=()=>{const C=y.exported.now()-g;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=c[o[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=E)&&(!C.maxzoom||C.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Ee(C)),this._inProgressLayer.continuePlacement(d[C.source],this.placement,this._showCollisionBoxes,C,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Ke=512/y.EXTENT/2;class Qe{constructor(o,c,d){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let g=0;g<c.length;g++){const x=c.get(g),C=x.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,c){const d=Ke/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*y.EXTENT+o.anchorX)*d),y:Math.floor((c.canonical.y*y.EXTENT+o.anchorY)*d)}}findMatches(o,c,d){const g=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<o.length;x++){const C=o.get(x);if(C.crossTileID)continue;const E=this.indexedSymbolInstances[C.key];if(!E)continue;const M=this.getScaledCoordinates(C,c);for(const A of E)if(Math.abs(A.coord.x-M.x)<=g&&Math.abs(A.coord.y-M.y)<=g&&!d[A.crossTileID]){d[A.crossTileID]=!0,C.crossTileID=A.crossTileID;break}}}}class Be{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class st{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(0!==c)for(const d in this.indexes){const g=this.indexes[d],x={};for(const C in g){const E=g[C];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+c),x[E.tileID.key]=E}this.indexes[d]=x}this.lng=o}addBucket(o,c,d){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const g=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const C=this.indexes[x];if(Number(x)>o.overscaledZ)for(const E in C){const M=C[E];M.tileID.isChildOf(o)&&M.findMatches(c.symbolInstances,o,g)}else{const E=C[o.scaledTo(Number(x)).key];E&&E.findMatches(c.symbolInstances,o,g)}}for(let x=0;x<c.symbolInstances.length;x++){const C=c.symbolInstances.get(x);C.crossTileID||(C.crossTileID=d.generate(),g[C.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Qe(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const d in c.indexedSymbolInstances)for(const g of c.indexedSymbolInstances[d])delete this.usedCrossTileIDs[o][g.crossTileID]}removeStaleBuckets(o){let c=!1;for(const d in this.indexes){const g=this.indexes[d];for(const x in g)o[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[x]),delete g[x],c=!0)}return c}}class ct{constructor(){this.layerIndexes={},this.crossTileIDs=new Be,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,d){let g=this.layerIndexes[o.id];void 0===g&&(g=this.layerIndexes[o.id]=new st);let x=!1;const C={};g.handleWrapJump(d);for(const E of c){const M=E.getBucket(o);M&&o.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(E.tileID,M,this.crossTileIDs)&&(x=!0),C[M.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(x=!0),x}pruneUnusedLayers(o){const c={};o.forEach(d=>{c[d]=!0});for(const d in this.layerIndexes)c[d]||delete this.layerIndexes[d]}}var $t=y.createLayout([{name:"a_pos",type:"Int16",components:2}]);class ft extends y.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const c=this._tiles[o];c.textures.forEach(d=>d.destroy()),c.textures=[]}}update(o,c){this.sourceCache.update(o,c),this._renderableTilesKeys=[];for(const d of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c}))this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),y.ortho(d.posMatrix,0,y.EXTENT,0,y.EXTENT,0,1),this._tiles[d.key]=new ko(d,this.tileSize))}removeOutdated(o){const c={};this.renderHistory=this.renderHistory.filter((d,g)=>this.renderHistory.indexOf(d)===g).slice(0,this.renderHistorySize);for(const d of this._renderableTilesKeys)c[d]=!0;for(const d of this.renderHistory)c[d]=!0;for(const d in this._tiles)c[d]||(this._tiles[d].clearTextures(o),delete this._tiles[d])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const c={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(g.canonical.equals(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16),y.ortho(x.posMatrix,0,y.EXTENT,0,y.EXTENT,0,1),c[d]=x}else if(g.canonical.isChildOf(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const C=g.canonical.z-o.canonical.z,E=g.canonical.x-(g.canonical.x>>C<<C),M=g.canonical.y-(g.canonical.y>>C<<C),A=y.EXTENT>>C;y.ortho(x.posMatrix,0,A,0,A,0,1),y.translate(x.posMatrix,x.posMatrix,[-E*A,-M*A,0]),c[d]=x}else if(o.canonical.isChildOf(g.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const C=o.canonical.z-g.canonical.z,E=o.canonical.x-(o.canonical.x>>C<<C),M=o.canonical.y-(o.canonical.y>>C<<C),A=y.EXTENT>>C;y.ortho(x.posMatrix,0,y.EXTENT,0,y.EXTENT,0,1),y.translate(x.posMatrix,x.posMatrix,[E*A,M*A,0]),y.scale(x.posMatrix,x.posMatrix,[1/2**C,1/2**C,0]),c[d]=x}}return c}getSourceTile(o,c){const d=this.sourceCache._source;let g=o.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(g).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!x||!x.dem)&&c)for(;g>=d.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(o.scaledTo(g--).key);return x}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(c=>c.timeLoaded>=o)}}class It{constructor(o,c,d){this.style=o,this.sourceCache=new ft(c),this.options=d,this.exaggeration="number"==typeof d.exaggeration?d.exaggeration:1,this.elevationOffset="number"==typeof d.elevationOffset?d.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,c,d,g=y.EXTENT){if(!(c>=0&&c<g&&d>=0&&d<g))return this.elevationOffset;let x=0;const C=this.getTerrainData(o);if(C.tile&&C.tile.dem){const E=y.transformMat4$1([],[c/g*y.EXTENT,d/g*y.EXTENT],C.u_terrain_matrix),M=[E[0]*C.tile.dem.dim,E[1]*C.tile.dem.dim],A=[Math.floor(M[0]),Math.floor(M[1])],F=C.tile.dem.get(A[0],A[1]),z=C.tile.dem.get(A[0],A[1]+1),V=C.tile.dem.get(A[0]+1,A[1]),X=C.tile.dem.get(A[0]+1,A[1]+1);x=y.number(y.number(F,z,M[0]-A[0]),y.number(V,X,M[0]-A[0]),M[1]-A[1])}return x}rememberForRerender(o,c){for(const d in this.sourceCache._tiles){const g=this.sourceCache._tiles[d];(g.tileID.equals(c)||g.tileID.isChildOf(c))&&(o===this.sourceCache.sourceCache.id&&(g.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][g.tileID.key]=!0)}}needsRerender(o,c){return this._rerender[o]&&this._rerender[o][c.key]}clearRerenderCache(){this._rerender={}}getElevation(o,c,d,g=y.EXTENT){return(this.getDEMElevation(o,c,d,g)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const g=this.style.map.painter.context,x=new y.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new On(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new On(g,new y.RGBAImage({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=y.identity([])}const c=this.sourceCache.getSourceTile(o,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const g=this.style.map.painter.context;c.demTexture=this.style.map.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new On(g,c.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),c.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const d=c&&c+c.tileID.key+o.key;if(d&&!this._demMatrixCache[d]){const g=this.sourceCache.sourceCache._source.maxzoom;let x=o.canonical.z-c.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=g?x=o.canonical.z-g:y.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=o.canonical.x-(o.canonical.x>>x<<x),E=o.canonical.y-(o.canonical.y>>x<<x),M=y.fromScaling(new Float64Array(16),[1/(y.EXTENT<<x),1/(y.EXTENT<<x),0]);y.translate(M,M,[C*y.EXTENT,E*y.EXTENT,0]),this._demMatrixCache[o.key]={matrix:M,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const c=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(c,c,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,c,c))}return this._rttFramebuffer}getFramebuffer(o){const c=this.style.map.painter,d=c.width/devicePixelRatio,g=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new On(c.context,{width:d,height:g,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new On(c.context,{width:d,height:g,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(d,g,!0),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set("coords"===o?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,C=0;x<this._coordsTextureSize;x++)for(let E=0;E<this._coordsTextureSize;E++,C+=4)c[C+0]=255&E,c[C+1]=255&x,c[C+2]=E>>8<<4|x>>8,c[C+3]=0;const d=new y.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),g=new On(o,d,o.gl.RGBA,{premultiply:!1});return g.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(o){const c=new Uint8Array(4),d=this.style.map.painter,g=d.context,x=g.gl;g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(o.x,d.height/devicePixelRatio-o.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,c),g.bindFramebuffer.set(null);const C=c[0]+(c[2]>>4<<8),E=c[1]+((15&c[2])<<8),M=this.coordsIndex[255-c[3]],A=M&&this.sourceCache.getTileByID(M);if(!A)return null;const F=this._coordsTextureSize,z=(1<<A.tileID.canonical.z)*F;return new y.MercatorCoordinate((A.tileID.canonical.x*F+C)/z,(A.tileID.canonical.y*F+E)/z,this.getElevation(A.tileID,C,E,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,c=new y.PosArray,d=new y.TriangleIndexArray,g=this.meshSize,x=y.EXTENT/g,C=g*g;for(let E=0;E<=g;E++)for(let M=0;M<=g;M++)c.emplaceBack(M*x,E*x);for(let E=0;E<C;E+=g+1)for(let M=0;M<g;M++)d.emplaceBack(M+E,g+M+E+1,g+M+E+2),d.emplaceBack(M+E,g+M+E+2,M+E+1);return this._mesh={indexBuffer:o.createIndexBuffer(d),vertexBuffer:o.createVertexBuffer(c,$t.members),segments:y.SegmentVector.simpleSegment(0,0,c.length,d.length)},this._mesh}getMinMaxElevation(o){const c=this.getTerrainData(o).tile,d={minElevation:null,maxElevation:null};return c&&c.dem&&(d.minElevation=(c.dem.min+this.elevationOffset)*this.exaggeration,d.maxElevation=(c.dem.max+this.elevationOffset)*this.exaggeration),d}}const Ht=(f,o)=>y.emitValidationErrors(f,o&&o.filter(c=>"source.canvas"!==c.identifier)),_n=y.pick(jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),zt=y.pick(jt,["setCenter","setZoom","setBearing","setPitch"]),Pn=function(){const f={},o=y.spec.$version;for(const c in y.spec.$root){const d=y.spec.$root[c];if(d.required){let g=null;g="version"===c?o:"array"===d.type?[]:{},null!=g&&(f[c]=g)}}return f}();class Sr extends y.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new Ao(Za(),this),this.imageManager=new Wa,this.imageManager.setEventedParent(this),this.glyphManager=new Un(o._requestManager,c.localIdeographFontFamily),this.lineAtlas=new la(256,512),this.crossTileSymbolIndex=new ct,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());const d=this;this._rtlTextPluginCallback=Sr.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(x,C)=>{if(y.triggerPluginCompletionEvent(x),C&&C.every(E=>E))for(const E in d.sourceCaches)d.sourceCaches[E].reload()})}),this.on("data",g=>{if("source"!==g.dataType||"metadata"!==g.sourceDataType)return;const x=this.sourceCaches[g.sourceId];if(!x)return;const C=x.getSource();if(C&&C.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===C.id&&this._validateLayer(M)}})}loadURL(o,c={}){this.fire(new y.Event("dataloading",{dataType:"style"}));const d="boolean"!=typeof c.validate||c.validate,g=this.map._requestManager.transformRequest(o,y.ResourceType.Style);this._request=y.getJSON(g,(x,C)=>{this._request=null,x?this.fire(new y.ErrorEvent(x)):C&&this._load(C,d)})}loadJSON(o,c={}){this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.exported.frame(()=>{this._request=null,this._load(o,!1!==c.validate)})}loadEmpty(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Pn,!1)}_load(o,c){if(c&&Ht(this,y.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const g in o.sources)this.addSource(g,o.sources[g],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const d=Ol(this.stylesheet.layers);this._order=d.map(g=>g.id),this._layers={},this._serializedLayers={};for(let g of d)g=y.createStyleLayer(g),g.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=g,this._serializedLayers[g.id]=g.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ci(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(c,d,g,x){let C,E,M;const A=g>1?"@2x":"";let F=y.getJSON(d.transformRequest(d.normalizeSpriteURL(c,A,".json"),y.ResourceType.SpriteJSON),(X,W)=>{F=null,M||(M=X,C=W,V())}),z=y.getImage(d.transformRequest(d.normalizeSpriteURL(c,A,".png"),y.ResourceType.SpriteImage),(X,W)=>{z=null,M||(M=X,E=W,V())});function V(){if(M)x(M);else if(C&&E){const X=y.exported.getImageData(E),W={};for(const Z in C){const{width:re,height:ae,x:he,y:K,sdf:pe,pixelRatio:ue,stretchX:_e,stretchY:be,content:Se}=C[Z],me=new y.RGBAImage({width:re,height:ae});y.RGBAImage.copy(X,me,{x:he,y:K},{x:0,y:0},{width:re,height:ae}),W[Z]={data:me,pixelRatio:ue,sdf:pe,stretchX:_e,stretchY:be,content:Se}}x(null,W)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(c,d)=>{if(this._spriteRequest=null,c)this.fire(new y.ErrorEvent(c));else if(d)for(const g in d)this.imageManager.addImage(g,d[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.sourceCaches[o.source];if(!c)return;const d=o.sourceLayer;if(!d)return;const g=c.getSource();("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(d))&&this.fire(new y.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const d of o){const g=this._layers[d];"custom"!==g.type&&c.push(g.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const C in this._updatedSources){const E=this._updatedSources[C];if("reload"===E)this._reloadSource(C);else{if("clear"!==E)throw new Error(`Invalid action ${E}`);this._clearSource(C)}}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const d={};for(const g in this.sourceCaches){const x=this.sourceCaches[g];d[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const g in d){const x=this.sourceCaches[g];d[g]!==x.used&&x.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(o),this.z=o.zoom,c&&this.fire(new y.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const c=this.sourceCaches[o.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new It(this,c,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=d=>{d.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=d=>{d.tile&&(d.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(d.sourceId,d.tile.tileID)):"geojson"===d.source.type&&this.terrain.rememberForRerender(d.sourceId,d.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new y.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),Ht(this,y.validateStyle(o)))return!1;(o=y.clone$1(o)).layers=Ol(o.layers);const c=function(g,x){if(!g)return[{command:jt.setStyle,args:[x]}];let C=[];try{if(!Xt(g.version,x.version))return[{command:jt.setStyle,args:[x]}];Xt(g.center,x.center)||C.push({command:jt.setCenter,args:[x.center]}),Xt(g.zoom,x.zoom)||C.push({command:jt.setZoom,args:[x.zoom]}),Xt(g.bearing,x.bearing)||C.push({command:jt.setBearing,args:[x.bearing]}),Xt(g.pitch,x.pitch)||C.push({command:jt.setPitch,args:[x.pitch]}),Xt(g.sprite,x.sprite)||C.push({command:jt.setSprite,args:[x.sprite]}),Xt(g.glyphs,x.glyphs)||C.push({command:jt.setGlyphs,args:[x.glyphs]}),Xt(g.transition,x.transition)||C.push({command:jt.setTransition,args:[x.transition]}),Xt(g.light,x.light)||C.push({command:jt.setLight,args:[x.light]});const E={},M=[];!function(F,z,V,X){let W;for(W in z=z||{},F=F||{})Object.prototype.hasOwnProperty.call(F,W)&&(Object.prototype.hasOwnProperty.call(z,W)||Lo(W,V,X));for(W in z)Object.prototype.hasOwnProperty.call(z,W)&&(Object.prototype.hasOwnProperty.call(F,W)?Xt(F[W],z[W])||("geojson"===F[W].type&&"geojson"===z[W].type&&ma(F,z,W)?V.push({command:jt.setGeoJSONSourceData,args:[W,z[W].data]}):Ps(W,z,V,X)):Fo(W,z,V))}(g.sources,x.sources,M,E);const A=[];g.layers&&g.layers.forEach(F=>{E[F.source]?C.push({command:jt.removeLayer,args:[F.id]}):A.push(F)}),C=C.concat(M),function(F,z,V){z=z||[];const X=(F=F||[]).map(ts),W=z.map(ts),Z=F.reduce(Ka,{}),re=z.reduce(Ka,{}),ae=X.slice(),he=Object.create(null);let K,pe,ue,_e,be,Se,me;for(K=0,pe=0;K<X.length;K++)ue=X[K],Object.prototype.hasOwnProperty.call(re,ue)?pe++:(V.push({command:jt.removeLayer,args:[ue]}),ae.splice(ae.indexOf(ue,pe),1));for(K=0,pe=0;K<W.length;K++)ue=W[W.length-1-K],ae[ae.length-1-K]!==ue&&(Object.prototype.hasOwnProperty.call(Z,ue)?(V.push({command:jt.removeLayer,args:[ue]}),ae.splice(ae.lastIndexOf(ue,ae.length-pe),1)):pe++,Se=ae[ae.length-K],V.push({command:jt.addLayer,args:[re[ue],Se]}),ae.splice(ae.length-K,0,ue),he[ue]=!0);for(K=0;K<W.length;K++)if(ue=W[K],_e=Z[ue],be=re[ue],!he[ue]&&!Xt(_e,be))if(Xt(_e.source,be.source)&&Xt(_e["source-layer"],be["source-layer"])&&Xt(_e.type,be.type)){for(me in Oo(_e.layout,be.layout,V,ue,null,jt.setLayoutProperty),Oo(_e.paint,be.paint,V,ue,null,jt.setPaintProperty),Xt(_e.filter,be.filter)||V.push({command:jt.setFilter,args:[ue,be.filter]}),Xt(_e.minzoom,be.minzoom)&&Xt(_e.maxzoom,be.maxzoom)||V.push({command:jt.setLayerZoomRange,args:[ue,be.minzoom,be.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,me)&&"layout"!==me&&"paint"!==me&&"filter"!==me&&"metadata"!==me&&"minzoom"!==me&&"maxzoom"!==me&&(0===me.indexOf("paint.")?Oo(_e[me],be[me],V,ue,me.slice(6),jt.setPaintProperty):Xt(_e[me],be[me])||V.push({command:jt.setLayerProperty,args:[ue,me,be[me]]}));for(me in be)Object.prototype.hasOwnProperty.call(be,me)&&!Object.prototype.hasOwnProperty.call(_e,me)&&"layout"!==me&&"paint"!==me&&"filter"!==me&&"metadata"!==me&&"minzoom"!==me&&"maxzoom"!==me&&(0===me.indexOf("paint.")?Oo(_e[me],be[me],V,ue,me.slice(6),jt.setPaintProperty):Xt(_e[me],be[me])||V.push({command:jt.setLayerProperty,args:[ue,me,be[me]]}))}else V.push({command:jt.removeLayer,args:[ue]}),Se=ae[ae.lastIndexOf(ue)+1],V.push({command:jt.addLayer,args:[be,Se]})}(A,x.layers,C)}catch(E){console.warn("Unable to compute style diff:",E),C=[{command:jt.setStyle,args:[x]}]}return C}(this.serialize(),o).filter(g=>!(g.command in zt));if(0===c.length)return!1;const d=c.filter(g=>!(g.command in _n));if(d.length>0)throw new Error(`Unimplemented: ${d.map(g=>g.command).join(", ")}.`);return c.forEach(g=>{"setTransition"!==g.command&&this[g.command].apply(this,g.args)}),this.stylesheet=o,!0}addImage(o,c){if(this.getImage(o))return this.fire(new y.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,c),this._afterImageUpdated(o)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new y.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,c,d={}){if(this._checkLoaded(),void 0!==this.sourceCaches[o])throw new Error(`Source "${o}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(y.validateStyle.source,`sources.${o}`,c,null,d))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const g=this.sourceCaches[o]=new Qt(o,c,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:g.serialize(),sourceId:o})),g.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===o)return this.fire(new y.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${d}" is using it.`)));const c=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],c.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,c){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error(`There is no source with this ID=${o}`);const d=this.sourceCaches[o].getSource();if("geojson"!==d.type)throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(c),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,c,d={}){this._checkLoaded();const g=o.id;if(this.getLayer(g))return void this.fire(new y.ErrorEvent(new Error(`Layer "${g}" already exists on this map.`)));let x;if("custom"===o.type){if(Ht(this,y.validateCustomStyleLayer(o)))return;x=y.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(g,o.source),o=y.clone$1(o),o=y.extend(o,{source:g})),this._validate(y.validateStyle.layer,`layers.${g}`,o,{arrayIndex:-1},d))return;x=y.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[x.id]=x.serialize()}const C=c?this._order.indexOf(c):this._order.length;if(c&&-1===C)this.fire(new y.ErrorEvent(new Error(`Cannot add layer "${g}" before non-existing layer "${c}".`)));else{if(this._order.splice(C,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&"custom"!==x.type){const E=this._removedLayers[g];delete this._removedLayers[g],E.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new y.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const d=this._order.indexOf(o);this._order.splice(d,1);const g=c?this._order.indexOf(c):this._order.length;c&&-1===g?this.fire(new y.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${c}".`))):(this._order.splice(g,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new y.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));c.setEventedParent(null);const d=this._order.indexOf(o);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,c,d){this._checkLoaded();const g=this.getLayer(o);g?g.minzoom===c&&g.maxzoom===d||(null!=c&&(g.minzoom=c),null!=d&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new y.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,c,d={}){this._checkLoaded();const g=this.getLayer(o);if(g){if(!Xt(g.filter,c))return null==c?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(y.validateStyle.filter,`layers.${g.id}.filter`,c,null,d)||(g.filter=y.clone$1(c),this._updateLayer(g)))}else this.fire(new y.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return y.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,c,d,g={}){this._checkLoaded();const x=this.getLayer(o);x?Xt(x.getLayoutProperty(c),d)||(x.setLayoutProperty(c,d,g),this._updateLayer(x)):this.fire(new y.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,c){const d=this.getLayer(o);if(d)return d.getLayoutProperty(c);this.fire(new y.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,c,d,g={}){this._checkLoaded();const x=this.getLayer(o);x?Xt(x.getPaintProperty(c),d)||(x.setPaintProperty(c,d,g)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new y.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,c){return this.getLayer(o).getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const d=o.source,g=o.sourceLayer,x=this.sourceCaches[d];if(void 0===x)return void this.fire(new y.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const C=x.getSource().type;"geojson"===C&&g?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==C||g?(void 0===o.id&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,o.id,c)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,c){this._checkLoaded();const d=o.source,g=this.sourceCaches[d];if(void 0===g)return void this.fire(new y.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const x=g.getSource().type,C="vector"===x?o.sourceLayer:void 0;"vector"!==x||C?c&&"string"!=typeof o.id&&"number"!=typeof o.id?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(C,o.id,c):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const c=o.source,d=o.sourceLayer,g=this.sourceCaches[c];if(void 0!==g)return"vector"!==g.getSource().type||d?(void 0===o.id&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,o.id)):void this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new y.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>void 0!==o)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&"raster"!==this.sourceCaches[o.source].getSource().type&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const c=C=>"fill-extrusion"===this._layers[C].type,d={},g=[];for(let C=this._order.length-1;C>=0;C--){const E=this._order[C];if(c(E)){d[E]=C;for(const M of o){const A=M[E];if(A)for(const F of A)g.push(F)}}}g.sort((C,E)=>E.intersectionZ-C.intersectionZ);const x=[];for(let C=this._order.length-1;C>=0;C--){const E=this._order[C];if(c(E))for(let M=g.length-1;M>=0;M--){const A=g[M].feature;if(d[A.layer.id]<C)break;x.push(A),g.pop()}else for(const M of o){const A=M[E];if(A)for(const F of A)x.push(F.feature)}}return x}queryRenderedFeatures(o,c,d){c&&c.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const g={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of c.layers){const E=this._layers[C];if(!E)return this.fire(new y.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[E.source]=!0}}const x=[];c.availableImages=this._availableImages;for(const C in this.sourceCaches)c.layers&&!g[C]||x.push(da(this.sourceCaches[C],this._layers,this._serializedLayers,o,c,d));return this.placement&&x.push(function(C,E,M,A,F,z,V){const X={},W=z.queryRenderedSymbols(A),Z=[];for(const re of Object.keys(W).map(Number))Z.push(V[re]);Z.sort(rr);for(const re of Z){const ae=re.featureIndex.lookupSymbolFeatures(W[re.bucketInstanceId],E,re.bucketIndex,re.sourceLayerIndex,F.filter,F.layers,F.availableImages,C);for(const he in ae){const K=X[he]=X[he]||[],pe=ae[he];pe.sort((ue,_e)=>{const be=re.featureSortOrder;if(be){const Se=be.indexOf(ue.featureIndex);return be.indexOf(_e.featureIndex)-Se}return _e.featureIndex-ue.featureIndex});for(const ue of pe)K.push(ue)}}for(const re in X)X[re].forEach(ae=>{const he=ae.feature,K=M[C[re].source].getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=K});return X}(this._layers,this._serializedLayers,this.sourceCaches,o,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,c){c&&c.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const d=this.sourceCaches[o];return d?function(g,x){const C=g.getRenderableIds().map(A=>g.getTileByID(A)),E=[],M={};for(let A=0;A<C.length;A++){const F=C[A],z=F.tileID.canonical.key;M[z]||(M[z]=!0,F.querySourceFeatures(E,x))}return E}(d,c):[]}addSourceType(o,c,d){return Sr.getSourceType(o)?d(new Error(`A source type called "${o}" already exists.`)):(Sr.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const C in o)if(!Xt(o[C],d[C])){g=!0;break}if(!g)return;const x={now:y.exported.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,c),this.light.updateTransitions(x)}_validate(o,c,d,g,x={}){return(!x||!1!==x.validate)&&Ht(this,o.call(y.validateStyle,y.extend({key:c,style:this.serialize(),value:d,styleSpec:y.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const c=this.sourceCaches[o];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const c in this.sourceCaches)this.sourceCaches[c].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,c,d,g,x=!1){let C=!1,E=!1;const M={};for(const A of this._order){const F=this._layers[A];if("symbol"!==F.type)continue;if(!M[F.source]){const V=this.sourceCaches[F.source];M[F.source]=V.getRenderableIds(!0).map(X=>V.getTileByID(X)).sort((X,W)=>W.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(W.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(F,M[F.source],o.center.lng);C=C||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||0===d)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.exported.now(),o.zoom))&&(this.pauseablePlacement=new ge(o,this.terrain,this._order,x,c,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.exported.now()),E=!0),C&&this.pauseablePlacement.placement.setStale()),E||C)for(const A of this._order){const F=this._layers[A];"symbol"===F.type&&this.placement.updateLayerOpacities(F,M[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,d){this.imageManager.getImages(c.icons,d),this._updateTilesForChangedImages();const g=this.sourceCaches[c.source];g&&g.setDependencies(c.tileID.key,c.type,c.icons)}getGlyphs(o,c,d){this.glyphManager.getGlyphs(c.stacks,d)}getResource(o,c,d){return y.makeRequest(c,d)}}Sr.getSourceType=function(f){return ua[f]},Sr.setSourceType=function(f,o){ua[f]=o},Sr.registerForPluginStateChange=y.registerForPluginStateChange;var is="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const dn={prelude:pn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:pn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:pn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:pn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:pn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:pn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:pn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:pn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:pn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:pn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:pn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:pn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:pn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:pn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:pn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:pn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:pn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:pn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:pn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:pn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:pn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",is),terrainDepth:pn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",is),terrainCoords:pn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",is)};function pn(f,o){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=o.match(/attribute ([\w]+) ([\w]+)/g),g=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=x?x.concat(g):g,E={};return{fragmentSource:f=f.replace(c,(M,A,F,z,V)=>(E[V]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${V}\nvarying ${F} ${z} ${V};\n#else\nuniform ${F} ${z} u_${V};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${V}\n    ${F} ${z} ${V} = u_${V};\n#endif\n`)),vertexSource:o=o.replace(c,(M,A,F,z,V)=>{const X="float"===z?"vec2":"vec4",W=V.match(/color/)?"color":X;return E[V]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${F} ${X} a_${V};\nvarying ${F} ${z} ${V};\n#else\nuniform ${F} ${z} u_${V};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = a_${V};\n#else\n    ${F} ${z} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);\n#else\n    ${F} ${z} ${V} = u_${V};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${F} ${X} a_${V};\n#else\nuniform ${F} ${z} u_${V};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${F} ${z} ${V} = a_${V};\n#else\n    ${F} ${z} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${F} ${z} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);\n#else\n    ${F} ${z} ${V} = u_${V};\n#endif\n`}),staticAttributes:d,staticUniforms:C}}class vn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,c,d,g,x,C,E,M,A){this.context=o;let F=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!F&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(F=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===d&&!F&&this.boundIndexBuffer===x&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===M&&this.boundDynamicVertexBuffer3===A?(o.bindVertexArrayOES.set(this.vao),E&&E.bind(),x&&x.dynamicDraw&&x.bind(),M&&M.bind(),A&&A.bind()):this.freshBind(c,d,g,x,C,E,M,A)}freshBind(o,c,d,g,x,C,E,M){let A;const F=o.numAttributes,z=this.context,V=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=M;else{A=z.currentNumAttributes||0;for(let X=F;X<A;X++)V.disableVertexAttribArray(X)}c.enableAttributes(V,o);for(const X of d)X.enableAttributes(V,o);C&&C.enableAttributes(V,o),E&&E.enableAttributes(V,o),M&&M.enableAttributes(V,o),c.bind(),c.setVertexAttribPointers(V,o,x);for(const X of d)X.bind(),X.setVertexAttribPointers(V,o,x);C&&(C.bind(),C.setVertexAttribPointers(V,o,x)),g&&g.bind(),E&&(E.bind(),E.setVertexAttribPointers(V,o,x)),M&&(M.bind(),M.setVertexAttribPointers(V,o,x)),z.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ja(f){const o=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const d=f[c].split(" ");o.push(d.pop())}return o}class Ku{constructor(o,c,d,g,x,C,E){const M=o.gl;this.program=M.createProgram();const A=Ja(d.staticAttributes),F=g?g.getBinderAttributes():[],z=A.concat(F),V=dn.prelude.staticUniforms?Ja(dn.prelude.staticUniforms):[],X=d.staticUniforms?Ja(d.staticUniforms):[],W=g?g.getBinderUniforms():[],Z=V.concat(X).concat(W),re=[];for(const be of Z)re.indexOf(be)<0&&re.push(be);const ae=g?g.defines():[];C&&ae.push("#define OVERDRAW_INSPECTOR;"),E&&ae.push("#define TERRAIN3D;");const he=ae.concat(dn.prelude.fragmentSource,d.fragmentSource).join("\n"),K=ae.concat(dn.prelude.vertexSource,d.vertexSource).join("\n"),pe=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(pe,he),M.compileShader(pe),M.attachShader(this.program,pe);const ue=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ue,K),M.compileShader(ue),M.attachShader(this.program,ue),this.attributes={};const _e={};this.numAttributes=z.length;for(let be=0;be<this.numAttributes;be++)z[be]&&(M.bindAttribLocation(this.program,be,z[be]),this.attributes[z[be]]=be);M.linkProgram(this.program),M.deleteShader(ue),M.deleteShader(pe);for(let be=0;be<re.length;be++){const Se=re[be];if(Se&&!_e[Se]){const me=M.getUniformLocation(this.program,Se);me&&(_e[Se]=me)}}var be,Se;this.fixedUniforms=x(o,_e),this.terrainUniforms={u_depth:new y.Uniform1i(be=o,(Se=_e).u_depth),u_terrain:new y.Uniform1i(be,Se.u_terrain),u_terrain_dim:new y.Uniform1f(be,Se.u_terrain_dim),u_terrain_matrix:new y.UniformMatrix4f(be,Se.u_terrain_matrix),u_terrain_unpack:new y.Uniform4f(be,Se.u_terrain_unpack),u_terrain_offset:new y.Uniform1f(be,Se.u_terrain_offset),u_terrain_exaggeration:new y.Uniform1f(be,Se.u_terrain_exaggeration)},this.binderUniforms=g?g.getUniforms(o,_e):[]}draw(o,c,d,g,x,C,E,M,A,F,z,V,X,W,Z,re,ae,he){const K=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(d),o.setStencilMode(g),o.setColorMode(x),o.setCullFace(C),M){o.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,M.depthTexture),o.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,M.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(M[ue])}for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(E[ue]);Z&&Z.setUniforms(o,this.binderUniforms,X,{zoom:W});let pe=0;switch(c){case K.LINES:pe=2;break;case K.TRIANGLES:pe=3;break;case K.LINE_STRIP:pe=1}for(const ue of V.get()){const _e=ue.vaos||(ue.vaos={});(_e[A]||(_e[A]=new vn)).bind(o,this,F,Z?Z.getPaintVertexBuffers():[],z,ue.vertexOffset,re,ae,he),K.drawElements(c,ue.primitiveLength*pe,K.UNSIGNED_SHORT,ue.primitiveOffset*pe*2)}}}function Cn(f,o,c){const d=1/Xn(c,1,o.transform.tileZoom),g=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,o.transform.tileZoom)/g,C=x*(c.tileID.canonical.x+c.tileID.wrap*g),E=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[C>>16,E>>16],u_pixel_coord_lower:[65535&C,65535&E]}}const mt=(f,o,c,d)=>{const g=o.style.light,x=g.properties.get("position"),C=[x.x,x.y,x.z],E=y.create$1();"viewport"===g.properties.get("anchor")&&y.fromRotation(E,-o.transform.angle),y.transformMat3(C,C,E);const M=g.properties.get("color");return{u_matrix:f,u_lightpos:C,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+c,u_opacity:d}},zc=(f,o,c,d,g,x,C)=>y.extend(mt(f,o,c,d),Cn(x,o,C),{u_height_factor:-Math.pow(2,g.overscaledZ)/C.tileSize/8}),Bc=f=>({u_matrix:f}),ze=(f,o,c,d)=>y.extend(Bc(f),Cn(c,o,d)),Ya=(f,o)=>({u_matrix:f,u_world:o}),Ct=(f,o,c,d,g)=>y.extend(ze(f,o,c,d),{u_world:g}),sn=(f,o,c,d)=>{const g=f.transform;let x,C;if("map"===d.paint.get("circle-pitch-alignment")){const E=Xn(c,1,g.zoom);x=!0,C=[E,E]}else x=!1,C=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+("map"===d.paint.get("circle-pitch-scale")),u_matrix:f.translatePosMatrix(o.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:C}},Os=(f,o,c)=>{const d=Xn(c,1,o.zoom),g=Math.pow(2,o.zoom-c.tileID.overscaledZ),x=c.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[o.pixelsToGLUnits[0]/(d*g),o.pixelsToGLUnits[1]/(d*g)],u_overscale_factor:x}},Nl=(f,o,c=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:c}),_a=f=>({u_matrix:f}),Ns=(f,o,c,d)=>({u_matrix:f,u_extrude_scale:Xn(o,1,c),u_intensity:d});function Mr(f,o){const c=Math.pow(2,o.canonical.z),d=o.canonical.y;return[new y.MercatorCoordinate(0,d/c).toLngLat().lat,new y.MercatorCoordinate(0,(d+1)/c).toLngLat().lat]}const Qa=(f,o,c,d)=>{const g=f.transform;return{u_matrix:zl(f,o,c,d),u_ratio:1/Xn(o,1,g.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Vc=(f,o,c,d,g)=>y.extend(Qa(f,o,c,g),{u_image:0,u_image_height:d}),Uc=(f,o,c,d,g)=>{const x=f.transform,C=Nn(o,x);return{u_matrix:zl(f,o,c,g),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Xn(o,1,x.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[C,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},di=(f,o,c,d,g,x)=>{const C=f.lineAtlas,E=Nn(o,f.transform),M="round"===c.layout.get("line-cap"),A=C.getDash(d.from,M),F=C.getDash(d.to,M),z=A.width*g.fromScale,V=F.width*g.toScale;return y.extend(Qa(f,o,c,x),{u_patternscale_a:[E/z,-A.height/2],u_patternscale_b:[E/V,-F.height/2],u_sdfgamma:C.width/(256*Math.min(z,V)*f.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:F.y,u_mix:g.t})};function Nn(f,o){return 1/Xn(f,1,o.tileZoom)}function zl(f,o,c,d){return f.translatePosMatrix(d?d.posMatrix:o.tileID.posMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const yd=(f,o,c,d,g)=>{return{u_matrix:f,u_tl_parent:o,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(x=g.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:_d(g.paint.get("raster-hue-rotate"))};var x,C};function _d(f){f*=Math.PI/180;const o=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const jc=(f,o,c,d,g,x,C,E,M,A)=>{const F=g.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:F.width/F.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:C,u_coord_matrix:E,u_is_text:+M,u_pitch_with_map:+d,u_texsize:A,u_texture:0}},$c=(f,o,c,d,g,x,C,E,M,A,F)=>{const z=g.transform;return y.extend(jc(f,o,c,d,g,x,C,E,M,A),{u_gamma_scale:d?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+F})},Ju=(f,o,c,d,g,x,C,E,M,A)=>y.extend($c(f,o,c,d,g,x,C,E,!0,M,!0),{u_texsize_icon:A,u_texture_icon:1}),uf=(f,o,c)=>({u_matrix:f,u_opacity:o,u_color:c}),pi=(f,o,c,d,g,x)=>y.extend(function(C,E,M,A){const F=M.imageManager.getPattern(C.from.toString()),z=M.imageManager.getPattern(C.to.toString()),{width:V,height:X}=M.imageManager.getPixelSize(),W=Math.pow(2,A.tileID.overscaledZ),Z=A.tileSize*Math.pow(2,M.transform.tileZoom)/W,re=Z*(A.tileID.canonical.x+A.tileID.wrap*W),ae=Z*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[V,X],u_mix:E.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Xn(A,1,M.transform.tileZoom),u_pixel_coord_upper:[re>>16,ae>>16],u_pixel_coord_lower:[65535&re,65535&ae]}}(d,x,c,g),{u_matrix:f,u_opacity:o}),an={fillExtrusion:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_lightpos:new y.Uniform3f(f,o.u_lightpos),u_lightintensity:new y.Uniform1f(f,o.u_lightintensity),u_lightcolor:new y.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,o.u_vertical_gradient),u_opacity:new y.Uniform1f(f,o.u_opacity)}),fillExtrusionPattern:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_lightpos:new y.Uniform3f(f,o.u_lightpos),u_lightintensity:new y.Uniform1f(f,o.u_lightintensity),u_lightcolor:new y.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,o.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,o.u_height_factor),u_image:new y.Uniform1i(f,o.u_image),u_texsize:new y.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,o.u_scale),u_fade:new y.Uniform1f(f,o.u_fade),u_opacity:new y.Uniform1f(f,o.u_opacity)}),fill:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix)}),fillPattern:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_image:new y.Uniform1i(f,o.u_image),u_texsize:new y.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,o.u_scale),u_fade:new y.Uniform1f(f,o.u_fade)}),fillOutline:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_world:new y.Uniform2f(f,o.u_world)}),fillOutlinePattern:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_world:new y.Uniform2f(f,o.u_world),u_image:new y.Uniform1i(f,o.u_image),u_texsize:new y.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,o.u_scale),u_fade:new y.Uniform1f(f,o.u_fade)}),circle:(f,o)=>({u_camera_to_center_distance:new y.Uniform1f(f,o.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,o.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,o.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,o.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,o.u_matrix)}),collisionBox:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,o.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,o.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,o.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,o.u_overscale_factor)}),collisionCircle:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,o.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,o.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,o.u_viewport_size)}),debug:(f,o)=>({u_color:new y.UniformColor(f,o.u_color),u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_overlay:new y.Uniform1i(f,o.u_overlay),u_overlay_scale:new y.Uniform1f(f,o.u_overlay_scale)}),clippingMask:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix)}),heatmap:(f,o)=>({u_extrude_scale:new y.Uniform1f(f,o.u_extrude_scale),u_intensity:new y.Uniform1f(f,o.u_intensity),u_matrix:new y.UniformMatrix4f(f,o.u_matrix)}),heatmapTexture:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_world:new y.Uniform2f(f,o.u_world),u_image:new y.Uniform1i(f,o.u_image),u_color_ramp:new y.Uniform1i(f,o.u_color_ramp),u_opacity:new y.Uniform1f(f,o.u_opacity)}),hillshade:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_image:new y.Uniform1i(f,o.u_image),u_latrange:new y.Uniform2f(f,o.u_latrange),u_light:new y.Uniform2f(f,o.u_light),u_shadow:new y.UniformColor(f,o.u_shadow),u_highlight:new y.UniformColor(f,o.u_highlight),u_accent:new y.UniformColor(f,o.u_accent)}),hillshadePrepare:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_image:new y.Uniform1i(f,o.u_image),u_dimension:new y.Uniform2f(f,o.u_dimension),u_zoom:new y.Uniform1f(f,o.u_zoom),u_unpack:new y.Uniform4f(f,o.u_unpack)}),line:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_ratio:new y.Uniform1f(f,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,o.u_units_to_pixels)}),lineGradient:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_ratio:new y.Uniform1f(f,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,o.u_units_to_pixels),u_image:new y.Uniform1i(f,o.u_image),u_image_height:new y.Uniform1f(f,o.u_image_height)}),linePattern:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_texsize:new y.Uniform2f(f,o.u_texsize),u_ratio:new y.Uniform1f(f,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_image:new y.Uniform1i(f,o.u_image),u_units_to_pixels:new y.Uniform2f(f,o.u_units_to_pixels),u_scale:new y.Uniform3f(f,o.u_scale),u_fade:new y.Uniform1f(f,o.u_fade)}),lineSDF:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_ratio:new y.Uniform1f(f,o.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,o.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,o.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,o.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,o.u_sdfgamma),u_image:new y.Uniform1i(f,o.u_image),u_tex_y_a:new y.Uniform1f(f,o.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,o.u_tex_y_b),u_mix:new y.Uniform1f(f,o.u_mix)}),raster:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_tl_parent:new y.Uniform2f(f,o.u_tl_parent),u_scale_parent:new y.Uniform1f(f,o.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,o.u_buffer_scale),u_fade_t:new y.Uniform1f(f,o.u_fade_t),u_opacity:new y.Uniform1f(f,o.u_opacity),u_image0:new y.Uniform1i(f,o.u_image0),u_image1:new y.Uniform1i(f,o.u_image1),u_brightness_low:new y.Uniform1f(f,o.u_brightness_low),u_brightness_high:new y.Uniform1f(f,o.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,o.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,o.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,o.u_spin_weights)}),symbolIcon:(f,o)=>({u_is_size_zoom_constant:new y.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,o.u_size_t),u_size:new y.Uniform1f(f,o.u_size),u_camera_to_center_distance:new y.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,o.u_pitch),u_rotate_symbol:new y.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,o.u_fade_change),u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new y.Uniform1i(f,o.u_is_text),u_pitch_with_map:new y.Uniform1i(f,o.u_pitch_with_map),u_texsize:new y.Uniform2f(f,o.u_texsize),u_texture:new y.Uniform1i(f,o.u_texture)}),symbolSDF:(f,o)=>({u_is_size_zoom_constant:new y.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,o.u_size_t),u_size:new y.Uniform1f(f,o.u_size),u_camera_to_center_distance:new y.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,o.u_pitch),u_rotate_symbol:new y.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,o.u_fade_change),u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new y.Uniform1i(f,o.u_is_text),u_pitch_with_map:new y.Uniform1i(f,o.u_pitch_with_map),u_texsize:new y.Uniform2f(f,o.u_texsize),u_texture:new y.Uniform1i(f,o.u_texture),u_gamma_scale:new y.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,o.u_is_halo)}),symbolTextAndIcon:(f,o)=>({u_is_size_zoom_constant:new y.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,o.u_size_t),u_size:new y.Uniform1f(f,o.u_size),u_camera_to_center_distance:new y.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,o.u_pitch),u_rotate_symbol:new y.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,o.u_fade_change),u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new y.Uniform1i(f,o.u_is_text),u_pitch_with_map:new y.Uniform1i(f,o.u_pitch_with_map),u_texsize:new y.Uniform2f(f,o.u_texsize),u_texsize_icon:new y.Uniform2f(f,o.u_texsize_icon),u_texture:new y.Uniform1i(f,o.u_texture),u_texture_icon:new y.Uniform1i(f,o.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,o.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,o.u_is_halo)}),background:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_opacity:new y.Uniform1f(f,o.u_opacity),u_color:new y.UniformColor(f,o.u_color)}),backgroundPattern:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_opacity:new y.Uniform1f(f,o.u_opacity),u_image:new y.Uniform1i(f,o.u_image),u_pattern_tl_a:new y.Uniform2f(f,o.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,o.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,o.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,o.u_pattern_br_b),u_texsize:new y.Uniform2f(f,o.u_texsize),u_mix:new y.Uniform1f(f,o.u_mix),u_pattern_size_a:new y.Uniform2f(f,o.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,o.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,o.u_scale_a),u_scale_b:new y.Uniform1f(f,o.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,o.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,o.u_tile_units_to_pixels)}),terrain:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_texture:new y.Uniform1i(f,o.u_texture)}),terrainDepth:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix)}),terrainCoords:(f,o)=>({u_matrix:new y.UniformMatrix4f(f,o.u_matrix),u_texture:new y.Uniform1i(f,o.u_texture),u_terrain_coords_id:new y.Uniform1f(f,o.u_terrain_coords_id)})};class Yu{constructor(o,c,d){this.context=o;const g=o.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class eh{constructor(o,c,d,g){this.length=c.length,this.attributes=d,this.itemSize=c.bytesPerElement,this.dynamicDraw=g,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let d=0;d<this.attributes.length;d++){const g=c.attributes[this.attributes[d].name];void 0!==g&&o.enableVertexAttribArray(g)}}setVertexAttribPointers(o,c,d){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],C=c.attributes[x.name];void 0!==C&&o.vertexAttribPointer(C,x.components,o[Qu[x.type]],!1,this.itemSize,x.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $e{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vd extends $e{getDefault(){return y.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class jr extends $e{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class os extends $e{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class el extends $e{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Hc extends $e{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class fi extends $e{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Gc extends $e{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class tl extends $e{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class zs extends $e{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class nl extends $e{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Bl extends $e{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class Vl extends $e{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ut extends $e{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class rl extends $e{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ul extends $e{getDefault(){return y.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class mi extends $e{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class qc extends $e{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class il extends $e{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ss extends $e{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Zi extends $e{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class hf extends $e{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class df extends $e{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class fo extends $e{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class En extends $e{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class th extends $e{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Wc extends $e{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class as extends $e{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class en extends $e{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class zo extends $e{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class jl extends $e{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class $l extends $e{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ol extends $e{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class $r extends ol{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class va extends ol{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class xa{constructor(o,c,d,g){this.context=o,this.width=c,this.height=d;const x=o.gl,C=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new $r(o,C),g&&(this.depthAttachment=new va(o,C)),x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}o.deleteFramebuffer(this.framebuffer)}}class Kt{constructor(o,c,d){this.blendFunction=o,this.blendColor=c,this.mask=d}}Kt.Replace=[1,0],Kt.disabled=new Kt(Kt.Replace,y.Color.transparent,[!1,!1,!1,!1]),Kt.unblended=new Kt(Kt.Replace,y.Color.transparent,[!0,!0,!0,!0]),Kt.alphaBlended=new Kt([1,771],y.Color.transparent,[!0,!0,!0,!0]);class nh{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new vd(this),this.clearDepth=new jr(this),this.clearStencil=new os(this),this.colorMask=new el(this),this.depthMask=new Hc(this),this.stencilMask=new fi(this),this.stencilFunc=new Gc(this),this.stencilOp=new tl(this),this.stencilTest=new zs(this),this.depthRange=new nl(this),this.depthTest=new Bl(this),this.depthFunc=new Vl(this),this.blend=new ut(this),this.blendFunc=new rl(this),this.blendColor=new Ul(this),this.blendEquation=new mi(this),this.cullFace=new qc(this),this.cullFaceSide=new il(this),this.frontFace=new ss(this),this.program=new Zi(this),this.activeTexture=new hf(this),this.viewport=new df(this),this.bindFramebuffer=new fo(this),this.bindRenderbuffer=new En(this),this.bindTexture=new th(this),this.bindVertexBuffer=new Wc(this),this.bindElementBuffer=new as(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new en(this),this.pixelStoreUnpack=new zo(this),this.pixelStoreUnpackPremultiplyAlpha=new jl(this),this.pixelStoreUnpackFlipY=new $l(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new Yu(this,o,c)}createVertexBuffer(o,c,d){return new eh(this,o,c,d)}createRenderbuffer(o,c,d){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,o,c,d),this.bindRenderbuffer.set(null),x}createFramebuffer(o,c,d){return new xa(this,o,c,d)}clear({color:o,depth:c}){const d=this.gl;let g=0;o&&(g|=d.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(g|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(g)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){Xt(o.blendFunction,Kt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Rt{constructor(o,c,d){this.func=o,this.mask=c,this.range=d}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);class Ft{constructor(o,c,d,g,x,C){this.test=o,this.ref=c,this.mask=d,this.fail=g,this.depthFail=x,this.pass=C}}Ft.disabled=new Ft({func:519,mask:0},0,0,7680,7680,7680);class kn{constructor(o,c,d){this.enable=o,this.mode=c,this.frontFace=d}}let ba;function lt(f,o,c,d,g,x,C){const E=f.context,M=E.gl,A=f.useProgram("collisionBox"),F=[];let z=0,V=0;for(let K=0;K<d.length;K++){const pe=d[K],ue=o.getTile(pe),_e=ue.getBucket(c);if(!_e)continue;let be=pe.posMatrix;0===g[0]&&0===g[1]||(be=f.translatePosMatrix(pe.posMatrix,ue,g,x));const Se=C?_e.textCollisionBox:_e.iconCollisionBox,me=_e.collisionCircleArray;if(me.length>0){const He=y.create(),Re=be;y.mul(He,_e.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(He,He,_e.placementViewportMatrix),F.push({circleArray:me,circleOffset:V,transform:Re,invTransform:He,coord:pe}),z+=me.length/4,V=z}Se&&A.draw(E,M.LINES,Rt.disabled,Ft.disabled,f.colorModeForRenderPass(),kn.disabled,Os(be,f.transform,ue),f.style.terrain&&f.style.terrain.getTerrainData(pe),c.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,f.transform.zoom,null,null,Se.collisionVertexBuffer)}if(!C||!F.length)return;const X=f.useProgram("collisionCircle"),W=new y.CollisionCircleLayoutArray;W.resize(4*z),W._trim();let Z=0;for(const K of F)for(let pe=0;pe<K.circleArray.length/4;pe++){const ue=4*pe,_e=K.circleArray[ue+0],be=K.circleArray[ue+1],Se=K.circleArray[ue+2],me=K.circleArray[ue+3];W.emplace(Z++,_e,be,Se,me,0),W.emplace(Z++,_e,be,Se,me,1),W.emplace(Z++,_e,be,Se,me,2),W.emplace(Z++,_e,be,Se,me,3)}(!ba||ba.length<2*z)&&(ba=function(K){const pe=2*K,ue=new y.QuadTriangleArray;ue.resize(pe),ue._trim();for(let _e=0;_e<pe;_e++){const be=6*_e;ue.uint16[be+0]=4*_e+0,ue.uint16[be+1]=4*_e+1,ue.uint16[be+2]=4*_e+2,ue.uint16[be+3]=4*_e+2,ue.uint16[be+4]=4*_e+3,ue.uint16[be+5]=4*_e+0}return ue}(z));const re=E.createIndexBuffer(ba,!0),ae=E.createVertexBuffer(W,y.collisionCircleLayout.members,!0);for(const K of F){const pe={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(he=f.transform).cameraToCenterDistance,u_viewport_size:[he.width,he.height]};X.draw(E,M.TRIANGLES,Rt.disabled,Ft.disabled,f.colorModeForRenderPass(),kn.disabled,pe,f.style.terrain&&f.style.terrain.getTerrainData(K.coord),c.id,ae,re,y.SegmentVector.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,f.transform.zoom,null,null,null)}var he;ae.destroy(),re.destroy()}kn.disabled=new kn(!1,1029,2305),kn.backCCW=new kn(!0,1029,2305);const Hr=y.identity(new Float32Array(16));function xn(f,o,c,d,g,x){const{horizontalAlign:C,verticalAlign:E}=y.getAnchorAlignment(f),M=-(C-.5)*o,A=-(E-.5)*c,F=y.evaluateVariableOffset(f,d);return new y.pointGeometry((M/g+F[0])*x,(A/g+F[1])*x)}function Tr(f,o,c,d,g,x,C,E,M,A,F){const z=f.text.placedSymbolArray,V=f.text.dynamicLayoutVertexArray,X=f.icon.dynamicLayoutVertexArray,W={};V.clear();for(let Z=0;Z<z.length;Z++){const re=z.get(Z),ae=f.allowVerticalPlacement&&!re.placedOrientation,he=re.hidden||!re.crossTileID||ae?null:d[re.crossTileID];if(he){const K=new y.pointGeometry(re.anchorX,re.anchorY),pe=qt(K,c?C:x,F),ue=Si(g.cameraToCenterDistance,pe.signedDistanceFromCamera);let _e=y.evaluateSizeForFeature(f.textSizeData,M,re)*ue/y.ONE_EM;c&&(_e*=f.tilePixelRatio/E);const{width:be,height:Se,anchor:me,textOffset:He,textBoxScale:Re}=he,qe=xn(me,be,Se,He,Re,_e),xt=c?qt(K.add(qe),x,F).point:pe.point.add(o?qe.rotate(-g.angle):qe),Dt=f.allowVerticalPlacement&&re.placedOrientation===y.WritingMode.vertical?Math.PI/2:0;for(let rt=0;rt<re.numGlyphs;rt++)y.addDynamicAttributes(V,xt,Dt);A&&re.associatedIconIndex>=0&&(W[re.associatedIconIndex]={shiftedAnchor:xt,angle:Dt})}else pt(re.numGlyphs,V)}if(A){X.clear();const Z=f.icon.placedSymbolArray;for(let re=0;re<Z.length;re++){const ae=Z.get(re);if(ae.hidden)pt(ae.numGlyphs,X);else{const he=W[re];if(he)for(let K=0;K<ae.numGlyphs;K++)y.addDynamicAttributes(X,he.shiftedAnchor,he.angle);else pt(ae.numGlyphs,X)}}f.icon.dynamicLayoutVertexBuffer.updateData(X)}f.text.dynamicLayoutVertexBuffer.updateData(V)}function Gr(f,o,c){return c.iconsInText&&o?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Bo(f,o,c,d,g,x,C,E,M,A,F,z){const V=f.context,X=V.gl,W=f.transform,Z="map"===E,re="map"===M,ae="viewport"!==E&&"point"!==c.layout.get("symbol-placement"),he=Z&&!re&&!ae,K=!c.layout.get("symbol-sort-key").isConstant();let pe=!1;const ue=f.depthModeForSublayer(0,Rt.ReadOnly),_e=c.layout.get("text-variable-anchor"),be=[];for(const Se of d){const me=o.getTile(Se),He=me.getBucket(c);if(!He)continue;const Re=g?He.text:He.icon;if(!Re||!Re.segments.get().length)continue;const qe=Re.programConfigurations.get(c.id),xt=g||He.sdfIcons,Dt=g?He.textSizeData:He.iconSizeData,rt=re||0!==W.pitch,ln=f.useProgram(Gr(xt,g,He),qe),tn=y.evaluateSizeForZoom(Dt,W.zoom),Bt=f.style.terrain&&f.style.terrain.getTerrainData(Se);let Vt,cn,ir,Ji,ki=[0,0],Yi=null;if(g){if(cn=me.glyphAtlasTexture,ir=X.LINEAR,Vt=me.glyphAtlasTexture.size,He.iconsInText){ki=me.imageAtlasTexture.size,Yi=me.imageAtlasTexture;const Fi="composite"===Dt.kind||"camera"===Dt.kind;Ji=rt||f.options.rotating||f.options.zooming||Fi?X.LINEAR:X.NEAREST}}else{const Fi=1!==c.layout.get("icon-size").constantOr(0)||He.iconsNeedLinear;cn=me.imageAtlasTexture,ir=xt||f.options.rotating||f.options.zooming||Fi||rt?X.LINEAR:X.NEAREST,Vt=me.imageAtlasTexture.size}const _o=Xn(me,1,f.transform.zoom),Ri=ga(Se.posMatrix,re,Z,f.transform,_o),si=Wi(Se.posMatrix,re,Z,f.transform,_o),$n=_e&&He.hasTextData(),Qi="none"!==c.layout.get("icon-text-fit")&&$n&&He.hasIconData();if(ae){const Fi=f.style.terrain?(Ma,Go)=>f.style.terrain.getElevation(Se,Ma,Go):null,vo="map"===c.layout.get("text-rotation-alignment");Ti(He,Se.posMatrix,f,g,Ri,si,re,A,vo,Fi)}const Lt=f.translatePosMatrix(Se.posMatrix,me,x,C),kt=ae||g&&_e||Qi?Hr:Ri,un=f.translatePosMatrix(si,me,x,C,!0),pr=xt&&0!==c.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1);let fr;fr=xt?He.iconsInText?Ju(Dt.kind,tn,he,re,f,Lt,kt,un,Vt,ki):$c(Dt.kind,tn,he,re,f,Lt,kt,un,g,Vt,!0):jc(Dt.kind,tn,he,re,f,Lt,kt,un,g,Vt);const Fn={program:ln,buffers:Re,uniformValues:fr,atlasTexture:cn,atlasTextureIcon:Yi,atlasInterpolation:ir,atlasInterpolationIcon:Ji,isSDF:xt,hasHalo:pr};if(K&&He.canOverlap){pe=!0;const Fi=Re.segments.get();for(const vo of Fi)be.push({segments:new y.SegmentVector([vo]),sortKey:vo.sortKey,state:Fn,terrainData:Bt})}else be.push({segments:Re.segments,sortKey:0,state:Fn,terrainData:Bt})}pe&&be.sort((Se,me)=>Se.sortKey-me.sortKey);for(const Se of be){const me=Se.state;if(V.activeTexture.set(X.TEXTURE0),me.atlasTexture.bind(me.atlasInterpolation,X.CLAMP_TO_EDGE),me.atlasTextureIcon&&(V.activeTexture.set(X.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),me.isSDF){const He=me.uniformValues;me.hasHalo&&(He.u_is_halo=1,vr(me.buffers,Se.segments,c,f,me.program,ue,F,z,He,Se.terrainData)),He.u_is_halo=0}vr(me.buffers,Se.segments,c,f,me.program,ue,F,z,me.uniformValues,Se.terrainData)}}function vr(f,o,c,d,g,x,C,E,M,A){const F=d.context;g.draw(F,F.gl.TRIANGLES,x,C,E,kn.disabled,M,A,c.id,f.layoutVertexBuffer,f.indexBuffer,o,c.paint,d.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ar(f,o,c,d,g,x,C){const E=f.context.gl,M=c.paint.get("fill-pattern"),A=M&&M.constantOr(1),F=c.getCrossfadeParameters();let z,V,X,W,Z;C?(V=A&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=E.LINES):(V=A?"fillPattern":"fill",z=E.TRIANGLES);for(const re of d){const ae=o.getTile(re);if(A&&!ae.patternsLoaded())continue;const he=ae.getBucket(c);if(!he)continue;const K=he.programConfigurations.get(c.id),pe=f.useProgram(V,K),ue=f.style.terrain&&f.style.terrain.getTerrainData(re);A&&(f.context.activeTexture.set(E.TEXTURE0),ae.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),K.updatePaintBuffers(F));const _e=M.constantOr(null);if(_e&&ae.imageAtlas){const me=ae.imageAtlas,He=me.patternPositions[_e.to.toString()],Re=me.patternPositions[_e.from.toString()];He&&Re&&K.setConstantPatternPositions(He,Re)}const be=ue?re:null,Se=f.translatePosMatrix(be?be.posMatrix:re.posMatrix,ae,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(C){W=he.indexBuffer2,Z=he.segments2;const me=[E.drawingBufferWidth,E.drawingBufferHeight];X="fillOutlinePattern"===V&&A?Ct(Se,f,F,ae,me):Ya(Se,me)}else W=he.indexBuffer,Z=he.segments,X=A?ze(Se,f,F,ae):Bc(Se);pe.draw(f.context,z,g,f.stencilModeForClipping(re),x,kn.disabled,X,ue,c.id,he.layoutVertexBuffer,W,Z,c.paint,f.transform.zoom,K)}}function Ge(f,o,c,d,g,x,C){const E=f.context,M=E.gl,A=c.paint.get("fill-extrusion-pattern"),F=A.constantOr(1),z=c.getCrossfadeParameters(),V=c.paint.get("fill-extrusion-opacity");for(const X of d){const W=o.getTile(X),Z=W.getBucket(c);if(!Z)continue;const re=f.style.terrain&&f.style.terrain.getTerrainData(X),ae=Z.programConfigurations.get(c.id),he=f.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ae);F&&(f.context.activeTexture.set(M.TEXTURE0),W.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ae.updatePaintBuffers(z));const K=A.constantOr(null);if(K&&W.imageAtlas){const be=W.imageAtlas,Se=be.patternPositions[K.to.toString()],me=be.patternPositions[K.from.toString()];Se&&me&&ae.setConstantPatternPositions(Se,me)}const pe=f.translatePosMatrix(X.posMatrix,W,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ue=c.paint.get("fill-extrusion-vertical-gradient"),_e=F?zc(pe,f,ue,V,X,z,W):mt(pe,f,ue,V);he.draw(E,E.gl.TRIANGLES,g,x,C,kn.backCCW,_e,re,c.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,c.paint,f.transform.zoom,ae,f.style.terrain&&Z.centroidVertexBuffer)}}function St(f,o,c,d,g,x,C){const E=f.context,M=E.gl,A=c.fbo;if(!A)return;const F=f.useProgram("hillshade"),z=f.style.terrain&&f.style.terrain.getTerrainData(o);E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,A.colorAttachment.get()),F.draw(E,M.TRIANGLES,g,x,C,kn.disabled,((V,X,W,Z)=>{const re=W.paint.get("hillshade-shadow-color"),ae=W.paint.get("hillshade-highlight-color"),he=W.paint.get("hillshade-accent-color");let K=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(K-=V.transform.angle);const pe=!V.options.moving;return{u_matrix:Z?Z.posMatrix:V.transform.calculatePosMatrix(X.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Mr(0,X.tileID),u_light:[W.paint.get("hillshade-exaggeration"),K],u_shadow:re,u_highlight:ae,u_accent:he}})(f,c,d,z?o:null),z,d.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Rn(f,o,c,d,g,x){const C=f.context,E=C.gl,M=o.dem;if(M&&M.data){const A=M.dim,F=M.stride,z=M.getPixels();if(C.activeTexture.set(E.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(F),o.demTexture){const X=o.demTexture;X.update(z,{premultiply:!1}),X.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else o.demTexture=new On(C,z,E.RGBA,{premultiply:!1}),o.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);C.activeTexture.set(E.TEXTURE0);let V=o.fbo;if(!V){const X=new On(C,{width:A,height:A,data:null},E.RGBA);X.bind(E.LINEAR,E.CLAMP_TO_EDGE),V=o.fbo=C.createFramebuffer(A,A,!0),V.colorAttachment.set(X.texture)}C.bindFramebuffer.set(V.framebuffer),C.viewport.set([0,0,A,A]),f.useProgram("hillshadePrepare").draw(C,E.TRIANGLES,d,g,x,kn.disabled,((X,W)=>{const Z=W.stride,re=y.create();return y.ortho(re,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(re,re,[0,-y.EXTENT,0]),{u_matrix:re,u_image:1,u_dimension:[Z,Z],u_zoom:X.overscaledZ,u_unpack:W.getUnpackVector()}})(o.tileID,M),null,c.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Pr(f,o,c,d,g,x){const C=d.paint.get("raster-fade-duration");if(!x&&C>0){const E=y.exported.now(),M=(E-f.timeAdded)/C,A=o?(E-o.timeAdded)/C:-1,F=c.getSource(),z=g.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),V=!o||Math.abs(o.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),X=V&&f.refreshedUponExpiration?1:y.clamp(V?M:1-A,0,1);return f.refreshedUponExpiration&&M>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const mo=new y.Color(1,0,0,1),Dn=new y.Color(0,1,0,1),ls=new y.Color(0,0,1,1),zn=new y.Color(1,0,1,1),wa=new y.Color(0,1,1,1);function Xi(f,o,c,d){Vo(f,0,o+c/2,f.transform.width,c,d)}function Mt(f,o,c,d){Vo(f,o-c/2,0,c,f.transform.height,d)}function Vo(f,o,c,d,g,x){const C=f.context,E=C.gl;E.enable(E.SCISSOR_TEST),E.scissor(o*f.pixelRatio,c*f.pixelRatio,d*f.pixelRatio,g*f.pixelRatio),C.clear({color:x}),E.disable(E.SCISSOR_TEST)}function Ca(f,o,c){const d=f.context,g=d.gl,x=c.posMatrix,C=f.useProgram("debug"),E=Rt.disabled,M=Ft.disabled,A=f.colorModeForRenderPass(),F="$debug",z=f.style.terrain&&f.style.terrain.getTerrainData(c);d.activeTexture.set(g.TEXTURE0),f.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE);const V=o.getTileByID(c.key).latestRawTileData,X=Math.floor((V&&V.byteLength||0)/1024),W=o.getTile(c).tileSize,Z=512/Math.min(W,512)*(c.overscaledZ/f.transform.zoom)*.5;let re=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(re+=` => ${c.overscaledZ}`),function(ae,he){ae.initDebugOverlayCanvas();const K=ae.debugOverlayCanvas,pe=ae.context.gl,ue=ae.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,K.width,K.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(he,5,5),ue.strokeText(he,5,5),ae.debugOverlayTexture.update(K),ae.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(f,`${re} ${X}kB`),C.draw(d,g.TRIANGLES,E,M,Kt.alphaBlended,kn.disabled,Nl(x,y.Color.transparent,Z),null,F,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),C.draw(d,g.LINE_STRIP,E,M,A,kn.disabled,Nl(x,y.Color.red),z,F,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Da(f,o,c){const d=f.context,g=d.gl,x=f.colorModeForRenderPass(),C=new Rt(g.LEQUAL,Rt.ReadWrite,f.depthRangeFor3D),E=f.useProgram("terrain"),M=o.getTerrainMesh(),A=o.getTerrainData(c.tileID);d.bindFramebuffer.set(null),d.viewport.set([0,0,f.width,f.height]),d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const F=f.transform.calculatePosMatrix(c.tileID.toUnwrapped());E.draw(d,g.TRIANGLES,C,Ft.disabled,x,kn.backCCW,{u_matrix:F,u_texture:0},A,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}function cs(f,o,c,d){const g=f.context,x=c.tileSize*o.qualityFactor;c.textures[d]||(c.textures[d]=f.getTileTexture(x)||new On(g,{width:x,height:x,data:null},g.gl.RGBA),c.textures[d].bind(g.gl.LINEAR,g.gl.CLAMP_TO_EDGE),0===d&&o.sourceCache.renderHistory.unshift(c.tileID.key));const C=o.getRTTFramebuffer();C.colorAttachment.set(c.textures[d].texture),g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,x,x])}class xr{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,c=o.terrain;for(const d in o.sourceCaches){this._coordsDescendingInv[d]={};const g=o.sourceCaches[d].getVisibleCoordinates();for(const x of g){const C=c.sourceCache.getTerrainCoords(x);for(const E in C)this._coordsDescendingInv[d][E]||(this._coordsDescendingInv[d][E]=[]),this._coordsDescendingInv[d][E].push(C[E])}}for(const d of o._order){const g=o._layers[d],x=g.source;if(this._renderToTexture[g.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const C in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][C]=this._coordsDescendingInv[x][C].map(E=>E.key).sort().join()}}return this._renderableTiles.forEach(d=>{for(const g in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[g][d.tileID.key];x&&x!==d.textureCoords[g]&&d.clearTextures(this.painter),c.needsRerender(g,d.tileID)&&d.clearTextures(this.painter)}this._rerender[d.tileID.key]=!d.textures.length}),c.clearRerenderCache(),c.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const c=o.type,d=this.painter,g=d.style._order,x=d.currentLayer,C=x+1===g.length;if(this._renderToTexture[c]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(g[x]),!C))return!0;if(this._renderToTexture[this._prevType]||"hillshade"===c||this._renderToTexture[c]&&C){this._prevType=c;const E=this._stacks.length-1,M=this._stacks[E]||[];for(const A of this._renderableTiles){if(cs(d,d.style.terrain,A,E),this._rerender[A.tileID.key]){d.context.clear({color:y.Color.transparent});for(let F=0;F<M.length;F++){const z=d.style._layers[M[F]],V=z.source?this._coordsDescendingInv[z.source][A.tileID.key]:[A.tileID];d._renderTileClippingMasks(z,V),d.renderLayer(d,d.style.sourceCaches[z.source],z,V),z.source&&(A.textureCoords[z.source]=this._coordsDescendingInvStr[z.source][A.tileID.key])}}Da(d,d.style.terrain,A)}if("hillshade"===c){this._stacks.push([g[x]]);for(const A of this._renderableTiles){const F=this._coordsDescendingInv[o.source][A.tileID.key];cs(d,d.style.terrain,A,this._stacks.length-1),d.context.clear({color:y.Color.transparent}),d._renderTileClippingMasks(o,F),d.renderLayer(d,d.style.sourceCaches[o.source],o,F),Da(d,d.style.terrain,A)}return!0}return this._renderToTexture[c]}return!1}}const Uo={symbol:function(f,o,c,d,g){if("translucent"!==f.renderPass)return;const x=Ft.disabled,C=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(E,M,A,F,z,V,X){const W=M.transform,Z="map"===z,re="map"===V;for(const ae of E){const he=F.getTile(ae),K=he.getBucket(A);if(!K||!K.text||!K.text.segments.get().length)continue;const pe=y.evaluateSizeForZoom(K.textSizeData,W.zoom),ue=Xn(he,1,M.transform.zoom),_e=ga(ae.posMatrix,re,Z,M.transform,ue),be="none"!==A.layout.get("icon-text-fit")&&K.hasIconData();if(pe){const Se=Math.pow(2,W.zoom-he.tileID.overscaledZ);Tr(K,Z,re,X,W,_e,ae.posMatrix,Se,pe,be,M.style.terrain?(me,He)=>M.style.terrain.getElevation(ae,me,He):null)}}}(d,f,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),g),0!==c.paint.get("icon-opacity").constantOr(1)&&Bo(f,o,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,C),0!==c.paint.get("text-opacity").constantOr(1)&&Bo(f,o,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,C),o.map.showCollisionBoxes&&(lt(f,o,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),lt(f,o,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,c,d){if("translucent"!==f.renderPass)return;const g=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),E=!c.layout.get("circle-sort-key").isConstant();if(0===g.constantOr(1)&&(0===x.constantOr(1)||0===C.constantOr(1)))return;const M=f.context,A=M.gl,F=f.depthModeForSublayer(0,Rt.ReadOnly),z=Ft.disabled,V=f.colorModeForRenderPass(),X=[];for(let W=0;W<d.length;W++){const Z=d[W],re=o.getTile(Z),ae=re.getBucket(c);if(!ae)continue;const he=ae.programConfigurations.get(c.id),K=f.useProgram("circle",he),pe=ae.layoutVertexBuffer,ue=ae.indexBuffer,_e=f.style.terrain&&f.style.terrain.getTerrainData(Z),be={programConfiguration:he,program:K,layoutVertexBuffer:pe,indexBuffer:ue,uniformValues:sn(f,Z,re,c),terrainData:_e};if(E){const Se=ae.segments.get();for(const me of Se)X.push({segments:new y.SegmentVector([me]),sortKey:me.sortKey,state:be})}else X.push({segments:ae.segments,sortKey:0,state:be})}E&&X.sort((W,Z)=>W.sortKey-Z.sortKey);for(const W of X){const{programConfiguration:Z,program:re,layoutVertexBuffer:ae,indexBuffer:he,uniformValues:K,terrainData:pe}=W.state;re.draw(M,A.TRIANGLES,F,z,V,kn.disabled,K,pe,c.id,ae,he,W.segments,c.paint,f.transform.zoom,Z)}},heatmap:function(f,o,c,d){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const g=f.context,x=g.gl,C=Ft.disabled,E=new Kt([x.ONE,x.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(M,A,F){const z=M.gl;M.activeTexture.set(z.TEXTURE1),M.viewport.set([0,0,A.width/4,A.height/4]);let V=F.heatmapFbo;if(V)z.bindTexture(z.TEXTURE_2D,V.colorAttachment.get()),M.bindFramebuffer.set(V.framebuffer);else{const X=z.createTexture();z.bindTexture(z.TEXTURE_2D,X),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),V=F.heatmapFbo=M.createFramebuffer(A.width/4,A.height/4,!1),function(W,Z,re,ae){const he=W.gl;he.texImage2D(he.TEXTURE_2D,0,he.RGBA,Z.width/4,Z.height/4,0,he.RGBA,W.extRenderToTextureHalfFloat?W.extTextureHalfFloat.HALF_FLOAT_OES:he.UNSIGNED_BYTE,null),ae.colorAttachment.set(re)}(M,A,X,V)}})(g,f,c),g.clear({color:y.Color.transparent});for(let M=0;M<d.length;M++){const A=d[M];if(o.hasRenderableParent(A))continue;const F=o.getTile(A),z=F.getBucket(c);if(!z)continue;const V=z.programConfigurations.get(c.id),X=f.useProgram("heatmap",V),{zoom:W}=f.transform;X.draw(g,x.TRIANGLES,Rt.disabled,C,E,kn.disabled,Ns(A.posMatrix,F,W,c.paint.get("heatmap-intensity")),null,c.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,c.paint,f.transform.zoom,V)}g.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(g,x){const C=g.context,E=C.gl,M=x.heatmapFbo;if(!M)return;C.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,M.colorAttachment.get()),C.activeTexture.set(E.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new On(C,x.colorRamp,E.RGBA)),A.bind(E.LINEAR,E.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(C,E.TRIANGLES,Rt.disabled,Ft.disabled,g.colorModeForRenderPass(),kn.disabled,((F,z,V,X)=>{const W=y.create();y.ortho(W,0,F.width,F.height,0,0,1);const Z=F.context.gl;return{u_matrix:W,u_world:[Z.drawingBufferWidth,Z.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}})(g,x),null,x.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,x.paint,g.transform.zoom)}(f,c))},line:function(f,o,c,d){if("translucent"!==f.renderPass)return;const g=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===g.constantOr(1)||0===x.constantOr(1))return;const C=f.depthModeForSublayer(0,Rt.ReadOnly),E=f.colorModeForRenderPass(),M=c.paint.get("line-dasharray"),A=c.paint.get("line-pattern"),F=A.constantOr(1),z=c.paint.get("line-gradient"),V=c.getCrossfadeParameters(),X=F?"linePattern":M?"lineSDF":z?"lineGradient":"line",W=f.context,Z=W.gl;let re=!0;for(const ae of d){const he=o.getTile(ae);if(F&&!he.patternsLoaded())continue;const K=he.getBucket(c);if(!K)continue;const pe=K.programConfigurations.get(c.id),ue=f.context.program.get(),_e=f.useProgram(X,pe),be=re||_e.program!==ue,Se=f.style.terrain&&f.style.terrain.getTerrainData(ae),me=A.constantOr(null);if(me&&he.imageAtlas){const qe=he.imageAtlas,xt=qe.patternPositions[me.to.toString()],Dt=qe.patternPositions[me.from.toString()];xt&&Dt&&pe.setConstantPatternPositions(xt,Dt)}const He=Se?ae:null,Re=F?Uc(f,he,c,V,He):M?di(f,he,c,M,V,He):z?Vc(f,he,c,K.lineClipsArray.length,He):Qa(f,he,c,He);if(F)W.activeTexture.set(Z.TEXTURE0),he.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),pe.updatePaintBuffers(V);else if(M&&(be||f.lineAtlas.dirty))W.activeTexture.set(Z.TEXTURE0),f.lineAtlas.bind(W);else if(z){const qe=K.gradients[c.id];let xt=qe.texture;if(c.gradientVersion!==qe.version){let Dt=256;if(c.stepInterpolant){const rt=o.getSource().maxzoom,ln=ae.canonical.z===rt?Math.ceil(1<<f.transform.maxZoom-ae.canonical.z):1;Dt=y.clamp(y.nextPowerOfTwo(K.maxLineLength/y.EXTENT*1024*ln),256,W.maxTextureSize)}qe.gradient=y.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:qe.gradient||void 0,clips:K.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new On(W,qe.gradient,Z.RGBA),qe.version=c.gradientVersion,xt=qe.texture}W.activeTexture.set(Z.TEXTURE0),xt.bind(c.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}_e.draw(W,Z.TRIANGLES,C,f.stencilModeForClipping(ae),E,kn.disabled,Re,Se,c.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,c.paint,f.transform.zoom,pe,K.layoutVertexBuffer2),re=!1}},fill:function(f,o,c,d){const g=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const C=f.colorModeForRenderPass(),E=c.paint.get("fill-pattern"),M=f.opaquePassEnabledForLayer()&&!E.constantOr(1)&&1===g.constantOr(y.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(f.renderPass===M){const A=f.depthModeForSublayer(1,"opaque"===f.renderPass?Rt.ReadWrite:Rt.ReadOnly);Ar(f,o,c,d,A,C,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const A=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly);Ar(f,o,c,d,A,C,!0)}},"fill-extrusion":function(f,o,c,d){const g=c.paint.get("fill-extrusion-opacity");if(0!==g&&"translucent"===f.renderPass){const x=new Rt(f.context.gl.LEQUAL,Rt.ReadWrite,f.depthRangeFor3D);if(1!==g||c.paint.get("fill-extrusion-pattern").constantOr(1))Ge(f,o,c,d,x,Ft.disabled,Kt.disabled),Ge(f,o,c,d,x,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const C=f.colorModeForRenderPass();Ge(f,o,c,d,x,Ft.disabled,C)}}},hillshade:function(f,o,c,d){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const g=f.context,x=f.depthModeForSublayer(0,Rt.ReadOnly),C=f.colorModeForRenderPass(),[E,M]="translucent"===f.renderPass?f.stencilConfigForOverlap(d):[{},d];for(const A of M){const F=o.getTile(A);void 0!==F.needsHillshadePrepare&&F.needsHillshadePrepare&&"offscreen"===f.renderPass?Rn(f,F,c,x,Ft.disabled,C):"translucent"===f.renderPass&&St(f,A,F,c,x,E[A.overscaledZ],C)}g.viewport.set([0,0,f.width,f.height])},raster:function(f,o,c,d){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!d.length)return;const g=f.context,x=g.gl,C=o.getSource(),E=f.useProgram("raster"),M=f.colorModeForRenderPass(),[A,F]=C instanceof Ei?[{},d]:f.stencilConfigForOverlap(d),z=F[F.length-1].overscaledZ,V=!f.options.moving;for(const X of F){const W=f.depthModeForSublayer(X.overscaledZ-z,1===c.paint.get("raster-opacity")?Rt.ReadWrite:Rt.ReadOnly,x.LESS),Z=o.getTile(X);Z.registerFadeDuration(c.paint.get("raster-fade-duration"));const re=o.findLoadedParent(X,0),ae=Pr(Z,re,o,c,f.transform,f.style.terrain);let he,K;const pe="nearest"===c.paint.get("raster-resampling")?x.NEAREST:x.LINEAR;g.activeTexture.set(x.TEXTURE0),Z.texture.bind(pe,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(x.TEXTURE1),re?(re.texture.bind(pe,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),he=Math.pow(2,re.tileID.overscaledZ-Z.tileID.overscaledZ),K=[Z.tileID.canonical.x*he%1,Z.tileID.canonical.y*he%1]):Z.texture.bind(pe,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const ue=f.style.terrain&&f.style.terrain.getTerrainData(X),_e=ue?X:null,be=_e?_e.posMatrix:f.transform.calculatePosMatrix(X.toUnwrapped(),V),Se=yd(be,K||[0,0],he||1,ae,c);C instanceof Ei?E.draw(g,x.TRIANGLES,W,Ft.disabled,M,kn.disabled,Se,ue,c.id,C.boundsBuffer,f.quadTriangleIndexBuffer,C.boundsSegments):E.draw(g,x.TRIANGLES,W,A[X.overscaledZ],M,kn.disabled,Se,ue,c.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,o,c,d){const g=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(0===x)return;const C=f.context,E=C.gl,M=f.transform,A=M.tileSize,F=c.paint.get("background-pattern");if(f.isPatternMissing(F))return;const z=!F&&1===g.a&&1===x&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==z)return;const V=Ft.disabled,X=f.depthModeForSublayer(0,"opaque"===z?Rt.ReadWrite:Rt.ReadOnly),W=f.colorModeForRenderPass(),Z=f.useProgram(F?"backgroundPattern":"background"),re=d||M.coveringTiles({tileSize:A,terrain:f.style.terrain});F&&(C.activeTexture.set(E.TEXTURE0),f.imageManager.bind(f.context));const ae=c.getCrossfadeParameters();for(const he of re){const K=d?he.posMatrix:f.transform.calculatePosMatrix(he.toUnwrapped()),pe=F?pi(K,x,f,F,{tileID:he,tileSize:A},ae):uf(K,x,g),ue=f.style.terrain&&f.style.terrain.getTerrainData(he);Z.draw(C,E.TRIANGLES,X,V,W,kn.disabled,pe,ue,c.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}},debug:function(f,o,c){for(let d=0;d<c.length;d++)Ca(f,o,c[d])},custom:function(f,o,c){const d=f.context,g=c.implementation;if("offscreen"===f.renderPass){const x=g.prerender;x&&(f.setCustomLayerDefaults(),d.setColorMode(f.colorModeForRenderPass()),x.call(g,d.gl,f.transform.customLayerMatrix()),d.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),d.setColorMode(f.colorModeForRenderPass()),d.setStencilMode(Ft.disabled);const x="3d"===g.renderingMode?new Rt(f.context.gl.LEQUAL,Rt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Rt.ReadOnly);d.setDepthMode(x),g.render(d.gl,f.transform.customLayerMatrix()),d.setDirty(),f.setBaseState(),d.bindFramebuffer.set(null)}}};class us{constructor(o,c){this.context=new nh(o),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:y.create(),renderTime:0},this.setup(),this.numSublayers=Qt.maxUnderzooming+Qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ct,this.gpuTimers={}}resize(o,c,d){if(this.width=o*d,this.height=c*d,this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const o=this.context,c=new y.PosArray;c.emplaceBack(0,0),c.emplaceBack(y.EXTENT,0),c.emplaceBack(0,y.EXTENT),c.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,$t.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);const d=new y.PosArray;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=o.createVertexBuffer(d,$t.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);const g=new y.RasterBoundsArray;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(g,Po.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);const x=new y.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,$t.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);const C=new y.LineStripIndexArray;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(C);const E=new y.TriangleIndexArray;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E),this.emptyTexture=new On(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const M=this.context.gl;this.stencilClearMode=new Ft({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=y.create();y.ortho(d,0,this.width,this.height,0,0,1),y.scale(d,d,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,c.TRIANGLES,Rt.disabled,this.stencilClearMode,Kt.disabled,kn.disabled,_a(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,c){if(this.currentStencilSource===o.source||!o.isTileClipped()||!c||!c.length)return;this.currentStencilSource=o.source;const d=this.context,g=d.gl;this.nextStencilID+c.length>256&&this.clearStencil(),d.setColorMode(Kt.disabled),d.setDepthMode(Rt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of c){const E=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,M=this.style.terrain&&this.style.terrain.getTerrainData(C);x.draw(d,g.TRIANGLES,Rt.disabled,new Ft({func:g.ALWAYS,mask:0},E,255,g.KEEP,g.KEEP,g.REPLACE),Kt.disabled,kn.disabled,_a(C.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new Ft({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){const c=this.context.gl;return new Ft({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,d=o.sort((C,E)=>E.overscaledZ-C.overscaledZ),g=d[d.length-1].overscaledZ,x=d[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const C={};for(let E=0;E<x;E++)C[E+g]=new Ft({func:c.GEQUAL,mask:255},E+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[C,d]}return[{[g]:Ft.disabled},d]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Kt([o.CONSTANT_COLOR,o.ONE],new y.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Kt.unblended:Kt.alphaBlended}depthModeForSublayer(o,c,d){if(!this.opaquePassEnabledForLayer())return Rt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Rt(d||this.context.gl.LEQUAL,c,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(y.exported.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,x=this.style.terrain&&new xr(this);for(const A in g){const F=g[A];F.used&&F.prepare(this.context)}const C={},E={},M={};for(const A in g){const F=g[A];C[A]=F.getVisibleCoordinates(),E[A]=C[A].slice().reverse(),M[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<d.length;A++)if(this.style._layers[d[A]].is3D()){this.opaquePassCutoff=A;break}if(x){this.opaquePassCutoff=0;const A=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!y.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(y.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,z){const V=F.context,X=V.gl,W=Kt.unblended,Z=new Rt(X.LEQUAL,Rt.ReadWrite,[0,1]),re=z.getTerrainMesh(),ae=z.sourceCache.getRenderableTiles(),he=F.useProgram("terrainDepth");V.bindFramebuffer.set(z.getFramebuffer("depth").framebuffer),V.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),V.clear({color:y.Color.transparent,depth:1});for(const K of ae){const pe=z.getTerrainData(K.tileID),ue=F.transform.calculatePosMatrix(K.tileID.toUnwrapped());he.draw(V,X.TRIANGLES,Z,Ft.disabled,W,kn.backCCW,{u_matrix:ue},pe,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}V.bindFramebuffer.set(null),V.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain),function(F,z){const V=F.context,X=V.gl,W=Kt.unblended,Z=new Rt(X.LEQUAL,Rt.ReadWrite,[0,1]),re=z.getTerrainMesh(),ae=z.getCoordsTexture(),he=z.sourceCache.getRenderableTiles(),K=F.useProgram("terrainCoords");V.bindFramebuffer.set(z.getFramebuffer("coords").framebuffer),V.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),V.clear({color:y.Color.transparent,depth:1}),z.coordsIndex=[];for(const pe of he){const ue=z.getTerrainData(pe.tileID);V.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,ae.texture);const _e=F.transform.calculatePosMatrix(pe.tileID.toUnwrapped());K.draw(V,X.TRIANGLES,Z,Ft.disabled,W,kn.backCCW,{u_matrix:_e,u_terrain_coords_id:(255-z.coordsIndex.length)/255,u_texture:0},ue,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),z.coordsIndex.push(pe.tileID.key)}V.bindFramebuffer.set(null),V.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const A of d){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const z=E[F.source];("custom"===F.type||z.length)&&this.renderLayer(this,g[F.source],F,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!x)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[d[this.currentLayer]],F=g[A.source],z=C[A.source];this._renderTileClippingMasks(A,z),this.renderLayer(this,F,A,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const A=this.style._layers[d[this.currentLayer]],F=g[A.source];if(x&&x.renderLayer(A))continue;const z=("symbol"===A.type?M:E)[A.source];this._renderTileClippingMasks(A,C[A.source]),this.renderLayer(this,F,A,z)}if(this.options.showTileBoundaries){let A,F;Object.values(this.style._layers).forEach(z=>{z.source&&!z.isHidden(this.transform.zoom)&&(z.source!==(F&&F.id)&&(F=this.style.sourceCaches[z.source]),(!A||A.getSource().maxzoom<F.getSource().maxzoom)&&(A=F))}),A&&Uo.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;Xi(A,A.transform.height-(F.top||0),3,mo),Xi(A,F.bottom||0,3,Dn),Mt(A,F.left||0,3,ls),Mt(A,A.transform.width-(F.right||0),3,zn);const z=A.transform.centerPoint;var V,X,W,Z;Vo(V=A,(X=z.x)-1,(W=A.transform.height-z.y)-10,2,20,Z=wa),Vo(V,X-10,W-1,20,2,Z)}(this),this.context.setDefault()}renderLayer(o,c,d,g){d.isHidden(this.transform.zoom)||("background"===d.type||"custom"===d.type||(g||[]).length)&&(this.id=d.id,this.gpuTimingStart(d),Uo[d.type](o,c,d,g,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let d=this.gpuTimers[o.id];d||(d=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),d.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,d.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const c={};for(const d in o){const g=o[d],x=this.context.extTimerQuery,C=x.getQueryObjectEXT(g.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(g.query),c[d]=C}return c}translatePosMatrix(o,c,d,g,x){if(!d[0]&&!d[1])return o;const C=x?"map"===g?this.transform.angle:0:"viewport"===g?-this.transform.angle:0;if(C){const A=Math.sin(C),F=Math.cos(C);d=[d[0]*F-d[1]*A,d[0]*A+d[1]*F]}const E=[x?d[0]:Xn(c,d[0],this.transform.zoom),x?d[1]:Xn(c,d[1],this.transform.zoom),0],M=new Float32Array(16);return y.translate(M,o,E),M}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const c=this.imageManager.getPattern(o.from.toString()),d=this.imageManager.getPattern(o.to.toString());return!c||!d}useProgram(o,c){this.cache=this.cache||{};const d=o+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new Ku(this.context,o,dn[o],c,an[o],this._showOverdrawInspector,this.style.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new On(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class oi{constructor(o,c){this.points=o,this.planes=c}static fromInvProjectionMatrix(o,c,d){const g=Math.pow(2,d),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const M=1/(E=y.transformMat4([],E,o))[3]/c*g;return y.mul$1(E,E,[M,M,1/E[3],M])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const M=y.sub([],x[E[0]],x[E[1]]),A=y.sub([],x[E[2]],x[E[1]]),F=y.normalize([],y.cross([],M,A)),z=-y.dot(F,x[E[1]]);return F.concat(z)});return new oi(x,C)}}class go{constructor(o,c){this.min=o,this.max=c,this.center=y.scale$1([],y.add([],this.min,this.max),.5)}quadrant(o){const c=[o%2==0,o<2],d=y.clone$2(this.min),g=y.clone$2(this.max);for(let x=0;x<c.length;x++)d[x]=c[x]?this.min[x]:this.center[x],g[x]=c[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new go(d,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let g=0;g<o.planes.length;g++){const x=o.planes[g];let C=0;for(let E=0;E<c.length;E++)y.dot$1(x,c[E])>=0&&C++;if(0===C)return 0;C!==c.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let x=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let E=0;E<o.points.length;E++){const M=o.points[E][g]-this.min[g];x=Math.min(x,M),C=Math.max(C,M)}if(C<0||x>this.max[g]-this.min[g])return 0}return 1}}class Bs{constructor(o=0,c=0,d=0,g=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=d,this.right=g}interpolate(o,c,d){return null!=c.top&&null!=o.top&&(this.top=y.number(o.top,c.top,d)),null!=c.bottom&&null!=o.bottom&&(this.bottom=y.number(o.bottom,c.bottom,d)),null!=c.left&&null!=o.left&&(this.left=y.number(o.left,c.left,d)),null!=c.right&&null!=o.right&&(this.right=y.number(o.right,c.right,d)),this}getCenter(o,c){const d=y.clamp((this.left+o-this.right)/2,0,o),g=y.clamp((this.top+c-this.bottom)/2,0,c);return new y.pointGeometry(d,g)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Bs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fn{constructor(o,c,d,g,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=void 0===x||!!x,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Bs,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new fn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const c=-y.wrap(o,-180,180)*Math.PI/180;var d,g,x,C,E,M,A,F,z,V;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(d=new y.ARRAY_TYPE(4),y.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),g=this.rotationMatrix,C=this.angle,E=(x=this.rotationMatrix)[0],M=x[1],A=x[2],F=x[3],z=Math.sin(C),V=Math.cos(C),g[0]=E*V+A*z,g[1]=M*V+F*z,g[2]=E*-z+A*V,g[3]=M*-z+F*V)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=y.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,d){this._unmodified=!1,this._edgeInsets.interpolate(o,c,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new y.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const d=this.pointCoordinate(new y.pointGeometry(0,0)),g=this.pointCoordinate(new y.pointGeometry(this.width,0)),x=this.pointCoordinate(new y.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new y.pointGeometry(0,this.height)),E=Math.floor(Math.min(d.x,g.x,x.x,C.x)),M=Math.floor(Math.max(d.x,g.x,x.x,C.x)),A=1;for(let F=E-A;F<=M+A;F++)0!==F&&c.push(new y.UnwrappedTileID(F,o))}return c}coveringTiles(o){var c,d;let g=this.coveringZoomLevel(o);const x=g;if(void 0!==o.minzoom&&g<o.minzoom)return[];void 0!==o.maxzoom&&g>o.maxzoom&&(g=o.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),E=y.MercatorCoordinate.fromLngLat(this.center),M=Math.pow(2,g),A=[M*C.x,M*C.y,0],F=[M*E.x,M*E.y,0],z=oi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let V=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=g);const X=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,W=K=>({aabb:new go([K*M,0,0],[(K+1)*M,M,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),Z=[],re=[],ae=g,he=o.reparseOverscaled?x:g;if(this._renderWorldCopies)for(let K=1;K<=3;K++)Z.push(W(-K)),Z.push(W(K));for(Z.push(W(0));Z.length>0;){const K=Z.pop(),pe=K.x,ue=K.y;let _e=K.fullyVisible;if(!_e){const qe=K.aabb.intersects(z);if(0===qe)continue;_e=2===qe}const be=o.terrain?A:F,Se=K.aabb.distanceX(be),me=K.aabb.distanceY(be),He=Math.max(Math.abs(Se),Math.abs(me)),Re=X+(1<<ae-K.zoom)-2;if(K.zoom===ae||He>Re&&K.zoom>=V){const qe=ae-K.zoom,xt=A[0]-.5-(pe<<qe),Dt=A[1]-.5-(ue<<qe);re.push({tileID:new y.OverscaledTileID(K.zoom===ae?he:K.zoom,K.wrap,K.zoom,pe,ue),distanceSq:y.sqrLen([F[0]-.5-pe,F[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(xt*xt+Dt*Dt)})}else for(let qe=0;qe<4;qe++){const xt=(pe<<1)+qe%2,Dt=(ue<<1)+(qe>>1),rt=K.zoom+1;let ln=K.aabb.quadrant(qe);if(o.terrain){const tn=new y.OverscaledTileID(rt,K.wrap,rt,xt,Dt),Bt=o.terrain.getMinMaxElevation(tn),Vt=null!==(c=Bt.minElevation)&&void 0!==c?c:this.elevation,cn=null!==(d=Bt.maxElevation)&&void 0!==d?d:this.elevation;ln=new go([ln.min[0],ln.min[1],Vt],[ln.max[0],ln.max[1],cn])}Z.push({aabb:ln,zoom:rt,x:xt,y:Dt,wrap:K.wrap,fullyVisible:_e})}}return re.sort((K,pe)=>K.distanceSq-pe.distanceSq).map(K=>K.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=y.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.pointGeometry(y.mercatorXfromLng(o.lng)*this.worldSize,y.mercatorYfromLat(c)*this.worldSize)}unproject(o){return new y.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,c){const d=y.MercatorCoordinate.fromLngLat(o),g=(1<<this.tileZoom)*y.EXTENT,x=d.x*g,C=d.y*g,E=Math.floor(x/y.EXTENT),M=Math.floor(C/y.EXTENT),A=new y.OverscaledTileID(this.tileZoom,0,this.tileZoom,E,M);return c.getElevation(A,x%y.EXTENT,C%y.EXTENT,y.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const c=this.pointLocation(this.centerPoint,o),d=this.getElevation(c,o);if(!(this.elevation-d))return;const g=this.getCameraPosition(),x=y.MercatorCoordinate.fromLngLat(g.lngLat,g.altitude),C=y.MercatorCoordinate.fromLngLat(c,d),E=x.x-C.x,M=x.y-C.y,A=x.z-C.z,F=Math.sqrt(E*E+M*M+A*A),z=this.scaleZoom(this.cameraToCenterDistance/F/this.tileSize);this._elevation=d,this._center=c,this.zoom=z}setLocationAtPoint(o,c){const d=this.pointCoordinate(c),g=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o),C=new y.MercatorCoordinate(x.x-(d.x-g.x),x.y-(d.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,c){return c?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,c),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,c){return this.coordinateLocation(this.pointCoordinate(o,c))}locationCoordinate(o){return y.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,c){if(c){const V=c.pointCoordinate(o);if(null!=V)return V}const d=[o.x,o.y,0,1],g=[o.x,o.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(g,g,this.pixelMatrixInverse);const x=d[3],C=g[3],E=d[1]/x,M=g[1]/C,A=d[2]/x,F=g[2]/C,z=A===F?0:(0-A)/(F-A);return new y.MercatorCoordinate(y.number(d[0]/x,g[0]/C,z)/this.worldSize,y.number(E,M,z)/this.worldSize)}coordinatePoint(o,c=0,d=this.pixelMatrix){const g=[o.x*this.worldSize,o.y*this.worldSize,c,1];return y.transformMat4(g,g,d),new y.pointGeometry(g[0]/g[3],g[1]/g[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return(new y.LngLatBounds).extend(this.pointLocation(new y.pointGeometry(0,o))).extend(this.pointLocation(new y.pointGeometry(this.width,o))).extend(this.pointLocation(new y.pointGeometry(this.width,this.height))).extend(this.pointLocation(new y.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,c=!1){const d=o.key,g=c?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];const x=o.canonical,C=this.worldSize/this.zoomScale(x.z),E=x.x+Math.pow(2,x.z)*o.wrap,M=y.identity(new Float64Array(16));return y.translate(M,M,[E*C,x.y*C,0]),y.scale(M,M,[C/y.EXTENT,C/y.EXTENT,1]),y.multiply(M,c?this.alignedProjMatrix:this.projMatrix,M),g[d]=new Float32Array(M),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,c,d,g,x=-90,C=90,E=-180,M=180;const A=this.size,F=this._unmodified;if(this.latRange){const X=this.latRange;x=y.mercatorYfromLat(X[1])*this.worldSize,C=y.mercatorYfromLat(X[0])*this.worldSize,o=C-x<A.y?A.y/(C-x):0}if(this.lngRange){const X=this.lngRange;E=y.wrap(y.mercatorXfromLng(X[0])*this.worldSize,0,this.worldSize),M=y.wrap(y.mercatorXfromLng(X[1])*this.worldSize,0,this.worldSize),M<E&&(M+=this.worldSize),c=M-E<A.x?A.x/(M-E):0}const z=this.point,V=Math.max(c||0,o||0);if(V)return this.center=this.unproject(new y.pointGeometry(c?(M+E)/2:z.x,o?(C+x)/2:z.y)),this.zoom+=this.scaleZoom(V),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const X=z.y,W=A.y/2;X-W<x&&(g=x+W),X+W>C&&(g=C-W)}if(this.lngRange){const X=(E+M)/2,W=y.wrap(z.x,X-this.worldSize/2,X+this.worldSize/2),Z=A.x/2;W-Z<E&&(d=E+Z),W+Z>M&&(d=M-Z)}void 0===d&&void 0===g||(this.center=this.unproject(new y.pointGeometry(void 0!==d?d:z.x,void 0!==g?g:z.y)).wrap()),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,c=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let g=y.identity(new Float64Array(16));y.scale(g,g,[this.width/2,-this.height/2,1]),y.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=y.identity(new Float64Array(16)),y.scale(g,g,[1,-1,1]),y.translate(g,g,[-1,-1,0]),y.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=Math.PI/2+this._pitch,C=this._fov*(.5+o.y/this.height),E=Math.sin(C)*this.cameraToSeaLevelDistance/Math.sin(y.clamp(Math.PI-x-C,.01,Math.PI-.01)),M=this.getHorizon(),A=2*Math.atan(M/this.cameraToCenterDistance)*(.5+o.y/(2*M)),F=Math.sin(A)*this.cameraToSeaLevelDistance/Math.sin(y.clamp(Math.PI-x-A,.01,Math.PI-.01)),z=Math.cos(Math.PI/2-this._pitch)*E+this.cameraToSeaLevelDistance,V=Math.cos(Math.PI/2-this._pitch)*F+this.cameraToSeaLevelDistance,X=1.01*Math.min(z,V),W=this.height/50;g=new Float64Array(16),y.perspective(g,this._fov,this.width/this.height,W,X),g[8]=2*-o.x/this.width,g[9]=2*o.y/this.height,y.scale(g,g,[1,-1,1]),y.translate(g,g,[0,0,-this.cameraToCenterDistance]),y.rotateX(g,g,this._pitch),y.rotateZ(g,g,this.angle),y.translate(g,g,[-c,-d,0]),this.mercatorMatrix=y.scale([],g,[this.worldSize,this.worldSize,this.worldSize]),y.scale(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,g),y.translate(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=y.invert([],g),this.pixelMatrix3D=y.multiply(new Float64Array(16),this.labelPlaneMatrix,g);const Z=this.width%2/2,re=this.height%2/2,ae=Math.cos(this.angle),he=Math.sin(this.angle),K=c-Math.round(c)+ae*Z+he*re,pe=d-Math.round(d)+ae*re+he*Z,ue=new Float64Array(g);if(y.translate(ue,ue,[K>.5?K-1:K,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=ue,g=y.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new y.pointGeometry(0,0)),c=[o.x*this.worldSize,o.y*this.worldSize,0,1];return y.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.pointGeometry(0,o))}getCameraQueryGeometry(o){const c=this.getCameraPoint();if(1===o.length)return[o[0],c];{let d=c.x,g=c.y,x=c.x,C=c.y;for(const E of o)d=Math.min(d,E.x),g=Math.min(g,E.y),x=Math.max(x,E.x),C=Math.max(C,E.y);return[new y.pointGeometry(d,g),new y.pointGeometry(x,g),new y.pointGeometry(x,C),new y.pointGeometry(d,C),new y.pointGeometry(d,g)]}}}class rh{constructor(o){this._hashName=o&&encodeURIComponent(o),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(c,d){let g=!1,x=null;const C=()=>{x=null,g&&(c(),x=setTimeout(C,300),g=!1)};return()=>(g=!0,x||C(),x)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const c=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),C=Math.round(c.lng*x)/x,E=Math.round(c.lat*x)/x,M=this._map.getBearing(),A=this._map.getPitch();let F="";if(F+=o?`/${C}/${E}/${d}`:`${d}/${E}/${C}`,(M||A)&&(F+="/"+Math.round(10*M)/10),A&&(F+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let V=!1;const X=window.location.hash.slice(1).split("&").map(W=>{const Z=W.split("=")[0];return Z===z?(V=!0,`${Z}=${F}`):W}).filter(W=>W);return V||X.push(`${z}=${F}`),`#${X.join("&")}`}return`#${F}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const sl={linearity:.3,easing:y.bezier(0,0,.3,1)},al=y.extend({deceleration:2500,maxSpeed:1400},sl),Hl=y.extend({deceleration:20,maxSpeed:1400},sl),Ea=y.extend({deceleration:1e3,maxSpeed:360},sl),jo=y.extend({deceleration:1e3,maxSpeed:90},sl);class hs{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=y.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new y.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(c.pan.mag()){const x=ll(c.pan.mag(),d,y.extend({},al,o||{}));g.offset=c.pan.mult(x.amount/c.pan.mag()),g.center=this._map.transform.center,Qn(g,x)}if(c.zoom){const x=ll(c.zoom,d,Hl);g.zoom=this._map.transform.zoom+x.amount,Qn(g,x)}if(c.bearing){const x=ll(c.bearing,d,Ea);g.bearing=this._map.transform.bearing+y.clamp(x.amount,-179,179),Qn(g,x)}if(c.pitch){const x=ll(c.pitch,d,jo);g.pitch=this._map.transform.pitch+x.amount,Qn(g,x)}if(g.zoom||g.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.extend(g,{noMoveStart:!0})}}function Qn(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function ll(f,o,c){const{maxSpeed:d,linearity:g,deceleration:x}=c,C=y.clamp(f*g/(o/1e3),-d,d),E=Math.abs(C)/(x*g);return{easing:c.easing,duration:1e3*E,amount:C*(E/2)}}class In extends y.Event{constructor(o,c,d,g={}){const x=xe.mousePos(c.getCanvasContainer(),d),C=c.unproject(x);super(o,y.extend({point:x,lngLat:C,originalEvent:d},g)),this._defaultPrevented=!1,this.target=c}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class qr extends y.Event{constructor(o,c,d){const g="touchend"===o?d.changedTouches:d.touches,x=xe.touchPos(c.getCanvasContainer(),g),C=x.map(M=>c.unproject(M)),E=x.reduce((M,A,F,z)=>M.add(A.div(z.length)),new y.pointGeometry(0,0));super(o,{points:x,point:E,lngLats:C,lngLat:c.unproject(E),originalEvent:d}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Wr extends y.Event{constructor(o,c,d){super(o,{originalEvent:d}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Gl{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Wr(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new In(o.type,this._map,o))}mouseup(o){this._map.fire(new In(o.type,this._map,o))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new In(o.type,this._map,o))}dblclick(o){return this._firePreventable(new In(o.type,this._map,o))}mouseover(o){this._map.fire(new In(o.type,this._map,o))}mouseout(o){this._map.fire(new In(o.type,this._map,o))}touchstart(o){return this._firePreventable(new qr(o.type,this._map,o))}touchmove(o){this._map.fire(new qr(o.type,this._map,o))}touchend(o){this._map.fire(new qr(o.type,this._map,o))}touchcancel(o){this._map.fire(new qr(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ki{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new In(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new In("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new In(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ai{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&0===o.button&&(xe.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const d=c;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=xe.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(g.x,d.x),C=Math.max(g.x,d.x),E=Math.min(g.y,d.y),M=Math.max(g.y,d.y);xe.setTransform(this._box,`translate(${x}px,${E}px)`),this._box.style.width=C-x+"px",this._box.style.height=M-E+"px"}mouseupWindow(o,c){if(!this._active||0!==o.button)return;const d=this._startPos,g=c;if(this.reset(),xe.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(xe.remove(this._box),this._box=null),xe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new y.Event(o,{originalEvent:c}))}}function $o(f,o){if(f.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${o.length}`);const c={};for(let d=0;d<f.length;d++)c[f[d].identifier]=o[d];return c}class ql{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,c,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const x=new y.pointGeometry(0,0);for(const C of g)x._add(C);return x.div(g.length)}(c),this.touches=$o(d,c)))}touchmove(o,c,d){if(this.aborted||!this.centroid)return;const g=$o(d,c);for(const x in this.touches){const C=this.touches[x],E=g[x];(!E||E.dist(C)>30)&&(this.aborted=!0)}}touchend(o,c,d){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===d.length){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Zc{constructor(o){this.singleTap=new ql(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,c,d){this.singleTap.touchstart(o,c,d)}touchmove(o,c,d){this.singleTap.touchmove(o,c,d)}touchend(o,c,d){const g=this.singleTap.touchend(o,c,d);if(g){const x=o.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(x&&C||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class xd{constructor(){this._zoomIn=new Zc({numTouches:1,numTaps:2}),this._zoomOut=new Zc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,d){this._zoomIn.touchstart(o,c,d),this._zoomOut.touchstart(o,c,d)}touchmove(o,c,d){this._zoomIn.touchmove(o,c,d),this._zoomOut.touchmove(o,c,d)}touchend(o,c,d){const g=this._zoomIn.touchend(o,c,d),x=this._zoomOut.touchend(o,c,d);return g?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(g)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pf={0:1,2:2};class Xc{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const d=xe.mouseButton(o);this._correctButton(o,d)&&(this._lastPoint=c,this._eventButton=d)}mousemoveWindow(o,c){const d=this._lastPoint;if(d)if(o.preventDefault(),function(g,x){const C=pf[x];return void 0===g.buttons||(g.buttons&C)!==C}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(d,c)}mouseupWindow(o){this._lastPoint&&xe.mouseButton(o)===this._eventButton&&(this._moved&&xe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl extends Xc{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return 0===c&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class ds extends Xc{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const d=.8*(c.x-o.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(o){o.preventDefault()}}class Xe extends Xc{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const d=-.5*(c.y-o.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(o){o.preventDefault()}}class bd{constructor(o,c){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new y.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,c,d){return this._calculateTransform(o,c,d)}touchmove(o,c,d){if(this._map._cooperativeGestures&&(2===this._minTouches&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,c,d)}touchend(o,c,d){this._calculateTransform(o,c,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,d){d.length>0&&(this._active=!0);const g=$o(d,c),x=new y.pointGeometry(0,0),C=new y.pointGeometry(0,0);let E=0;for(const A in g){const F=g[A],z=this._touches[A];z&&(x._add(F),C._add(F.sub(z)),E++,g[A]=F)}if(this._touches=g,E<this._minTouches||!C.mag())return;const M=C.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(E),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ia{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,c,d){return{}}touchstart(o,c,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,d){if(!this._firstTwoTouches)return;o.preventDefault();const[g,x]=this._firstTwoTouches,C=Vs(d,c,g),E=Vs(d,c,x);if(!C||!E)return;const M=this._aroundCenter?null:C.add(E).div(2);return this._move([C,E],M,o)}touchend(o,c,d){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,C=Vs(d,c,g),E=Vs(d,c,x);C&&E||(this._active&&xe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vs(f,o,c){for(let d=0;d<f.length;d++)if(f[d].identifier===c)return o[d]}function ih(f,o){return Math.log(f/o)/Math.LN2}class je extends Ia{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const d=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(ih(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ih(this._distance,d),pinchAround:c}}}function Kc(f,o){return 180*f.angleWith(o)/Math.PI}class ff extends Ia{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const d=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Kc(this._vector,d),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,d=Kc(o,this._startVector);return Math.abs(d)<c}}function oh(f){return Math.abs(f.y)>Math.abs(f.x)}class sh extends Ia{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,c,d){super.touchstart(o,c,d),this._currentTouchCount=d.length}_start(o){this._lastPoints=o,oh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,d.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(o,c,d){if(void 0!==this._valid)return this._valid;const g=o.mag()>=2,x=c.mag()>=2;if(!g&&!x)return;if(!g||!x)return void 0===this._firstMove&&(this._firstMove=d),d-this._firstMove<100&&void 0;const C=o.y>0==c.y>0;return oh(o)&&oh(c)&&C}}const Jc={panStep:100,bearingStep:15,pitchStep:10};class Zl{constructor(){const o=Jc;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,d=0,g=0,x=0,C=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?d=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?d=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?g=1:(o.preventDefault(),C=-1);break;case 40:o.shiftKey?g=-1:(o.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:E=>{const M=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:mf,zoom:c?Math.round(M)+c*(o.shiftKey?2:1):M,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+g*this._pitchStep,offset:[-x*this._panStep,-C*this._panStep],center:E.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mf(f){return f*(2-f)}const wd=4.000244140625;class ah{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,y.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const d=y.exported.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,0!==c&&c%wd==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(g*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=xe.mousePos(this._el,o);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(0!==this._delta){const E="wheel"===this._type&&Math.abs(this._delta)>wd?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==M&&(M=1/M);const A="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(A*M))),"wheel"===this._type&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c="number"==typeof this._targetZoom?this._targetZoom:o.zoom,d=this._startZoom,g=this._easing;let x,C=!1;if("wheel"===this._type&&d&&g){const E=Math.min((y.exported.now()-this._lastWheelEventTime)/200,1),M=g(E);x=y.number(d,c,M),E<1?this._frameId||(this._frameId=!0):C=!0}else x=c,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:x-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=y.ease;if(this._prevEase){const d=this._prevEase,g=(y.exported.now()-d.start)/d.duration,x=d.easing(g+.01)-d.easing(g),C=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-C*C);c=y.bezier(C,E,.25,1)}return this._prevEase={start:y.exported.now(),duration:o,easing:c},c}reset(){this._active=!1}}class Ho{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yc{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,c){return o.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(o.shiftKey?-1:1),around:d.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zr{constructor(){this._tap=new Zc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,c,d){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=c[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(o,c,d))}touchmove(o,c,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=c[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,c,d)}touchend(o,c,d){this._tapTime?this._swipePoint&&0===d.length&&this.reset():this._tap.touchend(o,c,d)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xr{constructor(o,c,d){this._el=o,this._mousePan=c,this._touchPan=d}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ps{constructor(o,c,d){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lh{constructor(o,c,d,g){this._el=o,this._touchZoom=c,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Us=f=>f.zoom||f.drag||f.pitch||f.rotate;class Xl extends y.Event{}function cl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Kl{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hs(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),y.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,C]of this._listeners)xe.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[o,c,d]of this._listeners)xe.removeEventListener(o,c,o===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(o){const c=this._map,d=c.getCanvasContainer();this._add("mapEvent",new Gl(c,o));const g=c.boxZoom=new Ai(c,o);this._add("boxZoom",g);const x=new xd,C=new Yc;c.doubleClickZoom=new Ho(C,x),this._add("tapZoom",x),this._add("clickZoom",C);const E=new Zr;this._add("tapDragZoom",E);const M=c.touchPitch=new sh(c);this._add("touchPitch",M);const A=new ds(o),F=new Xe(o);c.dragRotate=new ps(o,A,F),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const z=new Wl(o),V=new bd(o,c);c.dragPan=new Xr(d,z,V),this._add("mousePan",z),this._add("touchPan",V,["touchZoom","touchRotate"]);const X=new ff,W=new je;c.touchZoomRotate=new lh(d,W,X,E),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]);const Z=c.scrollZoom=new ah(c,this);this._add("scrollZoom",Z,["mousePan"]);const re=c.keyboard=new Zl;this._add("keyboard",re),this._add("blockableMapEvent",new Ki(c));for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ae]&&c[ae].enable(o[ae])}_add(o,c,d){this._handlers.push({handlerName:o,handler:c,allowed:d}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Us(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,c,d){for(const g in o)if(g!==d&&(!c||c.indexOf(g)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const d of o)this._el.contains(d.target)&&c.push(d);return c}handleEvent(o,c){if("blur"===o.type)return void this.stop(!0);this._updatingCamera=!0;const d="renderFrame"===o.type?void 0:o,g={needsRenderFrame:!1},x={},C={},E=o.touches,M=E?this._getMapTouches(E):void 0,A=M?xe.touchPos(this._el,M):xe.mousePos(this._el,o);for(const{handlerName:V,handler:X,allowed:W}of this._handlers){if(!X.isEnabled())continue;let Z;this._blockedByActive(C,W,V)?X.reset():X[c||o.type]&&(Z=X[c||o.type](o,A,M),this.mergeHandlerResult(g,x,Z,V,d),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||X.isActive())&&(C[V]=X)}const F={};for(const V in this._previousActiveHandlers)C[V]||(F[V]=d);this._previousActiveHandlers=C,(Object.keys(F).length||cl(g))&&(this._changes.push([g,x,F]),this._triggerRenderFrame()),(Object.keys(C).length||cl(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=g;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(o,c,d,g,x){if(!d)return;y.extend(o,d);const C={handlerName:g,originalEvent:d.originalEvent||x};void 0!==d.zoomDelta&&(c.zoom=C),void 0!==d.panDelta&&(c.drag=C),void 0!==d.pitchDelta&&(c.pitch=C),void 0!==d.bearingDelta&&(c.rotate=C)}_applyChanges(){const o={},c={},d={};for(const[g,x,C]of this._changes)g.panDelta&&(o.panDelta=(o.panDelta||new y.pointGeometry(0,0))._add(g.panDelta)),g.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+g.pitchDelta),void 0!==g.around&&(o.around=g.around),void 0!==g.pinchAround&&(o.pinchAround=g.pinchAround),g.noInertia&&(o.noInertia=g.noInertia),y.extend(c,x),y.extend(d,C);this._updateMapTransform(o,c,d),this._changes=[]}_updateMapTransform(o,c,d){const g=this._map,x=g.transform,C=g.style&&g.style.terrain;if(!(cl(o)||C&&this._drag))return this._fireEvents(c,d,!0);let{panDelta:E,zoomDelta:M,bearingDelta:A,pitchDelta:F,around:z,pinchAround:V}=o;void 0!==V&&(z=V),g._stop(!0),z=z||g.transform.centerPoint;const X=x.pointLocation(E?z.sub(E):z);A&&(x.bearing+=A),F&&(x.pitch+=F),M&&(x.zoom+=M),C?c.drag&&!this._drag?(this._drag={center:x.centerPoint,lngLat:x.pointLocation(z),point:z,handlerName:c.drag.handlerName},g.fire(new y.Event("freezeElevation",{freeze:!0}))):this._drag&&d[this._drag.handlerName]?(g.fire(new y.Event("freezeElevation",{freeze:!1})),this._drag=null):c.drag&&this._drag&&(x.center=x.pointLocation(x.centerPoint.sub(E))):x.setLocationAtPoint(X,z),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,d,!0)}_fireEvents(o,c,d){const g=Us(this._eventsInProgress),x=Us(o),C={};for(const F in o){const{originalEvent:z}=o[F];this._eventsInProgress[F]||(C[`${F}start`]=z),this._eventsInProgress[F]=o[F]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in C)this._fireEvent(F,C[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in o){const{originalEvent:z}=o[F];this._fireEvent(F,z)}const E={};let M;for(const F in this._eventsInProgress){const{handlerName:z,originalEvent:V}=this._eventsInProgress[F];this._handlersById[z].isActive()||(delete this._eventsInProgress[F],M=c[z]||V,E[`${F}end`]=M)}for(const F in E)this._fireEvent(F,E[F]);const A=Us(this._eventsInProgress);if(d&&(g||x)&&!A){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;F?(z(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:M})):(this._map.fire(new y.Event("moveend",{originalEvent:M})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new y.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Xl("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Pi={extend:(f,...o)=>y.extend(f,...o),run(f){f()},logToElement(f,o=!1,c="log"){const d=window.document.getElementById(c);d&&(o&&(d.innerHTML=""),d.innerHTML+=`<br>${f}`)}};class Gt extends y.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}getCenter(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,d){return o=y.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,y.extend({offset:o},c),d)}panTo(o,c,d){return this.easeTo(y.extend({center:o},c),d)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,d){return this.easeTo(y.extend({zoom:o},c),d)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,d){return this.easeTo(y.extend({bearing:o},c),d)}resetNorth(o,c){return this.rotateTo(0,y.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=y.LngLatBounds.convert(o);const d=c&&c.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),d,c)}_cameraForBoxAndBearing(o,c,d,g){const x={top:0,bottom:0,right:0,left:0};if("number"==typeof(g=y.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding){const ue=g.padding;g.padding={top:ue,bottom:ue,right:ue,left:ue}}g.padding=y.extend(x,g.padding);const C=this.transform,E=C.padding,M=C.project(y.LngLat.convert(o)),A=C.project(y.LngLat.convert(c)),F=M.rotate(-d*Math.PI/180),z=A.rotate(-d*Math.PI/180),V=new y.pointGeometry(Math.max(F.x,z.x),Math.max(F.y,z.y)),X=new y.pointGeometry(Math.min(F.x,z.x),Math.min(F.y,z.y)),W=V.sub(X),Z=(C.width-(E.left+E.right+g.padding.left+g.padding.right))/W.x,re=(C.height-(E.top+E.bottom+g.padding.top+g.padding.bottom))/W.y;if(re<0||Z<0)return void y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(C.scaleZoom(C.scale*Math.min(Z,re)),g.maxZoom),he=y.pointGeometry.convert(g.offset),K=new y.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),pe=he.add(K).mult(C.scale/C.zoomScale(ae));return{center:C.unproject(M.add(A).div(2).sub(pe)),zoom:ae,bearing:d}}fitBounds(o,c,d){return this._fitInternal(this.cameraForBounds(o,c),c,d)}fitScreenCoordinates(o,c,d,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.pointGeometry.convert(o)),this.transform.pointLocation(y.pointGeometry.convert(c)),d,g),g,x)}_fitInternal(o,c,d){return o?(delete(c=y.extend(o,c)).padding,c.linear?this.easeTo(c,d):this.flyTo(c,d)):this}jumpTo(o,c){this.stop();const d=this.transform;let g=!1,x=!1,C=!1;return"zoom"in o&&d.zoom!==+o.zoom&&(g=!0,d.zoom=+o.zoom),void 0!==o.center&&(d.center=y.LngLat.convert(o.center)),"bearing"in o&&d.bearing!==+o.bearing&&(x=!0,d.bearing=+o.bearing),"pitch"in o&&d.pitch!==+o.pitch&&(C=!0,d.pitch=+o.pitch),null==o.padding||d.isPaddingEqual(o.padding)||(d.padding=o.padding),this.fire(new y.Event("movestart",c)).fire(new y.Event("move",c)),g&&this.fire(new y.Event("zoomstart",c)).fire(new y.Event("zoom",c)).fire(new y.Event("zoomend",c)),x&&this.fire(new y.Event("rotatestart",c)).fire(new y.Event("rotate",c)).fire(new y.Event("rotateend",c)),C&&this.fire(new y.Event("pitchstart",c)).fire(new y.Event("pitch",c)).fire(new y.Event("pitchend",c)),this.fire(new y.Event("moveend",c))}calculateCameraOptionsFromTo(o,c,d,g=0){const x=y.MercatorCoordinate.fromLngLat(o,c),C=y.MercatorCoordinate.fromLngLat(d,g),E=C.x-x.x,M=C.y-x.y,A=C.z-x.z,F=Math.hypot(E,M,A);if(0===F)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(E,M),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),X=180*Math.atan2(E,-M)/Math.PI;let W=180*Math.acos(z/F)/Math.PI;return W=A<0?90-W:90+W,{center:C.toLngLat(),zoom:V,pitch:W,bearing:X}}easeTo(o,c){this._stop(!1,o.easeId),(!1===(o=y.extend({offset:[0,0],duration:500,easing:y.ease},o)).animate||!o.essential&&y.exported.prefersReducedMotion)&&(o.duration=0);const d=this.transform,g=this.getZoom(),x=this.getBearing(),C=this.getPitch(),E=this.getPadding(),M="zoom"in o?+o.zoom:g,A="bearing"in o?this._normalizeBearing(o.bearing,x):x,F="pitch"in o?+o.pitch:C,z="padding"in o?o.padding:d.padding,V=y.pointGeometry.convert(o.offset);let X=d.centerPoint.add(V);const W=d.pointLocation(X),Z=y.LngLat.convert(o.center||W);this._normalizeCenter(Z);const re=d.project(W),ae=d.project(Z).sub(re),he=d.zoomScale(M-g);let K,pe;o.around&&(K=y.LngLat.convert(o.around),pe=d.locationPoint(K));const ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==g,this._rotating=this._rotating||x!==A,this._pitching=this._pitching||F!==C,this._padding=!d.isPaddingEqual(z),this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,ue),this._ease(_e=>{if(this._zooming&&(d.zoom=y.number(g,M,_e)),this._rotating&&(d.bearing=y.number(x,A,_e)),this._pitching&&(d.pitch=y.number(C,F,_e)),this._padding&&(d.interpolatePadding(E,z,_e),X=d.centerPoint.add(V)),K)d.setLocationAtPoint(K,pe);else{const be=d.zoomScale(d.zoom-g),Se=M>g?Math.min(2,he):Math.max(.5,he),me=Math.pow(Se,1-_e),He=d.unproject(re.add(ae.mult(_e*me)).mult(be));d.setLocationAtPoint(d.renderWorldCopies?He.wrap():He,X)}this._fireMoveEvents(c)},_e=>{this._afterEase(c,_e)},o),this}_prepareEase(o,c,d={}){this._moving=!0,this.fire(new y.Event("freezeElevation",{freeze:!0})),c||d.moving||this.fire(new y.Event("movestart",o)),this._zooming&&!d.zooming&&this.fire(new y.Event("zoomstart",o)),this._rotating&&!d.rotating&&this.fire(new y.Event("rotatestart",o)),this._pitching&&!d.pitching&&this.fire(new y.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new y.Event("move",o)),this._zooming&&this.fire(new y.Event("zoom",o)),this._rotating&&this.fire(new y.Event("rotate",o)),this._pitching&&this.fire(new y.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.fire(new y.Event("freezeElevation",{freeze:!1}));const d=this._zooming,g=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new y.Event("zoomend",o)),g&&this.fire(new y.Event("rotateend",o)),x&&this.fire(new y.Event("pitchend",o)),this.fire(new y.Event("moveend",o))}flyTo(o,c){if(!o.essential&&y.exported.prefersReducedMotion){const rt=y.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(rt,c)}this.stop(),o=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},o);const d=this.transform,g=this.getZoom(),x=this.getBearing(),C=this.getPitch(),E=this.getPadding(),M="zoom"in o?y.clamp(+o.zoom,d.minZoom,d.maxZoom):g,A="bearing"in o?this._normalizeBearing(o.bearing,x):x,F="pitch"in o?+o.pitch:C,z="padding"in o?o.padding:d.padding,V=d.zoomScale(M-g),X=y.pointGeometry.convert(o.offset);let W=d.centerPoint.add(X);const Z=d.pointLocation(W),re=y.LngLat.convert(o.center||Z);this._normalizeCenter(re);const ae=d.project(Z),he=d.project(re).sub(ae);let K=o.curve;const pe=Math.max(d.width,d.height),ue=pe/V,_e=he.mag();if("minZoom"in o){const rt=y.clamp(Math.min(o.minZoom,g,M),d.minZoom,d.maxZoom),ln=pe/d.zoomScale(rt-g);K=Math.sqrt(ln/_e*2)}const be=K*K;function Se(rt){const ln=(ue*ue-pe*pe+(rt?-1:1)*be*be*_e*_e)/(2*(rt?ue:pe)*be*_e);return Math.log(Math.sqrt(ln*ln+1)-ln)}function me(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function He(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const Re=Se(0);let qe=function(rt){return He(Re)/He(Re+K*rt)},xt=function(rt){return pe*((He(Re)*(me(ln=Re+K*rt)/He(ln))-me(Re))/be)/_e;var ln},Dt=(Se(1)-Re)/K;if(Math.abs(_e)<1e-6||!isFinite(Dt)){if(Math.abs(pe-ue)<1e-6)return this.easeTo(o,c);const rt=ue<pe?-1:1;Dt=Math.abs(Math.log(ue/pe))/K,xt=function(){return 0},qe=function(ln){return Math.exp(rt*K*ln)}}return o.duration="duration"in o?+o.duration:1e3*Dt/("screenSpeed"in o?+o.screenSpeed/K:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=x!==A,this._pitching=F!==C,this._padding=!d.isPaddingEqual(z),this._prepareEase(c,!1),this._ease(rt=>{const ln=rt*Dt,tn=1/qe(ln);d.zoom=1===rt?M:g+d.scaleZoom(tn),this._rotating&&(d.bearing=y.number(x,A,rt)),this._pitching&&(d.pitch=y.number(C,F,rt)),this._padding&&(d.interpolatePadding(E,z,rt),W=d.centerPoint.add(X));const Bt=1===rt?re:d.unproject(ae.add(he.mult(xt(ln))).mult(tn));d.setLocationAtPoint(d.renderWorldCopies?Bt.wrap():Bt,W),this._fireMoveEvents(c)},()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,c)}if(!o){const d=this.handlers;d&&d.stop(!1)}return this}_ease(o,c,d){!1===d.animate||0===d.duration?(o(1),c()):(this._easeStart=y.exported.now(),this._easeOptions=d,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((y.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=y.wrap(o,-180,180);const d=Math.abs(o-c);return Math.abs(o-360-c)<d&&(o-=360),Math.abs(o+360-c)<d&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const d=o.lng-c.center.lng;o.lng+=d>180?-360:d<-180?360:0}}class js{constructor(o={}){this.options=o,y.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=xe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xe.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){xe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const d=this._map._getUIString(`AttributionControl.${c}`);o.title=d,o.setAttribute("aria-label",d)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType&&"terrain"!==o.type||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(g=>"string"!=typeof g?"":g)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const c=this._map.style.sourceCaches;for(const g in c){const x=c[g];if(x.used||x.usedForTerrain){const C=x.getSource();C.attribution&&o.indexOf(C.attribution)<0&&o.push(C.attribution)}}o=o.filter(g=>String(g).trim()),o.sort((g,x)=>g.length-x.length),o=o.filter((g,x)=>{for(let C=x+1;C<o.length;C++)if(o[C].indexOf(g)>=0)return!1;return!0});const d=o.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,o.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Jl{constructor(o={}){this.options=o,y.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=xe.create("div","maplibregl-ctrl mapboxgl-ctrl");const c=xe.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){xe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&c.classList.add("maplibregl-compact","mapboxgl-compact"):c.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,d=c?this._queue.concat(c):this._queue;for(const g of d)if(g.id===o)return void(g.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const d of c)if(!d.cancelled&&(d.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ch={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Cd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},er={showCompass:!0,showZoom:!0,visualizePitch:!1};class yo{constructor(o,c,d=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new ds({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,d&&(this.mousePitch=new Xe({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),xe.addEventListener(c,"mousedown",this.mousedown),xe.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),xe.addEventListener(c,"touchmove",this.touchmove),xe.addEventListener(c,"touchend",this.touchend),xe.addEventListener(c,"touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),xe.disableDrag()}move(o,c){const d=this.map,g=this.mouseRotate.mousemoveWindow(o,c);if(g&&g.bearingDelta&&d.setBearing(d.getBearing()+g.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,c);x&&x.pitchDelta&&d.setPitch(d.getPitch()+x.pitchDelta)}}off(){const o=this.element;xe.removeEventListener(o,"mousedown",this.mousedown),xe.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),xe.removeEventListener(o,"touchmove",this.touchmove),xe.removeEventListener(o,"touchend",this.touchend),xe.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){xe.enableDrag(),xe.removeEventListener(window,"mousemove",this.mousemove),xe.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(y.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),xe.mousePos(this.element,o)),xe.addEventListener(window,"mousemove",this.mousemove),xe.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,xe.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=xe.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=xe.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ql(f,o,c){if(f=new y.LngLat(f.lng,f.lat),o){const d=new y.LngLat(f.lng-360,f.lat),g=new y.LngLat(f.lng+360,f.lat),x=c.locationPoint(f).distSqr(o);c.locationPoint(d).distSqr(o)<x?f=d:c.locationPoint(g).distSqr(o)<x&&(f=g)}for(;Math.abs(f.lng-c.center.lng)>180;){const d=c.locationPoint(f);if(d.x>=0&&d.y>=0&&d.x<=c.width&&d.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const Je={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function et(f,o,c){const d=f.classList;for(const g in Je)d.remove(`maplibregl-${c}-anchor-${g}`,`mapboxgl-${c}-anchor-${g}`);d.add(`maplibregl-${c}-anchor-${o}`,`mapboxgl-${c}-anchor-${o}`)}class Sa extends y.Evented{constructor(o,c){if(super(),(o instanceof HTMLElement||c)&&(o=y.extend({element:o},c)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=y.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=xe.create("div"),this._element.setAttribute("aria-label","Map marker");const d=xe.createNS("http://www.w3.org/2000/svg","svg"),g=41,x=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${g}px`),d.setAttributeNS(null,"width",`${x}px`),d.setAttributeNS(null,"viewBox",`0 0 ${x} ${g}`);const C=xe.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const E=xe.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const M=xe.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const he of A){const K=xe.createNS("http://www.w3.org/2000/svg","ellipse");K.setAttributeNS(null,"opacity","0.04"),K.setAttributeNS(null,"cx","10.5"),K.setAttributeNS(null,"cy","5.80029008"),K.setAttributeNS(null,"rx",he.rx),K.setAttributeNS(null,"ry",he.ry),M.appendChild(K)}const F=xe.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const z=xe.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(z);const V=xe.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const X=xe.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild(X);const W=xe.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(6.0, 7.0)"),W.setAttributeNS(null,"fill","#FFFFFF");const Z=xe.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=xe.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const ae=xe.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),Z.appendChild(re),Z.appendChild(ae),E.appendChild(M),E.appendChild(F),E.appendChild(V),E.appendChild(W),E.appendChild(Z),d.appendChild(E),d.setAttributeNS(null,"height",g*this._scale+"px"),d.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(d),this._offset=y.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),et(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),xe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=y.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const c=o.code,d=o.charCode||o.keyCode;"Space"!==c&&"Enter"!==c&&32!==d&&13!==d||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ql(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?d="rotateX(0deg)":"map"===this._pitchAlignment&&(d=`rotateX(${this._map.getPitch()}deg)`),o&&"moveend"!==o.type||(this._pos=this._pos.round()),xe.setTransform(this._element,`${Je[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const g=this._map.unproject(this._pos),x=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=g.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=y.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new y.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ul={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let gi,bn=0,fs=!1;const yi={maxWidth:100,unit:"metric"};function uh(f,o,c){const d=c&&c.maxWidth||100,g=f._container.clientHeight/2,x=f.unproject([0,g]),C=f.unproject([d,g]),E=x.distanceTo(C);if(c&&"imperial"===c.unit){const M=3.2808*E;M>5280?Kr(o,d,M/5280,f._getUIString("ScaleControl.Miles")):Kr(o,d,M,f._getUIString("ScaleControl.Feet"))}else c&&"nautical"===c.unit?Kr(o,d,E/1852,f._getUIString("ScaleControl.NauticalMiles")):E>=1e3?Kr(o,d,E/1e3,f._getUIString("ScaleControl.Kilometers")):Kr(o,d,E,f._getUIString("ScaleControl.Meters"))}function Kr(f,o,c,d){const g=function(x){const C=Math.pow(10,`${Math.floor(x)}`.length-1);let E=x/C;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(M){const A=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*A)/A}(E),C*E}(c);f.style.width=o*(g/c)+"px",f.innerHTML=`${g}&nbsp;${d}`}const jn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vt(f){if(f){if("number"==typeof f){const o=Math.round(Math.sqrt(.5*Math.pow(f,2)));return{center:new y.pointGeometry(0,0),top:new y.pointGeometry(0,f),"top-left":new y.pointGeometry(o,o),"top-right":new y.pointGeometry(-o,o),bottom:new y.pointGeometry(0,-f),"bottom-left":new y.pointGeometry(o,-o),"bottom-right":new y.pointGeometry(-o,-o),left:new y.pointGeometry(f,0),right:new y.pointGeometry(-f,0)}}if(f instanceof y.pointGeometry||Array.isArray(f)){const o=y.pointGeometry.convert(f);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:y.pointGeometry.convert(f.center||[0,0]),top:y.pointGeometry.convert(f.top||[0,0]),"top-left":y.pointGeometry.convert(f["top-left"]||[0,0]),"top-right":y.pointGeometry.convert(f["top-right"]||[0,0]),bottom:y.pointGeometry.convert(f.bottom||[0,0]),"bottom-left":y.pointGeometry.convert(f["bottom-left"]||[0,0]),"bottom-right":y.pointGeometry.convert(f["bottom-right"]||[0,0]),left:y.pointGeometry.convert(f.left||[0,0]),right:y.pointGeometry.convert(f.right||[0,0])}}return vt(new y.pointGeometry(0,0))}const ms={supported:Hn,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:class extends Gt{constructor(f){var o;if(y.PerformanceUtils.mark(y.PerformanceMarkers.create),null!=(f=y.extend({},Cd,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fn(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Yl,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},ch,f.locale),this._clickTolerance=f.clickTolerance,this._pixelRatio=null!==(o=f.pixelRatio)&&void 0!==o?o:devicePixelRatio,this._requestManager=new Mo(f.transformRequest),"string"==typeof f.container){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Kl(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new rh("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,y.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new js({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new Jl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new y.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new y.Event(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new y.Event("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(f,o){if(void 0===o&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const d=this._controlPositions[o];return-1!==o.indexOf("bottom")?d.insertBefore(c,d.firstChild):d.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,o,c,d){return null==d&&this.style.terrain&&(d=this.transform.getElevation(c,this.style.terrain)),super.calculateCameraOptionsFromTo(f,o,c,d)}resize(f){const o=this._containerDimensions(),c=o[0],d=o[1];this._resizeCanvas(c,d,this.getPixelRatio()),this.transform.resize(c,d),this.painter.resize(c,d,this.getPixelRatio());const g=!this._moving;return g&&(this.stop(),this.fire(new y.Event("movestart",f)).fire(new y.Event("move",f))),this.fire(new y.Event("resize",f)),g&&this.fire(new y.Event("moveend",f)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(f){const[o,c]=this._containerDimensions();this._pixelRatio=f,this._resizeCanvas(o,c,f),this.painter.resize(o,c,f)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(y.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(y.LngLat.convert(f),this.style&&this.style.terrain)}unproject(f){return this.transform.pointLocation(y.pointGeometry.convert(f),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(f,o,c){if("mouseenter"===f||"mouseover"===f){let d=!1;return{layer:o,listener:c,delegates:{mousemove:x=>{const C=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];C.length?d||(d=!0,c.call(this,new In(f,this,x.originalEvent,{features:C}))):d=!1},mouseout:()=>{d=!1}}}}if("mouseleave"===f||"mouseout"===f){let d=!1;return{layer:o,listener:c,delegates:{mousemove:C=>{(this.getLayer(o)?this.queryRenderedFeatures(C.point,{layers:[o]}):[]).length?d=!0:d&&(d=!1,c.call(this,new In(f,this,C.originalEvent)))},mouseout:C=>{d&&(d=!1,c.call(this,new In(f,this,C.originalEvent)))}}}}{const d=g=>{const x=this.getLayer(o)?this.queryRenderedFeatures(g.point,{layers:[o]}):[];x.length&&(g.features=x,c.call(this,g),delete g.features)};return{layer:o,listener:c,delegates:{[f]:d}}}}on(f,o,c){if(void 0===c)return super.on(f,o);const d=this._createDelegatedListener(f,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(f,o,c){if(void 0===c)return super.once(f,o);const d=this._createDelegatedListener(f,o,c);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(f,o,c){return void 0===c?super.off(f,o):(this._delegatedListeners&&this._delegatedListeners[f]&&(d=>{const g=this._delegatedListeners[f];for(let x=0;x<g.length;x++){const C=g[x];if(C.layer===o&&C.listener===c){for(const E in C.delegates)this.off(E,C.delegates[E]);return g.splice(x,1),this}}})(),this)}queryRenderedFeatures(f,o){if(!this.style)return[];let c;if(void 0!==o||void 0===f||f instanceof y.pointGeometry||Array.isArray(f)||(o=f,f=void 0),o=o||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof y.pointGeometry||"number"==typeof f[0])c=[y.pointGeometry.convert(f)];else{const d=y.pointGeometry.convert(f[0]),g=y.pointGeometry.convert(f[1]);c=[d,new y.pointGeometry(g.x,d.y),g,new y.pointGeometry(d.x,g.y),d]}return this.style.queryRenderedFeatures(c,o,this.transform)}querySourceFeatures(f,o){return this.style.querySourceFeatures(f,o)}setStyle(f,o){return!1!==(o=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(f,o))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const o=this._locale[f];if(null==o)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new Sr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,o){if("string"==typeof f){const c=this._requestManager.transformRequest(f,y.ResourceType.Style);y.getJSON(c,(d,g)=>{d?this.fire(new y.ErrorEvent(d)):g&&this._updateDiff(g,o)})}else"object"==typeof f&&this._updateDiff(f,o)}_updateDiff(f,o){try{this.style.setState(f)&&this._update(!0)}catch(c){y.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")}addSource(f,o){return this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)}isSourceLoaded(f){const o=this.style&&this.style.sourceCaches[f];if(void 0!==o)return o.loaded();this.fire(new y.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){return this.style.setTerrain(f),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const o in f){const c=f[o]._tiles;for(const d in c){const g=c[d];if("loaded"!==g.state&&"errored"!==g.state)return!1}}return!0}addSourceType(f,o,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,c)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,o,{pixelRatio:c=1,sdf:d=!1,stretchX:g,stretchY:x,content:C}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||y.isImageBitmap(o)){const{width:E,height:M,data:A}=y.exported.getImageData(o);this.style.addImage(f,{data:new y.RGBAImage({width:E,height:M},A),pixelRatio:c,stretchX:g,stretchY:x,content:C,sdf:d,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:M,data:A}=o,F=o;this.style.addImage(f,{data:new y.RGBAImage({width:E,height:M},new Uint8Array(A)),pixelRatio:c,stretchX:g,stretchY:x,content:C,sdf:d,version:0,userImage:F}),F.onAdd&&F.onAdd(this,f)}}}updateImage(f,o){const c=this.style.getImage(f);if(!c)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=o instanceof HTMLImageElement||y.isImageBitmap(o)?y.exported.getImageData(o):o,{width:g,height:x,data:C}=d;if(void 0===g||void 0===x)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==c.data.width||x!==c.data.height)return this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(o instanceof HTMLImageElement||y.isImageBitmap(o));c.data.replace(C,E),this.style.updateImage(f,c)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){y.getImage(this._requestManager.transformRequest(f,y.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(f,o){return this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)}moveLayer(f,o){return this.style.moveLayer(f,o),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,o,c){return this.style.setLayerZoomRange(f,o,c),this._update(!0)}setFilter(f,o,c={}){return this.style.setFilter(f,o,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,o,c,d={}){return this.style.setPaintProperty(f,o,c,d),this._update(!0)}getPaintProperty(f,o){return this.style.getPaintProperty(f,o)}setLayoutProperty(f,o,c,d={}){return this.style.setLayoutProperty(f,o,c,d),this._update(!0)}getLayoutProperty(f,o){return this.style.getLayoutProperty(f,o)}setLight(f,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,o){return this.style.setFeatureState(f,o),this._update()}removeFeatureState(f,o){return this.style.removeFeatureState(f,o),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,o=0;return this._container&&(f=this._container.clientWidth||400,o=this._container.clientHeight||300),[f,o]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=xe.create("div","maplibregl-canvas-container mapboxgl-canvas-container",f);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=xe.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1],this.getPixelRatio());const d=this._controlContainer=xe.create("div","maplibregl-control-container mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=xe.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const f=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=xe.create("div","maplibregl-cooperative-gesture-screen",f);let o="Control",c="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(c="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${c}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,document.addEventListener("keydown",d=>{d.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",d=>{d.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",d=>{this._onCooperativeGesture(d,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(f,o,c){this._canvas.width=c*f,this._canvas.height=c*o,this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const f=y.extend({},Hn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);o?(this.painter=new us(o,this.transform),y.exported$1.testSupport(o)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(f,o,c){return!o&&c<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){let o,c=0;const d=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,o),c=y.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,E=y.exported.now();this.style.zoomHistory.update(C,E);const M=new y.EvaluationParameters(C,{now:E,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=M.crossFadingFactor();1===A&&A===this._crossFadingFactor||(g=!0,this._crossFadingFactor=A),this.style.update(M)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,y.PerformanceUtils.mark(y.PerformanceMarkers.load),this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const C=y.exported.now()-c;d.endQueryEXT(d.TIME_ELAPSED_EXT,o),setTimeout(()=>{const E=d.getQueryObjectEXT(o,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(o),this.fire(new y.Event("gpu-timing-frame",{cpuTime:C,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(C);this.fire(new y.Event("gpu-timing-layer",{layerTimes:E}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,y.PerformanceUtils.mark(y.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),xe.remove(this._canvasContainer),xe.remove(this._controlContainer),this._cooperativeGestures&&xe.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),y.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new y.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=y.exported.frame(f=>{y.PerformanceUtils.frame(f),this._frame=null,this._render(f)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,o){y.setCacheLimits(f,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(f){this.options=y.extend({},er,f),this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map.getZoom(),o=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=f}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){xe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,o){const c=xe.create("button",f,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(f,o){const c=this._map._getUIString(`NavigationControl.${o}`);f.title=c,f.setAttribute("aria-label",c)}},GeolocateControl:class extends y.Evented{constructor(f){super(),this.options=y.extend({},ul,f),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(f){var o;return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==gi?o(gi):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(c=>{gi="denied"!==c.state,o(gi)}):(gi=!!window.navigator.geolocation,o(gi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),xe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,bn=0,fs=!1}_isOutOfMapMaxBounds(f){const o=this._map.getMaxBounds(),c=f.coords;return o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",f)),this._finish()}}_updateCamera(f){const o=new y.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,d=this._map.getBearing(),g=y.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),g,{geolocateSource:!0})}_updateMarker(f){if(f){const o=new y.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.clientHeight/2,o=this._map.unproject([0,f]),c=this._map.unproject([1,f]),d=o.distanceTo(c),g=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&fs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=xe.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Sa(this._dotElement),this._circleElement=xe.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Sa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new y.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bn--,fs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),bn++,bn>1?(f={maximumAge:6e5,timeout:0},fs=!0):(f=this.options.positionOptions,fs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:js,LogoControl:Jl,ScaleControl:class{constructor(f){this.options=y.extend({},yi,f),y.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){uh(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){xe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,uh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){xe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=xe.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(f){this.options=f,y.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(f){return this._map=f,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=xe.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){xe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends y.Evented{constructor(f){super(),this.options=y.extend(Object.create(jn),f),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&xe.remove(this._content),this._container&&(xe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const o=document.createDocumentFragment(),c=document.createElement("body");let d;for(c.innerHTML=f;d=c.firstChild,d;)o.appendChild(d);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=xe.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=xe.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_update(f){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=xe.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=xe.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ql(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!f))return;const o=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat);let c=this.options.anchor;const d=vt(this.options.offset);if(!c){const x=this._container.offsetWidth,C=this._container.offsetHeight;let E;E=o.y+d.bottom.y<C?["top"]:o.y>this._map.transform.height-C?["bottom"]:[],o.x<x/2?E.push("left"):o.x>this._map.transform.width-x/2&&E.push("right"),c=0===E.length?"bottom":E.join("-")}const g=o.add(d[c]).round();xe.setTransform(this._container,`${Je[c]} translate(${g.x}px,${g.y}px)`),et(this._container,c,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Gn);f&&f.focus()}_onClose(){this.remove()}},Marker:Sa,Style:Sr,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.pointGeometry,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,AJAXError:y.AJAXError,config:y.config,CanvasSource:es,GeoJSONSource:Ur,ImageSource:Ei,RasterDEMTileSource:at,RasterTileSource:uo,VectorTileSource:ca,VideoSource:on,prewarm:function(){Za().acquire(qi)},clearPrewarmedResources:function(){const f=As;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(qi),As=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Ii.workerCount},set workerCount(f){Ii.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){y.clearTileCache(f)},workerUrl:"",addProtocol(f,o){y.config.REGISTERED_PROTOCOLS[f]=o},removeProtocol(f){delete y.config.REGISTERED_PROTOCOLS[f]}};return Pi.extend(ms,{isSafari:y.isSafari,getPerformanceMetrics:y.PerformanceUtils.getPerformanceMetrics}),ms}),Tn}()}},md=>{md(md.s=667)}]);